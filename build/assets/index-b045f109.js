var fe=Object.defineProperty,je=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var U=(e,t,n)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))Se.call(t,n)&&U(e,n,t[n]);if(O)for(var n of O(t))ye.call(t,n)&&U(e,n,t[n]);return e},w=(e,t)=>je(e,Ce(t));var v=(e,t,n)=>new Promise((o,r)=>{var u=l=>{try{a(n.next(l))}catch(F){r(F)}},h=l=>{try{a(n.throw(l))}catch(F){r(F)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(u,h);a((n=n.apply(e,t)).next())});import{p as c,e as Q,x as i,s as d,r as f,j as s,n as j,bs as X,h as $,v as D,a5 as we,K as ve,cN as ke,c as $e}from"./vendor-0c8c29fe.js";import{m as Ee,n as Ge,d as Y,o as be,p as Ie,q as E,u as I,h as Z,r as P,t as J,v as ee,w as te,x as Pe,y as Ne,z as Fe,D as De,b as Te,E as Ae,G as m,K as C,H as Le,J as Re,L as k,N as Me,O as _e,Q as ze,R as qe,U as Oe,V as Ue,X as We,M as Ve,Y as He,Z as Be,_ as Ke,P as Qe,a0 as Xe}from"./index-179b6f61.js";import{e as T,s as Ye,a as Ze,b as se,c as S,d as Je,f as A,h as ne,g as et,A as tt,i as b,j as st,k as nt,P as W}from"./student-c7cfca95.js";const oe=c({name:"addCompetition",sid:"ebmam4"}),G=Q(e=>Ee(e.competitionName),{name:"addCompetitionFx",sid:"-cvy5ax"});i({and:[{clock:oe,target:G}],or:{sid:"-pbpeie"}});i({and:[{clock:G.failData,fn:e=>({message:Ge(e,"Не удалось добавить соревнование"),type:"failure",time:3e3}),target:Y.evokePopUpMessage}],or:{sid:"-p9i84y"}});i({and:[{clock:G.doneData,fn:()=>({message:"Соревнование добавлено",type:"success",time:3e3}),target:Y.evokePopUpMessage}],or:{sid:"-orwt5e"}});i({and:[{clock:G.doneData,target:T.load}],or:{sid:"-oabe5u"}});i({and:[{clock:G.doneData,target:be.close}],or:{sid:"-nwkjbt"}});const ot=d.div.withConfig({componentId:"sc-apfm2h-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;justify-content:center;min-height:300px;@media (max-width:800px){min-height:40vh;}"]),at=()=>{const[e,t]=f.useState(""),n=()=>{oe({competitionName:e})};return s.jsxs(ot,{children:[s.jsx(Ie,{title:"Название",setValue:t,value:e}),s.jsx(E,{text:"Добавить",onClick:n})]})},it=[{field:"name",title:"Название"},{field:"name",title:"",render:e=>s.jsx(E,{onClick:()=>T.remove(e),text:"Удалить"})}],rt=d.div.withConfig({componentId:"sc-17yyi1s-0"})(["width:100%;display:flex;flex-direction:column;gap:10px;margin-top:20px;"]),dt=d.div.withConfig({componentId:"sc-17yyi1s-1"})(["display:flex;flex-direction:column;width:100%;gap:10px;"]);d.div.withConfig({componentId:"sc-17yyi1s-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;gap:10px;"]);const lt=()=>{const[e]=j([Ye.$competitions]),{open:t}=I(),n=()=>{t(s.jsx(at,{}))};return f.useEffect(()=>{T.load()},[]),s.jsx(dt,{children:s.jsxs(rt,{children:[s.jsx(Z,{align:"left",size:4,children:"Соревнования"}),s.jsx(E,{onClick:n,text:"Добавить соревнование"}),s.jsx(P,{data:e.map(o=>({name:o})),columns:it,onRowClick:()=>{}})]})})},ct=d.div.withConfig({componentId:"sc-12vwvep-0"})(["display:flex;flex-direction:row;align-items:center;gap:10px;@media (max-width:768px){flex-wrap:wrap;}"]);var ae=(e=>(e.Group="group.groupName",e.Course="course",e))(ae||{});const V=[{id:0,title:"Не выбрано"},{id:1,title:"1 курс"},{id:2,title:"2 курс"},{id:3,title:"3 курс"},{id:4,title:"4 курс"}],pt=()=>{var r,u,h;const[e,t]=j([Ze.$filters,se.$isExam]),[n,o]=f.useState((u=(r=e["group.groupName"])==null?void 0:r.value)!=null?u:"");return s.jsxs(ct,{children:[s.jsx(J,{leftIcon:s.jsx(X,{}),placeholder:"Номер группы",value:n,setValue:o,customMask:ee.groupMask,onValueEmpty:()=>S.addFilter({name:"group.groupName",value:""}),onHintClick:a=>{var l;return S.addFilter({name:"group.groupName",value:(l=a==null?void 0:a.id)!=null?l:"",strict:!0})},request:te,size:"big"}),s.jsx(Pe,{items:V,size:"big",placeholder:"Курс",selected:(h=V.find(a=>{var l;return a.id===((l=e.course)==null?void 0:l.value)}))!=null?h:null,setSelected:a=>{if(a!=null&&a.id){S.addFilter({name:"course",value:a.id});return}S.addFilter({name:"course",value:""})}}),s.jsx(Ne,{title:"Зачет",state:t,action:a=>Je.setIsExam(a)})]})},L=c({name:"pageIndexChanged",sid:"-yqoz9l"}),ie=c({name:"pageLoaded",sid:"adwljo"}),ut=$(0,{name:"$page",sid:"ndbopj"}).on(L,(e,t)=>t);i({and:[{clock:ie,target:[A.load,Fe.load]}],or:{sid:"8a9ft4"}});const re=c({name:"load",sid:"h6031v"}),de=D({and:{effect:t=>v(void 0,[t],function*({currentUser:e}){var o;const{data:n}=yield De((o=e==null?void 0:e.guid)!=null?o:"");return n.data}),source:Te.user},or:{name:"loadFx",sid:"-fzko9u"}});i({and:[{clock:re,target:de}],or:{sid:"-b03ras"}});const mt=$([],{name:"$myGroups",sid:"qqeqg2"}).on(de.doneData,(e,t)=>t);function H(){const[e]=j([mt]);f.useEffect(()=>{re()},[]);const t=n=>{S.resetFilters(),S.addFilter({name:ae.Group,value:n.groupName,strict:!0}),L(0)};return s.jsx(P,{onRowClick:t,data:e,columns:xt})}const xt=[{field:"groupName",title:"Группа"},{field:"curatorFullName",title:"Преподаватель"}],gt=(e,t)=>{let n=e;for(const o in t)n=n.replace(`:${o}`,t[o]);return n};d.div.withConfig({componentId:"sc-10c5ztk-0"})(["min-height:50px;display:flex;gap:5px;flex-direction:column;"]);const ht=d.div.withConfig({componentId:"sc-10c5ztk-1"})(["","{width:500px;}"],Ae.isNotMobile),ft=({student:e})=>{const t=we(),{close:n}=I(),o=()=>{t.push(gt(Re,{studentId:e.studentGuid})),n()};return s.jsx(ht,{children:s.jsxs(m,{d:"column",gap:"16px",ai:"flex-start",children:[s.jsxs(m,{d:"column",ai:"flex-start",gap:"2px",children:[s.jsx(C,{keyStr:"Группа",value:e.groupNumber}),s.jsx(C,{keyStr:"Баллы",value:e.totalPoints}),s.jsx(C,{keyStr:"Курс",value:e.course}),s.jsx(C,{keyStr:"ЛМС",value:e.lmsPoints}),s.jsx(C,{keyStr:"Группа здоровья",value:ne[e.healthGroup]}),s.jsx(C,{keyStr:"Специализация",value:et[e.specialization]})]}),s.jsx(Le,{width:"100%",margin:"0"}),s.jsxs(m,{d:"column",gap:"4px",ai:"flex-start",children:[s.jsx(Z,{align:"left",size:4,children:"Дата"}),s.jsx(tt,{studentGuid:e.studentGuid})]}),s.jsx(E,{onClick:o,text:"Перейти к студенту",width:"100%"})]})})},jt=d.div.withConfig({componentId:"sc-12o9ec3-0"})(["display:grid;width:100%;"]),Ct=d.div.withConfig({componentId:"sc-12o9ec3-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]),St=d(m).withConfig({componentId:"sc-12o9ec3-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]),R=d.span.withConfig({componentId:"sc-12o9ec3-3"})(["color:",";"],({hasDebt:e})=>e&&k.red.main),yt=[{title:"ФИО",field:"fullName",priority:"one",showFull:!0,render:(e,t)=>s.jsx(R,{hasDebt:t.hasDebt,children:t.fullName})},{title:"Группа",field:"groupNumber",priority:"one"},{title:"Посещений",field:"visits",priority:"two"},{title:"Баллы",field:"totalPoints",priority:"one"},{title:"Нормативы",field:"standardPoints",priority:"two"},{title:"ЛМС",field:"lmsPoints",priority:"two"},{title:"Группа здоровья",showFull:!0,field:"healthGroup",priority:"two",render:e=>{const t=ne[e];return s.jsx("span",{children:t})}}],wt=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(R,{hasDebt:t.hasDebt,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],le=c({name:"pageLoaded",sid:"-n45vlm"});i({and:[{clock:le,target:A.load}],or:{sid:"t4c48d"}});const B=()=>{const{open:e}=I(),{students:t,totalCount:n,page:o,search:r,loading:u,isExam:h}=j({students:b.$pEStudents,loading:b.$loading,totalCount:b.$pEStudentsTotalCount,page:b.$pEStudentsPage,search:st.$search,isExam:se.$isExam});return f.useEffect(()=>{le()},[]),s.jsx(jt,{children:s.jsxs(Ct,{children:[s.jsxs(St,{children:[s.jsx(Me,{value:r,setValue:nt.update,size:"big"}),s.jsx(pt,{})]}),s.jsx(P,{loading:u,data:t,columns:h?wt:yt,onRowClick:a=>{e(s.jsx(ft,{student:a}),a.fullName)}}),s.jsx(_e,{condition:!0,align:"right",pages:Math.floor(n/ze),currentPage:o,setCurrentPage:A.setPage})]})})},M=c({name:"endSemester",sid:"-50inz6"}),ce=c({name:"reset",sid:"-jpbmuk"}),N=Q(t=>v(void 0,[t],function*({studentId:e}){return yield qe(e),{studentGuid:e}}),{name:"endSemesterFx",sid:"yxjzgs"});var x=(e=>(e.LOADING="loading",e.SUCCESS="success",e.ERROR="error",e))(x||{});const g=$({},{name:"$statuses",sid:"-dggygt"}).reset(ce);i({and:[{clock:M,source:g,fn:(e,{studentId:t})=>w(y({},e),{[t]:"loading"}),target:g}],or:{sid:"77dp82"}});i({and:[{clock:N.doneData,source:g,fn:(e,{studentGuid:t})=>w(y({},e),{[t]:"success"}),target:g}],or:{sid:"7q2pec"}});i({and:[{clock:N.fail,source:g,fn:(e,{params:t})=>w(y({},e),{[t.studentId]:"error"}),target:g}],or:{sid:"88rpkm"}});i({and:[{clock:N.done,source:g,fn:(e,{params:t})=>w(y({},e),{[t.studentId]:"success"}),target:g}],or:{sid:"8rgpqw"}});i({and:[{clock:M,target:N}],or:{sid:"9lpedr"}});const vt={endSemester:M,reset:ce},pe={statuses:g},ue=c({name:"selectedGroupChanged",sid:"-yusgt0"}),me=c({name:"load",sid:"4qbbdm"}),_=c({name:"reset",sid:"g7h26n"}),xe=c({name:"endSemesterForGroup",sid:"842241"}),z=$("",{name:"$selectedGroup",sid:"-n8kqn6"}).on(ue,(e,t)=>t).reset(_),q=D({and:{source:z,effect:e=>v(void 0,null,function*(){const{data:t}=yield Oe(0,{group:{value:e}},200);return t.data.students})},or:{name:"loadFx",sid:"xfnq33"}});i({and:[{source:z,filter:Boolean,target:q}],or:{sid:"gule9"}});const ge=$([],{name:"$pEStudents",sid:"-7tia7t"}).on(q.doneData,(e,t)=>t).reset(_),kt=ve({and:[q.pending,Boolean],or:{name:"$loading",sid:"ghro6d"}}),$t=D({and:{source:ge,effect:e=>v(void 0,null,function*(){e.forEach(t=>vt.endSemester({studentId:t.studentGuid}))})},or:{name:"endSemesterForGroupFx",sid:"3q6tp7"}});i({and:[{clock:pe.statuses,filter:e=>Object.values(e).every(t=>t!==x.LOADING),target:me}],or:{sid:"10n6r9"}});i({and:[{clock:xe,target:$t}],or:{sid:"1exu6n"}});const Et={load:me,reset:_,selectedGroupChanged:ue,endSemesterForGroup:xe},Gt={$loading:kt,$pEStudents:ge,$selectedGroup:z},p={events:Et,stores:Gt},bt={[x.LOADING]:"Загрузка",[x.ERROR]:"Не зачтено",[x.SUCCESS]:"Успешно"},It={[x.LOADING]:s.jsx(Ue,{}),[x.ERROR]:s.jsx(ke,{color:k.red.main}),[x.SUCCESS]:s.jsx($e,{color:k.green.main})},Pt=d.span.withConfig({componentId:"sc-ph8uia-0"})(["color:var(--text);font-size:1em;"]),Nt=()=>{const[e,t]=j([pe.statuses,p.stores.$pEStudents]);return s.jsx(m,{p:"30px",d:"column",jc:"space-between",children:t.map(n=>{var o,r;return s.jsxs(m,{w:"100%",gap:"16px",ai:"flex-start",jc:"space-between",children:[s.jsx(Pt,{children:n.fullName}),s.jsxs(m,{gap:"8px",w:"auto",children:[s.jsx(We,{align:"center",children:bt[(o=e[n.studentGuid])!=null?o:x.LOADING]}),It[(r=e[n.studentGuid])!=null?r:x.LOADING]]})]},n.studentGuid)})})},he=c({name:"pageLoaded",sid:"4q0med"}),Ft=c({name:"pageUnloaded",sid:"he5rd5"});i({and:[{clock:he,target:p.events.load}],or:{sid:"74c8dr"}});i({and:[{clock:Ft,target:p.events.reset}],or:{sid:"76jer7"}});const Dt=d.div.withConfig({componentId:"sc-s6hadh-0"})(["display:grid;width:100%;"]),Tt=d.div.withConfig({componentId:"sc-s6hadh-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]);d(m).withConfig({componentId:"sc-s6hadh-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]);const At=d(m).withConfig({componentId:"sc-s6hadh-3"})([""]),Lt=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(R,{hasDebt:t.hasDebtFromPreviousSemester,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],K=()=>{const{open:e,close:t}=I(),{students:n,loading:o,selectedGroup:r}=j({students:p.stores.$pEStudents,loading:p.stores.$loading,selectedGroup:p.stores.$selectedGroup}),u=!!(n.length&&!o&&r),h=()=>{He.evokeConfirm({message:"Вы уверены, что хотите завершить семестр?",onConfirm:()=>{p.events.endSemesterForGroup(),e(s.jsx(Nt,{}))},onReject:()=>{t(),p.events.reset()}})};return f.useEffect(()=>(he(),()=>{p.events.reset()}),[]),s.jsxs(Dt,{children:[!u&&s.jsx(Ve,{type:"alert",children:"Выберите группу чтобы провести зачет"}),s.jsxs(Tt,{children:[s.jsxs(At,{d:"row",jc:"space-between",p:"8px",children:[s.jsx(J,{leftIcon:s.jsx(X,{}),placeholder:"Номер группы",value:r,setValue:p.events.selectedGroupChanged,customMask:ee.groupMask,onValueEmpty:()=>p.events.selectedGroupChanged(""),onHintClick:a=>a&&p.events.selectedGroupChanged(a.id),request:te,size:"big"}),u&&s.jsx(E,{text:`Завершить семестр для ${r}`,width:"210px",background:k.green.main,textColor:k.white.main,onClick:h})]}),u&&s.jsx(P,{loading:o,data:n,columns:Lt})]})]})},qt=()=>{const[e,t]=j([Be.peTeacher,ut]);f.useEffect(()=>{ie()},[]);const n=[W.AdminAccess,W.SuperUser].some(o=>{var r;return(r=e==null?void 0:e.permissions)==null?void 0:r.includes(o)})?[{title:"Студенты",content:s.jsx(B,{})},{title:"Управление",content:s.jsx(lt,{})},{title:"Мои Группы",content:s.jsx(H,{})},{title:"Проведение зачета",content:s.jsx(K,{})}]:[{title:"Студенты",content:s.jsx(B,{})},{title:"Мои Группы",content:s.jsx(H,{})},{title:"Проведение зачета",content:s.jsx(K,{})}];return s.jsx(Ke,{padding:"10px",children:s.jsx(Qe,{children:s.jsxs(m,{d:"column",gap:"2px",ai:"flex-start",children:[s.jsx(Xe,{appearance:!1,pages:n,currentPage:t,setCurrentPage:L}),n[t].content]})})})};export{qt as default};
