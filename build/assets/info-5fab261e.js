import{s as C,q as L,j as e,r as U,Q as P,T as E,cM as R}from"./vendor-48260ac4.js";import{aq as A,h as v,X as i,l as k,M as x,au as f,G as t,at as M,q as z,aU as T,aV as N,aW as W,d as V,V as B,aX as $,ax as u,P as b,aY as q,ay as O,H as I}from"./index-4085bf87.js";import{D as X}from"./dev-mode-message-1d44c583.js";import{A as _}from"./forbidden-f8a4f001.js";const m=s=>s==="Approved"?"success":s==="Declined"||s==="Expired"?"failure":s==="Unknown"?"hint":"alert",D=({employee:s,role:c,userId:o,id:a})=>{var p,h,g;const[n,j]=L([A.approve,A.reject]),d=(s==null?void 0:s.approvalStatus)||((p=s==null?void 0:s.employeeVerdicts)!=null&&p.every(r=>r.approvalStatus==="Approved")&&s.zkguApprovalStatus==="Approved"&&s.selfApprovalStatus==="Approved"&&s.orderStatus==="Ready"?"Approved":(h=s==null?void 0:s.employeeVerdicts)!=null&&h.some(r=>r.approvalStatus==="Declined")||s.zkguApprovalStatus==="Declined"||s.selfApprovalStatus==="Declined"?"Declined":"InProgress");return e.jsxs(G,{children:[e.jsx(v,{align:"left",size:4,children:s.initials}),e.jsxs(v,{align:"left",size:5,children:[s.divisionName,", ",s.position]}),s.paymentIdentifier&&e.jsx(i,{children:s.paymentIdentifier}),e.jsxs(i,{children:["Сумма: ",s.sum," руб."]}),e.jsxs(i,{children:["Период: ",k(s.startDate)," - ",k(s.endDate)]}),e.jsx(x,{type:d==="Approved"?"success":d==="Declined"?"failure":"alert",title:f[d]||"—",align:"left",icon:null}),c==="Initiator".toLowerCase()&&e.jsxs(e.Fragment,{children:[(g=s.employeeVerdicts)==null?void 0:g.map(r=>e.jsxs(t,{w:"100%",jc:"space-between",ai:"center",children:[e.jsxs(t,{d:"column",ai:"flex-start",children:[e.jsx(i,{fontSize:"0.9rem",children:r.approverPosition}),e.jsx(i,{children:r.approverName})]}),e.jsx(x,{minWidth:"180px",width:"180px",type:m(r.approvalStatus),icon:r.approvalStatus==="Unknown"?null:void 0,title:f[r.approvalStatus]||"—",align:r.approvalStatus==="Unknown"?"center":"left"})]},r.approverEmployeeId)),e.jsxs(t,{w:"100%",jc:"space-between",ai:"center",children:[e.jsx(i,{fontSize:"0.9rem",children:"1С:ЗКГУ"}),e.jsx(x,{width:"180px",type:m(s.zkguApprovalStatus),icon:s.zkguApprovalStatus==="Unknown"?null:void 0,title:f[s.zkguApprovalStatus]||"—",align:s.zkguApprovalStatus==="Unknown"?"center":"left"})]}),e.jsxs(t,{w:"100%",jc:"space-between",ai:"center",children:[e.jsxs(t,{d:"column",ai:"flex-start",children:[e.jsx(i,{fontSize:"0.9rem",children:"Получатель надбавки"}),e.jsx(i,{children:s.initials})]}),e.jsx(x,{minWidth:"180px",width:"180px",type:m(s.selfApprovalStatus),icon:s.selfApprovalStatus==="Unknown"?null:void 0,title:f[s.selfApprovalStatus]||"—",align:s.selfApprovalStatus==="Unknown"?"center":"left"})]}),s.orderStatus&&e.jsxs(t,{w:"100%",jc:"space-between",ai:"center",children:[e.jsxs(t,{d:"column",ai:"flex-start",children:[e.jsx(i,{fontSize:"0.9rem",children:"Статус приказа"}),s.orderTitle&&e.jsx(i,{children:s.orderTitle})]}),e.jsx(x,{minWidth:"180px",width:"180px",type:s.orderStatus==="Ready"?"success":"alert",title:M[s.orderStatus]||"—"})]})]}),c==="Approver".toLowerCase()&&d!=="Approved"&&d!=="Declined"&&e.jsxs(t,{jc:"space-between",children:[e.jsx(z,{text:"Отказать",background:"var(--red)",textColor:"white",onClick:()=>{j({allowanceId:a,approverEmployeeId:o,employeeId:s.id})}}),e.jsx(z,{text:"Согласовать",background:"var(--green)",textColor:"white",onClick:()=>{n({allowanceId:a,approverEmployeeId:o,employeeId:s.id})}})]})]})},G=C.div.withConfig({componentId:"sc-n1ez6c-0"})(["width:100%;display:flex;flex-direction:column;gap:0.5rem;background-color:var(--block-content);padding:1rem 0.5rem;border-radius:0.5rem;"]),F=({file:s})=>{const[c,o]=U.useState(!1);return e.jsx(T,{onClick:a=>a.preventDefault(),children:e.jsxs("div",{className:"file-body",onClick:()=>{s.sizeB?(o(!0),fetch(`${N}files?${new URLSearchParams({fileId:s.id})}`,{headers:{Authorization:`Bearer ${W()}`}}).then(a=>a.blob()).then(a=>{var n;(n=window.open(window.URL.createObjectURL(a),"_blank"))==null||n.focus()}).catch(a=>{console.log(a)}).finally(()=>o(!1))):V.evokePopUpMessage({message:"Файл недоступен",type:"failure"})},children:[e.jsx("div",{className:"image-container",children:c?e.jsx(B,{width:"16px",height:"16px"}):s.contentType.includes("image")?e.jsx(P,{}):e.jsx(E,{})}),e.jsxs("div",{className:"name-and-size",children:[e.jsxs("b",{className:"file-name",children:[s.name,".",s.extension]}),s.digitalSignature&&e.jsxs(i,{fontSize:"0.7em",children:["Подпись: ",s.digitalSignature]}),!!s.sizeB&&e.jsx(i,{fontSize:"0.7em",children:$(s.sizeB)})]})]})})},K=()=>{const{id:s,role:c,jobId:o}=R(),[a,n,j,d,p,h]=L([A.infoPageMounted,u.allowance.data,u.allowance.loading,u.allowance.error,u.roles,u.jobRoles]),g=p.includes("Initiator"),r=p.includes("Approver"),w=g||r;return U.useEffect(()=>{w&&a({id:s,role:c,userId:o})},[s,c,o,w]),j?e.jsx(b,{children:e.jsx(t,{w:"100%",jc:"center",ai:"center",children:e.jsx(B,{})})}):w?e.jsx(b,{children:e.jsx(q,{load:()=>{},data:n,loading:j,error:d?d.message:null,children:e.jsxs(e.Fragment,{children:[e.jsx(X,{}),n!=null&&n.files.application.length||n!=null&&n.files.other.length?e.jsx(O,{pages:[{title:"Сотрудники",content:e.jsx(t,{d:"column",gap:"1rem",w:"100%",children:n==null?void 0:n.employees.map((l,S)=>e.jsxs(e.Fragment,{children:[S!==0&&e.jsx(I,{}),e.jsx(D,{employee:l,role:c,userId:o,id:s},l.id)]}))})},{title:"Файлы",content:e.jsxs(t,{d:"column",gap:"2rem",children:[!!(n!=null&&n.files.application.length)&&e.jsxs(e.Fragment,{children:[e.jsx(v,{size:4,align:"left",children:"Файлы заявления"}),e.jsx(t,{d:"column",gap:"1rem",children:n==null?void 0:n.files.application.map(l=>e.jsx(F,{file:l},l.id))})]}),!!(n!=null&&n.files.other.length)&&e.jsxs(e.Fragment,{children:[!!(n!=null&&n.files.application.length)&&e.jsx(v,{size:4,align:"left",children:"Другое"}),e.jsx(t,{d:"column",gap:"0.5rem",children:n==null?void 0:n.files.other.map(l=>e.jsx(F,{file:l},l.id))})]})]})}]}):e.jsx(t,{d:"column",gap:"1rem",w:"100%",children:n==null?void 0:n.employees.map((l,S)=>e.jsxs(e.Fragment,{children:[S!==0&&e.jsx(I,{}),e.jsx(D,{employee:l,role:c,userId:o,id:s},l.id)]}))})]})})}):e.jsx(_,{jobRoles:h})};export{K as default};
