import{r,K as C,bT as D,j as h,z as A}from"./vendor-52b5ac7c.js";import{aC as I,av as N,ah as H,aD as O,ar as F,F as P,B as T,aw as B,I as k,S as w,d as E,N as G}from"./index-d0879ffc.js";const L=async(s,a,o)=>{o(!1);const c=a.map(d=>{if(Array.isArray(d.data[0])){const e=d.data.map(u=>Object.assign({},...u==null?void 0:u.map(t=>{var p,m;const f={};return t!=null&&t.fieldName&&(f[t==null?void 0:t.fieldName]=(p=t==null?void 0:t.value)!=null&&p.title?(m=t==null?void 0:t.value)==null?void 0:m.title:t==null?void 0:t.value),f}))),n={};return n[s]=JSON.stringify(e),n}else return d.data.map(e=>{const n={};return e!=null&&e.fieldName&&(n[(e==null?void 0:e.fieldName)??""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(n[(e==null?void 0:e.fieldName)??""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))),n})}).flat(),i=Object.assign({},...c);i.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?i.holiday_type=1:i.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?i.holiday_type=2:i.holiday_type=="Отпуск без сохранения заработной платы"?i.holiday_type=3:i.holiday_type=="Отпуск по коллективному договору"&&(i.holiday_type=4),!(await I.sendBufferHolidayPlanningFx({employeeGuid:i.jobGuid,type:i.holiday_type,start:i.holiday_start,end:i.holiday_end})).isError&&o(!0)},R=s=>{const a=s.find(o=>o.fieldName==="holiday_type");return a!=null&&a.value&&(a==null?void 0:a.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},q=(s,a,o,c,i,y,d,e,n,u,t)=>{const{surname:f,name:p,patronymic:m}=s,g=c||new Date().toISOString(),b=y||new Date().toISOString(),v=e||"";return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:f+" "+p+" "+m,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[o].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[o].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:u,editable:!0,required:!0,onChange:l=>{t(l)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:v,editable:!0,required:!0,onChange:l=>{n(l),d(N(l?+l.data:0,g+5))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:c,fieldName:"holiday_start",editable:!0,mask:!0,onChange:l=>{i(l),d(l)},required:!0,minValueInput:N(5)},{title:"",type:"simple-text",value:a[o].jobGuid.toString(),fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:b,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:l=>{d(l)},minValueInput:y||N(0),maxValueInput:N(e?+e.data:365,g)}]}},U=()=>{var _;const[s,a]=r.useState(null),[o,c]=r.useState(null),[i,y]=r.useState(null),[d,e]=r.useState(null),[n,u]=r.useState(null),{data:{dataUserApplication:t,dataWorkerApplication:f}}=H.useApplications(),{loading:p}=O.useBufferHolidayPlanning(),[m,g]=r.useState({}),[b,v]=r.useState(!1),l=b??!1,x=C(),{id:j}=D(),S=+j;return r.useEffect(()=>{t&&f&&!p&&a(q(t,f,S,o,c,i,y,d,e,n,u))},[t,S,p,o,d,n]),r.useEffect(()=>{s&&t&&g(R(s.data))},[s]),h.jsx(F,{isDone:l,children:!!s&&!!a&&h.jsxs(P,{children:[h.jsx(T,{text:"Назад к кадровым заявлениям",icon:h.jsx(A,{}),onClick:()=>x.push(B),background:"transparent",textColor:"var(--blue)"}),h.jsx(k,{...s,collapsed:l,setData:a,specialFieldsNameConfig:m}),h.jsx(w,{text:"Отправить",action:()=>L(E.HOLIDAY_PLANNING,[s],v),isLoading:p,completed:b,setCompleted:v,repeatable:!1,buttonSuccessText:"Отправлено",isDone:l,isActive:G(s,m)&&(((_=s.optionalCheckbox)==null?void 0:_.value)??!0),alerts:!1})]})})};export{U as default};
