var _=Object.defineProperty,j=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var b=(a,t,e)=>t in a?_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,N=(a,t)=>{for(var e in t||(t={}))g.call(t,e)&&b(a,e,t[e]);if(y)for(var e of y(t))S.call(t,e)&&b(a,e,t[e]);return a},h=(a,t)=>j(a,k(t));var x=(a,t,e)=>new Promise((u,s)=>{var v=o=>{try{i(e.next(o))}catch(d){s(d)}},n=o=>{try{i(e.throw(o))}catch(d){s(d)}},i=o=>o.done?u(o.value):Promise.resolve(o.value).then(v,n);i((e=e.apply(a,t)).next())});import{r as p,cM as F,j as f}from"./vendor-33947725.js";import{b0 as A,b6 as C,s as w,b7 as D,B as O,F as B,I as H,S as W,j as q,c as E}from"./index-958ef795.js";const G=(a,t,e)=>x(void 0,null,function*(){e(!1);const u=t.map(n=>{if(Array.isArray(n.data[0])){const i=n.data.map(d=>Object.assign({},...d==null?void 0:d.map(l=>{var r,c;const m={};return l!=null&&l.fieldName&&(m[l==null?void 0:l.fieldName]=l!=null&&(r=l.value)!==null&&r!==void 0&&r.title?l==null||(c=l.value)===null||c===void 0?void 0:c.title:l==null?void 0:l.value),m}))),o={};return o[a]=JSON.stringify(i),o}else return n.data.map(i=>{var o;const d={};if(i!=null&&i.fieldName&&(d[(o=i==null?void 0:i.fieldName)!==null&&o!==void 0?o:""]=typeof i.value!="object"?i==null?void 0:i.value:i.value.title),i.type==="multiselect"){var l;d[(l=i==null?void 0:i.fieldName)!==null&&l!==void 0?l:""]=JSON.stringify(i==null?void 0:i.value.map(r=>r.title))}return d})}).flat(),s=Object.assign({},...u);!(yield A.sendBufferHolidayWorkFx({employeeGuid:s.jobGuid,dates:[{date:s.holiday_work_date,dayOff:s.extra_holiday_date?s.extra_holiday_date:null,hours:+s.holiday_work_hours}]})).isError&&e(!0)}),I=a=>{const t=a.find(u=>u.fieldName==="compensation");let e=null;return t!=null&&t.value&&(t==null?void 0:t.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(e="Compensation"),{compensation:e}},R=(a,t,e)=>{const{surname:u,name:s,patronymic:v}=a;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:u+" "+s+" "+v,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:t[e].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:t[e].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:C(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:t[e].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},L=()=>{var a,t;const[e,u]=p.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:v}}=w.useApplications(),{loading:n}=D.useBufferHolidayWork(),[i,o]=p.useState(!1),[d,l]=p.useState({}),r=i!=null?i:!1,{id:c}=F(),m=+c;return p.useEffect(()=>{s&&v&&!n&&u(R(s,v,m))},[s,m,n]),p.useEffect(()=>{e&&s&&l(I(e.data))},[e]),f.jsx(O,{isDone:r,children:!!e&&!!u&&f.jsxs(B,{children:[f.jsx(H,h(N({},e),{collapsed:r,setData:u,specialFieldsNameConfig:d})),f.jsx(W,{text:"Отправить",action:()=>G(q.HOLIDAY_WORK,[e],o),isLoading:n,completed:i,setCompleted:o,repeatable:!1,buttonSuccessText:"Отправлено",isDone:r,isActive:E(e)&&((a=(t=e.optionalCheckbox)===null||t===void 0?void 0:t.value)!==null&&a!==void 0?a:!0),alerts:!1})]})})};export{L as default};
