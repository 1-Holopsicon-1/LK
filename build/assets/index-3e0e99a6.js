var ae=Object.defineProperty,ce=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var V=(e,t,o)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))de.call(t,o)&&V(e,o,t[o]);if(W)for(var o of W(t))pe.call(t,o)&&V(e,o,t[o]);return e},g=(e,t)=>ce(e,le(t));import{p as ue,e as B,h as fe,f as b,s as u,r as d,j as s,af as xe,J as he,n as E,a5 as ge,cM as me,L as we}from"./vendor-31894644.js";import{$ as I,g as F,b as ve,ai as X,X as m,l as v,an as Y,L as j,S as K,ao as je,d as Se,G as z,a2 as O,ap as w,aq as Z,ar as ye,as as Te,h as N,at as ke,au as J,q as H,av as Ne,aw as be,ax as G,V as De,W as Ce,P as $e,p as Ie,x as Fe,ay as Ae,az as Le}from"./index-0f8b6250.js";import{D as Me}from"./dev-mode-message-9bdc0b33.js";const Q=()=>I.get("?getNotification&token=".concat(F())),Pe=e=>I.get("?viewNotification=".concat(e,"&token=").concat(F())),Ee=Object.freeze(Object.defineProperty({__proto__:null,get:Q,view:Pe},Symbol.toStringTag,{value:"Module"})),ee=()=>I.get("?getDocList&token=".concat(F())).then(e=>g(p({},e),{data:e.data.map(t=>g(p({},t),{document:!0}))})),ze=e=>I.get("?viewDoc=".concat(e,"&token=").concat(F())),Oe=Object.freeze(Object.defineProperty({__proto__:null,get:ee,view:ze},Symbol.toStringTag,{value:"Module"})),q={type:null,personalNotifications:null,error:null,completed:!1},Be=()=>({data:b(T).personalNotifications,loading:b(y.pending),error:b(T).error,completed:b(T).completed}),Re=()=>b(T).type,_e=ue({name:"changeCompleted",sid:"vr0j8g"}),te=B(e=>e,{name:"setNotificationsType",sid:"-m97y8b"}),y=B(async()=>{const{type:e}=T.getState();if(e==="notifications")try{return(await Q()).data}catch(t){throw new Error(t)}try{return{docs:(await ee()).data}}catch(t){throw new Error(t)}},{name:"getPersonalNotificationsFx",sid:"pa84d1"}),C=B(async e=>{const{type:t}=T.getState(),o=t==="notifications"?Ee:Oe;try{return await o.view(e),"ok"}catch(a){throw new Error("Ошибка загрузки данных")}},{name:"viewPersonalNotificationsFx",sid:"-64tonw"}),T=fe(q,{name:"$personalNotificationsStore",sid:"53pwkb"}).on(te,(e,t)=>g(p({},e),{type:t})).on(y,e=>g(p({},e),{error:null})).on(y.doneData,(e,t)=>g(p({},e),{personalNotifications:t})).on(y.failData,(e,t)=>g(p({},e),{error:t.message})).on(C.doneData,e=>p({},e)).on(C.failData,(e,t)=>g(p({},e),{error:t.message})).on(_e,(e,t)=>g(p({},e),{completed:t.completed})).on(ve.userGuid,()=>p({},q));C.doneData.watch(()=>y());const se={usePersonalNotifications:Be,useType:Re},S={setNotificationsType:te,getPersonalNotificationsFx:y,viewPersonalNotificationsFx:C},Ue=(e,t,o)=>{const a={};let i=[];const r=n=>{if("document"in n){const{viewed:A,name:x}=n,D=(x==null?void 0:x.includes(e))||!e.length;return t==="all"&&D?!0:!A&&t!=="all"&&D}const{viewed:c,post:l,event:k}=n,f=(k==null?void 0:k.includes(e))||(l==null?void 0:l.includes(e))||!e.length;return t==="all"&&f?!0:!c&&t!=="all"&&f};return Object.entries(o).map(([n,c])=>{i=[],c.map(l=>{r(l)&&i.push(l)}),a[n]=i}),a},$=(e,t,o)=>{switch(e){case"Female":return o;default:return t}},oe=u.div.withConfig({componentId:"sc-rnm93p-0"})(["display:flex;flex-direction:column;gap:10px;width:100%;"]),ne=u.div.withConfig({componentId:"sc-rnm93p-1"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),We=u.div.withConfig({componentId:"sc-1g1tw42-0"})(["display:flex;width:100%;align-items:center;justify-content:space-between;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;@media (max-width:768px){flex-direction:column;}"]),Ve=u.div.withConfig({componentId:"sc-1g1tw42-1"})(["display:flex;gap:10px;align-self:end;@media (max-width:768px){width:100%;gap:20px;}"]),Je=({data:e})=>{const{data:{user:t}}=X.useUser(),[o,a]=d.useState(!1),[i,r]=d.useState(!1);return s.jsxs(We,{children:[s.jsxs(oe,{children:[s.jsx(ne,{children:e.event||e.post}),e.startDate&&e.endDate!=="0000-00-00"?s.jsxs(m,{children:["Период: ",v(e.startDate,"numeric")," - ",v(e.endDate,"numeric")]}):s.jsxs(m,{children:["Дата: ",v(e.startDate,"numeric")]})]}),s.jsxs(Ve,{children:[e.file&&s.jsx(Y,{href:e.file,onClick:()=>null,text:"Скачать",width:"150px",icon:s.jsx(xe,{}),height:"35px",minHeight:"30px",background:j.grey.transparent2}),s.jsx(K,{text:e.viewed?$(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:()=>{a(!0),S.viewPersonalNotificationsFx(e.id),a(!1),r(!0)},height:"35px",width:"150px",buttonSuccessText:$(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"),isLoading:o,completed:i,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},He=u.div.withConfig({componentId:"sc-168uakk-0"})(["width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;display:flex;flex-direction:column;align-items:flex-end;"]),Ge=u.div.withConfig({componentId:"sc-168uakk-1"})(["display:flex;gap:8px;margin-top:5px;width:300px;@media (max-width:768px){max-width:100%;width:100%;}"]),qe=({data:e})=>{const{data:{user:t}}=X.useUser(),[o,a]=d.useState(!1),[i,r]=d.useState(!1),n=()=>{try{a(!0),S.viewPersonalNotificationsFx(e.id),je.clearById({id:"studdoc-".concat(e.id),pageId:"doclist"}),a(!1),r(!0)}catch(c){Se.evokePopUpMessage({message:"Не удалось отправить данные",type:"failure"})}};return s.jsxs(He,{children:[s.jsxs(oe,{children:[s.jsx(ne,{children:e.name}),e.date&&s.jsxs(m,{children:["Дата: ",v(e.date,"numeric")]})]}),s.jsxs(Ge,{children:[e.link&&s.jsx(Y,{href:e.link,onClick:()=>null,text:"Подробнее",width:"100%",icon:s.jsx(he,{}),height:"35px",minHeight:"30px",background:j.grey.transparent2}),s.jsx(K,{text:e.viewed?$(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:n,height:"35px",width:"100%",buttonSuccessText:$(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"),isLoading:o,completed:i,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},P=({listNotification:e})=>{const t=se.useType();return s.jsx(z,{d:"column",gap:"8px",children:e.length?e.map(o=>t==="notifications"?s.jsx(Je,{data:o},o.id):s.jsx(qe,{data:o},o.id)):s.jsx(O,{text:"У вас нет приказов, с которыми вы еще не ознакомились"})})},Xe=e=>{const t=new Date().getTime()-new Date(e).getTime(),o=Math.floor(t/1e3);if(o<60&&o>=1)return"".concat(o," ").concat(w(o,Ye));const a=Math.floor(o/60);if(a<60&&a>=1)return"".concat(a," ").concat(w(a,Ke));const i=Math.floor(a/60);if(i<24&&i>=1)return"".concat(i," ").concat(w(i,Ze));const r=Math.floor(i/24);if(r>=1&&r<7)return"".concat(r," ").concat(w(r,Qe));const n=Math.floor(r/7);if(n>=1&&n<4)return"".concat(n," ").concat(w(n,et));const c=Math.floor(r/30);if(c>=1&&c<12)return"".concat(c," ").concat(w(c,tt));const l=Math.floor(r/365);return"".concat(l," ").concat(w(l,st))},Ye={zero:"секунд",one:"секунду",twoToFour:"секунды",fiveToNine:"секунд"},Ke={zero:"минут",one:"минута",twoToFour:"минуты",fiveToNine:"минут"},Ze={zero:"часов",one:"час",twoToFour:"часа",fiveToNine:"часов"},Qe={zero:"дней",one:"день",twoToFour:"дня",fiveToNine:"дней"},et={zero:"недель",one:"неделя",twoToFour:"недели",fiveToNine:"недель"},tt={zero:"месяцев",one:"месяц",twoToFour:"месяца",fiveToNine:"месяцев"},st={zero:"лет",one:"год",twoToFour:"года",fiveToNine:"лет"},ot=({allowance:e})=>{const t=E(Z.allowanceStatusChanged),o=E(ye.userSettings);return e?s.jsxs(nt,{children:[s.jsxs(Te,{children:[s.jsxs(N,{align:"left",size:3,children:[e.paymentIdentifier,", ",e.position]}),e.orderStatus&&e.selfApprovalStatus==="Approved"&&s.jsx(N,{align:"left",size:4,children:ke[e.orderStatus]}),e.selfApprovalStatus==="Approved"&&s.jsx(m,{fontSize:"1em",color:"var(--greenMain)",children:J[e.selfApprovalStatus]}),(e.selfApprovalStatus==="Declined"||e.selfApprovalStatus==="Expired")&&s.jsx(m,{fontSize:"1em",color:"var(--redMain)",children:J[e.selfApprovalStatus]}),s.jsxs(N,{align:"left",size:5,children:["Инициатор: ",e.initiatorName]}),s.jsxs(N,{align:"left",size:5,children:["Источник: ",e.sourceOfFunding]}),s.jsxs(N,{align:"left",size:5,children:["Сумма: ",e.sum," руб."]}),s.jsxs(m,{children:["Период: ",v(e.startDate,"numeric")," -"," ",v(e.endDate,"numeric")," "]}),s.jsxs(m,{children:["Дата: ",v(e.issueDate,"numeric")]})]}),(e.selfApprovalStatus==="Unknown"||e.selfApprovalStatus==="InProgress")&&s.jsxs(s.Fragment,{children:[s.jsxs(it,{children:[s.jsx(H,{text:"Отказаться",onClick:()=>t({allowanceId:e.allowanceId,isConfirmed:!1}),background:j.red.main,textColor:"white",height:"35px",width:"100%",isActive:!0}),s.jsx(H,{text:"Согласиться",onClick:()=>t({allowanceId:e.allowanceId,isConfirmed:!0}),background:j.green.main,textColor:"white",height:"35px",width:"100%",isActive:!0})]}),s.jsx(rt,{isLightTheme:(o==null?void 0:o.appearance.theme)===Ne.Light,children:s.jsxs(m,{children:["Подтвердите надбавку в течение 1 дня."," ",be(e.confirmationEndDate)&&"Осталось ".concat(Xe(e.confirmationEndDate))]})})]})]}):null},nt=u.div.withConfig({componentId:"sc-ceiafc-0"})(["position:relative;width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);min-height:70px;display:flex;flex-direction:column;align-items:flex-end;overflow:hidden;"]),it=u.div.withConfig({componentId:"sc-ceiafc-1"})(["display:flex;gap:8px;margin:0.5rem 0;width:300px;@media (max-width:768px){max-width:100%;width:100%;}@media (max-width:380px){margin:1.5rem 0;}"]),rt=u.div.withConfig({componentId:"sc-ceiafc-2"})(["position:absolute;bottom:0;background-color:",";width:100%;color:",";left:0;text-align:center;"],j.orange.transparent3,({isLightTheme:e})=>e?j.orange.dark3:j.orange.light3),at=({searchQuery:e,filter:t})=>{const[o,a,i]=E([G.personalAllowances.data,G.personalAllowances.loading,Z.personalAllowancesMounted]);d.useEffect(()=>{i()},[]);const r=d.useMemo(()=>{const n=e?o==null?void 0:o.filter(c=>c.position.includes(e)||c.paymentIdentifier.includes(e)||c.sourceOfFunding.includes(e)):o;return t&&(t==null?void 0:t.id)==="unread"?n==null?void 0:n.filter(c=>c.selfApprovalStatus==="Unknown"||c.selfApprovalStatus==="InProgress"):n},[o,e,t]);return a?s.jsx(z,{h:"100%",d:"column",ai:"center",jc:"center",children:s.jsx(De,{})}):s.jsxs(z,{d:"column",gap:"8px",p:"0.25rem",children:[s.jsx(Me,{}),r?r.length>0?r.map(n=>s.jsx(ot,{allowance:n},n.allowanceId)):s.jsx(O,{text:"Нет надбавок"}):s.jsx(O,{text:"Произошла ошибка"})]})},ct=u.div.withConfig({componentId:"sc-xrueg0-0"})(["display:flex;justify-content:center;gap:10px;width:100%;"]),lt=[{id:"all",title:"Все"},{id:"unread",title:"Непрочитанные"}],dt=[{id:"all",title:"Все"},{id:"vacation",title:"Отпуск"},{id:"fire",title:"Увольнение"},{id:"businesstrip",title:"Командировка"}],gt=({docsType:e})=>{const t=ge(),{type:o}=me(),a=h=>t.push(Le+"/"+h),{data:i,error:r}=se.usePersonalNotifications(),[n,c]=d.useState(),[l,k]=d.useState(""),[f,A]=d.useState({id:"all",title:"Все"}),[x,D]=d.useState({id:"all",title:"Все"});d.useEffect(()=>{c(JSON.parse(JSON.stringify(i)))},[i]),d.useEffect(()=>{var h;i&&c(Ue(l,(h=f==null?void 0:f.id)!=null?h:"",JSON.parse(JSON.stringify(i))))},[f,l]),d.useEffect(()=>{S.setNotificationsType(o),S.getPersonalNotificationsFx()},[o]);const ie=h=>{a(h)},R=d.useMemo(()=>{const h=(i==null?void 0:i.vacation)||[],_=(i==null?void 0:i.businesstrip)||[],U=(i==null?void 0:i.fire)||[];switch(x==null?void 0:x.id){case"all":return[...h,..._,...U].sort((L,M)=>{const re=L.notificationType==="docs"?new Date(L.date):new Date(L.startDate||"");return(M.notificationType==="docs"?new Date(M.date):new Date(M.startDate||"")).getTime()<re.getTime()?-1:1});case"vacation":return h;case"fire":return U;case"businesstrip":return _;default:return[]}},[i,x]);return s.jsx(Ce,{load:()=>{S.setNotificationsType(o),S.getPersonalNotificationsFx()},error:r,data:n,children:s.jsxs($e,{children:[s.jsxs(ct,{children:[s.jsx(Ie,{value:l,setValue:k,placeholder:"Поиск",leftIcon:s.jsx(we,{})}),s.jsx(Fe,{items:o==="notifications"?dt:lt,selected:o==="notifications"?x:f,setSelected:o==="notifications"?D:A})]}),e?(n==null?void 0:n.docs)&&s.jsx(P,{listNotification:n==null?void 0:n.docs}):s.jsx(Ae,{onChangePage:ie,currentPage:o==="allowances"?2:o==="notifications"?1:0,pages:[{id:"docs",title:"Приказы",content:(n==null?void 0:n.docs)&&s.jsx(P,{listNotification:n==null?void 0:n.docs})},{id:"notifications",title:"Кадровые уведомления",content:R.length?s.jsx(P,{listNotification:R}):void 0},{id:"allowances",title:"Надбавки",content:s.jsx(at,{filter:f,searchQuery:l})}]})]})})};export{gt as N};
