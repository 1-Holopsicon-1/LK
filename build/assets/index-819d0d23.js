import{s as x,J as E,cN as $,j as e,q as v,r as p,cJ as F}from"./vendor-905eebdf.js";import{o as q,n as j,p as H,q as S,A as W,r as X,t as z,s as B,e as K,u as _,v as Q,g as L,w as k}from"./ui-3547da8e.js";import{t as D,R as g,o as C,r as b,n as P,X as Y,J as f,l as R,u as G,M as Z,h as U,z as tt,Y as et,U as it,P as st,Z as nt,V as ot,_ as lt,b as dt}from"./index-dc093c1d.js";var u=(t=>(t.Activist="ACTIVIST",t.Competition="COMPETITION",t.ExternalFitness="EXTERNAL_FITNESS",t.GTO="GTO",t.InternalTeam="INTERNAL_TEAM",t.OnlineWork="ONLINE_WORK",t.Science="SCIENCE",t))(u||{});const rt=x(D).withConfig({componentId:"sc-1qi5h46-0"})(["flex:1;"]),at=x.div.withConfig({componentId:"sc-1qi5h46-1"})(["display:flex;flex-direction:column;justify-content:center;gap:10px;"]),ut=E({and:[g.peTeacher,q.pendingRemoveVisit,(t,l)=>{var o;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},...(o=t==null?void 0:t.permissions)!=null&&o.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const s=d,i=$(new Date(s.date),new Date)<-7,c=[j.AdminAccess,j.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return s.teacherGuid===(t==null?void 0:t.id)&&!i||c?e.jsx(C,{width:"100%",text:"Удалить",isActive:!l,onClick:()=>{H.removeVisit({id:s.id.toString()})}}):null}}]:[]]}],or:{name:"$peStudentVisitsColumns",sid:"bwdu0h"}}),ct=()=>{var n;const[t,l,o]=v([S.$selectedStudent,ut,g.peTeacher]);return t?e.jsxs(at,{children:[!!((n=o==null?void 0:o.permissions)!=null&&n.length)&&e.jsx(W,{studentGuid:t.studentGuid}),e.jsx(rt,{columns:l,data:t.visitsHistory})]}):null},I=[{id:u.Activist,title:"Активист"},{id:u.ExternalFitness,title:"Внешний фитнес"},{id:u.Competition,title:"Соревнование"},{id:u.GTO,title:"ГТО"},{id:u.InternalTeam,title:"Сборная"},{id:u.OnlineWork,title:"Работа в LMS"},{id:u.Science,title:"Научная работа"}],mt=E({and:[g.peTeacher,X.pendingRemoveAdditionPoints,(t,l)=>{var o;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Тип работ",field:"workType",render:(n,d)=>{const s=I.find(({id:i})=>i===n);return(s==null?void 0:s.id)===u.Competition?d.comment:s==null?void 0:s.title}},{title:"Количество баллов",field:"points"},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},{title:"Комментарий",field:"comment",priority:"five",render:(n,d)=>{const s=I.find(({id:i})=>i===d.workType);return(s==null?void 0:s.id)!==u.Competition?d.comment:null}},...(o=t==null?void 0:t.permissions)!=null&&o.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const s=d,i=$(new Date(s.date),new Date)<-7,c=[j.AdminAccess,j.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return s.teacherGuid===(t==null?void 0:t.id)&&!i||c?e.jsx(C,{width:"100%",text:"Удалить",isActive:!l,onClick:()=>z.removeAdditionPoints({id:s.id.toString()})}):null}}]:[]]}],or:{name:"$additionalPointsColumns",sid:"cv7zhj"}}),pt=x.div.withConfig({componentId:"sc-xw90or-0"})(["display:flex;flex-direction:column;justify-content:center;gap:10px;"]),xt=()=>{const[t,l]=v([S.$selectedStudent,B.$competitions]),[o,n]=p.useState(null),[d,s]=p.useState(new Date().toISOString()),[i,c]=p.useState(null),[r,a]=p.useState("0"),[A,h]=p.useState(""),M=()=>{z.addAdditionPoints({comment:(i==null?void 0:i.id)===u.Competition?(o==null?void 0:o.title)??"":A,date:R(d,"numeric"),pointsAmount:Number(r),studentGuid:t==null?void 0:t.studentGuid,workType:i==null?void 0:i.id})};p.useEffect(()=>{K.load()},[]),p.useEffect(()=>{(i==null?void 0:i.id)===u.Competition&&r==="0"&&a("5"),(i==null?void 0:i.id)===u.InternalTeam&&r==="0"&&a("50")},[i==null?void 0:i.id]);const T=new Date(d),O=T.getDay()!==0&&T.getDay()!==1,y=l.map(N=>({id:N,title:N}));return e.jsxs(pt,{children:[e.jsx(b,{width:"100%",size:"big",title:"Тип работ",items:I,selected:i,setSelected:c}),(i==null?void 0:i.id)===u.Competition&&e.jsx(b,{width:"100%",size:"big",title:"Соревнование",items:y,selected:o,setSelected:n}),e.jsx(P,{alertMessage:O?"":"Не допустимая дата",size:"big",title:"Дата",setValue:s,value:d,type:"date"}),e.jsx(P,{width:"100%",size:"big",title:"Количество баллов",setValue:a,value:r,type:"number",stepSize:1,minValue:1}),(i==null?void 0:i.id)!==u.Competition&&e.jsx(Y,{width:"100%",setValue:h,value:A,title:"Комментарий"}),e.jsx(C,{isActive:O,text:"Добавить",onClick:M,background:f.blue.main,textColor:f.white.main,width:"100%"})]})},ft=x.div.withConfig({componentId:"sc-19i0iom-0"})(["display:flex;flex-direction:column;height:100%;gap:10px;"]),St=x(D).withConfig({componentId:"sc-19i0iom-1"})(["flex:1;"]),gt=()=>{var s;const[t,l,o]=v([S.$selectedStudent,mt,g.peTeacher]),{open:n}=G(),d=()=>{n(e.jsx(xt,{}),"Дополнительные баллы")};return t?e.jsxs(ft,{children:[!!((s=o==null?void 0:o.permissions)!=null&&s.length)&&e.jsx(C,{text:"Добавить дополнительные баллы",onClick:d,background:f.blue.main,textColor:f.white.main}),e.jsx(St,{columns:l,data:t.pointsHistory})]}):null};var m=(t=>(t.FlexionAndExtensionOfArms="FLEXION_AND_EXTENSION_OF_ARMS",t.JumpingRopeJumps="JUMPING_ROPE_JUMPS",t.Jumps="JUMPS",t.PullUps="PULL_UPS",t.ShuttleRun="SHUTTLE_RUN",t.Squats="SQUATS",t.Tilts="TILTS",t.TorsoLifts="TORSO_LIFTS",t.Other="OTHER",t))(m||{});const J=[{id:m.FlexionAndExtensionOfArms,title:"Сгибание и разгибание рук"},{id:m.JumpingRopeJumps,title:"Прыжки со скакалкой"},{id:m.Jumps,title:"Прыжок в длину"},{id:m.PullUps,title:"Подтягивания(Вис)"},{id:m.ShuttleRun,title:"Челночный бег"},{id:m.Squats,title:"Приседания"},{id:m.Tilts,title:"Наклон"},{id:m.TorsoLifts,title:"Подъемы туловища"},{id:m.Other,title:"Другое"}],Ct=x.div.withConfig({componentId:"sc-uipy8z-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;height:100%;"]),jt=()=>{const t=v(S.$selectedStudent),[l,o]=p.useState(new Date().toISOString()),[n,d]=p.useState(null),[s,i]=p.useState("0"),[c,r]=p.useState(""),a=()=>{_.addRegulationPoints({date:R(l,"numeric"),pointsAmount:Number(s),studentGuid:t==null?void 0:t.studentGuid,standardType:n==null?void 0:n.id,isOverride:!1,comment:(n==null?void 0:n.id)===m.Other?c??"":""})},A=new Date(l),h=A.getDay()!==0&&A.getDay()!==1;return e.jsxs(Ct,{children:[e.jsx(b,{width:"100%",size:"big",title:"Тип работ",items:J,selected:n,setSelected:d}),(n==null?void 0:n.id)===m.Other&&e.jsx(P,{width:"100%",size:"big",title:"Комментарий",setValue:r,value:c}),e.jsx(P,{alertMessage:h?"":"Не допустимая дата",size:"big",title:"Дата",setValue:o,value:l,type:"date",width:"100%"}),e.jsx(P,{width:"100%",size:"big",title:"Количество баллов",setValue:i,value:s,type:"number",stepSize:1,minValue:1}),e.jsx(C,{text:"Добавить",isActive:h,onClick:a,background:f.blue.main,textColor:f.white.main,width:"100%"})]})},vt=x(D).withConfig({componentId:"sc-4mpo2k-0"})(["flex:1;"]),At=x.div.withConfig({componentId:"sc-4mpo2k-1"})(["display:flex;flex-direction:column;justify-content:center;gap:10px;"]),Pt=E({and:[g.peTeacher,Q.pendingRemoveRegulationPoints,(t,l)=>{var o;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Норматив",field:"standardType",render:(n,d)=>{var s;return n===m.Other?d.comment:(s=J.find(({id:i})=>i===n))==null?void 0:s.title}},{title:"Количество баллов",field:"points"},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},{title:"Комментарий",field:"comment",priority:"five"},...(o=t==null?void 0:t.permissions)!=null&&o.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const s=d,i=$(new Date(s.date),new Date)<-30,c=[j.AdminAccess,j.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return s.teacherGuid===(t==null?void 0:t.id)&&!i||c?e.jsx(C,{width:"100%",text:"Удалить",isActive:!l,onClick:()=>_.removeRegulationPoints({id:s.id.toString()})}):null}}]:[]]}],or:{name:"$regularPointsColumns",sid:"levsbz"}}),ht=()=>{var c;const[t,l,o]=v([S.$selectedStudent,Pt,g.peTeacher]),{open:n}=G(),d=!!t&&L(t),s=()=>{n(e.jsx(jt,{}),"Добавить норматив")},i=Number(d)<20;return t?e.jsxs(At,{children:[!t&&i&&e.jsx(Z,{type:"alert",children:"Чтобы добавить норматив, у студента должно быть хотя бы 20 баллов"}),!!((c=o==null?void 0:o.permissions)!=null&&c.length)&&e.jsx(C,{text:"Добавить норматив",onClick:s,background:f.blue.main,textColor:f.white.main,isActive:!i}),e.jsx(vt,{data:t.standardsHistory,columns:l})]}):null},V=[{title:"Посещения",content:e.jsx(ct,{})},{title:"Нормативы ",content:e.jsx(ht,{})},{title:"Дополнительные баллы ",content:e.jsx(gt,{})}],w=({label:t,value:l})=>e.jsxs(wt,{children:[e.jsx(U,{size:3,children:t}),e.jsx(bt,{children:l})]}),wt=x.div.withConfig({componentId:"sc-bzc523-0"})(["display:flex;flex-direction:column;align-items:center;row-gap:4px;border-radius:4px;padding:12px;background-color:var(--theme-2);flex:1;"]),bt=x.span.withConfig({componentId:"sc-bzc523-1"})([""]),Dt=()=>{const{studentId:t}=F(),[l,{currentUser:o},n,d]=v([S.$selectedStudent,dt.user,g.isLoading,S.$loading]),s=(o==null?void 0:o.user_status)==="staff"?t:(o==null?void 0:o.guid)??"",[i,c]=p.useState(0);return p.useEffect(()=>(k.setCurrentStudentId(s),tt.load(),()=>k.resetStudentId()),[s]),!l&&s&&!n&&!d?e.jsx(et,{text:"Нет данных"}):l?e.jsx(it,{padding:"10px",children:e.jsxs(st,{children:[e.jsx(U,{size:3,align:"left",children:l.fullName}),e.jsxs(nt,{children:[e.jsx(w,{label:"Группа",value:l.groupNumber}),e.jsx(w,{label:"Баллы",value:L(l).toString()}),e.jsx(w,{label:"Курс",value:l.course.toString()}),e.jsx(w,{label:"ЛМС",value:l.pointsHistory.filter(r=>r.workType===u.OnlineWork).reduce((r,a)=>r+a.points,0).toString()})]}),e.jsx(ot,{appearance:!1,pages:V,currentPage:i,setCurrentPage:c}),e.jsx(lt,{children:V[i].content})]})}):null};export{Dt as default};
