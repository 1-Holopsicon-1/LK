var ce=Object.defineProperty,re=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var E=(e,t,i)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,G=(e,t)=>{for(var i in t||(t={}))pe.call(t,i)&&E(e,i,t[i]);if(I)for(var i of I(t))me.call(t,i)&&E(e,i,t[i]);return e},T=(e,t)=>re(e,de(t));var W=(e,t,i)=>new Promise((c,d)=>{var s=r=>{try{a(i.next(r))}catch(g){d(g)}},m=r=>{try{a(i.throw(r))}catch(g){d(g)}},a=r=>r.done?c(r.value):Promise.resolve(r.value).then(s,m);a((i=i.apply(e,t)).next())});import{c$ as Q,p as F,h as S,O as D,e as ge,x as p,k as Y,d0 as xe,g as ue,d2 as J,cH as Ae,i as y,j as n,q as K,r as X}from"./vendor-04d91f24.js";import{A as f}from"./types-94f8684b.js";import{dA as ve,dy as fe,dB as he,dC as je,dD as ye,dE as De,dF as k,p as O,U as _,k as ke,P as we,f as l,r as Z,T as H,g as h,S as j,a5 as $e,_ as ee,Y as o,I as Ce,B as u,v as Fe}from"./index-60431b6d.js";import{r as te}from"./index-b1b7ecd2.js";const L=Q({and:[],or:{name:"ArticleApplicationsAdminGate",sid:"29j1vt"}}),ne=Q({and:[],or:{name:"ApplicationGate",sid:"-3p4z8w"}}),R=F({name:"approve",sid:"lo4ssa"}),N=F({name:"decline",sid:"-kyijsg"}),ie=F({name:"applicationOpened",sid:"h5ajxo"}),z=F({name:"applicationDataFetched",sid:"1l9rqk"}),ae=S([],{name:"$articleApplications",sid:"3170zn"}),M=S(null,{name:"$articleApplication",sid:"-rfmees"}),w=S(new Map,{name:"$applicationsLoading",sid:"-i3u9pb"}),b=D({and:{effect:ve},or:{name:"getAllArticleApplicationsFx",sid:"pjlr0r"}}),Re=D({and:{effect:fe},or:{name:"getUserArticleApplicationsFx",sid:"-l6rp8v"}}),se=D({and:{effect:he},or:{name:"getArticleApplicationByIdFx",sid:"6f7ias"}}),oe=D({and:{effect:je},or:{name:"getArticleApplicationByIdAdminFx",sid:"xttl3m"}}),$=D({and:{effect:ye},or:{name:"approveApplicationFx",sid:"uj3y1n"}}),C=D({and:{effect:De},or:{name:"declineApplicationFx",sid:"j0ezei"}}),Me=ge(i=>W(void 0,[i],function*({params:e,isAdmin:t}){t?oe(e):se(e)}),{name:"getArticleApplicationFx",sid:"-z4tguj"});p({and:[{clock:z,source:k.$data,fn:(e,t)=>({params:t,isAdmin:!!(e!=null&&e.Data.Apps.Science.Roles.some(i=>i.Name==="Admin"))}),target:Me}],or:{sid:"-fuqvbe"}});const be=Y({sid:"bpj5we",fn:()=>xe([b]),name:"pageLoading",method:"pending"});p({and:[{clock:L.open,source:k.$data,filter:e=>!(e!=null&&e.Data.Apps.Science.Roles.some(t=>t.Name==="Admin")),fn:()=>({limit:100,offset:0,statuses:["AdminReview","DeanOrDeputyDeanReview","HeadOfDepartmentReview"]}),target:[Re]}],or:{sid:"-fdp8x7"}});p({and:[{clock:L.open,source:k.$data,filter:e=>!!(e!=null&&e.Data.Apps.Science.Roles.some(t=>t.Name==="Admin")),fn:()=>({limit:100,offset:0,statuses:["AdminReview","DeanOrDeputyDeanReview","HeadOfDepartmentReview"]}),target:[b]}],or:{sid:"-ew3txn"}});p({and:[{clock:ne.open,target:z}],or:{sid:"-eeiey3"}});Y({sid:"-ecb8kn",fn:()=>ue({clock:ie,target:M}),name:"none",method:"reset"});ae.on(b.doneData,(e,{data:t})=>t);M.on([se.doneData,oe.doneData],(e,t)=>t);p({and:[{clock:R,target:$}],or:{sid:"-dwd7d6"}});p({and:[{clock:N,target:C}],or:{sid:"-dimcj5"}});w.on(R,(e,{id:t})=>new Map(e).set(t,"approving"));w.on(N,(e,{id:t})=>new Map(e).set(t,"declining"));p({and:[{clock:$.done,target:O.evokePopUpMessage.prepend(()=>({message:"Заявка одобрена",type:"success"}))}],or:{sid:"vuvuvv"}});p({and:[{clock:C.done,target:O.evokePopUpMessage.prepend(()=>({message:"Заявка отклонена",type:"success"}))}],or:{sid:"vyqf1e"}});p({and:[{clock:[$.fail,C.fail],target:O.evokePopUpMessage.prepend(()=>({message:"Что-то пошло не так",type:"failure"}))}],or:{sid:"we4nni"}});w.on([$.finally,C.finally],(e,{params:{id:t}})=>{const i=new Map(e);return i.delete(t),i});p({and:[{clock:[$.done,C.done],fn:()=>({limit:100,offset:0,statuses:["AdminReview","DeanOrDeputyDeanReview","HeadOfDepartmentReview"]}),target:b}],or:{sid:"xa0q2g"}});p({and:[{clock:[$.done,C.done],source:M,filter:Boolean,fn:e=>({applicationId:e.id}),target:z}],or:{sid:"xeyvep"}});const Ue=()=>{J(L);const e=Ae(ae,s=>s.map(m=>T(G({},m),{status:f[m.status]}))),{open:t}=_(),[i,c]=y([be,k.$data]),d=c==null?void 0:c.Data.Apps.Science.Roles.find(s=>s.Name==="Admin");return n.jsx(ke,{padding:"10px",children:n.jsx(we,{children:n.jsx(l,{d:"column",ai:"flex-start",gap:"1rem",children:i?n.jsx(l,{jc:"center",style:{minHeight:"200px"},children:n.jsx(Z,{})}):e.length>0?e.map(s=>n.jsxs(l,{d:"column",ai:"flex-start",gap:"0.5rem",brad:"1rem",style:{backgroundColor:"var(--block-content)",border:"1px solid var(--blockBorder)"},p:"1rem",cursor:"pointer",onClick:()=>{ie(),t(n.jsx(Be,{applicationId:s.id}),"Информация о заявке")},children:[n.jsx(H,{align:"left",size:4,children:s.article.title}),d&&n.jsx(h,{width:"fit-content",type:s.status==="Принято"?"success":s.status==="Отклонено"?"failure":"alert",title:s.status||"—",align:"center",icon:null}),n.jsxs(j,{children:["Дата подачи:"," ",K(new Date(s.createdAt),"dd MMMM yyyy, HH:mm",{locale:te})]})]},s.id)):n.jsx($e,{text:"Нет заявок"})})})})},Be=({applicationId:e})=>{var t;J(ne,{applicationId:e});const{isMobile:i}=ee(),{close:c,open:d}=_(),[s,m]=X.useState(""),[a,r,g]=y([M,R,w]),[A]=y([k.$data]),v=A==null?void 0:A.Data.Apps.Science.Roles.find(x=>x.Name==="Admin");return a?n.jsxs(l,{d:"column",gap:"1rem",style:{minWidth:"300px"},w:"100%",ai:"flex-start",mw:"600px",children:[n.jsxs(j,{align:"left",children:["Название: ",a.article.title]}),n.jsxs(j,{align:"left",children:["Автор заявки:"," ",n.jsx("span",{style:{color:(t=a.authorsFractionShares)!==null&&t!==void 0&&t.some(x=>x.isApplyingAuthor)?o.green.main:"unset"},children:a.author.fullName})]}),a.authorsFractionShares&&n.jsx(Oe,{authorsFractionShares:a.authorsFractionShares}),n.jsxs(j,{children:["Дата подачи: ",K(new Date(a.createdAt),"dd MMMM yyyy, HH:mm",{locale:te})]}),n.jsxs(l,{ai:"flex-start",gap:"1rem",children:[n.jsx(j,{align:"left",children:"Статус:"}),n.jsx(Se,{acceptanceChain:a.acceptanceChain,declineReason:a.declineReason,status:a.status,applicationId:a.id})]}),a.status!=="Accepted"&&a.status!=="Declined"&&n.jsx(l,{gap:"1rem",children:a.status==="AdminReview"?n.jsxs(l,{d:"column",gap:"0.5rem",ai:"flex-start",children:[n.jsx(H,{align:"left",size:5,children:"Укажите фракционную долю автора"}),n.jsx(Ce,{value:s,setValue:m,placeholder:"Фракционная доля",type:"number",width:"100%",maxWidth:"100%"}),n.jsxs(l,{gap:"0.25rem",children:[n.jsx(u,{text:"Отказать",textColor:o.red.main,hoverBackground:o.red.transparent3,onClick:()=>{d(n.jsx(V,{applicationId:a.id}),"Отказать")},width:"100%"}),n.jsx(u,{text:"Подтвердить",loading:g.get(e)==="approving",textColor:o.green.main,background:o.green.transparent3,onClick:()=>{r({id:e,fractionShare:Number(s)})},width:"100%",isActive:!!s,notActiveClickMessage:"Введите фракционную долю"})]})]}):n.jsxs(l,{gap:"0.25rem",children:[n.jsx(u,{text:"Отказать",textColor:o.red.main,hoverBackground:o.red.transparent3,onClick:()=>{d(n.jsx(V,{applicationId:a.id}),"Отказать")},width:"100%"}),(!v||i)&&n.jsx(u,{text:"Подтвердить",loading:g.get(e)==="approving",textColor:o.green.main,background:o.green.transparent3,onClick:()=>{r({id:e,fractionShare:null}),v||c()},width:"100%"})]})})]}):n.jsx(l,{jc:"center",style:{minHeight:"200px"},children:n.jsx(Z,{})})},Se=({status:e,acceptanceChain:t,declineReason:i,applicationId:c})=>{var d,s,m,a,r,g,A,v;const{isMobile:x}=ee(),[B]=y([k.$data]),[U,P]=y([R,w]),q=B==null?void 0:B.Data.Apps.Science.Roles.find(le=>le.Name==="Admin");return e==="Accepted"?n.jsx(h,{width:"fit-content",type:"success",title:f.Accepted,align:"center",icon:null}):e==="Declined"?n.jsx(h,{width:"fit-content",type:"failure",title:f.Declined,align:"left",icon:null,children:i}):n.jsxs(l,{d:"column",ai:"flex-start",gap:"0.25rem",children:[n.jsxs(l,{jc:"space-between",children:[n.jsx(h,{width:x?"100%":"fit-content",type:(d=t.headOfDepartment)!==null&&d!==void 0&&d.isApproved?"success":"alert",title:f.HeadOfDepartmentReview,align:"center",icon:null}),q&&!((s=t.headOfDepartment)!==null&&s!==void 0&&s.isApproved)&&!x&&n.jsx(u,{text:"Подтвердить",loading:P.get(c)==="approving",textColor:o.green.main,background:o.green.transparent3,onClick:()=>{U({id:c,fractionShare:null})}})]}),n.jsxs(l,{jc:"space-between",children:[n.jsx(h,{width:x?"100%":"fit-content",type:(m=t.deanOrDeputyDean)!==null&&m!==void 0&&m.isApproved?"success":(a=t.headOfDepartment)!==null&&a!==void 0&&a.isApproved?"alert":"tip",title:f.DeanOrDeputyDeanReview,align:"center",icon:null}),q&&((r=t.headOfDepartment)===null||r===void 0?void 0:r.isApproved)&&!((g=t.deanOrDeputyDean)!==null&&g!==void 0&&g.isApproved)&&!x&&n.jsx(u,{text:"Подтвердить",loading:P.get(c)==="approving",textColor:o.green.main,background:o.green.transparent3,onClick:()=>{U({id:c,fractionShare:null})}})]}),n.jsx(h,{width:x?"100%":"fit-content",type:(A=t.admin)!==null&&A!==void 0&&A.isApproved?"success":(v=t.deanOrDeputyDean)!==null&&v!==void 0&&v.isApproved?"alert":"tip",title:f.AdminReview,align:"center",icon:null})]})},Oe=({authorsFractionShares:e})=>n.jsxs(j,{align:"left",children:["Авторы:"," ",e==null?void 0:e.map((t,i)=>n.jsxs("span",{style:{color:t.isApplyingAuthor?o.green.main:"unset"},children:[t.authorName," (",t.fractionShare,")",i!==(e==null?void 0:e.length)-1&&", "]},i))]}),V=({applicationId:e})=>{const{back:t}=_(),[i,c]=X.useState(""),[d,s]=y([N,w]);return n.jsxs(l,{d:"column",gap:"1rem",style:{minWidth:"300px"},w:"400px",mw:"100%",children:[n.jsx(H,{align:"left",size:5,style:{marginBottom:"0.5rem"},children:"Укажите причину"}),n.jsx(Fe,{value:i,setValue:c,placeholder:"Причина отказа",rows:4}),n.jsxs(l,{gap:"0.25rem",children:[n.jsx(u,{text:"Закрыть",textColor:"var(--text)",onClick:t,width:"100%"}),n.jsx(u,{text:"Отказать",loading:s.get(e)==="approving",textColor:o.red.main,hoverBackground:o.red.transparent3,onClick:()=>{d({id:e,declineReason:i}),t()},width:"100%",isActive:!!i,notActiveClickMessage:"Введите причину отказа"})]})]})};export{Ue as default};
