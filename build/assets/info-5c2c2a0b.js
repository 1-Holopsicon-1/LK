import{s as E,n as C,j as e,r as P,Q as M,T as N,cM as T}from"./vendor-08ab745b.js";import{aq as h,h as v,X as c,l as k,M as j,au as f,G as o,at as W,q as b,aU as y,aV as V,aW as $,d as J,V as B,aX as q,ax as x,P as z,aY as O,ay as L,H as F}from"./index-0892b83f.js";import{D as X}from"./dev-mode-message-76e05c08.js";import{A as _,F as G}from"./forbidden-72913831.js";const S=a=>a==="Approved"?"success":a==="Declined"||a==="Expired"?"failure":a==="Unknown"?"hint":"alert",D=({employee:a,role:i,userId:n,id:r})=>{const[p,t]=C([h.approve,h.reject]),l=a?.approvalStatus||(a?.employeeVerdicts?.every(s=>s.approvalStatus==="Approved")&&a.zkguApprovalStatus==="Approved"&&a.selfApprovalStatus==="Approved"&&a.orderStatus==="Ready"?"Approved":a?.employeeVerdicts?.some(s=>s.approvalStatus==="Declined")||a.zkguApprovalStatus==="Declined"||a.selfApprovalStatus==="Declined"?"Declined":"InProgress");return e.jsxs(H,{children:[e.jsx(v,{align:"left",size:4,children:a.initials}),e.jsxs(v,{align:"left",size:5,children:[a.divisionName,", ",a.position]}),a.paymentIdentifier&&e.jsx(c,{children:a.paymentIdentifier}),e.jsxs(c,{children:["Сумма: ",a.sum," руб."]}),e.jsxs(c,{children:["Период: ",k(a.startDate)," - ",k(a.endDate)]}),e.jsx(j,{type:l==="Approved"?"success":l==="Declined"?"failure":"alert",title:f[l]||"—",align:"left",icon:null,children:a.commentary}),i==="Initiator"&&e.jsxs(e.Fragment,{children:[a.employeeVerdicts?.map(s=>e.jsxs(o,{w:"100%",jc:"space-between",ai:"center",children:[e.jsxs(o,{d:"column",ai:"flex-start",children:[e.jsx(c,{fontSize:"0.9rem",children:s.approverPosition}),e.jsx(c,{children:s.approverName})]}),e.jsx(j,{minWidth:"180px",width:"180px",type:S(s.approvalStatus),icon:s.approvalStatus==="Unknown"?null:void 0,title:f[s.approvalStatus]||"—",align:s.approvalStatus==="Unknown"?"center":"left"})]},s.approverEmployeeId)),e.jsxs(o,{w:"100%",jc:"space-between",ai:"center",children:[e.jsx(c,{fontSize:"0.9rem",children:"Должностное лицо УЭФ"}),e.jsx(j,{width:"180px",type:S(a.zkguApprovalStatus),icon:a.zkguApprovalStatus==="Unknown"?null:void 0,title:f[a.zkguApprovalStatus]||"—",align:a.zkguApprovalStatus==="Unknown"?"center":"left"})]}),e.jsxs(o,{w:"100%",jc:"space-between",ai:"center",children:[e.jsxs(o,{d:"column",ai:"flex-start",children:[e.jsx(c,{fontSize:"0.9rem",children:"Работник (получатель надбавки)"}),e.jsx(c,{children:a.initials})]}),e.jsx(j,{minWidth:"180px",width:"180px",type:S(a.selfApprovalStatus),icon:a.selfApprovalStatus==="Unknown"?null:void 0,title:f[a.selfApprovalStatus]||"—",align:a.selfApprovalStatus==="Unknown"?"center":"left"})]}),a.orderStatus&&e.jsxs(o,{w:"100%",jc:"space-between",ai:"center",children:[e.jsx(o,{d:"column",ai:"flex-start",children:e.jsx(c,{fontSize:"0.9rem",children:"Статус приказа"})}),e.jsx(j,{minWidth:"180px",width:"180px",type:a.orderStatus==="Ready"?"success":"alert",title:W[a.orderStatus]||"—"})]})]}),i==="Approver"&&l!=="Approved"&&l!=="Declined"&&e.jsxs(o,{jc:"space-between",children:[e.jsx(b,{text:"Отказать",background:"var(--red)",textColor:"white",onClick:()=>{t({allowanceId:r,approverEmployeeId:n,employeeId:a.id})}}),e.jsx(b,{text:"Согласовать",background:"var(--green)",textColor:"white",onClick:()=>{p({allowanceId:r,approverEmployeeId:n,employeeId:a.id})}})]})]})},H=E.div.withConfig({componentId:"sc-n1ez6c-0"})(["width:100%;display:flex;flex-direction:column;gap:0.5rem;background-color:var(--block-content);padding:1rem 0.5rem;border-radius:0.5rem;"]),U=({file:a})=>{const[i,n]=P.useState(!1);return e.jsx(y,{onClick:r=>r.preventDefault(),children:e.jsxs("div",{className:"file-body",onClick:()=>{a.sizeB?(n(!0),fetch(`${V}files?${new URLSearchParams({fileId:a.id})}`,{headers:{Authorization:`Bearer ${$()}`}}).then(r=>r.blob()).then(r=>{window.open(window.URL.createObjectURL(r),"_blank")?.focus()}).catch(r=>{console.log(r)}).finally(()=>n(!1))):J.evokePopUpMessage({message:"Файл недоступен",type:"failure"})},children:[e.jsx("div",{className:"image-container",children:i?e.jsx(B,{width:"16px",height:"16px"}):a.contentType.includes("image")?e.jsx(M,{}):e.jsx(N,{})}),e.jsxs("div",{className:"name-and-size",children:[e.jsxs("b",{className:"file-name",children:[a.name,".",a.extension]}),a.digitalSignature&&e.jsxs(c,{fontSize:"0.7em",children:["Подпись: ",a.digitalSignature]}),!!a.sizeB&&e.jsx(c,{fontSize:"0.7em",children:q(a.sizeB)})]})]})})},ee=()=>{const{id:a}=T(),[i,n,r,p,t,l,s,w,d,A]=C([h.infoPageMounted,x.allowance.data,x.allowance.loading,x.allowance.error,x.roles,x.jobRoles,x.allowance.role,h.setCurrentRole,x.allowance.jobId,h.setCurrentJobId]),R=t.includes("Initiator"),I=t.includes("Approver"),g=R||I;return g&&(d||(I?(A(l?.find(u=>u.roles.includes("Approver"))?.employeeId||""),w("Approver")):(A(l?.find(u=>u.roles.includes("Initiator"))?.employeeId||""),w("Initiator")))),P.useEffect(()=>{g&&s&&d&&i({id:a,role:s,userId:d})},[a,s,d,g]),r?e.jsx(z,{children:e.jsx(o,{w:"100%",jc:"center",ai:"center",children:e.jsx(B,{})})}):g?e.jsx(z,{children:e.jsx(O,{load:()=>{},data:n,loading:r,error:p?p.message:null,children:s&&d?e.jsxs(e.Fragment,{children:[e.jsx(X,{}),t.length>1?e.jsx(L,{pages:[{id:"Approver",title:"Согласование",content:e.jsx(m,{id:a,role:s,jobId:d,files:n?.files,employees:n?.employees})},{id:"Initiator",title:"Установление",content:e.jsx(m,{id:a,role:s,jobId:d,files:n?.files,employees:n?.employees})}],currentPage:s==="Initiator"?1:0,onChangePage:u=>{w(u||"Approver")},appearance:!1}):t[0]==="Initiator"?e.jsx(m,{id:a,role:"Initiator",jobId:d,files:n?.files,employees:n?.employees}):e.jsx(m,{id:a,role:"Approver",jobId:d,files:n?.files,employees:n?.employees})]}):e.jsx(G,{text:"Произошла ошибка"})})}):e.jsx(_,{jobRoles:l})};function m({id:a,files:i,employees:n,role:r,jobId:p}){return i?.application.length||i?.other.length?e.jsx(L,{pages:[{title:"Сотрудники",content:e.jsx(o,{d:"column",gap:"1rem",w:"100%",children:n?.map((t,l)=>e.jsxs(e.Fragment,{children:[l!==0&&e.jsx(F,{}),e.jsx(D,{employee:t,role:r,userId:p,id:a},t.id)]}))})},{title:"Файлы",content:e.jsxs(o,{d:"column",gap:"2rem",children:[!!i?.application.length&&e.jsxs(e.Fragment,{children:[e.jsx(v,{size:4,align:"left",children:"Файлы заявления"}),e.jsx(o,{d:"column",gap:"1rem",children:i?.application.map(t=>e.jsx(U,{file:t},t.id))})]}),!!i?.other.length&&e.jsxs(e.Fragment,{children:[!!i?.application.length&&e.jsx(v,{size:4,align:"left",children:"Другое"}),e.jsx(o,{d:"column",gap:"0.5rem",children:i?.other.map(t=>e.jsx(U,{file:t},t.id))})]})]})}]}):e.jsx(o,{d:"column",gap:"1rem",w:"100%",children:n?.map((t,l)=>e.jsxs(e.Fragment,{children:[l!==0&&e.jsx(F,{}),e.jsx(D,{employee:t,role:r,userId:p,id:a},t.id)]}))})}export{ee as default};
