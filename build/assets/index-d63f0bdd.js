var x=(e,t,s)=>new Promise((a,i)=>{var p=m=>{try{f(s.next(m))}catch(A){i(A)}},l=m=>{try{f(s.throw(m))}catch(A){i(A)}},f=m=>m.done?a(m.value):Promise.resolve(m.value).then(p,l);f((s=s.apply(e,t)).next())});import{d as Y,p as c,h as v,bO as b,k as y,N as Z,f as w,x as h,cG as q,i as r,r as ee,j as n,cH as te}from"./vendor-8a1e4858.js";import{n as F,o as M,p as se,q as ne,f as oe,r as ae,k as ie,t as re,l as ce,T as le,v as de,I as $,w as L,i as pe}from"./index-28c96bb4.js";const me="https://api.mospolytech.ru/ticketsservice",j=Y.create({baseURL:me}),ue=e=>x(void 0,null,function*(){const t=new FormData;t.append("ApplicantName",e.applicantName),t.append("Description",e.description),t.append("ServiceAreaId",e.serviceAreaId),t.append("ServiceCategoryId",e.serviceCategoryId),e.phone&&t.append("phone",e.phone),e.location&&t.append("location",e.location),e.room&&t.append("location",e.room),e.email&&t.append("email",e.email),e.room&&t.append("room",e.room),e.files&&e.files[0]&&t.append("files",e.files[0]);const{data:s}=yield j.post("/tickets",t,{headers:{"Content-Type":"multipart/form-data"}});return s}),ve=()=>x(void 0,null,function*(){const{data:e}=yield j.get("/handbooks/locations");return e}),he=()=>x(void 0,null,function*(){const{data:e}=yield j.get("/handbooks/service-areas");return e}),ge=t=>x(void 0,[t],function*({serviceArea:e}){const{data:s}=yield j.get(`/handbooks/${e}`);return s}),u=c({name:"pageMounted",sid:"c5fr4t"}),_=c({name:"sendForm",sid:"-dc3oa1"}),I=c({name:"setFiles",sid:"-521qo1"}),B=c({name:"setName",sid:"3yh40o"}),E=c({name:"setPhone",sid:"-hbpn1l"}),Q=c({name:"setEmail",sid:"-8nd6m0"}),V=c({name:"setNote",sid:"azuum"}),C=c({name:"setServiceType",sid:"se3d14"}),R=c({name:"setService",sid:"de1td6"}),D=c({name:"setLocation",sid:"f6rur3"}),P=c({name:"setRoom",sid:"e8nich"}),U=v([],{name:"$files",sid:"773rl7"}).on(I,(e,t)=>t).reset(u),z=v("",{name:"$note",sid:"7g99fs"}).on(V,(e,t)=>t).reset(u),G=v("",{name:"$name",sid:"mxv2gp"}).on(B,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{if(!t)return"";const{name:s,surname:a,patronymic:i}=t;return`${s} ${a} ${i}`}),H=v("",{name:"$phone",sid:"3wmc64"}).on(E,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.phone)!==null&&s!==void 0?s:""}),O=v("",{name:"$email",sid:"dj21e3"}).on(Q,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.email)!==null&&s!==void 0?s:""}),S=b(C,null,{name:"$serviceType",sid:"-uj8teu"}).reset(u),W=b(R,null,{name:"$service",sid:"m4yxcc"}).reset([u,S]),J=b(P,"",{name:"$room",sid:"-brldhx"}).reset(u),K=v(null,{name:"$location",sid:"-1ex79w"}).on(D,(e,t)=>t).reset(u),X=v("",{name:"$applicationNumber",sid:"-e32p3j"}).reset(u),g=y({sid:"h4z3m",fn:()=>Z({handler:ue}),name:"sendFormMutation",method:"createMutation"}),N=y({sid:"-ttslb8",fn:()=>w({handler:ve}),name:"locationsQuery",method:"createQuery"}),T=y({sid:"851yfd",fn:()=>w({handler:he}),name:"serviceAreasQuery",method:"createQuery"}),k=y({sid:"s8nfeq",fn:()=>w({handler:ge}),name:"servicesQuery",method:"createQuery"});h({and:[{clock:u,target:[g.reset,M.getUserDataApplicationsFx,N.start,T.start]}],or:{sid:"-y7y2lb"}});h({and:[{clock:h({and:[{clock:S,filter:Boolean}],or:{name:"clock",sid:"-sq974w"}}),fn:({id:e})=>({serviceArea:e.toString()}),target:k.start}],or:{sid:"-y5qw7v"}});h({and:[{clock:_,source:{files:U,name:G,phone:H,email:O,note:z,serviceType:S,service:W,location:K,room:J},filter:({serviceType:e,service:t})=>!!e&&!!t,fn:({files:e,name:t,phone:s,email:a,note:i,service:p,location:l,room:f,serviceType:m})=>({applicantName:t,description:i,email:a,phone:s,location:l==null?void 0:l.title,room:f,files:e,serviceAreaId:m.id.toString(),serviceCategoryId:p.id.toString()}),target:g.start}],or:{sid:"-xc206d"}});h({and:[{clock:g.finished.success,fn:({result:e})=>e.ticketId,target:X}],or:{sid:"f5qvx0"}});h({and:[{clock:g.$failed,fn:()=>({message:"Произошла ошибка. Попробуйте позднее",type:"failure"}),target:se.evokePopUpMessage}],or:{sid:"fl54j4"}});const d={pageMounted:u,setFiles:I,setName:B,setPhone:E,setEmail:Q,setNote:V,setServiceType:C,setService:R,setLocation:D,setRoom:P,sendForm:_},o={locations:N.$data,serviceAreas:T.$data,services:k.$data,servicesLoading:k.$pending,pageLoading:y({sid:"gkpha7",fn:()=>q(N.$pending,T.$pending,M.getUserDataApplicationsFx.pending),name:"pageLoading",method:"or"}),files:U,note:z,name:G,phone:H,email:O,serviceType:S,service:W,location:K,room:J,loading:g.$pending,done:g.$succeeded,applicationNumber:X},Fe=()=>{const[e,t,s,a]=r([d.pageMounted,o.done,o.applicationNumber,o.pageLoading]),i=r(ne.isAuthenticated);return ee.useEffect(()=>{e()},[]),a?n.jsx(oe,{h:"100%",d:"column",ai:"center",jc:"center",children:n.jsx(ae,{})}):n.jsx(ie,{padding:"1rem",style:{overflow:"auto",alignItems:"start"},children:n.jsxs(re,{noHeader:!0,children:[!i&&n.jsx(ce,{}),n.jsx(le,{size:4,align:"left",children:"Техническое обслуживание"}),t?n.jsxs(n.Fragment,{children:["Спасибо! Ваш номер заявки ",s,"."]}):n.jsxs(n.Fragment,{children:[n.jsx(xe,{}),n.jsx(ye,{}),n.jsx($e,{}),n.jsx(Ae,{}),n.jsx(Ne,{}),n.jsx(je,{}),n.jsx(Se,{}),n.jsx(fe,{}),n.jsx(Te,{})]})]})})},fe=()=>{const[e,t]=r([o.note,d.setNote]);return n.jsx(de,{placeholder:"Опишите проблему и точное местоположение",required:!0,title:"Описание заявки",value:e,setValue:t})},xe=()=>{const[e,t]=r([o.name,d.setName]);return n.jsx($,{title:"Фамилия Имя Отчество",placeholder:"Введите ФИО",required:!0,value:e,setValue:t})},ye=()=>{const[e,t]=r([o.phone,d.setPhone]);return n.jsx($,{title:"Контактный телефон (сотовый в формате +7-ххх-ххх-хх-хх или внутренний в формате хххх)",placeholder:"Введите контактный телефон",type:"tel",value:e,setValue:t})},$e=()=>{const[e,t]=r([o.email,d.setEmail]);return n.jsx($,{title:"Адрес электронной почты",placeholder:"Введите адрес электронной почты",value:e,type:"email",setValue:t})},je=()=>{const[e]=r([o.serviceAreas]),[t,s]=r([o.serviceType,d.setServiceType]);return n.jsx(L,{title:"Выберите направление заявки",placeholder:"Выберите направление заявки",required:!0,isActive:!!e,width:"100%",items:e||[],selected:t,setSelected:s})},Se=()=>{const[e,t]=r([o.serviceType,o.services]),[s,a]=r([o.service,d.setService]);return n.jsx(L,{title:"Выберите необходимый сервис",placeholder:"Начните вводить название сервиса",isActive:!!e&&!!t,required:!0,width:"100%",items:t||[],selected:s,setSelected:a,withSearch:!0})},Ae=()=>{const[e,t]=r([o.location,d.setLocation]),s=te(o.locations,i=>{var p;return(p=i==null?void 0:i.map(l=>({id:l.name,title:l.name})))!==null&&p!==void 0?p:[]}),[a]=r([o.serviceType]);return n.jsx(L,{title:"Локация, где необходимо выполнить заявку",placeholder:"Начните вводить локацию",required:(a==null?void 0:a.id)==="campus",width:"100%",isActive:!!(s!=null&&s.length),items:s!=null?s:[],selected:e,setSelected:t,withSearch:!0})},Ne=()=>{const[e,t]=r([o.room,d.setRoom]);return n.jsx($,{title:"№ аудитории",placeholder:"Введите № аудитории",value:e,setValue:t})},Te=()=>{const[e,t,s,a,i,p,l]=r([d.sendForm,o.done,o.loading,o.note,o.name,o.serviceType,o.service]);return n.jsx(pe,{text:t?"Отправлено":"Отправить",action:e,isLoading:s,completed:t,setCompleted:()=>{},repeatable:!1,buttonSuccessText:"Отправлено",isDone:t,isActive:!!a&&!!i&&!!p&&!!l,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})};export{Fe as default};
