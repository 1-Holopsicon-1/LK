var B=(e,i,t)=>new Promise((r,s)=>{var o=p=>{try{d(t.next(p))}catch(c){s(c)}},b=p=>{try{d(t.throw(p))}catch(c){s(c)}},d=p=>p.done?r(p.value):Promise.resolve(p.value).then(o,b);d((t=t.apply(e,i)).next())});import{s as l,j as n,dl as Y,dm as X,r as f,R as K,dn as V}from"./vendor-fdf02817.js";import{al as J,am as Z,X as g,E as D,dU as v,dV as $,y as Q,d as u,ab as ee,dW as ne,S as j,ap as te,dX as ie,T as S,K as h,bj as re,D as se,aG as I,$ as P,an as oe,H as m,dY as E,s as ae,W as de,P as ce,b4 as le,Z as O,q as ue}from"./index-2172af78.js";const pe=i=>B(void 0,[i],function*({semestr:e}){var t;return(t=yield J.get(`?getAcademicPerformance&semestr=${e}&token=${Z()}`))===null||t===void 0||(t=t.data)===null||t===void 0?void 0:t.academicPerformance}),C=(e,i)=>{const t=new Date(e).getMonth();return t>1&&t<8?+i*2:+i*2-1},xe=e=>{const i=C(new Date().toISOString(),e),t=[];for(let r=1;r<=i;r++)t.push({id:r,title:`${r} семестр`});return t.push({id:-1,title:"Все семестры"}),t};function A(e){const i={};for(const t of e)i[t.exam_type]?i[t.exam_type].push(t):i[t.exam_type]=[t];return i}function q(e,i){const t=e+Math.floor((i-1)/2);return`${t}/${t+1}`}function ge(e,i,t){return t===-1?e.filter(r=>(r==null?void 0:r.year)===q(i,Number(r.semestr))):e==null?void 0:e.filter(r=>(r==null?void 0:r.year)===q(i,t))}const he=(e,i)=>A(i.filter(t=>g(t.name).includes(g(e))||g(t.teacher).includes(g(e))||g(D(t.exam_date)).includes(g(e))||g(t.bill_num).includes(g(e)))),z=(e,i)=>{if(e){var t;return i?v[e]||v.default:((t=v[e])===null||t===void 0?void 0:t.main)||v.default.main}else return"var(--grey)"},me=e=>e.split(" ").reduce((i,t,r)=>(r===0?i.push(t):i.push(`${t[0]}.`),i),[]).join(" "),fe=l.div.withConfig({componentId:"sc-1mqkodv-0"})(["display:flex;align-items:center;justify-content:center;color:",";width:",";height:22px;min-width:22px;min-height:22px;border-radius:50%;svg{width:100%;height:100%;}"],({grade:e})=>z(e),({superWide:e})=>e?"105px":"22px"),je=({grade:e})=>n.jsx(fe,{grade:e,superWide:e==="Не явился",children:e==="Не явился"?e:e&&($[e]>2?n.jsx(Y,{}):n.jsx(X,{}))}),be=l.div.withConfig({componentId:"sc-blq100-0"})(["width:100%;display:flex;min-height:60px;align-items:center;justify-content:space-between;padding:15px 0;box-sizing:border-box;cursor:pointer;opacity:",";"],({isGraded:e})=>e?1:.4),ve=l.div.withConfig({componentId:"sc-blq100-1"})(["display:flex;margin-right:10px;font-weight:500;hyphens:auto;@media (max-width:1000px){min-width:0px;}"]),ke=l.strong.withConfig({componentId:"sc-blq100-2"})(["color:",";font-weight:600;width:",";display:flex;justify-content:flex-end;"],({color:e})=>e,({superWide:e})=>e?"105px":"30px"),we=({item:e,type:i})=>{const{open:t}=Q(),{name:r,grade:s}=e,o=z(s),b=()=>e.grade&&t(n.jsx(Ce,{item:e,color:z(s,!0)}));return n.jsxs(be,{onClick:b,isGraded:!!e.grade,children:[n.jsxs(u,{gap:"16px",children:[n.jsx(ee,{color:o,borderRadius:"9px",children:ne(r)}),n.jsxs(u,{d:"column",ai:"flex-start",gap:"4px",children:[n.jsx(ve,{children:r}),n.jsx(j,{children:n.jsx(te,{words:[me(e.teacher),D(e.exam_date)]})})]})]}),n.jsx(ke,{color:o,superWide:s==="Не явился",children:i==="Зачет"?n.jsx(je,{grade:s}):s==="Не явился"?"Не явился":s&&$[s]})]})},ye=l.div.withConfig({componentId:"sc-7hxibl-0"})(["width:400px;@media (max-width:800px){width:100%;}"]),Se=l.div.withConfig({componentId:"sc-7hxibl-1"})(["margin:20px 0;"]),Ce=({item:e,color:i})=>n.jsxs(ye,{children:[n.jsx(ie,{subjectName:e.name,color:i,noPadding:!0}),n.jsx(Se,{children:n.jsx(S,{size:3,align:"left",children:e.name})}),n.jsx(h,{keyStr:"Курс",value:e.course}),n.jsx(h,{keyStr:"Форма аттестации",value:e.exam_type}),n.jsx(h,{keyStr:"Дата проведения",value:D(e.exam_date)}),n.jsx(h,{keyStr:"Оценка",value:e.grade}),n.jsx(h,{keyStr:"Номер ведомости",value:e.bill_num}),n.jsx(h,{keyStr:"Семестр",value:C(e.exam_date,+e.course)}),n.jsx(h,{keyStr:"Кафедра",value:e.chair}),n.jsx(h,{keyStr:"Преподаватель",value:n.jsx(re,{id:void 0,type:"staff",name:e.teacher}),direction:"vertical"})]}),Ie=({items:e,type:i})=>n.jsx(n.Fragment,{children:e.map((t,r)=>n.jsxs(K.Fragment,{children:[n.jsx(we,{item:t,type:i}),r!==e.length-1&&n.jsx(se,{margin:"0",width:"100%"})]},t.id))}),ze=f.memo(Ie),De=({items:e,loading:i})=>{var t;return e?i?n.jsxs(u,{d:"column",ai:"flex-start",gap:"12px",children:[n.jsx(I,{shape:"rect",size:{width:"100px",height:"30px"}}),n.jsx(P,{quantity:5,avatarShape:"rect"}),n.jsx(I,{shape:"rect",size:{width:"100px",height:"30px"}}),n.jsx(P,{quantity:10,avatarShape:"rect"})]}):n.jsx(u,{d:"column",gap:"20px",children:(t=Object.keys(e))===null||t===void 0?void 0:t.map(r=>n.jsxs(u,{d:"column",children:[n.jsxs(S,{size:3,align:"left",width:"fit-content",children:[r,n.jsx(j,{children:e[r].length})]}),n.jsx(ze,{items:e[r]||[],type:r,loading:i})]},r))}):null},$e=f.memo(De),W=oe({api:{get:pe},prepareData:A});function Ae(e){const i={5:0,4:0,3:0,2:0},t=e.filter(r=>!!r.grade&&r.exam_type!=="Зачет").length;return e.forEach(({grade:r,exam_type:s})=>{s!=="Зачет"&&r!==void 0&&i[$[r]]++}),t===0?i:Object.keys(i).reduce((r,s)=>(r[+s]=i[+s]/t,r),{})}const _e=l.div.withConfig({componentId:"sc-1gg99m8-0"})(["overflow:hidden;width:100%;display:flex;gap:2px;height:10px;background:var(--block-content);"]),k=l.div.withConfig({componentId:"sc-1gg99m8-1"})(["width:",";height:10px;background:",";display:flex;border-radius:2px;justify-content:center;align-items:center;color:#fff;font-weight:500;display:",";"],({percent:e})=>`calc(${e} * 100%)`,({color:e})=>e,({percent:e})=>e===0&&"none"),w=l(u).withConfig({componentId:"sc-1gg99m8-2"})(["opacity:",";"],({percentage:e})=>e===0&&"0.2"),y=l.div.withConfig({componentId:"sc-1gg99m8-3"})(["min-width:10px;width:10px;height:10px;border-radius:2px;background:",";"],({color:e})=>e),Fe=({data:e,loading:i})=>{if(!e)return null;if(i)return n.jsx(I,{margin:"0",shape:"rect",size:{width:"100%",height:"12px"}});const t=Ae(e);return n.jsxs(u,{d:"column",gap:"10px",children:[n.jsxs(_e,{children:[n.jsx(k,{percent:t[5],color:m.green.main}),n.jsx(k,{percent:t[4],color:m.blue.main}),n.jsx(k,{percent:t[3],color:m.orange.main}),n.jsx(k,{percent:t[2],color:m.red.main})]}),n.jsxs(u,{gap:"30px",children:[n.jsxs(w,{percentage:t[5],gap:"4px",w:"fit-content",children:[n.jsx(y,{color:m.green.main}),n.jsxs(j,{children:["5 - ",(t[5]*100).toFixed(1),"%"]})]}),n.jsxs(w,{percentage:t[4],gap:"4px",w:"fit-content",children:[n.jsx(y,{color:m.blue.main}),n.jsxs(j,{children:["4 - ",(t[4]*100).toFixed(1),"%"]})]}),n.jsxs(w,{percentage:t[3],gap:"4px",w:"fit-content",children:[n.jsx(y,{color:m.orange.main}),n.jsxs(j,{children:["3 - ",(t[3]*100).toFixed(1),"%"]})]}),n.jsxs(w,{percentage:t[2],gap:"4px",w:"fit-content",children:[n.jsx(y,{color:m.red.main}),n.jsxs(j,{children:["2 - ",(t[2]*100).toFixed(1),"%"]})]})]})]})},Ne=l.div.withConfig({componentId:"sc-1p3ekrb-0"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#246655,#46b99b,#46a4b9);background-size:600% 600%;-webkit-animation:AStudentBackground 10s ease infinite;-moz-animation:AStudentBackground 10s ease infinite;animation:AStudentBackground 10s ease infinite;img{filter:drop-shadow(2px 4px 25px black);}@-webkit-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),Be=l.div.withConfig({componentId:"sc-1p3ekrb-1"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#243766,#4657b9,#46a4b9,#5d46b9);background-size:800% 800%;-webkit-animation:AnimationName 10s ease infinite;-moz-animation:AnimationName 10s ease infinite;animation:AnimationName 10s ease infinite;@-webkit-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),Pe=e=>{if(!e)return"empty";let i=0,t=!1;for(let r=0;r<e.length;r++){const{grade:s}=e[r];if(!s)return"empty";s!=="Отлично"&&s!=="Хорошо"&&s!=="Зачтено"&&(t=!0),s!=="Зачтено"&&s!=="Отлично"&&i++}return t?"empty":i===1?"almost":i>1?"empty":"a-student"},Ee=({data:e})=>{const i=Pe(e);return i==="empty"?null:i==="almost"?n.jsxs(Be,{children:[n.jsxs(u,{d:"column",ai:"flex-start",gap:"4px",children:[n.jsx(S,{size:3,align:"left",children:"Почти отличник"}),n.jsx(j,{fontSize:"1rem",children:"В следующий раз повезет"})]}),n.jsx(E,{src:"https://media2.giphy.com/media/Iblv3w6yvj9DTMwCsJ/giphy.gif?cid=6c09b952zc1sjle3291d5t30ls5aqkl8kw1xrr1klyc7h5gk&ep=v1_stickers_related&rid=giphy.gif&ct=g",width:"70px",height:"70px",loading:!1})]}):n.jsxs(Ne,{children:[n.jsxs(u,{d:"column",ai:"flex-start",gap:"4px",children:[n.jsx(S,{size:3,align:"left",children:"В этом семестре ты отличник!"}),n.jsx(j,{fontSize:"1rem",children:"Наши поздравления!"})]}),n.jsx(E,{src:"https://i.pinimg.com/originals/d3/c6/8a/d3c68aeb6f9ead3e57f80f12d12304b8.gif",width:"70px",height:"70px",loading:!1})]})},Me=()=>{var e,i;const{data:t,loading:r,error:s}=W.selectors.useData(),{data:{user:o}}=ae.useUser(),b=f.useMemo(()=>{var a;return xe((a=o==null?void 0:o.course)!==null&&a!==void 0?a:0)},[o]),[d,p]=f.useState({id:C(new Date().toString(),(e=o==null?void 0:o.course)!==null&&e!==void 0?e:1),title:C(new Date().toString(),(i=o==null?void 0:o.course)!==null&&i!==void 0?i:1).toString()+" семестр"}),[c,M]=f.useState(null),_=c&&!Object.keys(c!=null?c:{}).find(a=>(a==null?void 0:a.length)!==0)&&!r,T=`${(d==null?void 0:d.id)!==-1?d==null?void 0:d.id:""}`,F=a=>{W.effects.getFx({semestr:a?`${(a==null?void 0:a.id)!==-1?a==null?void 0:a.id:""}`:T})},[x,G]=f.useState(null),[L,R]=f.useState(null);f.useEffect(()=>{if(o&&t){const a=Number(d==null?void 0:d.id),H=Number(o==null?void 0:o.enterYear.split("/")[0]),N=ge(t,H,a);G(N),R(A(N))}},[t]);const U=(x==null?void 0:x.length)===0&&!r;return n.jsx(de,{loading:r,load:F,error:s,data:x,children:n.jsx(ce,{topRightCornerElement:!!(o!=null&&o.id)&&n.jsx(le,{onClick:F,width:"150px",items:b,selected:d,setSelected:p}),children:U||!x?n.jsx(O,{text:"Данных за этот семестр нет, попробуйте другой!"}):n.jsxs(n.Fragment,{children:[!c&&!r&&n.jsx(Ee,{data:x}),n.jsx(ue,{whereToSearch:x,searchEngine:he,setResult:M,placeholder:"Поиск предметов",loadingOnType:!0}),_&&n.jsx(O,{text:"По данному запросу ничего не найдено",image:n.jsx(V,{})}),!_&&n.jsxs(u,{d:"column",gap:"40px",children:[n.jsx(Fe,{data:x,loading:r}),n.jsx($e,{items:c!=null?c:L,loading:r})]})]})})})};export{Me as default};
