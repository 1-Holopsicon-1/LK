import{n as o,j as e,r as x}from"./vendor-08ab745b.js";import{aZ as i,G as h,i as D,h as L,X as A,p as w,ax as m,aq as V,B as k,F as I,V as q,S as T,x as E,a1 as R,a_ as N,a$ as U,N as B,b0 as P,d as W,ap as M}from"./index-0892b83f.js";import{D as z}from"./dev-mode-message-76e05c08.js";import{A as O}from"./forbidden-72913831.js";const _=({subordinate:{employeeId:t,employeeName:r,divisionName:l,position:s,employmentType:n,rate:c}})=>{const{addItem:f,removeItem:v,setValue:j,value:S}=o(i.employees),{minDate:u}=o(i.period),a=S.find(p=>p.id===t),d=!!a;return e.jsxs(h,{gap:"0.5rem",onClick:()=>d?v(t):f(t),cursor:"pointer",brad:"0.5rem",hoverBackground:"var(--theme-5)",p:"0.5rem",ai:"flex-start",children:[e.jsx(D,{checked:d,setChecked:()=>d?v(t):f(t)}),e.jsxs(h,{gap:"0.5rem",d:"column",ai:"flex-start",children:[e.jsx(L,{align:"left",size:4,children:r}),e.jsx(A,{children:l}),e.jsx(A,{children:s}),e.jsxs(A,{children:[n,c&&` (ставка: ${c})`]}),d&&e.jsxs(h,{jc:"space-between",ai:"flex-end",gap:"0.5rem",onClick:p=>p.stopPropagation(),cursor:"auto",children:[e.jsx(w,{title:"Сумма",value:a?.sum||"",setValue:p=>{a&&j({...a,sum:p})},type:"number",required:!0,width:"38%",placeholder:"Сумма выплаты",isActive:d}),e.jsx(w,{title:"Дата начала",value:a?.startDate||"",setValue:p=>{a&&j({...a,startDate:p})},type:"date",required:!0,width:"30%",isActive:d,minValue:u}),e.jsx(w,{title:"Дата окончания",value:a?.endDate||"",setValue:p=>{a&&j({...a,endDate:p})},type:"date",required:!0,width:"30%",minValue:a?.startDate,isActive:d})]})]})]})},le=()=>{const[t,r,l,s,n,c,f,v,j,S]=o([m.rolesPending,V.createSupplement,m.supplementCreating,V.pageMounted,m.roles,m.completed,V.setCompleted,m.isActive,m.jobRoles,m.errorMessage]),u=c??!1,a=n.includes("Initiator");return x.useEffect(()=>{a&&s()},[a]),t?e.jsx(k,{isDone:u,children:e.jsx(I,{noHeader:!0,children:e.jsx(h,{w:"100%",jc:"center",ai:"center",children:e.jsx(q,{})})})}):a?e.jsx(k,{isDone:u,children:e.jsxs(I,{noHeader:!0,children:[e.jsx(z,{}),e.jsx($,{}),e.jsx(H,{}),e.jsx(G,{}),e.jsx(J,{}),e.jsx(X,{}),e.jsx(Y,{}),e.jsx(Q,{}),e.jsx(T,{text:u?"Отправлено":"Отправить",action:r,isLoading:l,completed:c,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:v,popUpFailureMessage:S,popUpSuccessMessage:"Данные формы успешно отправлены"})]})}):e.jsx(O,{jobRoles:j})};function $(){const{value:t,setValue:r}=o(i.job),l=o(m.jobRoles);if(!l)return null;const s=x.useMemo(()=>l.filter(n=>n.roles.includes("Initiator")).map(n=>({id:n.employeeId,title:n.division})),l);return x.useEffect(()=>{s.length===1&&r(s[0])},[s]),e.jsx(E,{title:"Должность / Подразделение",items:s,selected:s.length===1?s[0]:t,setSelected:r,isActive:s.length>1,required:!0,width:"100%"})}function H(){const t=o(m.paymentIdentifiers),{value:r,setValue:l}=o(i.paymentIdentifier);return x.useEffect(()=>{t.length===1&&l(t[0])},[t]),e.jsx(E,{title:"Вид надбавки",items:t,selected:r,setSelected:l,isActive:t.length>1,required:!0,width:"100%",withSearch:!0,placeholder:"Вид надбавки"})}function G(){const{startDate:t,setStartDate:r,endDate:l,setEndDate:s,minDate:n}=o(i.period);return e.jsxs(h,{jc:"space-between",gap:"0.5rem",children:[e.jsx(w,{title:"Дата начала",value:t,setValue:r,type:"date",required:!0,width:"49%",minValue:n}),e.jsx(w,{title:"Дата окончания",value:l,setValue:s,type:"date",required:!0,width:"49%",minValue:t})]})}function J(){const{value:t,setValue:r}=o(i.commentary);return e.jsx(R,{title:"Комментарий (предполагаемый источник финансирования)",placeholder:"Комментарий (предполагаемый источник финансирования, например, проект)",value:t,setValue:r})}function X(){const[t,r,l,s,n]=o([m.employees,i.employees.value,i.employees.allSelected,i.employees.selectAll,i.employees.deselectAll]),{value:c}=o(i.job),[f,v]=x.useState(!0),[j,S]=x.useState(!1),[u,a]=x.useState(""),[d,p]=x.useState(!1),F=x.useMemo(()=>{if(!t||!c)return[];const y=r.map(g=>g.id),C=d?t[c?.id].filter(g=>y.includes(g.employeeId)):t[c?.id];if(!u)return C;const b=u.toLowerCase();return C.filter(g=>g.employeeName.toLowerCase().includes(b)||g.divisionName.toLowerCase().includes(b)||g.position.toLowerCase().includes(b))},[t,c,u,d,r]);return e.jsxs(N,{openArea:f,children:[e.jsx(U,{title:"Сотрудники",included:j,optional:!1,setOpenArea:v,setIncluded:S,collapsed:!1,openArea:f}),e.jsx("div",{className:"inputs",children:c&&t?e.jsxs(h,{gap:"1.5rem",ai:"flex-start",d:"column",children:[e.jsx(B,{value:u,setValue:a,placeholder:"Поиск по сотрудникам"}),e.jsxs(h,{gap:"0.5rem",ai:"flex-start",d:"column",children:[e.jsx(D,{checked:d,setChecked:p,text:"Отобразить только выбранных"}),e.jsx(D,{checked:l,setChecked:y=>{y?s(t[c?.id].map(C=>C.employeeId)):n()},text:"Выбрать всех"})]}),e.jsx(h,{gap:"1rem",ai:"flex-start",d:"column",children:F.map(y=>e.jsx(_,{subordinate:y},y.employeeId))})]}):e.jsx(A,{children:"Выберите должность"})})]})}function Y(){const{value:t,setValue:r}=o(i.files),l=o(m.fileUploading);return e.jsx(P,{files:t,formats:["doc","pdf","docx"],setFiles:s=>{if(t.length<s.length&&t.some(n=>n.name===s[s.length-1].name)){W.evokePopUpMessage({message:"Имя файла не может повторятся",type:"failure"});return}r(s)},isActive:!l})}const Z={fiveToNine:"сотрудников",one:"сотрудник",twoToFour:"сотрудника",zero:"сотрудников"},K={fiveToNine:"Добавлено",one:"Добавлен",twoToFour:"Добавлено",zero:"Добавлено"};function Q(){const t=o(i.employees.value);return e.jsxs(A,{children:[M(Math.trunc(t?.length),K)," ",t?.length," ",M(Math.trunc(t?.length),Z)]})}export{le as default};
