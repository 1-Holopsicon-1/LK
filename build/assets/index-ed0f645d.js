import{s as c,j as t,d5 as Y,d6 as U,r as g,R as X,d7 as K}from"./vendor-8312535b.js";import{$ as V,g as J,aE as Q,bB as x,l as I,cT as f,cU as z,u as Z,G as d,bR as ee,cV as te,X as m,bC as ne,cW as ie,h as w,K as u,cX as re,H as se,cY as v,bQ as _,L as h,cZ as P,ai as oe,W as ae,P as ce,x as de,a2 as E,bp as le}from"./index-3ed27df5.js";const pe=async({semestr:e})=>{var r,n;return(n=(r=await V.get(`?getAcademicPerformance&semestr=${e}&token=${J()}`))==null?void 0:r.data)==null?void 0:n.academicPerformance};function A(e){const r={};for(const n of e)r[n.exam_type]?r[n.exam_type].push(n):r[n.exam_type]=[n];return r}function O(e,r){const n=e+Math.floor((r-1)/2);return`${n}/${n+1}`}function xe(e,r,n){return n===-1?e.filter(i=>(i==null?void 0:i.year)===O(r,Number(i.semestr))):e==null?void 0:e.filter(i=>(i==null?void 0:i.year)===O(r,n))}const G=Q({api:{get:pe},prepareData:A}),y=(e,r)=>{const n=new Date(e).getMonth();return n>1&&n<8?+r*2:+r*2-1},ue=e=>{const r=y(new Date().toISOString(),e),n=[];for(let i=1;i<=r;i++)n.push({id:i,title:`${i} семестр`});return n.push({id:-1,title:"Все семестры"}),n},he=(e,r)=>A(r.filter(n=>x(n.name).includes(x(e))||x(n.teacher).includes(x(e))||x(I(n.exam_date)).includes(x(e))||x(n.bill_num).includes(x(e)))),C=(e,r)=>{var n;return e?r?f[e]||f.default:((n=f[e])==null?void 0:n.main)||f.default.main:"var(--grey)"},ge=e=>e.split(" ").reduce((r,n,i)=>(i===0?r.push(n):r.push(`${n[0]}.`),r),[]).join(" "),me=c.div.withConfig({componentId:"sc-1mqkodv-0"})(["display:flex;align-items:center;justify-content:center;color:",";width:",";height:22px;min-width:22px;min-height:22px;border-radius:50%;svg{width:100%;height:100%;}"],({grade:e})=>C(e),({superWide:e})=>e?"105px":"22px"),fe=({grade:e})=>t.jsx(me,{grade:e,superWide:e==="Не явился",children:e==="Не явился"?e:e&&(z[e]>2?t.jsx(Y,{}):t.jsx(U,{}))}),je=c.div.withConfig({componentId:"sc-blq100-0"})(["width:100%;display:flex;min-height:60px;align-items:center;justify-content:space-between;padding:15px 0;box-sizing:border-box;cursor:pointer;opacity:",";"],({isGraded:e})=>e?1:.4),be=c.div.withConfig({componentId:"sc-blq100-1"})(["display:flex;margin-right:10px;font-weight:500;hyphens:auto;@media (max-width:1000px){min-width:0px;}"]),ke=c.strong.withConfig({componentId:"sc-blq100-2"})(["color:",";font-weight:600;width:",";display:flex;justify-content:flex-end;"],({color:e})=>e,({superWide:e})=>e?"105px":"30px"),we=({item:e,type:r})=>{const{open:n}=Z(),{name:i,grade:s}=e,a=C(s),S=()=>e.grade&&n(t.jsx(ve,{item:e,color:C(s,!0)}));return t.jsxs(je,{onClick:S,isGraded:!!e.grade,children:[t.jsxs(d,{gap:"16px",children:[t.jsx(ee,{color:a,borderRadius:"9px",children:te(i)}),t.jsxs(d,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(be,{children:i}),t.jsx(m,{children:t.jsx(ne,{words:[ge(e.teacher),I(e.exam_date)]})})]})]}),t.jsx(ke,{color:a,superWide:s==="Не явился",children:r==="Зачет"?t.jsx(fe,{grade:s}):s==="Не явился"?"Не явился":s&&z[s]})]})},ye=c.div.withConfig({componentId:"sc-7hxibl-0"})(["width:400px;@media (max-width:800px){width:100%;}"]),Se=c.div.withConfig({componentId:"sc-7hxibl-1"})(["margin:20px 0;"]),ve=({item:e,color:r})=>t.jsxs(ye,{children:[t.jsx(ie,{subjectName:e.name,color:r,noPadding:!0}),t.jsx(Se,{children:t.jsx(w,{size:3,align:"left",children:e.name})}),t.jsx(u,{keyStr:"Курс",value:e.course}),t.jsx(u,{keyStr:"Форма аттестации",value:e.exam_type}),t.jsx(u,{keyStr:"Дата проведения",value:I(e.exam_date)}),t.jsx(u,{keyStr:"Оценка",value:e.grade}),t.jsx(u,{keyStr:"Номер ведомости",value:e.bill_num}),t.jsx(u,{keyStr:"Семестр",value:y(e.exam_date,+e.course)}),t.jsx(u,{keyStr:"Кафедра",value:e.chair}),t.jsx(u,{keyStr:"Преподаватель",value:t.jsx(re,{id:void 0,type:"staff",name:e.teacher}),direction:"vertical"})]}),Ce=({items:e,type:r})=>t.jsx(t.Fragment,{children:e.map((n,i)=>t.jsxs(X.Fragment,{children:[t.jsx(we,{item:n,type:r}),i!==e.length-1&&t.jsx(se,{margin:"0",width:"100%"})]},n.id))}),Ie=g.memo(Ce),ze=({items:e,loading:r})=>{var n;return e?r?t.jsxs(d,{d:"column",ai:"flex-start",gap:"12px",children:[t.jsx(v,{shape:"rect",size:{width:"100px",height:"30px"}}),t.jsx(_,{quantity:5,avatarShape:"rect"}),t.jsx(v,{shape:"rect",size:{width:"100px",height:"30px"}}),t.jsx(_,{quantity:10,avatarShape:"rect"})]}):t.jsx(d,{d:"column",gap:"20px",children:(n=Object.keys(e))==null?void 0:n.map(i=>t.jsxs(d,{d:"column",children:[t.jsxs(w,{size:3,align:"left",width:"fit-content",children:[i,t.jsx(m,{children:e[i].length})]}),t.jsx(Ie,{items:e[i]||[],type:i,loading:r})]},i))}):null},Ae=g.memo(ze);function De(e){const r={5:0,4:0,3:0,2:0},n=e.filter(i=>!!i.grade&&i.exam_type!=="Зачет").length;return e.forEach(({grade:i,exam_type:s})=>{s!=="Зачет"&&i!==void 0&&r[z[i]]++}),n===0?r:Object.keys(r).reduce((i,s)=>(i[+s]=r[+s]/n,i),{})}const Be=c.div.withConfig({componentId:"sc-1gg99m8-0"})(["overflow:hidden;width:100%;display:flex;gap:2px;height:10px;background:var(--block-content);"]),j=c.div.withConfig({componentId:"sc-1gg99m8-1"})(["width:",";height:10px;background:",";display:flex;border-radius:2px;justify-content:center;align-items:center;color:#fff;font-weight:500;display:",";"],({percent:e})=>`calc(${e} * 100%)`,({color:e})=>e,({percent:e})=>e===0&&"none"),b=c(d).withConfig({componentId:"sc-1gg99m8-2"})(["opacity:",";"],({percentage:e})=>e===0&&"0.2"),k=c.div.withConfig({componentId:"sc-1gg99m8-3"})(["min-width:10px;width:10px;height:10px;border-radius:2px;background:",";"],({color:e})=>e),Fe=({data:e,loading:r})=>{if(!e)return null;if(r)return t.jsx(v,{margin:"0",shape:"rect",size:{width:"100%",height:"12px"}});const n=De(e);return t.jsxs(d,{d:"column",gap:"10px",children:[t.jsxs(Be,{children:[t.jsx(j,{percent:n[5],color:h.green.main}),t.jsx(j,{percent:n[4],color:h.blue.main}),t.jsx(j,{percent:n[3],color:h.orange.main}),t.jsx(j,{percent:n[2],color:h.red.main})]}),t.jsxs(d,{gap:"30px",children:[t.jsxs(b,{percentage:n[5],gap:"4px",w:"fit-content",children:[t.jsx(k,{color:h.green.main}),t.jsxs(m,{children:["5 - ",(n[5]*100).toFixed(1),"%"]})]}),t.jsxs(b,{percentage:n[4],gap:"4px",w:"fit-content",children:[t.jsx(k,{color:h.blue.main}),t.jsxs(m,{children:["4 - ",(n[4]*100).toFixed(1),"%"]})]}),t.jsxs(b,{percentage:n[3],gap:"4px",w:"fit-content",children:[t.jsx(k,{color:h.orange.main}),t.jsxs(m,{children:["3 - ",(n[3]*100).toFixed(1),"%"]})]}),t.jsxs(b,{percentage:n[2],gap:"4px",w:"fit-content",children:[t.jsx(k,{color:h.red.main}),t.jsxs(m,{children:["2 - ",(n[2]*100).toFixed(1),"%"]})]})]})]})},$e=c.div.withConfig({componentId:"sc-1p3ekrb-0"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#246655,#46b99b,#46a4b9);background-size:600% 600%;-webkit-animation:AStudentBackground 10s ease infinite;-moz-animation:AStudentBackground 10s ease infinite;animation:AStudentBackground 10s ease infinite;img{filter:drop-shadow(2px 4px 25px black);}@-webkit-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),Ne=c.div.withConfig({componentId:"sc-1p3ekrb-1"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#243766,#4657b9,#46a4b9,#5d46b9);background-size:800% 800%;-webkit-animation:AnimationName 10s ease infinite;-moz-animation:AnimationName 10s ease infinite;animation:AnimationName 10s ease infinite;@-webkit-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),_e=e=>{if(!e)return"empty";let r=0,n=!1;for(let i=0;i<e.length;i++){const{grade:s}=e[i];if(!s)return"empty";s!=="Отлично"&&s!=="Хорошо"&&s!=="Зачтено"&&(n=!0),s!=="Зачтено"&&s!=="Отлично"&&r++}return n?"empty":r===1?"almost":r>1?"empty":"a-student"},Pe=({data:e})=>{const r=_e(e);return r==="empty"?null:r==="almost"?t.jsxs(Ne,{children:[t.jsxs(d,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(w,{size:3,align:"left",children:"Почти отличник"}),t.jsx(m,{fontSize:"1rem",children:"В следующий раз повезет"})]}),t.jsx(P,{src:"https://media2.giphy.com/media/Iblv3w6yvj9DTMwCsJ/giphy.gif?cid=6c09b952zc1sjle3291d5t30ls5aqkl8kw1xrr1klyc7h5gk&ep=v1_stickers_related&rid=giphy.gif&ct=g",width:"70px",height:"70px",loading:!1})]}):t.jsxs($e,{children:[t.jsxs(d,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(w,{size:3,align:"left",children:"В этом семестре ты отличник!"}),t.jsx(m,{fontSize:"1rem",children:"Наши поздравления!"})]}),t.jsx(P,{src:"https://i.pinimg.com/originals/d3/c6/8a/d3c68aeb6f9ead3e57f80f12d12304b8.gif",width:"70px",height:"70px",loading:!1})]})},Ge=()=>{var F,$;const{data:e,loading:r,error:n}=G.selectors.useData(),{data:{user:i}}=oe.useUser(),s=g.useMemo(()=>{var o;return ue((o=i==null?void 0:i.course)!=null?o:0)},[i]),[a,S]=g.useState({id:y(new Date().toString(),(F=i==null?void 0:i.course)!=null?F:1),title:y(new Date().toString(),($=i==null?void 0:i.course)!=null?$:1).toString()+" семестр"}),[l,W]=g.useState(null),D=l&&!Object.keys(l!=null?l:{}).find(o=>(o==null?void 0:o.length)!==0)&&!r,q=`${(a==null?void 0:a.id)!==-1?a==null?void 0:a.id:""}`,B=o=>{G.effects.getFx({semestr:o?`${(o==null?void 0:o.id)!==-1?o==null?void 0:o.id:""}`:q})},[p,L]=g.useState(null),[M,T]=g.useState(null);g.useEffect(()=>{if(i&&e){const o=Number(a==null?void 0:a.id),H=Number(i==null?void 0:i.enterYear.split("/")[0]),N=xe(e,H,o);L(N),T(A(N))}},[e]);const R=(p==null?void 0:p.length)===0&&!r;return t.jsx(ae,{loading:r,load:B,error:n,data:p,children:t.jsx(ce,{topRightCornerElement:!!(i!=null&&i.id)&&t.jsx(de,{onClick:B,width:"150px",items:s,selected:a,setSelected:S}),children:R||!p?t.jsx(E,{text:"Данных за этот семестр нет, попробуйте другой!"}):t.jsxs(t.Fragment,{children:[!l&&!r&&t.jsx(Pe,{data:p}),t.jsx(le,{whereToSearch:p,searchEngine:he,setResult:W,placeholder:"Поиск предметов",loadingOnType:!0}),D&&t.jsx(E,{text:"По данному запросу ничего не найдено",image:t.jsx(K,{})}),!D&&t.jsxs(d,{d:"column",gap:"40px",children:[t.jsx(Fe,{data:p,loading:r}),t.jsx(Ae,{items:l!=null?l:M,loading:r})]})]})})})};export{Ge as default};
