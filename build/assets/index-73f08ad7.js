var C=Object.defineProperty,R=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var D=(i,t,a)=>t in i?C(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,h=(i,t)=>{for(var a in t||(t={}))G.call(t,a)&&D(i,a,t[a]);if(N)for(var a of N(t))I.call(t,a)&&D(i,a,t[a]);return i},_=(i,t)=>R(i,F(t));var k=(i,t,a)=>new Promise((d,r)=>{var c=n=>{try{l(a.next(n))}catch(e){r(e)}},o=n=>{try{l(a.throw(n))}catch(e){r(e)}},l=n=>n.done?d(n.value):Promise.resolve(n.value).then(c,o);l((a=a.apply(i,t)).next())});import{r as b,cM as O,j as y}from"./vendor-00bea631.js";import{b6 as L,b2 as $,aW as q,b7 as B,s as E,B as J,F as M,I as T,S as V,j as z,c as H}from"./index-d824e111.js";const P=(i,t,a)=>k(void 0,null,function*(){var d,r;a(!1);const c=t.map(n=>{if(Array.isArray(n.data[0])){const e=n.data.map(v=>Object.assign({},...v==null?void 0:v.map(s=>{var p,f;const g={};return s!=null&&s.fieldName&&(g[s==null?void 0:s.fieldName]=s!=null&&(p=s.value)!==null&&p!==void 0&&p.title?s==null||(f=s.value)===null||f===void 0?void 0:f.title:s==null?void 0:s.value),g}))),m={};return m[i]=JSON.stringify(e),m}else return n.data.map(e=>{var v,s;const m={};return e!=null&&e.fieldName&&(m[(v=e==null?void 0:e.fieldName)!=null?v:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(m[(s=e==null?void 0:e.fieldName)!=null?s:""]=JSON.stringify(e==null?void 0:e.value.map(p=>p.title))),m})}).flat(),o=Object.assign({},...c),l=yield L.postApplicationFx({guid:$(q()||"{}").IndividualGuid,jobGuid:o.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:o.last_day,isSendMail:o.get_tk==="По почте",isRetirement:!!o.isRetirement,address:o.get_tk_address,reason:o.reason.charAt(0).toLowerCase()+o.reason.slice(1)});!(l!=null&&(d=l.data)!==null&&d!==void 0&&(r=d.dismissalResponse)!==null&&r!==void 0&&r.isError)&&a(!0)}),U=(i,t,a,d,r,c,o,l,n,e,m,v,s)=>{const{surname:p,name:f,patronymic:g}=i;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:p+" "+f+" "+g,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:t[a].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:t[a].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:t[a].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:t[a].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:v,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:B(0),onChange:u=>{s(u)}},{title:"Причина",type:"text",value:e,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:u=>{m(u)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:d,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:u=>{r(u)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:l,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:u=>{n(u)}},{title:"Адрес для отправки трудовой книжки",value:c,fieldName:"get_tk_address",editable:!0,mask:!0,required:(l==null?void 0:l.title)=="По почте",visible:(l==null?void 0:l.title)=="По почте",onChange:u=>{o(u)}}]}},X=()=>{var x;var i;const[t,a]=b.useState(null),{data:{dataUserApplication:d,dataWorkerApplication:r},workerLoading:c}=E.useApplications(),[o,l]=b.useState(!1),[n,e]=b.useState(null),[m,v]=b.useState(!1),[s,p]=b.useState(null),[f,g]=b.useState("По собственному желанию"),[u,A]=b.useState(null),S=o!=null?o:!1,{id:w}=O(),j=+w;return b.useEffect(()=>{d&&r&&!c&&a(U(d,r,j,n,e,s,p,m,v,f,g,u,A))},[d,j,c,n,s,m,f,u]),y.jsx(J,{isDone:S,children:!!t&&!!a&&y.jsxs(M,{children:[y.jsx(T,_(h({},t),{collapsed:S,setData:a})),y.jsx(V,{text:"Отправить",action:()=>P(z.DISMISSAL,[t],l),isLoading:c,completed:o,setCompleted:l,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:H(t)&&((x=(i=t.optionalCheckbox)===null||i===void 0?void 0:i.value)!=null?x:!0),alerts:!1})]})})};export{X as default};
