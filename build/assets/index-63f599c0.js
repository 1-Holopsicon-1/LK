var H=Object.defineProperty,O=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var A=(o,e,t)=>e in o?H(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,I=(o,e)=>{for(var t in e||(e={}))T.call(e,t)&&A(o,t,e[t]);if(k)for(var t of k(e))q.call(e,t)&&A(o,t,e[t]);return o},w=(o,e)=>O(o,P(e));var B=(o,e,t)=>new Promise((f,l)=>{var p=s=>{try{a(t.next(s))}catch(n){l(n)}},u=s=>{try{a(t.throw(s))}catch(n){l(n)}},a=s=>s.done?f(s.value):Promise.resolve(s.value).then(p,u);a((t=t.apply(o,e)).next())});import{r,j as _}from"./vendor-00bea631.js";import{bc as E,b7 as j,s as G,bd as J,P as W,B as $,F as R,I as V,S as L,c as U}from"./index-d824e111.js";import{g as z,a as K}from"./get-default-subdivision-17957fb0.js";const M=(o,e,t)=>B(void 0,null,function*(){t(!1);const f=e.map(u=>{if(Array.isArray(u.data[0])){const a=u.data.map(n=>Object.assign({},...n==null?void 0:n.map(i=>{var c,y;const v={};return i!=null&&i.fieldName&&(v[i==null?void 0:i.fieldName]=i!=null&&(c=i.value)!==null&&c!==void 0&&c.title?i==null||(y=i.value)===null||y===void 0?void 0:y.title:i==null?void 0:i.value),v}))),s={};return s[o]=JSON.stringify(a),s}else return u.data.map(a=>{var n,i;const s={};return a!=null&&a.fieldName&&(s[(n=a==null?void 0:a.fieldName)!=null?n:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"&&(s[(i=a==null?void 0:a.fieldName)!=null?i:""]=JSON.stringify(a==null?void 0:a.value.map(c=>c.title))),s})}).flat(),l=Object.assign({},...f);l.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?l.holiday_type=1:l.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?l.holiday_type=2:l.holiday_type=="Отпуск без сохранения заработной платы"?l.holiday_type=3:l.holiday_type=="Отпуск по коллективному договору"&&(l.holiday_type=4),!(yield E.sendBufferHolidayPlanningFx({employeeGuid:l.jobGuid,type:l.holiday_type,start:l.holiday_start,end:l.holiday_end})).isError&&t(!0)}),Q=o=>{const e=o.find(t=>t.fieldName==="holiday_type");return e!=null&&e.value&&(e==null?void 0:e.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},X=(o,e,t,f,l,p,u,a,s,n,i,c,y,v)=>{const{surname:x,name:m,patronymic:D,subdivisions:g}=o,b=t||new Date().toISOString(),F=l||new Date().toISOString(),h=u||"",N=y||"",S=i||z(g);return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:x+" "+m+" "+D,fieldName:"fio",visible:!0},{title:"Подразделение/должность",value:S,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:K(g),isSpecificSelect:!0,onChange:d=>{c(d),v(d.id)}},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:s,editable:!0,required:!0,onChange:d=>{n(d)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:h,editable:!0,required:!0,onChange:d=>{const C=new Date(Date.parse(b));C.setDate(C.getDate()+5),a(d),p(j(d?+d.data:0,C.toString()))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:t,fieldName:"holiday_start",editable:!0,mask:!0,onChange:d=>{f(d),p(d)},required:!0,minValueInput:j(5)},{title:"",type:"simple-text",value:N,fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:F,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:d=>{p(d)},minValueInput:l||j(0),maxValueInput:j(u?+u.data:365,b)}]}},ae=()=>{var d;var o;const[e,t]=r.useState(null),[f,l]=r.useState(null),[p,u]=r.useState(null),[a,s]=r.useState(null),[n,i]=r.useState(null),[c,y]=r.useState(null),[v,x]=r.useState(null),{data:{dataUserApplication:m,dataWorkerApplication:D}}=G.useApplications(),{loading:g}=J.useBufferHolidayPlanning(),[b,F]=r.useState({}),[h,N]=r.useState(!1),S=h!=null?h:!1;return r.useEffect(()=>{m&&D&&!g&&t(X(m,D,f,l,n,i,c,y,v,x,a,s,p,u))},[m,g,f,c,v,p,a]),r.useEffect(()=>{e&&m&&F(Q(e.data))},[e]),_.jsx(W,{children:_.jsx($,{isDone:S,children:!!e&&!!t&&_.jsxs(R,{children:[_.jsx(V,w(I({},e),{collapsed:S,setData:t,specialFieldsNameConfig:b})),_.jsx(L,{text:"Отправить",action:()=>M("",[e],N),isLoading:g,completed:h,setCompleted:N,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:U(e,b)&&((d=(o=e.optionalCheckbox)===null||o===void 0?void 0:o.value)!=null?d:!0),alerts:!1})]})})})};export{ae as default};
