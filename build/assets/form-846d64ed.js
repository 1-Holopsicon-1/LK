import{r as s,cM as k,j as r}from"./vendor-08ab745b.js";import{$ as d,g as m,s as D,a as j,W as b,B as v,F as B,I as A,S as E,c as C}from"./index-0892b83f.js";import{s as M}from"./send-form-b99a96a1.js";import{c as P}from"./create-form-store-77e7c04e.js";const W=e=>d.get(`?getPhoneBookData=${e}&token=${m()}`),$=e=>{const t=new FormData;t.set("token",m()),t.set("setPhoneBookData","1");for(const[c,u]of Object.entries(e))t.set(c,u);return d.post("?setPhoneBookData=1",t,{headers:{"Content-Type":"multipart/form-data"}})},n=P({defaultStore:{completed:!1,error:null,loading:!0,data:null},api:{get:W,post:$}}),L=()=>{const[e,t]=s.useState(null),[c,u]=s.useState(!1),[g,F]=s.useState(!1),{guid:p}=k(),i=c??!1,[o,f]=s.useState(p),{data:l,error:x}=n.selectors.useForm(),{data:{dataUserApplication:a}}=D.useApplications();return s.useEffect(()=>{a&&f(p||a?.subdivisions[0].guid_staff)},[a]),s.useEffect(()=>{if(l&&o){const S=a?.subdivisions?.find(h=>h.guid_staff===o);t(j(l,S))}},[o,l]),s.useEffect(()=>()=>{n.events.clearStore()},[]),o?r.jsx(b,{load:()=>{n.effects.getFormFx(o)},data:a&&l,error:x,children:r.jsx(v,{isDone:i,children:!!e&&r.jsxs(B,{noHeader:!0,children:[r.jsx(A,{...e,collapsed:i,setData:t}),r.jsx(E,{text:i?"Отправлено":"Отправить",action:()=>M(e,n.effects.postFormFx,F,n.events.changeCompleted),isLoading:g,completed:c,setCompleted:u,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:C(e),popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})}):null};export{L as default};
