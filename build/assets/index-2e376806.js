var w=Object.defineProperty,N=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var x=(a,e,s)=>e in a?w(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,E=(a,e)=>{for(var s in e||(e={}))$.call(e,s)&&x(a,s,e[s]);if(k)for(var s of k(e))S.call(e,s)&&x(a,s,e[s]);return a},P=(a,e)=>N(a,O(e));var p=(a,e,s)=>new Promise((l,r)=>{var u=o=>{try{t(s.next(o))}catch(n){r(n)}},d=o=>{try{t(s.throw(o))}catch(n){r(n)}},t=o=>o.done?l(o.value):Promise.resolve(o.value).then(u,d);t((s=s.apply(a,e)).next())});import{p as T,e as j,x as c,h as W,u as h,r as b,n as D,j as f}from"./vendor-91dd51cf.js";import{b1 as B,b2 as G,aW as I,b3 as F,b4 as q,s as H,B as J,F as C,I as L,S as U,j as z,c as M,b5 as R}from"./index-2caaee2c.js";const K=T({name:"loadBufferPartTimeEmployment",sid:"rqpj9r"}),Y=T({name:"sendBufferPartTimeEmployment",sid:"-1vo25s"}),A=j(()=>p(void 0,null,function*(){var e;const{data:a}=yield B.get(`InternalPartTime.GetAllHistory?PersonalGuid=${G((e=I())!=null?e:"").IndividualGuid}`);return a.orders}),{name:"loadBufferPartTimeEmploymentFx",sid:"lptsxp"});c({and:[{clock:K,target:A}],or:{sid:"-bwsfri"}});const v=j(a=>p(void 0,null,function*(){return(yield B.post("Weekend.AddWeekend",a)).data}),{name:"sendBufferPartTimeEmploymentFx",sid:"-26c53s"});c({and:[{clock:Y,target:v}],or:{sid:"-bguek1"}});const _=W([],{name:"$bufferPartTimeEmploymentOrders",sid:"-rtc3mi"}),Q=v.pending;c({and:[{clock:A.doneData,target:_}],or:{sid:"-bdjmzv"}});c({and:[{clock:v.doneData,fn:a=>{const e=a;return e.isError?{message:e.error,type:"hrFailure",time:3e5}:{message:"Форма отправлена успешно",type:"success",time:0}},target:F.evokePopUpMessage}],or:{sid:"-azss5u"}});c({and:[{clock:v.fail,fn:()=>({message:"Не удалось отправить форму.",type:"hrFailure",time:3e5}),target:F.evokePopUpMessage}],or:{sid:"-a29byt"}});const V={useBufferPartTimeEmployment:()=>({data:h(_),loading:h(Q)})},X=(a,e)=>{const{surname:s,name:l,patronymic:r}=a;return{title:"Заявление на трудоустройство по совместительству",data:[{title:"ФИО",value:s+" "+l+" "+r,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделениe, куда производится трудорустройство",type:"auto-complete-input",fieldName:"newPlaceOfWork",value:"",width:"100%",suggestions:e,required:!0,mask:!0,visible:!0,placeholder:"Начните вводить название подразделения"},{title:"Должность",value:null,fieldName:"post",mask:!0,editable:!0,required:!0},{title:"Ставка",type:"select",fieldName:"rate",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"0.5"},{id:2,title:"0.25"}]}]}},Z=(a,e,s)=>p(void 0,null,function*(){s(!1);const l=e.map(d=>{if(Array.isArray(d.data[0])){const t=d.data.map(n=>Object.assign({},...n==null?void 0:n.map(i=>{var m,y;const g={};return i!=null&&i.fieldName&&(g[i==null?void 0:i.fieldName]=i!=null&&(m=i.value)!==null&&m!==void 0&&m.title?i==null||(y=i.value)===null||y===void 0?void 0:y.title:i==null?void 0:i.value),g}))),o={};return o[a]=JSON.stringify(t),o}else return d.data.map(t=>{var n,i;const o={};return t!=null&&t.fieldName&&(o[(n=t==null?void 0:t.fieldName)!=null?n:""]=typeof t.value!="object"?t==null?void 0:t.value:t.value.title),t.type==="multiselect"&&(o[(i=t==null?void 0:t.fieldName)!=null?i:""]=JSON.stringify(t==null?void 0:t.value.map(m=>m.title))),o})}).flat(),r=Object.assign({},...l);!(yield q.sendBufferHolidayWorkFx({employeeGuid:r.jobGuid,dates:[{date:r.holiday_work_date,dayOff:r.extra_holiday_date?r.extra_holiday_date:null,hours:+r.holiday_work_hours}]})).isError&&s(!0)}),se=()=>{var n;var a;const[e,s]=b.useState(null),{data:{dataUserApplication:l}}=H.useApplications(),{loading:r}=V.useBufferPartTimeEmployment(),[u,d]=b.useState(!1),t=u!=null?u:!1,o=D(R);return b.useEffect(()=>{l&&!r&&s(X(l,o))},[l,r]),f.jsx(J,{isDone:t,children:!!e&&!!s&&f.jsxs(C,{children:[f.jsx(L,P(E({},e),{collapsed:t,setData:s})),f.jsx(U,{text:"Отправить",action:()=>Z(z.HOLIDAY_WORK,[e],d),isLoading:r,completed:u,setCompleted:d,repeatable:!1,buttonSuccessText:"Отправлено",isDone:t,isActive:M(e)&&((n=(a=e.optionalCheckbox)===null||a===void 0?void 0:a.value)!=null?n:!0)})]})})};export{se as default};
