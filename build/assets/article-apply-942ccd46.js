import{da as h,p as F,h as v,k as f,be as k,O as g,db as S,x as l,dc as y,cI as j,dd as I,j as s,i as u,cH as w}from"./vendor-e66a8a59.js";import{dn as D,dv as U,dw as V,dx as q,p as P,k as C,t as G,T,I as _,w as B,i as M}from"./index-dd17438c.js";import{a as z}from"./article-e0f203b6.js";import{c as E}from"./create-checkbox-field-9f63694e.js";const n=h({and:[],or:{name:"ArticleApplyGate",sid:"-pa9kwb"}}),x=F({name:"sendForm",sid:"-3wmcrc"}),m=v(null,{name:"$departments",sid:"o6biq"}),H=v(null,{name:"$articleId",sid:"-n80qdd"}).on(n.open,(e,{articleId:t})=>t),o=D(),c=U({reset:[n.open,n.close]}),p=E({reset:[n.open,n.close]}),L=f({sid:"-e7whs2",fn:()=>k(o.value),name:"$isActive",method:"and"}),d=g({and:{effect:V},or:{name:"applyArticleFx",sid:"-5forrb"}}),A=g({and:{effect:q},or:{name:"getUserSubdivisionsFx",sid:"fcy9dn"}}),O=f({sid:"q91qbo",fn:()=>S([d]),name:"$formPending",method:"pending"});l({and:[{clock:n.open,source:z.article,filter:Boolean,fn:({articleTitle:e})=>e,target:o.value}],or:{sid:"-p9q626"}});l({and:[{clock:n.open,source:m,filter:e=>!e,fn:()=>({guid:null,name:null,isDepartment:!0,isFaculty:null,headGuid:null,parentGuid:null,includeDisabled:null,includeChildSubdivisions:null}),target:A}],or:{sid:"-ot8c9c"}});l({and:[{clock:A.doneData,fn:e=>e.filter(t=>t.isDepartment),target:m}],or:{sid:"-o8vyaz"}});l({and:[{clock:x,source:{articleId:H,department:c.value},fn:({articleId:e,department:t})=>{var a;return{articleId:e,departmentId:(a=t==null?void 0:t.id.toString())!==null&&a!==void 0?a:null}},target:d}],or:{sid:"-nulavl"}});l({and:[{clock:d.done,target:p.setValue.prepend(()=>!0)}],or:{sid:"-naspil"}});l({and:[{clock:d.failData,fn:e=>{var t;return y(e)&&((t=e.response)===null||t===void 0?void 0:t.data.type)==="AlreadyApplied"?{message:"Вы уже подали заявку на эту статью",type:"failure"}:{message:"При отправке заявки произошла ошибка. Попробуйте позднее",type:"failure"}},target:P.evokePopUpMessage}],or:{sid:"-mx1uok"}});const Y=()=>{const{id:e}=j();return I(n,{articleId:e}),s.jsx(C,{padding:"10px",children:s.jsxs(G,{noHeader:!0,children:[s.jsx(T,{size:4,align:"left",children:"Заявить об авторстве"}),s.jsx(R,{}),s.jsx(W,{}),s.jsx(J,{})]})})},R=()=>{const[e,t]=u([o.value,o.setValue]);return s.jsx(_,{title:"Название статьи",placeholder:"Название статьи",value:e,setValue:t,isActive:!1})},W=()=>{const[e,t]=u([c.value,c.setValue]),a=w(m,i=>{var r;return(r=i==null?void 0:i.map(({name:$,guid:b})=>({id:b,title:$})))!==null&&r!==void 0?r:[]});return s.jsx(B,{title:"Кафедра",placeholder:"Кафедра",width:"100%",items:a,selected:e,setSelected:t,withSearch:!0,isActive:!!a.length})},J=()=>{const[e,t,a,i,r]=u([x,p.value,p.setValue,O,L]);return s.jsx(M,{text:t?"Отправлено":"Отправить",action:e,isLoading:i,completed:t,setCompleted:a,repeatable:!1,buttonSuccessText:"Отправлено",isDone:t,isActive:r,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})};export{Y as default};
