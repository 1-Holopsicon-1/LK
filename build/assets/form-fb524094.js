import{r as o,bT as k,j as r}from"./vendor-cbee1f3c.js";import{$ as m,g,f as D,s as j,h as v,W as B,B as E,F as C,I as P,S as T,b as W}from"./index-1f9cdbd4.js";import{s as $}from"./send-form-1105d155.js";const M=t=>m.get(`?getPhoneBookData=${t}&token=${g()}`),y=t=>{const s=new FormData;s.set("token",g()),s.set("setPhoneBookData","1");for(const[c,f]of Object.entries(t))s.set(c,f);return m.post("?setPhoneBookData=1",s,{headers:{"Content-Type":"multipart/form-data"}})},n=D({defaultStore:{completed:!1,error:null,loading:!0,data:null},api:{get:M,post:y}}),w=()=>{const[t,s]=o.useState(null),[c,f]=o.useState(!1),[F,x]=o.useState(!1),{guid:l}=k(),i=c??!1,[a,d]=o.useState(l),{data:u,error:S}=n.selectors.useForm(),{data:{dataUserApplication:e}}=j.useApplications();return o.useEffect(()=>{e&&d(l||(e==null?void 0:e.subdivisions[0].guid_staff))},[e]),o.useEffect(()=>{var p;if(u&&a){const h=(p=e==null?void 0:e.subdivisions)==null?void 0:p.find(b=>b.guid_staff===a);s(v(u,h))}},[a,u]),o.useEffect(()=>()=>{n.events.clearStore()},[]),a?r.jsx(B,{load:()=>{n.effects.getFormFx(a)},data:e&&u,error:S,children:r.jsx(E,{isDone:i,children:!!t&&r.jsxs(C,{noHeader:!0,children:[r.jsx(P,{...t,collapsed:i,setData:s}),r.jsx(T,{text:i?"Отправлено":"Отправить",action:()=>$(t,n.effects.postFormFx,x,n.events.changeCompleted),isLoading:F,completed:c,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:W(t),popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})}):null};export{w as default};
