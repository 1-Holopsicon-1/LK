var A=Object.defineProperty,B=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var P=(e,t,a)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,U=(e,t)=>{for(var a in t||(t={}))K.call(t,a)&&P(e,a,t[a]);if(D)for(var a of D(t))Q.call(t,a)&&P(e,a,t[a]);return e},W=(e,t)=>B(e,J(t));import{j as s,L as X,bs as Y,ce as Z,s as I,aa as ee,a6 as G,bw as se,r as w,a5 as te,cI as ae,cU as ne,co as re,cp as ie,aW as ce}from"./vendor-31894644.js";import{ai as V,t as oe,v as le,w as de,ch as ue,L as he,X as $,G as C,bT as T,q,H as pe,ci as b,bx as xe,cj as fe,ck as Se,cl as ge,u as me,cm as N,cn as x,bV as O,co as _,cp as L,d as Ee,cq as je,E as we,aJ as Ce,W as Me,P as ke,a0 as ve,cr as be,cs as Ie,ct as Re}from"./index-0f8b6250.js";import{E as ye}from"./index-079e6782.js";const Ue=({value:e,setValue:t,onHintClick:a,onValueEmpty:d})=>{const r=/\d/.test(e),{data:{user:i}}=V.useUser(),u=async c=>r?await de(c):await ue(c,"",1,20);return s.jsx(oe,{value:e,width:"100%",setValue:t,onHintClick:a(r),placeholder:"Поиск",customMask:r?le.groupMask:void 0,transformRequest:r?void 0:c=>c.fio,request:u,leftIcon:e.length===0?s.jsx(X,{}):r?s.jsx(Y,{}):s.jsx(Z,{}),onValueEmpty:(i==null?void 0:i.user_status)==="staff"?d:void 0})},Oe=I(ee).withConfig({componentId:"sc-17n125n-0"})(["color:var(--text);padding:15px 15px;max-width:140px;width:100%;opacity:",";border-radius:10px;background:",";color:",";&:hover{filter:brightness(0.97);}"],({disabled:e})=>e?.5:1,({isCurrent:e})=>e?he.blue.transparent3:"transparent",({isCurrent:e})=>e?"var(--blue)":"var(--grey)"),_e=I.div.withConfig({componentId:"sc-17n125n-1"})(["display:flex;align-items:center;justify-content:center;svg{width:20px;min-width:20px;height:20px;}"]),Le=I.div.withConfig({componentId:"sc-17n125n-2"})(["font-weight:",";font-size:0.9rem;"],({isCurrent:e})=>e?500:400),Ve=({route:e,collapsed:t=!1,disabled:a=!1,isCurrent:d=!1})=>{if(!e)return s.jsx($,{children:"Ссылка не определена"});const{path:r,title:i,icon:u,color:c,shortTitle:n}=e,h=f=>{if(a)return f.preventDefault()};return s.jsx(Oe,{collapsed:t,disabled:a,isCurrent:d,to:r,title:n!=null?n:i,color:c,onClick:h,children:s.jsxs(C,{gap:"8px",children:[s.jsx(_e,{children:u}),!t&&s.jsx(Le,{isCurrent:d,children:n!=null?n:i})]})})},z=({handleReturnToMySchedule:e,baseSearchValue:t,handleValue:a,onHintClick:d,isSideMenuOpen:r})=>{var f;const{data:{searchValue:i,filter:u}}=T.useSchedule(),c=G(),{data:{user:n}}=V.useUser(),h=(n==null?void 0:n.user_status)==="staff";return s.jsxs(s.Fragment,{children:[r&&s.jsxs(s.Fragment,{children:[s.jsx($,{children:"Группа или преподаватель"}),s.jsx(Ue,{value:i,setValue:a,onHintClick:d})]}),t!==i&&s.jsx(q,{text:r&&"Мое расписание",onClick:e,icon:s.jsx(se,{}),background:"var(--block)",textColor:"var(--blue)"}),s.jsx(pe,{margin:"16px 0",width:"100%"}),s.jsx(C,{d:"column",gap:"2px",ai:"flex-start",children:Object.keys((f=b)!=null?f:{}).map(p=>{const o=b[p],{id:m,path:S}=o,g=u?"".concat(S,"/").concat(u):S;return m==="schedule-session"&&h?null:s.jsx(Ve,{collapsed:!r,isCurrent:c.pathname===g,route:W(U({},o),{path:g})},m)})})]})},Te=()=>{var F,H;const{data:{user:e}}=V.useUser(),{data:{filter:t,view:a,errorInData:d}}=T.useSchedule(),{isTablet:r,isMobile:i}=xe(),[u,c]=w.useState(!0),n=G(),h=te(),f=n.pathname!==fe,p=n.pathname.split("/"),o=p.length===4?p[p.length-1]:null,m=o?/\d/.test(o):!1,S=(e==null?void 0:e.user_status)==="staff"?(F=e==null?void 0:e.fullName)!=null?F:"":(H=e==null?void 0:e.group)!=null?H:"",g=n.pathname.includes(Se),R=n.pathname.includes(ge),j=g||R,{open:M}=me(),E=()=>{t&&h.push(_(L,{page:n.pathname.split("/")[2]})),x.setSearchValue(S),x.setFilter(""),x.resetExternalSchedule()};w.useLayoutEffect(()=>{a===N.month&&!j&&x.changeView(N.day)},[a,j]),w.useEffect(()=>{c(!(i||r))},[r,i]),w.useEffect(()=>{o?(x.setFilter(o),x.setSearchValue(o),m?O.getGroupScheduleFx({group:o}):O.getTeacherScheduleFx({fullName:o})):E()},[o]),w.useEffect(()=>()=>{x.resetExternalSchedule()},[]);const y=()=>{O.getScheduleFx(e)},k=()=>l=>{(l==null?void 0:l.id)===(e==null?void 0:e.group)&&E(),l!=null&&l.id&&(n.pathname.split("/")[2]==="retake"?h.push(_(L,{page:"current",filter:l.value})):h.push(_(L,{page:n.pathname.split("/")[2],filter:l.value})))},v=l=>{x.setSearchValue(l)};return{isSideMenuOpen:u,shouldShowSlider:f,isMobile:i,isSessionPage:g,baseSearchValue:S,showMonth:j,handleErrorClick:()=>{Ee.evokePopUpMessage({message:d,type:"failure",time:je.ten_seconds})},handleValue:v,onHintClick:k,handleReturnToMySchedule:E,handleLoad:y,handleOpenSideMenu:()=>{i?M(s.jsx(C,{d:"column",gap:"8px",ai:"flex-start",children:s.jsx(z,{isSideMenuOpen:!0,baseSearchValue:S,handleReturnToMySchedule:E,onHintClick:k,handleValue:v})})):c(l=>!l)}}},Fe=I.div.withConfig({componentId:"sc-sh5ff8-0"})(["min-width:",";width:",";padding-right:10px;height:calc(100vh - var(--header-height) - 112px);display:flex;z-index:10;gap:8px;flex-direction:column;align-items:",";","{display:none;}"],({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"flex-start":"center",we.isMobile),He=e=>s.jsx(Fe,{isSideMenuOpen:e.isSideMenuOpen,children:s.jsx(z,U({},e))}),qe=()=>{var M;const{data:{view:e,schedule:t,externalSchedule:a,errorInData:d},loading:r,error:i}=T.useSchedule(),{allRoutes:u}=Ce.useMenu(),{isSideMenuOpen:c,shouldShowSlider:n,showMonth:h,baseSearchValue:f,isMobile:p,onHintClick:o,handleValue:m,handleReturnToMySchedule:S,handleLoad:g,handleOpenSideMenu:R,handleErrorClick:j}=Te();return s.jsx(Me,{loading:r,load:g,error:i,data:r?a:t,children:s.jsx(ke,{topCenterElement:n&&s.jsx(ve,{size:"small",sliderWidth:"240px",pages:h?be:Ie,currentPage:e,appearance:!p,setCurrentPage:x.changeView}),topRightCornerElement:s.jsxs(C,{w:"fit-content",gap:"20px",children:[s.jsx(ye,{visible:!!d,onClick:j}),s.jsx(q,{icon:p?s.jsx(ae,{}):s.jsx(ne,{}),width:"36px",height:"36px",onClick:R})]}),children:u&&s.jsxs(C,{gap:"16px",ai:"flex-start",children:[!p&&s.jsx(He,{isSideMenuOpen:c,baseSearchValue:f,handleReturnToMySchedule:S,onHintClick:o,handleValue:m}),s.jsxs(re,{children:[Object.keys((M=b)!=null?M:{}).map(E=>{const{path:y,id:k,Component:v}=b[E];return s.jsx(ie,{path:y,children:s.jsx(v,{})},k)}),s.jsx(ce,{to:Re})]})]})})})};export{qe as default};
