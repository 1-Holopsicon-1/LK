import{d as K,j as D,al as W,p as l,h as r,e as Z,m as E,a4 as G,x as n,I as M}from"./vendor-0433f525.js";import{bo as J,bp as L,bq as A,d as Q}from"./index-f22e44ea.js";import{c as j}from"./create-checkbox-field-7dde474e.js";const X="https://api.mospolytech.ru/lk/science/",c=K.create({baseURL:X});c.interceptors.request.use(J);c.interceptors.response.use(async e=>{var t,s,i,a;return((a=(i=(s=(t=e==null?void 0:e.data)==null?void 0:t.errors)==null?void 0:s[0])==null?void 0:i.extensions)==null?void 0:a.code)==="AUTH_NOT_AUTHENTICATED"?await L(c)(e):e},L(c));const ee=async({scopusFile:e,wosFile:t})=>{const s=new FormData;s.append("scopusFile",e),s.append("wosFile",t);const{data:i}=await c.post("/data",s,{headers:{"Content-Type":"multipart/form-data"}});return i},te=async e=>{const{data:t}=await c.post("/article/all",e);return t},se=async e=>{const{data:t}=await c.get(`/article/${e}`);return t.data},ie=async e=>{const{data:t}=await c.get(`/article/${e}/details`);return{titles:{scopus:g(t.titles.scopus),wos:g(t.titles.wos)},data:{scopus:g(t.data.scopus),wos:g(t.data.wos)}}};function g(e){return Object.keys(e).reduce((t,s)=>(t[s.toLowerCase()]=e[s],t),{})}const le=()=>[{title:"Название публикации",field:"articleTitle",width:"150px",showFull:!0,align:"center"},{title:"Авторы",field:"authors",width:"130px",showFull:!0,align:"center"},{title:"Год",field:"publicationYear",width:"100px",align:"center",sort:!0,search:!0},{title:"Издательство",field:"publisher",showFull:!0,align:"center",sort:!0,search:!0},{title:"Номер страницы",field:"pageNumber",width:"120px",render:e=>e||"-",showFull:!0,align:"center"},{title:"Scopus",field:"isScopus",width:"115px",align:"center",render:e=>e&&D.jsx(W,{}),sort:!0,search:!0},{title:"WoS",field:"isWoS",width:"110px",align:"center",render:e=>e&&D.jsx(W,{}),sort:!0,search:!0},{title:"Тип",showFull:!0,field:"publicationType",align:"center"},{title:"Количество цитирований",field:"quotesCount",showFull:!0,width:"165px",align:"center",sort:!0,search:!0},{title:"DOI",field:"doi",showFull:!0,align:"center"},{title:"Источник финансирования",field:"fundingSource",showFull:!0,width:"170px",align:"center"}],ae=30,oe={publicationYear:"PublicationYear",publisher:"SourceTitle",isScopus:"IsScopus",isWoS:"IsWoS",quotesCount:"QuotesCount"},o=l({name:"pageMounted",sid:"-nyvv9i"}),N=l({name:"tableOpened",sid:"-9d12pl"}),v=l({name:"modalOpened",sid:"-1o83cr"}),P=l({name:"setScopusFile",sid:"-bh0ron"}),U=l({name:"setWosFile",sid:"-c50cvc"}),_=l({name:"uploadFiles",sid:"bzqn36"}),Y=l({name:"selectArticle",sid:"92mkkj"}),O=l({name:"setColumns",sid:"eksrx7"}),re=l({name:"getArticles",sid:"z9fdq4"}),R=l({name:"fetchArticles",sid:"-jq4br7"}),V=l({name:"sortPressed",sid:"qkj2ye"}),k=l({name:"filtersApplied",sid:"-gztca8"}),w=l({name:"filtersReset",sid:"-78ambh"}),I=r(!1,{name:"$filtersApplied",sid:"-cy6sv"}).on(k,()=>!0).on(w,()=>!1).reset([o]),u=Z(async({offset:e,sorts:t,filters:s})=>await te({limit:ae,offset:e,sorts:t?t.map(({field:i,order:a})=>({field:oe[i],order:a})):null,filters:s}),{name:"fetchArticlesFx",sid:"fo0r6b"}),C=A({reset:o}),S=A({reset:o}),b=A({reset:o}),F=A({reset:o}),x=j({reset:o}),y=j({reset:o}),d=E({sid:"pssul1",fn:()=>G({handler:ee}),name:"uploadArticleMutation",method:"createMutation"}),m=r(null,{name:"$sorts",sid:"-npterm"}).on(V,(e,t)=>{if(!e)return[{field:t,order:"ASC"}];const s=e.find(a=>a.field===t),i=e.filter(a=>a.field!==t);return s?s.order==="ASC"?[...i,{field:t,order:"DESC"}]:i.length?i:null:[...e,{field:t,order:"ASC"}]}).reset(o),ne=r([],{name:"$articles",sid:"-p3q035"}).on(u.doneData,(e,{data:t})=>[...e,...t]).reset([m,k,w]),$=r(0,{name:"$totalCount",sid:"-yplae5"}).on(u.doneData,(e,{totalCount:t})=>t);n({and:[{clock:u.doneData,source:$,filter:(e,{totalCount:t})=>e!==t,fn:(e,{totalCount:t})=>t,target:$}],or:{sid:"-byl6hx"}});const ce=r(new Set,{name:"$selectedArticles",sid:"-ymt6xl"}).on(Y,(e,t)=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}).reset(o),ue=r([],{name:"$scopusFile",sid:"-dcqa4h"}).on(P,(e,t)=>t).reset([d.finished.success,v]),de=r([],{name:"$wosFile",sid:"-3rupqm"}).on(U,(e,t)=>t).reset(d.finished.success,v),pe=r(!1,{name:"$filesUploaded",sid:"is0o9i"}).on(d.finished.success,()=>!0).reset(v),fe=r(le(),{name:"$columns",sid:"9yu9hx"}).on(O,(e,t)=>t).reset(o);n({and:[{clock:N,fn:()=>({offset:0,sorts:null,filters:null}),target:u}],or:{sid:"kxgcev"}});n({and:[{clock:R,source:{pending:u.inFlight,filtersApplied:I,sorts:m,isWoSCheck:y.value,isScopusCheck:x.value,articleTitle:C.value,publicationYear:S.value,publisher:b.value,quotesCount:F.value},filter:({pending:e})=>!e,fn:({sorts:e,filtersApplied:t,isWoSCheck:s,isScopusCheck:i,articleTitle:a,publicationYear:p,publisher:f,quotesCount:h},{startIndex:B})=>({offset:B,sorts:e,filters:t?[...a?[{field:"ArticleTitle",operation:"Like",value:a}]:[],...s?[{field:"IsWoS",operation:"Eq",value:s}]:[],...i?[{field:"IsScopus",operation:"Eq",value:i}]:[],...p?[{field:"PublicationYear",operation:"Eq",value:Number(p)}]:[],...f?[{field:"SourceTitle",operation:"Like",value:f}]:[],...h?[{field:"QuotesCount",operation:"Eq",value:Number(h)}]:[]]:null}),target:u}],or:{sid:"ldy67p"}});n({and:[{clock:[m,k,w],source:{sorts:m,filtersApplied:I,isWoSCheck:y.value,isScopusCheck:x.value,articleTitle:C.value,publicationYear:S.value,publisher:b.value,quotesCount:F.value},fn:({sorts:e,filtersApplied:t,isWoSCheck:s,isScopusCheck:i,publicationYear:a,publisher:p,quotesCount:f,articleTitle:h})=>({offset:0,sorts:e,filters:t?[...h?[{field:"ArticleTitle",operation:"Like",value:h}]:[],...s?[{field:"IsWoS",operation:"Eq",value:s}]:[],...i?[{field:"IsScopus",operation:"Eq",value:i}]:[],...a?[{field:"PublicationYear",operation:"Eq",value:Number(a)}]:[],...p?[{field:"SourceTitle",operation:"Like",value:p}]:[],...f?[{field:"QuotesCount",operation:"Eq",value:Number(f)}]:[]]:null}),target:u}],or:{sid:"o87wkv"}});n({and:[{clock:_,target:d.start}],or:{sid:"-ygmdyh"}});n({and:[{clock:d.finished.success,fn:()=>({message:"Статья успешно загружена",type:"success"}),target:Q.evokePopUpMessage}],or:{sid:"-yef7l1"}});n({and:[{clock:d.finished.failure,fn:()=>({message:"Произошла ошибка",type:"failure"}),target:Q.evokePopUpMessage}],or:{sid:"-xyh6dk"}});const Ae={articles:ne,articlesLoading:u.inFlight,totalCount:$,selectedArticles:ce,filesUploaded:pe,scopusFile:ue,wosFile:de,uploadLoading:d.$pending,columns:fe,sorts:m,filtersApplied:I,articleTitle:C.value,publicationYear:S.value,publisher:b.value,quotesCount:F.value,isScopusCheck:x.value,isWoSCheck:y.value},ve={tableOpened:N,pageMounted:o,selectArticle:Y,uploadFiles:_,modalOpened:v,setScopusFile:P,setWosFile:U,setColumns:O,getArticles:re,fetchArticles:R,sortPressed:V,setArticleTitle:C.setValue,setPublicationYear:S.setValue,setPublisher:b.setValue,setQuotesCount:F.setValue,setIsScopusCheck:x.setValue,setIsWoSCheck:y.setValue,filtersApplied:k,filtersReset:w},z=l({name:"getDetailsClicked",sid:"xxk06l"}),H=l({name:"pageMounted",sid:"-5pxjrw"}),q=E({sid:"k0ppeo",fn:()=>M({handler:se}),name:"getArticleQuery",method:"createQuery"}),T=E({sid:"-vdnnzx",fn:()=>M({handler:ie}),name:"getArticleDetailsQuery",method:"createQuery"});n({and:[{clock:H,target:q.start}],or:{sid:"hiv5ll"}});n({and:[{clock:z,target:T.start}],or:{sid:"hl2bz1"}});const ke={pageMounted:H,getDetailsClicked:z},we={article:q.$data,details:T.$data,loading:q.$pending,detailsLoading:T.$pending};export{ae as T,we as a,ke as b,ve as e,le as g,Ae as s};
