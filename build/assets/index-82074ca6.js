import{r as n,j as S}from"./vendor-08ab745b.js";import{bc as C,b7 as j,s as k,bd as I,P as w,B,F as H,I as O,S as P,c as T}from"./index-0892b83f.js";import{g as q,a as E}from"./get-default-subdivision-17957fb0.js";const G=async(t,r,l)=>{l(!1);const y=r.map(s=>{if(Array.isArray(s.data[0])){const a=s.data.map(u=>Object.assign({},...u?.map(o=>{const p={};return o?.fieldName&&(p[o?.fieldName]=o?.value?.title?o?.value?.title:o?.value),p}))),d={};return d[t]=JSON.stringify(a),d}else return s.data.map(a=>{const d={};return a?.fieldName&&(d[a?.fieldName??""]=typeof a.value!="object"?a?.value:a.value.title),a.type==="multiselect"&&(d[a?.fieldName??""]=JSON.stringify(a?.value.map(u=>u.title))),d})}).flat(),e=Object.assign({},...y);e.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?e.holiday_type=1:e.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?e.holiday_type=2:e.holiday_type=="Отпуск без сохранения заработной платы"?e.holiday_type=3:e.holiday_type=="Отпуск по коллективному договору"&&(e.holiday_type=4),!(await C.sendBufferHolidayPlanningFx({employeeGuid:e.jobGuid,type:e.holiday_type,start:e.holiday_start,end:e.holiday_end})).isError&&l(!0)},J=t=>{const r=t.find(l=>l.fieldName==="holiday_type");return r?.value&&(r?.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},W=(t,r,l,y,e,c,s,a,d,u,o,p,m,x)=>{const{surname:f,name:v,patronymic:g,subdivisions:h}=t,_=l||new Date().toISOString(),D=e||new Date().toISOString(),N=s||"",b=m||"",A=o||q(h);return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:f+" "+v+" "+g,fieldName:"fio",visible:!0},{title:"Подразделение/должность",value:A,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:E(h),isSpecificSelect:!0,onChange:i=>{p(i),x(i.id)}},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:d,editable:!0,required:!0,onChange:i=>{u(i)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:N,editable:!0,required:!0,onChange:i=>{const F=new Date(Date.parse(_));F.setDate(F.getDate()+5),a(i),c(j(i?+i.data:0,F.toString()))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:l,fieldName:"holiday_start",editable:!0,mask:!0,onChange:i=>{y(i),c(i)},required:!0,minValueInput:j(5)},{title:"",type:"simple-text",value:b,fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:D,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:i=>{c(i)},minValueInput:e||j(0),maxValueInput:j(s?+s.data:365,_)}]}},U=()=>{const[t,r]=n.useState(null),[l,y]=n.useState(null),[e,c]=n.useState(null),[s,a]=n.useState(null),[d,u]=n.useState(null),[o,p]=n.useState(null),[m,x]=n.useState(null),{data:{dataUserApplication:f,dataWorkerApplication:v}}=k.useApplications(),{loading:g}=I.useBufferHolidayPlanning(),[h,_]=n.useState({}),[D,N]=n.useState(!1),b=D??!1;return n.useEffect(()=>{f&&v&&!g&&r(W(f,v,l,y,d,u,o,p,m,x,s,a,e,c))},[f,g,l,o,m,e,s]),n.useEffect(()=>{t&&f&&_(J(t.data))},[t]),S.jsx(w,{children:S.jsx(B,{isDone:b,children:!!t&&!!r&&S.jsxs(H,{children:[S.jsx(O,{...t,collapsed:b,setData:r,specialFieldsNameConfig:h}),S.jsx(P,{text:"Отправить",action:()=>G("",[t],N),isLoading:g,completed:D,setCompleted:N,repeatable:!1,buttonSuccessText:"Отправлено",isDone:b,isActive:T(t,h)&&(t.optionalCheckbox?.value??!0),alerts:!1})]})})})};export{U as default};
