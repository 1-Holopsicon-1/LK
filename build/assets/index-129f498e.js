var F=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var I=(t,e,s)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,w=(t,e)=>{for(var s in e||(e={}))P.call(e,s)&&I(t,s,e[s]);if(k)for(var s of k(e))T.call(e,s)&&I(t,s,e[s]);return t},B=(t,e)=>H(t,O(e));import{r as d,j as _}from"./vendor-31894644.js";import{bc as q,b7 as A,s as E,bd as G,P as J,B as W,F as R,I as V,S as L,c as U}from"./index-0f8b6250.js";import{g as $,a as z}from"./get-default-subdivision-17957fb0.js";const K=async(t,e,s)=>{s(!1);const h=e.map(n=>{if(Array.isArray(n.data[0])){const a=n.data.map(r=>Object.assign({},...r==null?void 0:r.map(i=>{var p,y;const c={};return i!=null&&i.fieldName&&(c[i==null?void 0:i.fieldName]=(p=i==null?void 0:i.value)!=null&&p.title?(y=i==null?void 0:i.value)==null?void 0:y.title:i==null?void 0:i.value),c}))),u={};return u[t]=JSON.stringify(a),u}else return n.data.map(a=>{var r,i;const u={};return a!=null&&a.fieldName&&(u[(r=a==null?void 0:a.fieldName)!=null?r:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"&&(u[(i=a==null?void 0:a.fieldName)!=null?i:""]=JSON.stringify(a==null?void 0:a.value.map(c=>c.title))),u})}).flat(),l=Object.assign({},...h);l.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?l.holiday_type=1:l.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?l.holiday_type=2:l.holiday_type=="Отпуск без сохранения заработной платы"?l.holiday_type=3:l.holiday_type=="Отпуск по коллективному договору"&&(l.holiday_type=4),!(await q.sendBufferHolidayPlanningFx({employeeGuid:l.jobGuid,type:l.holiday_type,start:l.holiday_start,end:l.holiday_end})).isError&&s(!0)},M=t=>{const e=t.find(s=>s.fieldName==="holiday_type");return e!=null&&e.value&&(e==null?void 0:e.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},Q=(t,e,s,h,l,f,n,a,u,r,i,c,p,y)=>{const{surname:m,name:D,patronymic:b,subdivisions:S}=t,N=s||new Date().toISOString(),g=l||new Date().toISOString(),j=n||"",v=p||"",x=i||$(S);return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:m+" "+D+" "+b,fieldName:"fio",visible:!0},{title:"Подразделение/должность",value:x,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:z(S),isSpecificSelect:!0,onChange:o=>{c(o),y(o.id)}},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:u,editable:!0,required:!0,onChange:o=>{r(o)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:j,editable:!0,required:!0,onChange:o=>{const C=new Date(Date.parse(N));C.setDate(C.getDate()+5),a(o),f(A(o?+o.data:0,C.toString()))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:s,fieldName:"holiday_start",editable:!0,mask:!0,onChange:o=>{h(o),f(o)},required:!0,minValueInput:A(5)},{title:"",type:"simple-text",value:v,fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:g,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:o=>{f(o)},minValueInput:l||A(0),maxValueInput:A(n?+n.data:365,N)}]}},te=()=>{var x,o;const[t,e]=d.useState(null),[s,h]=d.useState(null),[l,f]=d.useState(null),[n,a]=d.useState(null),[u,r]=d.useState(null),[i,c]=d.useState(null),[p,y]=d.useState(null),{data:{dataUserApplication:m,dataWorkerApplication:D}}=E.useApplications(),{loading:b}=G.useBufferHolidayPlanning(),[S,N]=d.useState({}),[g,j]=d.useState(!1),v=g!=null?g:!1;return d.useEffect(()=>{m&&D&&!b&&e(Q(m,D,s,h,u,r,i,c,p,y,n,a,l,f))},[m,b,s,i,p,l,n]),d.useEffect(()=>{t&&m&&N(M(t.data))},[t]),_.jsx(J,{children:_.jsx(W,{isDone:v,children:!!t&&!!e&&_.jsxs(R,{children:[_.jsx(V,B(w({},t),{collapsed:v,setData:e,specialFieldsNameConfig:S})),_.jsx(L,{text:"Отправить",action:()=>K("",[t],j),isLoading:b,completed:g,setCompleted:j,repeatable:!1,buttonSuccessText:"Отправлено",isDone:v,isActive:U(t,S)&&((o=(x=t.optionalCheckbox)==null?void 0:x.value)!=null?o:!0),alerts:!1})]})})})};export{te as default};
