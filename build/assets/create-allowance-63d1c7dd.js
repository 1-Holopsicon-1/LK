import{n as o,j as e,r as x}from"./vendor-0d3de025.js";import{aZ as c,G as h,i as k,h as L,X as w,p as C,ax as m,aq as y,B as I,F as M,V as q,S as T,x as b,a1 as R,a_ as N,a$ as U,N as B,b0 as P,d as W,ap as E}from"./index-45f1fe9f.js";import{D as z}from"./dev-mode-message-507243ae.js";import{A as O}from"./forbidden-f8ab5260.js";const _=({subordinate:{employeeId:t,employeeName:n,divisionName:l,position:r,employmentType:i,rate:a}})=>{const{addItem:f,removeItem:v,setValue:j,value:A}=o(c.employees),{minDate:u}=o(c.period),s=A.find(p=>p.id===t),d=!!s;return e.jsxs(h,{gap:"0.5rem",onClick:()=>d?v(t):f(t),cursor:"pointer",brad:"0.5rem",hoverBackground:"var(--theme-5)",p:"0.5rem",ai:"flex-start",children:[e.jsx(k,{checked:d,setChecked:()=>d?v(t):f(t)}),e.jsxs(h,{gap:"0.5rem",d:"column",ai:"flex-start",children:[e.jsx(L,{align:"left",size:4,children:n}),e.jsx(w,{children:l}),e.jsx(w,{children:r}),e.jsxs(w,{children:[i,a&&` (ставка: ${a})`]}),d&&e.jsxs(h,{jc:"space-between",ai:"flex-end",gap:"0.5rem",onClick:p=>p.stopPropagation(),cursor:"auto",children:[e.jsx(C,{title:"Сумма",value:(s==null?void 0:s.sum)||"",setValue:p=>{s&&j({...s,sum:p})},type:"number",required:!0,width:"38%",placeholder:"Сумма выплаты",isActive:d}),e.jsx(C,{title:"Дата начала",value:(s==null?void 0:s.startDate)||"",setValue:p=>{s&&j({...s,startDate:p})},type:"date",required:!0,width:"30%",isActive:d,minValue:u}),e.jsx(C,{title:"Дата окончания",value:(s==null?void 0:s.endDate)||"",setValue:p=>{s&&j({...s,endDate:p})},type:"date",required:!0,width:"30%",minValue:s==null?void 0:s.startDate,isActive:d})]})]})]})},ne=()=>{const[t,n,l,r,i,a,f,v,j,A]=o([m.rolesPending,y.createSupplement,m.supplementCreating,y.pageMounted,m.roles,m.completed,y.setCompleted,m.isActive,m.jobRoles,m.errorMessage]),u=a??!1,s=i.includes("Initiator");return x.useEffect(()=>{s&&r()},[s]),t?e.jsx(I,{isDone:u,children:e.jsx(M,{noHeader:!0,children:e.jsx(h,{w:"100%",jc:"center",ai:"center",children:e.jsx(q,{})})})}):s?e.jsx(I,{isDone:u,children:e.jsxs(M,{noHeader:!0,children:[e.jsx(z,{}),e.jsx($,{}),e.jsx(H,{}),e.jsx(G,{}),e.jsx(J,{}),e.jsx(X,{}),e.jsx(Y,{}),e.jsx(Q,{}),e.jsx(T,{text:u?"Отправлено":"Отправить",action:n,isLoading:l,completed:a,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:v,popUpFailureMessage:A,popUpSuccessMessage:"Данные формы успешно отправлены"})]})}):e.jsx(O,{jobRoles:j})};function $(){const{value:t,setValue:n}=o(c.job),l=o(m.jobRoles);if(!l)return null;const r=x.useMemo(()=>l.filter(i=>i.roles.includes("Initiator")).map(i=>({id:i.employeeId,title:i.division})),l);return x.useEffect(()=>{r.length===1&&n(r[0])},[r]),e.jsx(b,{title:"Должность / Подразделение",items:r,selected:r.length===1?r[0]:t,setSelected:n,isActive:r.length>1,required:!0,width:"100%"})}function H(){const t=o(m.paymentIdentifiers),{value:n,setValue:l}=o(c.paymentIdentifier);return x.useEffect(()=>{t.length===1&&l(t[0])},[t]),e.jsx(b,{title:"Вид надбавки",items:t,selected:n,setSelected:l,isActive:t.length>1,required:!0,width:"100%",withSearch:!0,placeholder:"Вид надбавки"})}function G(){const{startDate:t,setStartDate:n,endDate:l,setEndDate:r,minDate:i}=o(c.period);return e.jsxs(h,{jc:"space-between",gap:"0.5rem",children:[e.jsx(C,{title:"Дата начала",value:t,setValue:n,type:"date",required:!0,width:"49%",minValue:i}),e.jsx(C,{title:"Дата окончания",value:l,setValue:r,type:"date",required:!0,width:"49%",minValue:t})]})}function J(){const{value:t,setValue:n}=o(c.commentary);return e.jsx(R,{title:"Комментарий (предполагаемый источник финансирования)",placeholder:"Комментарий (предполагаемый источник финансирования, например, проект)",value:t,setValue:n})}function X(){const[t,n,l,r,i]=o([m.employees,c.employees.value,c.employees.allSelected,c.employees.selectAll,c.employees.deselectAll]),{value:a}=o(c.job),[f,v]=x.useState(!0),[j,A]=x.useState(!1),[u,s]=x.useState(""),[d,p]=x.useState(!1),F=x.useMemo(()=>{if(!t||!a)return[];const S=n.map(g=>g.id),V=d?t[a==null?void 0:a.id].filter(g=>S.includes(g.employeeId)):t[a==null?void 0:a.id];if(!u)return V;const D=u.toLowerCase();return V.filter(g=>g.employeeName.toLowerCase().includes(D)||g.divisionName.toLowerCase().includes(D)||g.position.toLowerCase().includes(D))},[t,a,u,d,n]);return e.jsxs(N,{openArea:f,children:[e.jsx(U,{title:"Сотрудники",included:j,optional:!1,setOpenArea:v,setIncluded:A,collapsed:!1,openArea:f}),e.jsx("div",{className:"inputs",children:a&&t?e.jsxs(h,{gap:"1.5rem",ai:"flex-start",d:"column",children:[e.jsx(B,{value:u,setValue:s,placeholder:"Поиск по сотрудникам"}),e.jsxs(h,{gap:"0.5rem",ai:"flex-start",d:"column",children:[e.jsx(k,{checked:d,setChecked:p,text:"Отобразить только выбранных"}),e.jsx(k,{checked:l,setChecked:S=>{S?r(t[a==null?void 0:a.id].map(V=>V.employeeId)):i()},text:"Выбрать всех"})]}),e.jsx(h,{gap:"1rem",ai:"flex-start",d:"column",children:F.map(S=>e.jsx(_,{subordinate:S},S.employeeId))})]}):e.jsx(w,{children:"Выберите должность"})})]})}function Y(){const{value:t,setValue:n}=o(c.files),l=o(m.fileUploading);return e.jsx(P,{files:t,formats:["doc","pdf","docx"],setFiles:r=>{if(t.length<r.length&&t.some(i=>i.name===r[r.length-1].name)){W.evokePopUpMessage({message:"Имя файла не может повторятся",type:"failure"});return}n(r)},isActive:!l})}const Z={fiveToNine:"сотрудников",one:"сотрудник",twoToFour:"сотрудника",zero:"сотрудников"},K={fiveToNine:"Добавлено",one:"Добавлен",twoToFour:"Добавлено",zero:"Добавлено"};function Q(){const t=o(c.employees.value);return e.jsxs(w,{children:[E(Math.trunc(t==null?void 0:t.length),K)," ",t==null?void 0:t.length," ",E(Math.trunc(t==null?void 0:t.length),Z)]})}export{ne as default};
