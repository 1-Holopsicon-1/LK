var N=Object.defineProperty,U=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var E=(e,s,l)=>s in e?N(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,b=(e,s)=>{for(var l in s||(s={}))P.call(s,l)&&E(e,l,s[l]);if(M)for(var l of M(s))W.call(s,l)&&E(e,l,s[l]);return e},V=(e,s)=>U(e,B(s));import{q as o,j as t,r as x}from"./vendor-00bea631.js";import{aZ as d,G as h,i as I,h as z,X as A,p as w,ax as m,aq as k,B as F,F as q,V as O,S as _,x as T,a1 as $,a_ as H,a$ as G,N as J,b0 as X,d as Y,ap as L}from"./index-d824e111.js";import{D as Z}from"./dev-mode-message-500dbc04.js";import{A as K}from"./forbidden-33bb8846.js";const Q=({subordinate:{employeeId:e,employeeName:s,divisionName:l,position:r,employmentType:i,rate:a}})=>{const{addItem:f,removeItem:g,setValue:j,value:S}=o(d.employees),{minDate:c}=o(d.period),n=S.find(p=>p.id===e),u=!!n;return t.jsxs(h,{gap:"0.5rem",onClick:()=>u?g(e):f(e),cursor:"pointer",brad:"0.5rem",hoverBackground:"var(--theme-5)",p:"0.5rem",ai:"flex-start",children:[t.jsx(I,{checked:u,setChecked:()=>u?g(e):f(e)}),t.jsxs(h,{gap:"0.5rem",d:"column",ai:"flex-start",children:[t.jsx(z,{align:"left",size:4,children:s}),t.jsx(A,{children:l}),t.jsx(A,{children:r}),t.jsxs(A,{children:[i,a&&` (ставка: ${a})`]}),u&&t.jsxs(h,{jc:"space-between",ai:"flex-end",gap:"0.5rem",onClick:p=>p.stopPropagation(),cursor:"auto",children:[t.jsx(w,{title:"Сумма",value:(n==null?void 0:n.sum)||"",setValue:p=>{n&&j(V(b({},n),{sum:p}))},type:"number",required:!0,width:"38%",placeholder:"Сумма выплаты",isActive:u}),t.jsx(w,{title:"Дата начала",value:(n==null?void 0:n.startDate)||"",setValue:p=>{n&&j(V(b({},n),{startDate:p}))},type:"date",required:!0,width:"30%",isActive:u,minValue:c}),t.jsx(w,{title:"Дата окончания",value:(n==null?void 0:n.endDate)||"",setValue:p=>{n&&j(V(b({},n),{endDate:p}))},type:"date",required:!0,width:"30%",minValue:n==null?void 0:n.startDate,isActive:u})]})]})]})},he=()=>{const[e,s,l,r,i,a,f,g,j,S]=o([m.rolesPending,k.createSupplement,m.supplementCreating,k.pageMounted,m.roles,m.completed,k.setCompleted,m.isActive,m.jobRoles,m.errorMessage]),c=a!=null?a:!1,n=i.includes("Initiator");return x.useEffect(()=>{n&&r()},[n]),e?t.jsx(F,{isDone:c,children:t.jsx(q,{noHeader:!0,children:t.jsx(h,{w:"100%",jc:"center",ai:"center",children:t.jsx(O,{})})})}):n?t.jsx(F,{isDone:c,children:t.jsxs(q,{noHeader:!0,children:[t.jsx(Z,{}),t.jsx(ee,{}),t.jsx(te,{}),t.jsx(se,{}),t.jsx(le,{}),t.jsx(ne,{}),t.jsx(re,{}),t.jsx(oe,{}),t.jsx(_,{text:c?"Отправлено":"Отправить",action:s,isLoading:l,completed:a,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:c,isActive:g,popUpFailureMessage:S,popUpSuccessMessage:"Данные формы успешно отправлены"})]})}):t.jsx(K,{jobRoles:j})};function ee(){const{value:e,setValue:s}=o(d.job),l=o(m.jobRoles);if(!l)return null;const r=x.useMemo(()=>l.filter(i=>i.roles.includes("Initiator")).map(i=>({id:i.employeeId,title:i.division})),l);return x.useEffect(()=>{r.length===1&&s(r[0])},[r]),t.jsx(T,{title:"Должность / Подразделение",items:r,selected:r.length===1?r[0]:e,setSelected:s,isActive:r.length>1,required:!0,width:"100%"})}function te(){const e=o(m.paymentIdentifiers),{value:s,setValue:l}=o(d.paymentIdentifier);return x.useEffect(()=>{e.length===1&&l(e[0])},[e]),t.jsx(T,{title:"Вид надбавки",items:e,selected:s,setSelected:l,isActive:e.length>1,required:!0,width:"100%",withSearch:!0,placeholder:"Вид надбавки"})}function se(){const{startDate:e,setStartDate:s,endDate:l,setEndDate:r,minDate:i}=o(d.period);return t.jsxs(h,{jc:"space-between",gap:"0.5rem",children:[t.jsx(w,{title:"Дата начала",value:e,setValue:s,type:"date",required:!0,width:"49%",minValue:i}),t.jsx(w,{title:"Дата окончания",value:l,setValue:r,type:"date",required:!0,width:"49%",minValue:e})]})}function le(){const{value:e,setValue:s}=o(d.commentary);return t.jsx($,{title:"Комментарий (предполагаемый источник финансирования)",placeholder:"Комментарий (предполагаемый источник финансирования, например, проект)",value:e,setValue:s})}function ne(){const[e,s,l,r,i]=o([m.employees,d.employees.value,d.employees.allSelected,d.employees.selectAll,d.employees.deselectAll]),{value:a}=o(d.job),[f,g]=x.useState(!0),[j,S]=x.useState(!1),[c,n]=x.useState(""),[u,p]=x.useState(!1),R=x.useMemo(()=>{if(!e||!a)return[];const y=s.map(v=>v.id),C=u?e[a==null?void 0:a.id].filter(v=>y.includes(v.employeeId)):e[a==null?void 0:a.id];if(!c)return C;const D=c.toLowerCase();return C.filter(v=>v.employeeName.toLowerCase().includes(D)||v.divisionName.toLowerCase().includes(D)||v.position.toLowerCase().includes(D))},[e,a,c,u,s]);return t.jsxs(H,{openArea:f,children:[t.jsx(G,{title:"Сотрудники",included:j,optional:!1,setOpenArea:g,setIncluded:S,collapsed:!1,openArea:f}),t.jsx("div",{className:"inputs",children:a&&e?t.jsxs(h,{gap:"1.5rem",ai:"flex-start",d:"column",children:[t.jsx(J,{value:c,setValue:n,placeholder:"Поиск по сотрудникам"}),t.jsxs(h,{gap:"0.5rem",ai:"flex-start",d:"column",children:[t.jsx(I,{checked:u,setChecked:p,text:"Отобразить только выбранных"}),t.jsx(I,{checked:l,setChecked:y=>{y?r(e[a==null?void 0:a.id].map(C=>C.employeeId)):i()},text:"Выбрать всех"})]}),t.jsx(h,{gap:"1rem",ai:"flex-start",d:"column",children:R.map(y=>t.jsx(Q,{subordinate:y},y.employeeId))})]}):t.jsx(A,{children:"Выберите должность"})})]})}function re(){const{value:e,setValue:s}=o(d.files),l=o(m.fileUploading);return t.jsx(X,{files:e,formats:["doc","pdf","docx"],setFiles:r=>{if(e.length<r.length&&e.some(i=>i.name===r[r.length-1].name)){Y.evokePopUpMessage({message:"Имя файла не может повторятся",type:"failure"});return}s(r)},isActive:!l})}const ae={fiveToNine:"сотрудников",one:"сотрудник",twoToFour:"сотрудника",zero:"сотрудников"},ie={fiveToNine:"Добавлено",one:"Добавлен",twoToFour:"Добавлено",zero:"Добавлено"};function oe(){const e=o(d.employees.value);return t.jsxs(A,{children:[L(Math.trunc(e==null?void 0:e.length),ie)," ",e==null?void 0:e.length," ",L(Math.trunc(e==null?void 0:e.length),ae)]})}export{he as default};
