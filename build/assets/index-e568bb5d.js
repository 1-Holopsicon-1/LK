var D=Object.defineProperty;var g=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var h=(n,e,o)=>e in n?D(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,j=(n,e)=>{for(var o in e||(e={}))M.call(e,o)&&h(n,o,e[o]);if(g)for(var o of g(e))T.call(e,o)&&h(n,o,e[o]);return n};import{s as B,j as t,r as m,M as N}from"./vendor-31894644.js";import{$ as E,g as U,aE as L,aF as H,h as $,X as V,aG as A,aH as _,K as v,r as I,ap as p,l as u,ai as R,W as K,_ as q,P as G,q as O,an as y,H as X,x as J}from"./index-0f8b6250.js";const Q=async()=>(await E.get("?getVacations&token=".concat(U()))).data,P=L({api:{get:Q},errorMessage:()=>"Возникла ошибка с получением графика отпусков!"}),Y=B(H).withConfig({componentId:"sc-13iobzb-0"})(["border-radius:var(--brLight);background:var(--block-content);position:relative;.background{font-size:6em;position:absolute;bottom:0px;right:10px;font-weight:bold;opacity:0.5;}.content{height:100%;display:flex;align-items:flex-end;}"]),b=({children:n,title:e,text:o,width:l,height:s,background:i,padding:a})=>t.jsxs(Y,{alignItems:"flex-start",gap:"10px",orientation:"vertical",width:l!=null?l:"15vw",minHeight:s!=null?s:"150px",maxHeight:s!=null?s:"150px",padding:a,children:[t.jsx($,{size:4,align:"left",children:e}),t.jsx(V,{visible:!!o,fontSize:"0.9em",children:A(o!=null?o:"",60)}),i&&t.jsx("div",{className:"background",children:i}),n&&t.jsx("div",{className:"content",children:n})]}),x={fiveToNine:"дней",one:"день",twoToFour:"дня",zero:"дней"},Z=[{title:"Плановые периоды отпуска",field:"plannedVacationPeriods",showFull:!0},{title:"Фактические периоды отпуска",field:"actualVacationPeriods",showFull:!0},{title:"Остаток отпуска",field:"unusedVacationPeriods",showFull:!0}],ee=n=>{const{division:e,post:o,vacations:l,allActualVacationPeriods:s,allPlannedVacationPeriods:i,allUnusedVacationPeriods:a}=te(n);return t.jsxs(t.Fragment,{children:[t.jsxs(_,{children:[t.jsx(v,{keyStr:"Подразделение",value:e}),t.jsx(v,{keyStr:"Должность",value:o})]}),t.jsx(I,{columns:Z,data:l,footer:()=>({allPlannedVacationPeriods:f(i),allActualVacationPeriods:f(s),allUnusedVacationPeriods:f(a)})})]})};function f(n){return"Всего: ".concat(n," ").concat(p(Math.trunc(n||0),x))}function te(n){const{fact:e,plan:o,unused:l,division:s,post:i}=n;return{division:s,post:i,vacations:oe(e,o,l),allActualVacationPeriods:e.reduce((a,{numdays:r})=>(a+=+r,a),0),allPlannedVacationPeriods:o.reduce((a,{numdays:r})=>(a+=+r,a),0),allUnusedVacationPeriods:l.reduce((a,{numdays:r})=>(a+=+r,a),0)}}function oe(n,e,o){const l=Math.max(n.length,e.length,o.length),s=[];for(let i=0;i<l;i++){const a=n[i],r=e[i],c=o[i],d={actualVacationPeriods:"",plannedVacationPeriods:"",unusedVacationPeriods:""},F=u(a==null?void 0:a.from,"numeric"),C=u(a==null?void 0:a.to,"numeric"),S=u(r==null?void 0:r.from,"numeric"),w=u(r==null?void 0:r.to,"numeric"),W=u(c==null?void 0:c.from,"numeric"),z=u(c==null?void 0:c.to,"numeric");a&&(d.actualVacationPeriods="".concat(F," - ").concat(C," (").concat(a.numdays," ").concat(p(Number(a.numdays)||0,x),")")),r&&(d.plannedVacationPeriods="".concat(S," - ").concat(w," (").concat(r.numdays," ").concat(p(Number(r.numdays)||0,x),")")),c&&(d.unusedVacationPeriods="".concat(W," - ").concat(z," (").concat(c.numdays," ").concat(p(Math.trunc(Number(c.numdays))||0,x),")")),s.push(d)}return s}const k={fiveWorkDays:"https://e.mospolytech.ru/old/storage/files/Proizvodstvennyj_kalendar_na_2024_god_dlya_pyatidnevnoj_rabochej_nedeli.pdf",sixWorkDays:"https://e.mospolytech.ru/old/storage/files/Proizvodstvennyj_kalendar_na_2024_god_dlya_shestidnevnoj_rabochej.pdf"},ae=()=>{var r;const{data:{user:n}}=R.useUser(),{data:e,error:o}=P.selectors.useData(),l=m.useMemo(()=>(e==null?void 0:e.map((c,d)=>({id:d,title:c.division})))||[],[e]),[s,i]=m.useState((r=l[0])!=null?r:{});m.useEffect(()=>{s!=null&&s.id||i(l[0])},[s==null?void 0:s.id,i,l]);const a=e==null?void 0:e[Number((s==null?void 0:s.id)||0)];return t.jsx(K,{load:P.effects.getFx,error:o,data:e,children:t.jsx(q,{alignItems:"flex-start",children:t.jsxs(G,{topRightCornerElement:t.jsx(O,{onClick:()=>{window.location.replace("https://e.mospolytech.ru/old/index.php?p=vacation")},text:"Заполнить график",background:"var(--reallyBlue)",textColor:"#fff",icon:t.jsx(N,{}),minWidth:"35px",height:"36px"}),children:[t.jsx(V,{width:"100%",maxWidth:"100%",children:"Производственный календарь на 2024 год"}),t.jsxs(_,{scroll:!1,direction:"horizontal",gap:12,wrapOnMobile:!0,children:[t.jsx(b,{title:"Для пятидневной рабочей недели",height:"120px",width:"50%",background:"5",padding:"20px 40px 20px 20px",children:t.jsx(y,{onClick:()=>null,href:k.fiveWorkDays,textColor:"var(--reallyBlue)",text:"Подробнее",background:"transparent",padding:"10px 0"})}),t.jsx(b,{title:"Для шестидневной рабочей недели",height:"120px",width:"50%",background:"6",padding:"20px 40px 20px 20px",children:t.jsx(y,{onClick:()=>null,href:k.sixWorkDays,textColor:"var(--reallyBlue)",text:"Подробнее",background:"transparent",padding:"10px 0"})})]}),t.jsx(X,{}),t.jsx($,{size:3,align:"left",children:"Сведения о трудоустройстве"}),!!(n!=null&&n.id)&&t.jsx(J,{width:"fit-content",items:l,selected:s,setSelected:i}),a&&t.jsx(ee,j({},a))]})})})},ie=()=>t.jsx(ae,{});export{ie as default};
