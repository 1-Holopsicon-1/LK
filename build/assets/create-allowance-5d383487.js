var N=Object.defineProperty,U=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var E=(e,s,r)=>s in e?N(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,D=(e,s)=>{for(var r in s||(s={}))P.call(s,r)&&E(e,r,s[r]);if(b)for(var r of b(s))W.call(s,r)&&E(e,r,s[r]);return e},y=(e,s)=>U(e,B(s));import{n as o,j as t,r as x}from"./vendor-0c8c29fe.js";import{a_ as c,G as h,i as M,h as z,X as w,p as C,ay as m,ar as I,B as F,F as L,V as O,S as _,x as T,a1 as $,a$ as H,b0 as G,N as J,b1 as X,d as Y,aq as q}from"./index-179b6f61.js";import{D as K}from"./dev-mode-message-0aa0e975.js";import{A as Q}from"./forbidden-f788b6b1.js";const Z=({subordinate:{employeeId:e,employeeName:s,divisionName:r,position:n,employmentType:i,rate:l}})=>{const{addItem:f,removeItem:v,setValue:j,value:A}=o(c.employees),{minDate:u}=o(c.period),a=A.find(p=>p.id===e),d=!!a;return t.jsxs(h,{gap:"0.5rem",onClick:()=>d?v(e):f(e),cursor:"pointer",brad:"0.5rem",hoverBackground:"var(--theme-5)",p:"0.5rem",ai:"flex-start",children:[t.jsx(M,{checked:d,setChecked:()=>d?v(e):f(e)}),t.jsxs(h,{gap:"0.5rem",d:"column",ai:"flex-start",children:[t.jsx(z,{align:"left",size:4,children:s}),t.jsx(w,{children:r}),t.jsx(w,{children:n}),t.jsxs(w,{children:[i,l&&` (ставка: ${l})`]}),d&&t.jsxs(h,{jc:"space-between",ai:"flex-end",gap:"0.5rem",onClick:p=>p.stopPropagation(),cursor:"auto",children:[t.jsx(C,{title:"Сумма",value:(a==null?void 0:a.sum)||"",setValue:p=>{a&&j(y(D({},a),{sum:p}))},type:"number",required:!0,width:"38%",placeholder:"Сумма выплаты",isActive:d}),t.jsx(C,{title:"Дата начала",value:(a==null?void 0:a.startDate)||"",setValue:p=>{a&&j(y(D({},a),{startDate:p}))},type:"date",required:!0,width:"30%",isActive:d,minValue:u}),t.jsx(C,{title:"Дата окончания",value:(a==null?void 0:a.endDate)||"",setValue:p=>{a&&j(y(D({},a),{endDate:p}))},type:"date",required:!0,width:"30%",minValue:a==null?void 0:a.startDate,isActive:d})]})]})]})},he=()=>{const[e,s,r,n,i,l,f,v,j,A]=o([m.rolesPending,I.createSupplement,m.supplementCreating,I.pageMounted,m.roles,m.completed,I.setCompleted,m.isActive,m.jobRoles,m.errorMessage]),u=l!=null?l:!1,a=i.includes("Initiator");return x.useEffect(()=>{a&&n()},[a]),e?t.jsx(F,{isDone:u,children:t.jsx(L,{noHeader:!0,children:t.jsx(h,{w:"100%",jc:"center",ai:"center",children:t.jsx(O,{})})})}):a?t.jsx(F,{isDone:u,children:t.jsxs(L,{noHeader:!0,children:[t.jsx(K,{}),t.jsx(ee,{}),t.jsx(te,{}),t.jsx(se,{}),t.jsx(re,{}),t.jsx(ae,{}),t.jsx(ne,{}),t.jsx(oe,{}),t.jsx(_,{text:u?"Отправлено":"Отправить",action:s,isLoading:r,completed:l,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:v,popUpFailureMessage:A,popUpSuccessMessage:"Данные формы успешно отправлены"})]})}):t.jsx(Q,{jobRoles:j})};function ee(){const{value:e,setValue:s}=o(c.job),r=o(m.jobRoles);if(!r)return null;const n=x.useMemo(()=>r.filter(i=>i.roles.includes("Initiator")).map(i=>({id:i.employeeId,title:i.division})),r);return x.useEffect(()=>{n.length===1&&s(n[0])},[n]),t.jsx(T,{title:"Должность / Подразделение",items:n,selected:n.length===1?n[0]:e,setSelected:s,isActive:n.length>1,required:!0,width:"100%"})}function te(){const e=o(m.paymentIdentifiers),{value:s,setValue:r}=o(c.paymentIdentifier);return x.useEffect(()=>{e.length===1&&r(e[0])},[e]),t.jsx(T,{title:"Вид надбавки",items:e,selected:s,setSelected:r,isActive:e.length>1,required:!0,width:"100%",withSearch:!0,placeholder:"Вид надбавки"})}function se(){const{startDate:e,setStartDate:s,endDate:r,setEndDate:n,minDate:i}=o(c.period);return t.jsxs(h,{jc:"space-between",gap:"0.5rem",children:[t.jsx(C,{title:"Дата начала",value:e,setValue:s,type:"date",required:!0,width:"49%",minValue:i}),t.jsx(C,{title:"Дата окончания",value:r,setValue:n,type:"date",required:!0,width:"49%",minValue:e})]})}function re(){const{value:e,setValue:s}=o(c.commentary);return t.jsx($,{title:"Комментарий (предполагаемый источник финансирования)",placeholder:"Комментарий (предполагаемый источник финансирования, например, проект)",value:e,setValue:s})}function ae(){const[e,s,r,n,i]=o([m.employees,c.employees.value,c.employees.allSelected,c.employees.selectAll,c.employees.deselectAll]),{value:l}=o(c.job),[f,v]=x.useState(!0),[j,A]=x.useState(!1),[u,a]=x.useState(""),[d,p]=x.useState(!1),R=x.useMemo(()=>{if(!e||!l)return[];const S=s.map(g=>g.id),V=d?e[l==null?void 0:l.id].filter(g=>S.includes(g.employeeId)):e[l==null?void 0:l.id];if(!u)return V;const k=u.toLowerCase();return V.filter(g=>g.employeeName.toLowerCase().includes(k)||g.divisionName.toLowerCase().includes(k)||g.position.toLowerCase().includes(k))},[e,l,u,d,s]);return t.jsxs(H,{openArea:f,children:[t.jsx(G,{title:"Сотрудники",included:j,optional:!1,setOpenArea:v,setIncluded:A,collapsed:!1,openArea:f}),t.jsx("div",{className:"inputs",children:l&&e?t.jsxs(h,{gap:"1.5rem",ai:"flex-start",d:"column",children:[t.jsx(J,{value:u,setValue:a,placeholder:"Поиск по сотрудникам"}),t.jsxs(h,{gap:"0.5rem",ai:"flex-start",d:"column",children:[t.jsx(M,{checked:d,setChecked:p,text:"Отобразить только выбранных"}),t.jsx(M,{checked:r,setChecked:S=>{S?n(e[l==null?void 0:l.id].map(V=>V.employeeId)):i()},text:"Выбрать всех"})]}),t.jsx(h,{gap:"1rem",ai:"flex-start",d:"column",children:R.map(S=>t.jsx(Z,{subordinate:S},S.employeeId))})]}):t.jsx(w,{children:"Выберите должность"})})]})}function ne(){const{value:e,setValue:s}=o(c.files),r=o(m.fileUploading);return t.jsx(X,{files:e,formats:["doc","pdf","docx"],setFiles:n=>{if(e.length<n.length&&e.some(i=>i.name===n[n.length-1].name)){Y.evokePopUpMessage({message:"Имя файла не может повторятся",type:"failure"});return}s(n)},isActive:!r})}const le={fiveToNine:"сотрудников",one:"сотрудник",twoToFour:"сотрудника",zero:"сотрудников"},ie={fiveToNine:"Добавлено",one:"Добавлен",twoToFour:"Добавлено",zero:"Добавлено"};function oe(){const e=o(c.employees.value);return t.jsxs(w,{children:[q(Math.trunc(e==null?void 0:e.length),ie)," ",e==null?void 0:e.length," ",q(Math.trunc(e==null?void 0:e.length),le)]})}export{he as default};
