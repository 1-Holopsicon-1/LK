import{p as ie,e as z,h as oe,f as y,s as p,r as l,j as t,af as ne,J as re,n as M,a5 as ae,cM as ce,L as le}from"./vendor-08ab745b.js";import{$ as D,g as C,b as de,ai as J,X as u,l as x,an as H,L as g,S as G,ao as pe,d as ue,G as P,a2 as E,ap as h,aq as q,ar as fe,as as he,h as N,at as xe,au as _,q as U,av as ge,aw as me,ax as W,V as we,W as ve,P as je,p as Se,x as Ne,ay as ye,az as Te}from"./index-0892b83f.js";import{D as be}from"./dev-mode-message-76e05c08.js";const X=()=>D.get(`?getNotification&token=${C()}`),ke=e=>D.get(`?viewNotification=${e}&token=${C()}`),De=Object.freeze(Object.defineProperty({__proto__:null,get:X,view:ke},Symbol.toStringTag,{value:"Module"})),Y=()=>D.get(`?getDocList&token=${C()}`).then(e=>({...e,data:e.data.map(s=>({...s,document:!0}))})),Ce=e=>D.get(`?viewDoc=${e}&token=${C()}`),$e=Object.freeze(Object.defineProperty({__proto__:null,get:Y,view:Ce},Symbol.toStringTag,{value:"Module"})),V={type:null,personalNotifications:null,error:null,completed:!1},Fe=()=>({data:y(j).personalNotifications,loading:y(v.pending),error:y(j).error,completed:y(j).completed}),Ie=()=>y(j).type,Ae=ie({name:"changeCompleted",sid:"vr0j8g"}),K=z(e=>e,{name:"setNotificationsType",sid:"-m97y8b"}),v=z(async()=>{const{type:e}=j.getState();if(e==="notifications")try{return(await X()).data}catch(s){throw new Error(s)}try{return{docs:(await Y()).data}}catch(s){throw new Error(s)}},{name:"getPersonalNotificationsFx",sid:"pa84d1"}),b=z(async e=>{const{type:s}=j.getState(),i=s==="notifications"?De:$e;try{return await i.view(e),"ok"}catch{throw new Error("Ошибка загрузки данных")}},{name:"viewPersonalNotificationsFx",sid:"-64tonw"}),j=oe(V,{name:"$personalNotificationsStore",sid:"53pwkb"}).on(K,(e,s)=>({...e,type:s})).on(v,e=>({...e,error:null})).on(v.doneData,(e,s)=>({...e,personalNotifications:s})).on(v.failData,(e,s)=>({...e,error:s.message})).on(b.doneData,e=>({...e})).on(b.failData,(e,s)=>({...e,error:s.message})).on(Ae,(e,s)=>({...e,completed:s.completed})).on(de.userGuid,()=>({...V}));b.doneData.watch(()=>v());const Z={usePersonalNotifications:Fe,useType:Ie},w={setNotificationsType:K,getPersonalNotificationsFx:v,viewPersonalNotificationsFx:b},Le=(e,s,i)=>{const a={};let o=[];const r=n=>{if("document"in n){const{viewed:F,name:S}=n,T=S?.includes(e)||!e.length;return s==="all"&&T?!0:!F&&s!=="all"&&T}const{viewed:c,post:d,event:$}=n,f=$?.includes(e)||d?.includes(e)||!e.length;return s==="all"&&f?!0:!c&&s!=="all"&&f};return Object.entries(i).map(([n,c])=>{o=[],c.map(d=>{r(d)&&o.push(d)}),a[n]=o}),a},k=(e,s,i)=>{switch(e){case"Female":return i;default:return s}},Q=p.div.withConfig({componentId:"sc-rnm93p-0"})(["display:flex;flex-direction:column;gap:10px;width:100%;"]),ee=p.div.withConfig({componentId:"sc-rnm93p-1"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),Me=p.div.withConfig({componentId:"sc-1g1tw42-0"})(["display:flex;width:100%;align-items:center;justify-content:space-between;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;@media (max-width:768px){flex-direction:column;}"]),Pe=p.div.withConfig({componentId:"sc-1g1tw42-1"})(["display:flex;gap:10px;align-self:end;@media (max-width:768px){width:100%;gap:20px;}"]),Ee=({data:e})=>{const{data:{user:s}}=J.useUser(),[i,a]=l.useState(!1),[o,r]=l.useState(!1);return t.jsxs(Me,{children:[t.jsxs(Q,{children:[t.jsx(ee,{children:e.event||e.post}),e.startDate&&e.endDate!=="0000-00-00"?t.jsxs(u,{children:["Период: ",x(e.startDate,"numeric")," - ",x(e.endDate,"numeric")]}):t.jsxs(u,{children:["Дата: ",x(e.startDate,"numeric")]})]}),t.jsxs(Pe,{children:[e.file&&t.jsx(H,{href:e.file,onClick:()=>null,text:"Скачать",width:"150px",icon:t.jsx(ne,{}),height:"35px",minHeight:"30px",background:g.grey.transparent2}),t.jsx(G,{text:e.viewed?k(s?.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:()=>{a(!0),w.viewPersonalNotificationsFx(e.id),a(!1),r(!0)},height:"35px",width:"150px",buttonSuccessText:k(s?.sex,"Ознакомлен","Ознакомлена"),isLoading:i,completed:o,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},ze=p.div.withConfig({componentId:"sc-168uakk-0"})(["width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;display:flex;flex-direction:column;align-items:flex-end;"]),Be=p.div.withConfig({componentId:"sc-168uakk-1"})(["display:flex;gap:8px;margin-top:5px;width:300px;@media (max-width:768px){max-width:100%;width:100%;}"]),Oe=({data:e})=>{const{data:{user:s}}=J.useUser(),[i,a]=l.useState(!1),[o,r]=l.useState(!1),n=()=>{try{a(!0),w.viewPersonalNotificationsFx(e.id),pe.clearById({id:`studdoc-${e.id}`,pageId:"doclist"}),a(!1),r(!0)}catch{ue.evokePopUpMessage({message:"Не удалось отправить данные",type:"failure"})}};return t.jsxs(ze,{children:[t.jsxs(Q,{children:[t.jsx(ee,{children:e.name}),e.date&&t.jsxs(u,{children:["Дата: ",x(e.date,"numeric")]})]}),t.jsxs(Be,{children:[e.link&&t.jsx(H,{href:e.link,onClick:()=>null,text:"Подробнее",width:"100%",icon:t.jsx(re,{}),height:"35px",minHeight:"30px",background:g.grey.transparent2}),t.jsx(G,{text:e.viewed?k(s?.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:n,height:"35px",width:"100%",buttonSuccessText:k(s?.sex,"Ознакомлен","Ознакомлена"),isLoading:i,completed:o,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},L=({listNotification:e})=>{const s=Z.useType();return t.jsx(P,{d:"column",gap:"8px",children:e.length?e.map(i=>s==="notifications"?t.jsx(Ee,{data:i},i.id):t.jsx(Oe,{data:i},i.id)):t.jsx(E,{text:"У вас нет приказов, с которыми вы еще не ознакомились"})})},Re=e=>{const s=new Date().getTime()-new Date(e).getTime(),i=Math.floor(s/1e3);if(i<60&&i>=1)return`${i} ${h(i,_e)}`;const a=Math.floor(i/60);if(a<60&&a>=1)return`${a} ${h(a,Ue)}`;const o=Math.floor(a/60);if(o<24&&o>=1)return`${o} ${h(o,We)}`;const r=Math.floor(o/24);if(r>=1&&r<7)return`${r} ${h(r,Ve)}`;const n=Math.floor(r/7);if(n>=1&&n<4)return`${n} ${h(n,Je)}`;const c=Math.floor(r/30);if(c>=1&&c<12)return`${c} ${h(c,He)}`;const d=Math.floor(r/365);return`${d} ${h(d,Ge)}`},_e={zero:"секунд",one:"секунду",twoToFour:"секунды",fiveToNine:"секунд"},Ue={zero:"минут",one:"минута",twoToFour:"минуты",fiveToNine:"минут"},We={zero:"часов",one:"час",twoToFour:"часа",fiveToNine:"часов"},Ve={zero:"дней",one:"день",twoToFour:"дня",fiveToNine:"дней"},Je={zero:"недель",one:"неделя",twoToFour:"недели",fiveToNine:"недель"},He={zero:"месяцев",one:"месяц",twoToFour:"месяца",fiveToNine:"месяцев"},Ge={zero:"лет",one:"год",twoToFour:"года",fiveToNine:"лет"},qe=({allowance:e})=>{const s=M(q.allowanceStatusChanged),i=M(fe.userSettings);return e?t.jsxs(Xe,{children:[t.jsxs(he,{children:[t.jsxs(N,{align:"left",size:3,children:[e.paymentIdentifier,", ",e.position]}),e.orderStatus&&e.selfApprovalStatus==="Approved"&&t.jsx(N,{align:"left",size:4,children:xe[e.orderStatus]}),e.selfApprovalStatus==="Approved"&&t.jsx(u,{fontSize:"1em",color:"var(--greenMain)",children:_[e.selfApprovalStatus]}),(e.selfApprovalStatus==="Declined"||e.selfApprovalStatus==="Expired")&&t.jsx(u,{fontSize:"1em",color:"var(--redMain)",children:_[e.selfApprovalStatus]}),t.jsxs(N,{align:"left",size:5,children:["Инициатор: ",e.initiatorName]}),t.jsxs(N,{align:"left",size:5,children:["Источник: ",e.sourceOfFunding]}),t.jsxs(N,{align:"left",size:5,children:["Сумма: ",e.sum," руб."]}),t.jsxs(u,{children:["Период: ",x(e.startDate,"numeric")," -"," ",x(e.endDate,"numeric")," "]}),t.jsxs(u,{children:["Дата: ",x(e.issueDate,"numeric")]})]}),(e.selfApprovalStatus==="Unknown"||e.selfApprovalStatus==="InProgress")&&t.jsxs(t.Fragment,{children:[t.jsxs(Ye,{children:[t.jsx(U,{text:"Отказаться",onClick:()=>s({allowanceId:e.allowanceId,isConfirmed:!1}),background:g.red.main,textColor:"white",height:"35px",width:"100%",isActive:!0}),t.jsx(U,{text:"Согласиться",onClick:()=>s({allowanceId:e.allowanceId,isConfirmed:!0}),background:g.green.main,textColor:"white",height:"35px",width:"100%",isActive:!0})]}),t.jsx(Ke,{isLightTheme:i?.appearance.theme===ge.Light,children:t.jsxs(u,{children:["Подтвердите надбавку в течение 1 дня."," ",me(e.confirmationEndDate)&&`Осталось ${Re(e.confirmationEndDate)}`]})})]})]}):null},Xe=p.div.withConfig({componentId:"sc-ceiafc-0"})(["position:relative;width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);min-height:70px;display:flex;flex-direction:column;align-items:flex-end;overflow:hidden;"]),Ye=p.div.withConfig({componentId:"sc-ceiafc-1"})(["display:flex;gap:8px;margin:0.5rem 0;width:300px;@media (max-width:768px){max-width:100%;width:100%;}@media (max-width:380px){margin:1.5rem 0;}"]),Ke=p.div.withConfig({componentId:"sc-ceiafc-2"})(["position:absolute;bottom:0;background-color:",";width:100%;color:",";left:0;text-align:center;"],g.orange.transparent3,({isLightTheme:e})=>e?g.orange.dark3:g.orange.light3),Ze=({searchQuery:e,filter:s})=>{const[i,a,o]=M([W.personalAllowances.data,W.personalAllowances.loading,q.personalAllowancesMounted]);l.useEffect(()=>{o()},[]);const r=l.useMemo(()=>{const n=e?i?.filter(c=>c.position.includes(e)||c.paymentIdentifier.includes(e)||c.sourceOfFunding.includes(e)):i;return s&&s?.id==="unread"?n?.filter(c=>c.selfApprovalStatus==="Unknown"||c.selfApprovalStatus==="InProgress"):n},[i,e,s]);return a?t.jsx(P,{h:"100%",d:"column",ai:"center",jc:"center",children:t.jsx(we,{})}):t.jsxs(P,{d:"column",gap:"8px",p:"0.25rem",children:[t.jsx(be,{}),r?r.length>0?r.map(n=>t.jsx(qe,{allowance:n},n.allowanceId)):t.jsx(E,{text:"Нет надбавок"}):t.jsx(E,{text:"Произошла ошибка"})]})},Qe=p.div.withConfig({componentId:"sc-xrueg0-0"})(["display:flex;justify-content:center;gap:10px;width:100%;"]),et=[{id:"all",title:"Все"},{id:"unread",title:"Непрочитанные"}],tt=[{id:"all",title:"Все"},{id:"vacation",title:"Отпуск"},{id:"fire",title:"Увольнение"},{id:"businesstrip",title:"Командировка"}],rt=({docsType:e})=>{const s=ae(),{type:i}=ce(),a=m=>s.push(Te+"/"+m),{data:o,error:r}=Z.usePersonalNotifications(),[n,c]=l.useState(),[d,$]=l.useState(""),[f,F]=l.useState({id:"all",title:"Все"}),[S,T]=l.useState({id:"all",title:"Все"});l.useEffect(()=>{c(JSON.parse(JSON.stringify(o)))},[o]),l.useEffect(()=>{o&&c(Le(d,f?.id??"",JSON.parse(JSON.stringify(o))))},[f,d]),l.useEffect(()=>{w.setNotificationsType(i),w.getPersonalNotificationsFx()},[i]);const te=m=>{a(m)},B=l.useMemo(()=>{const m=o?.vacation||[],O=o?.businesstrip||[],R=o?.fire||[];switch(S?.id){case"all":return[...m,...O,...R].sort((I,A)=>{const se=I.notificationType==="docs"?new Date(I.date):new Date(I.startDate||"");return(A.notificationType==="docs"?new Date(A.date):new Date(A.startDate||"")).getTime()<se.getTime()?-1:1});case"vacation":return m;case"fire":return R;case"businesstrip":return O;default:return[]}},[o,S]);return t.jsx(ve,{load:()=>{w.setNotificationsType(i),w.getPersonalNotificationsFx()},error:r,data:n,children:t.jsxs(je,{children:[t.jsxs(Qe,{children:[t.jsx(Se,{value:d,setValue:$,placeholder:"Поиск",leftIcon:t.jsx(le,{})}),t.jsx(Ne,{items:i==="notifications"?tt:et,selected:i==="notifications"?S:f,setSelected:i==="notifications"?T:F})]}),e?n?.docs&&t.jsx(L,{listNotification:n?.docs}):t.jsx(ye,{onChangePage:te,currentPage:i==="allowances"?2:i==="notifications"?1:0,pages:[{id:"docs",title:"Приказы",content:n?.docs&&t.jsx(L,{listNotification:n?.docs})},{id:"notifications",title:"Кадровые уведомления",content:B.length?t.jsx(L,{listNotification:B}):void 0},{id:"allowances",title:"Надбавки",content:t.jsx(Ze,{filter:f,searchQuery:d})}]})]})})};export{rt as N};
