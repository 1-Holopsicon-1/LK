import{j as t,a5 as h,q as j,r as p,cM as v,M as R}from"./vendor-48260ac4.js";import{aO as S,M as y,ax as n,aq as x,G as f,x as A,r as b,aP as I,P as g,V as M,q as P,ay as E,aQ as F,aR as O}from"./index-a4b9dc87.js";import{D as k}from"./dev-mode-message-cc5e22b3.js";import{A as L}from"./forbidden-637b87be.js";const C=()=>[{title:"Дата",field:"createdAt",priority:"one",sort:!0,type:"date",align:"center",width:"120px"},{title:"Тип",field:"paymentIdentifier",priority:"one",width:"150px",showFull:!0,render:s=>s||"-"},{title:"Источник финансирования",field:"sourceOfFunding",priority:"three",showFull:!0,width:"175px",render:s=>s||"-"},{title:"Статус",field:"allowanceStatus",priority:"one",width:"165px",showFull:!0,catalogs:[...Object.values(S).map((s,i)=>({id:i.toString(),title:s}))??[]],render:s=>t.jsx(y,{type:s==="Completed"?"success":s==="Cancelled"?"failure":"alert",title:s||"—",align:"center",icon:null})},{title:"Комментарий",width:"160px",field:"commentary",priority:"two",render:s=>s||"-"},{title:"Файлы",field:"files",priority:"two",width:"100px",align:"center",showFull:!0,render:s=>s.application.length+s.other.length||"-"}],m=()=>{const s=h(),[i,o,a,d]=j([n.allowances,n.jobRoles,x.setCurrentRole,x.setCurrentJobId]),[r,c]=p.useState(()=>{const e=o&&o.find(u=>u.roles.includes("Initiator"));return e?{id:e.employeeId,title:e.division}:null}),l=p.useMemo(()=>o?o.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[o]);return o?t.jsxs(f,{gap:"16px",d:"column",children:[l.length>1&&t.jsx(f,{d:"column",jc:"flex-start",ai:"flex-start",children:t.jsx(A,{items:o.filter(e=>e.roles.includes("Initiator")).map(e=>({id:e.employeeId,title:e.division})),selected:r,setSelected:c})}),t.jsx(b,{loading:!i,columns:C(),data:r&&i?i[r.id].initiatorAllowances:null,maxOnPage:7,onRowClick:e=>{a("Initiator"),d((r==null?void 0:r.id.toString())||""),s.push(I+`/${e.id}`)}})]}):null},w=()=>{const s=h(),[i,o,a,d]=j([n.allowances,n.jobRoles,x.setCurrentRole,x.setCurrentJobId]),[r,c]=p.useState(()=>{const e=o&&o.find(u=>u.roles.includes("Approver"));return e?{id:e.employeeId,title:e.division}:null}),l=p.useMemo(()=>o?o.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[o]);return o?t.jsxs(f,{gap:"16px",d:"column",children:[l.length>1&&t.jsx(f,{d:"column",jc:"flex-start",ai:"flex-start",children:t.jsx(A,{items:l,selected:r,setSelected:c})}),t.jsx(b,{loading:!i,columns:C(),data:r&&i?i[r.id].approverAllowances:null,maxOnPage:7,onRowClick:e=>{a("Approver"),d((r==null?void 0:r.id.toString())||""),s.push(I+`/${e.id}`)}})]}):null},W=()=>{const s=h(),{role:i}=v(),o=u=>{s.push(F+`/${u}`)},[a,d,r,c]=j([x.pageMounted,n.rolesPending,n.roles,n.jobRoles]),l=()=>{s.push(O)},e=r.includes("Initiator")||r.includes("Approver");return p.useEffect(()=>{e&&a()},[e]),d?t.jsx(g,{children:t.jsx(f,{w:"100%",jc:"center",ai:"center",children:t.jsx(M,{})})}):e?t.jsxs(g,{topRightCornerElement:r.includes("Initiator")&&t.jsx(P,{onClick:l,text:"Подать заявку",background:"var(--reallyBlue)",textColor:"#fff",icon:t.jsx(R,{}),minWidth:"35px",height:"36px",shrinkTextInMobile:!0}),children:[t.jsx(y,{type:"info",children:t.jsxs("p",{children:["Инструкция для инициаторов доступна"," ",t.jsx("a",{href:"https://e.mospolytech.ru/old/storage/files/Ustanovlenie_nadbavok_(dlya_initsiatorov).pdf",target:"_blank",rel:"noreferrer",children:"по ссылке"}),"."]})}),t.jsx(k,{}),r.length>1?t.jsx(E,{pages:[{id:"approver",title:"Согласование надбавок",content:t.jsx(w,{})},{id:"initiator",title:"Установление надбавок",content:t.jsx(m,{})}],currentPage:i==="initiator"?1:0,onChangePage:o,appearance:!1}):r[0]==="Initiator"?t.jsx(m,{}):t.jsx(w,{})]}):t.jsx(L,{jobRoles:c})};export{W as default};
