var h=Object.defineProperty,S=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var _=(l,t,a)=>t in l?h(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,j=(l,t)=>{for(var a in t||(t={}))D.call(t,a)&&_(l,a,t[a]);if(b)for(var a of b(t))A.call(t,a)&&_(l,a,t[a]);return l},N=(l,t)=>S(l,g(t));var x=(l,t,a)=>new Promise((n,o)=>{var u=s=>{try{e(a.next(s))}catch(r){o(r)}},d=s=>{try{e(a.throw(s))}catch(r){o(r)}},e=s=>s.done?n(s.value):Promise.resolve(s.value).then(u,d);e((a=a.apply(l,t)).next())});import{r as c,cM as I,j as f}from"./vendor-00bea631.js";import{be as k,b7 as m,s as F,bf as w,B,F as T,I as q,S as H,j as E,c as G}from"./index-d824e111.js";const O=(l,t,a)=>x(void 0,null,function*(){a(!1);const n=t.map(d=>{if(Array.isArray(d.data[0])){const e=d.data.map(r=>Object.assign({},...r==null?void 0:r.map(i=>{var v,p;const y={};return i!=null&&i.fieldName&&(y[i==null?void 0:i.fieldName]=i!=null&&(v=i.value)!==null&&v!==void 0&&v.title?i==null||(p=i.value)===null||p===void 0?void 0:p.title:i==null?void 0:i.value),y}))),s={};return s[l]=JSON.stringify(e),s}else return d.data.map(e=>{var r,i;const s={};return e!=null&&e.fieldName&&(s[(r=e==null?void 0:e.fieldName)!=null?r:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(s[(i=e==null?void 0:e.fieldName)!=null?i:""]=JSON.stringify(e==null?void 0:e.value.map(v=>v.title))),s})}).flat(),o=Object.assign({},...n);!(yield k.sendBufferHolidayTransferFx({employeeGuid:o.jobGuid,reason:o.reason,period:{from:{startDate:o.holiday_old_start,endDate:o.holiday_old_end},to:{startDate:o.holiday_new_start,endDate:o.holiday_new_end}}})).isError&&a(!0)}),V=(l,t,a)=>{const{surname:n,name:o,patronymic:u}=l;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:n+" "+o+" "+u,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:t[a].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:t[a].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:m(0)},{title:"",type:"simple-text",value:t[a].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:m(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:m(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:m(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},L=()=>{var v;var l;const[t,a]=c.useState(null),{data:{dataUserApplication:n,dataWorkerApplication:o}}=F.useApplications(),{loading:u}=w.useBufferHolidayTransfer(),[d,e]=c.useState(!1),s=d!=null?d:!1,{id:r}=I(),i=+r;return c.useEffect(()=>{n&&o&&!u&&a(V(n,o,i))},[n,i,u]),f.jsx(B,{isDone:s,children:!!t&&!!a&&f.jsxs(T,{children:[f.jsx(q,N(j({},t),{collapsed:s,setData:a})),f.jsx(H,{text:"Отправить",action:()=>O(E.DISMISSAL,[t],e),isLoading:u,completed:d,setCompleted:e,repeatable:!1,buttonSuccessText:"Отправлено",isDone:s,isActive:G(t)&&((v=(l=t.optionalCheckbox)===null||l===void 0?void 0:l.value)!=null?v:!0),alerts:!1})]})})};export{L as default};
