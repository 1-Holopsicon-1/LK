var N=Object.defineProperty,S=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var _=(l,a,t)=>a in l?N(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,j=(l,a)=>{for(var t in a||(a={}))D.call(a,t)&&_(l,t,a[t]);if(b)for(var t of b(a))k.call(a,t)&&_(l,t,a[t]);return l},h=(l,a)=>S(l,g(a));var x=(l,a,t)=>new Promise((n,s)=>{var v=o=>{try{e(t.next(o))}catch(d){s(d)}},r=o=>{try{e(t.throw(o))}catch(d){s(d)}},e=o=>o.done?n(o.value):Promise.resolve(o.value).then(v,r);e((t=t.apply(l,a)).next())});import{r as c,cM as A,j as p}from"./vendor-33947725.js";import{bd as I,b6 as m,s as F,be as w,B,F as T,I as q,S as H,j as C,c as E}from"./index-af9b07d7.js";const G=(l,a,t)=>x(void 0,null,function*(){t(!1);const n=a.map(r=>{if(Array.isArray(r.data[0])){const e=r.data.map(d=>Object.assign({},...d==null?void 0:d.map(i=>{var u,f;const y={};return i!=null&&i.fieldName&&(y[i==null?void 0:i.fieldName]=i!=null&&(u=i.value)!==null&&u!==void 0&&u.title?i==null||(f=i.value)===null||f===void 0?void 0:f.title:i==null?void 0:i.value),y}))),o={};return o[l]=JSON.stringify(e),o}else return r.data.map(e=>{var o;const d={};if(e!=null&&e.fieldName&&(d[(o=e==null?void 0:e.fieldName)!==null&&o!==void 0?o:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"){var i;d[(i=e==null?void 0:e.fieldName)!==null&&i!==void 0?i:""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))}return d})}).flat(),s=Object.assign({},...n);!(yield I.sendBufferHolidayTransferFx({employeeGuid:s.jobGuid,reason:s.reason,period:{from:{startDate:s.holiday_old_start,endDate:s.holiday_old_end},to:{startDate:s.holiday_new_start,endDate:s.holiday_new_end}}})).isError&&t(!0)}),O=(l,a,t)=>{const{surname:n,name:s,patronymic:v}=l;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:n+" "+s+" "+v,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[t].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[t].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:m(0)},{title:"",type:"simple-text",value:a[t].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:m(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:m(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:m(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},L=()=>{var l,a;const[t,n]=c.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:v}}=F.useApplications(),{loading:r}=w.useBufferHolidayTransfer(),[e,o]=c.useState(!1),d=e!=null?e:!1,{id:i}=A(),u=+i;return c.useEffect(()=>{s&&v&&!r&&n(O(s,v,u))},[s,u,r]),p.jsx(B,{isDone:d,children:!!t&&!!n&&p.jsxs(T,{children:[p.jsx(q,h(j({},t),{collapsed:d,setData:n})),p.jsx(H,{text:"Отправить",action:()=>G(C.DISMISSAL,[t],o),isLoading:r,completed:e,setCompleted:o,repeatable:!1,buttonSuccessText:"Отправлено",isDone:d,isActive:E(t)&&((l=(a=t.optionalCheckbox)===null||a===void 0?void 0:a.value)!==null&&l!==void 0?l:!0),alerts:!1})]})})};export{L as default};
