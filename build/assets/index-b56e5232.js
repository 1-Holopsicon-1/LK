import{r as m,ag as D,b6 as A,j as g,C}from"./vendor-1d6bafc4.js";import{aq as R,al as _,am as w,ar as I,ad as O,an as k,F,B as L,as as G,I as q,S as B,d as E,x as J}from"./index-0f16aa88.js";const H=async(u,o,i)=>{var c,s;i(!1);const v=o.map(p=>{if(Array.isArray(p.data[0])){const e=p.data.map(r=>Object.assign({},...r==null?void 0:r.map(t=>{var y,b;const f={};return t!=null&&t.fieldName&&(f[t==null?void 0:t.fieldName]=(y=t==null?void 0:t.value)!=null&&y.title?(b=t==null?void 0:t.value)==null?void 0:b.title:t==null?void 0:t.value),f}))),l={};return l[u]=JSON.stringify(e),l}else return p.data.map(e=>{const l={};return e!=null&&e.fieldName&&(l[(e==null?void 0:e.fieldName)??""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(l[(e==null?void 0:e.fieldName)??""]=JSON.stringify(e==null?void 0:e.value.map(r=>r.title))),l})}).flat(),a=Object.assign({},...v),d=await R.postApplicationFx({guid:_(w()||"{}").IndividualGuid,jobGuid:a.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:a.last_day,isSendMail:a.get_tk==="По почте",isRetirement:!!a.isRetirement,address:a.get_tk_address,reason:a.reason.charAt(0).toLowerCase()+a.reason.slice(1)});!((s=(c=d==null?void 0:d.data)==null?void 0:c.dismissalResponse)!=null&&s.isError)&&i(!0)},P=(u,o,i,v,a,d,c,s,p,e,l,r,t)=>{const{surname:f,name:y,patronymic:b}=u;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:f+" "+y+" "+b,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:o[i].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:o[i].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:o[i].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:o[i].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:r,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:I(0),onChange:n=>{t(n)}},{title:"Причина",type:"text",value:e,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:n=>{l(n)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:v,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:n=>{a(n)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:s,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:n=>{p(n)}},{title:"Адрес для отправки трудовой книжки",value:d,fieldName:"get_tk_address",editable:!0,mask:!0,required:(s==null?void 0:s.title)=="По почте",visible:(s==null?void 0:s.title)=="По почте",onChange:n=>{c(n)}}]}},V=()=>{var j;const[u,o]=m.useState(null),{data:{dataUserApplication:i,dataWorkerApplication:v},workerLoading:a}=O.useApplications(),[d,c]=m.useState(!1),[s,p]=m.useState(null),[e,l]=m.useState(!1),[r,t]=m.useState(null),[f,y]=m.useState("По собственному желанию"),[b,n]=m.useState(null),x=d??!1,N=D(),{id:h}=A(),S=+h;return m.useEffect(()=>{i&&v&&!a&&o(P(i,v,S,s,p,r,t,e,l,f,y,b,n))},[i,S,a,s,r,e,f,b]),g.jsx(k,{isDone:x,children:!!u&&!!o&&g.jsxs(F,{children:[g.jsx(L,{text:"Назад к кадровым заявлениям",icon:g.jsx(C,{}),onClick:()=>N.push(G),background:"transparent",textColor:"var(--blue)"}),g.jsx(q,{...u,collapsed:x,setData:o}),g.jsx(B,{text:"Отправить",action:()=>H(E.DISMISSAL,[u],c),isLoading:a,completed:d,setCompleted:c,repeatable:!1,buttonSuccessText:"Отправлено",isDone:x,isActive:J(u)&&(((j=u.optionalCheckbox)==null?void 0:j.value)??!0),alerts:!1})]})})};export{V as default};
