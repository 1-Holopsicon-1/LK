var B=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var P=(e,a,n)=>a in e?B(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,O=(e,a)=>{for(var n in a||(a={}))Q.call(a,n)&&P(e,n,a[n]);if(D)for(var n of D(a))X.call(a,n)&&P(e,n,a[n]);return e},W=(e,a)=>J(e,K(a));var N=(e,a,n)=>new Promise((d,r)=>{var i=t=>{try{o(n.next(t))}catch(l){r(l)}},u=t=>{try{o(n.throw(t))}catch(l){r(l)}},o=t=>t.done?d(t.value):Promise.resolve(t.value).then(i,u);o((n=n.apply(e,a)).next())});import{j as s,L as Z,bs as Y,ce as ee,s as I,aa as se,a6 as $,bw as te,r as j,a5 as ne,cI as ae,d6 as re,co as ie,cp as oe,aW as le}from"./vendor-91dd51cf.js";import{ai as V,t as ce,v as de,w as ue,cn as he,L as pe,X as z,G as w,bZ as F,q,H as xe,co as b,bn as fe,cp as Se,cq as ge,cr as me,u as Ee,cs as G,ct as x,b$ as U,cu as _,cv as L,d as ve,cw as je,E as we,aJ as Ce,W as Me,P as ke,a0 as be,cx as Ie,cy as ye,cz as Re}from"./index-2caaee2c.js";import{E as Oe}from"./index-dabd9129.js";const Ue=({value:e,setValue:a,onHintClick:n,onValueEmpty:d})=>{const r=/\d/.test(e),{data:{user:i}}=V.useUser(),u=o=>N(void 0,null,function*(){return r?yield ue(o):yield he(o,"",1,20)});return s.jsx(ce,{value:e,width:"100%",setValue:a,onHintClick:n(r),placeholder:"Поиск",customMask:r?de.groupMask:void 0,transformRequest:r?void 0:o=>o.fio,request:u,leftIcon:e.length===0?s.jsx(Z,{}):r?s.jsx(Y,{}):s.jsx(ee,{}),onValueEmpty:(i==null?void 0:i.user_status)==="staff"?d:void 0})},_e=I(se).withConfig({componentId:"sc-17n125n-0"})(["color:var(--text);padding:15px 15px;max-width:140px;width:100%;opacity:",";border-radius:10px;background:",";color:",";&:hover{filter:brightness(0.97);}"],({disabled:e})=>e?.5:1,({isCurrent:e})=>e?pe.blue.transparent3:"transparent",({isCurrent:e})=>e?"var(--blue)":"var(--grey)"),Le=I.div.withConfig({componentId:"sc-17n125n-1"})(["display:flex;align-items:center;justify-content:center;svg{width:20px;min-width:20px;height:20px;}"]),Ve=I.div.withConfig({componentId:"sc-17n125n-2"})(["font-weight:",";font-size:0.9rem;"],({isCurrent:e})=>e?500:400),Fe=({route:e,collapsed:a=!1,disabled:n=!1,isCurrent:d=!1})=>{if(!e)return s.jsx(z,{children:"Ссылка не определена"});const{path:r,title:i,icon:u,color:o,shortTitle:t}=e,l=f=>{if(n)return f.preventDefault()};return s.jsx(_e,{collapsed:a,disabled:n,isCurrent:d,to:r,title:t!=null?t:i,color:o,onClick:l,children:s.jsxs(w,{gap:"8px",children:[s.jsx(Le,{children:u}),!a&&s.jsx(Ve,{isCurrent:d,children:t!=null?t:i})]})})},A=({handleReturnToMySchedule:e,baseSearchValue:a,handleValue:n,onHintClick:d,isSideMenuOpen:r})=>{var f;const{data:{searchValue:i,filter:u}}=F.useSchedule(),o=$(),{data:{user:t}}=V.useUser(),l=(t==null?void 0:t.user_status)==="staff";return s.jsxs(s.Fragment,{children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(z,{children:"Группа или преподаватель"}),s.jsx(Ue,{value:i,setValue:n,onHintClick:d})]}),a!==i&&s.jsx(q,{text:r&&"Мое расписание",onClick:e,icon:s.jsx(te,{}),background:"var(--block)",textColor:"var(--blue)"}),s.jsx(xe,{margin:"16px 0",width:"100%"}),s.jsx(w,{d:"column",gap:"2px",ai:"flex-start",children:Object.keys((f=b)!=null?f:{}).map(p=>{const c=b[p],{id:m,path:S}=c,g=u?`${S}/${u}`:S;return m==="schedule-session"&&l?null:s.jsx(Fe,{collapsed:!r,isCurrent:o.pathname===g,route:W(O({},c),{path:g})},m)})})]})},Te=()=>{var T,H;const{data:{user:e}}=V.useUser(),{data:{filter:a,view:n,errorInData:d}}=F.useSchedule(),{isTablet:r,isMobile:i}=fe(),[u,o]=j.useState(!0),t=$(),l=ne(),f=t.pathname!==Se,p=t.pathname.split("/"),c=p.length===4?p[p.length-1]:null,m=c?/\d/.test(c):!1,S=(e==null?void 0:e.user_status)==="staff"?(T=e==null?void 0:e.fullName)!=null?T:"":(H=e==null?void 0:e.group)!=null?H:"",g=t.pathname.includes(ge),y=t.pathname.includes(me),v=g||y,{open:C}=Ee(),E=()=>{a&&l.push(_(L,{page:t.pathname.split("/")[2]})),x.setSearchValue(S),x.setFilter(""),x.resetExternalSchedule()};j.useLayoutEffect(()=>{n===G.month&&!v&&x.changeView(G.day)},[n,v]),j.useEffect(()=>{o(!(i||r))},[r,i]),j.useEffect(()=>{c?(x.setFilter(c),x.setSearchValue(c),m?U.getGroupScheduleFx({group:c}):U.getTeacherScheduleFx({fullName:c})):E()},[c]),j.useEffect(()=>()=>{x.resetExternalSchedule()},[]);const R=()=>{U.getScheduleFx(e)},M=()=>h=>{(h==null?void 0:h.id)===(e==null?void 0:e.group)&&E(),h!=null&&h.id&&(t.pathname.split("/")[2]==="retake"?l.push(_(L,{page:"current",filter:h.value})):l.push(_(L,{page:t.pathname.split("/")[2],filter:h.value})))},k=h=>{x.setSearchValue(h)};return{isSideMenuOpen:u,shouldShowSlider:f,isMobile:i,isSessionPage:g,baseSearchValue:S,showMonth:v,handleErrorClick:()=>{ve.evokePopUpMessage({message:d,type:"failure",time:je.ten_seconds})},handleValue:k,onHintClick:M,handleReturnToMySchedule:E,handleLoad:R,handleOpenSideMenu:()=>{i?C(s.jsx(w,{d:"column",gap:"8px",ai:"flex-start",children:s.jsx(A,{isSideMenuOpen:!0,baseSearchValue:S,handleReturnToMySchedule:E,onHintClick:M,handleValue:k})})):o(h=>!h)}}},He=I.div.withConfig({componentId:"sc-sh5ff8-0"})(["min-width:",";width:",";padding-right:10px;height:calc(100vh - var(--header-height) - 112px);display:flex;z-index:10;gap:8px;flex-direction:column;align-items:",";","{display:none;}"],({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"flex-start":"center",we.isMobile),De=e=>s.jsx(He,{isSideMenuOpen:e.isSideMenuOpen,children:s.jsx(A,O({},e))}),qe=()=>{var C;const{data:{view:e,schedule:a,externalSchedule:n,errorInData:d},loading:r,error:i}=F.useSchedule(),{allRoutes:u}=Ce.useMenu(),{isSideMenuOpen:o,shouldShowSlider:t,showMonth:l,baseSearchValue:f,isMobile:p,onHintClick:c,handleValue:m,handleReturnToMySchedule:S,handleLoad:g,handleOpenSideMenu:y,handleErrorClick:v}=Te();return s.jsx(Me,{loading:r,load:g,error:i,data:r?n:a,children:s.jsx(ke,{topCenterElement:t&&s.jsx(be,{size:"small",sliderWidth:"240px",pages:l?Ie:ye,currentPage:e,appearance:!p,setCurrentPage:x.changeView}),topRightCornerElement:s.jsxs(w,{w:"fit-content",gap:"20px",children:[s.jsx(Oe,{visible:!!d,onClick:v}),s.jsx(q,{icon:p?s.jsx(ae,{}):s.jsx(re,{}),width:"36px",height:"36px",onClick:y})]}),children:u&&s.jsxs(w,{gap:"16px",ai:"flex-start",children:[!p&&s.jsx(De,{isSideMenuOpen:o,baseSearchValue:f,handleReturnToMySchedule:S,onHintClick:c,handleValue:m}),s.jsxs(ie,{children:[Object.keys((C=b)!=null?C:{}).map(E=>{const{path:R,id:M,Component:k}=b[E];return s.jsx(oe,{path:R,children:s.jsx(k,{})},M)}),s.jsx(le,{to:Re})]})]})})})};export{qe as default};
