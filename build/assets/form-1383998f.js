import{r as o,cM as D,j as n}from"./vendor-8312535b.js";import{$ as m,g,s as j,a as b,W as v,B,F as E,I as C,S as M,c as P}from"./index-3ed27df5.js";import{s as W}from"./send-form-67a97344.js";import{c as $}from"./create-form-store-ebf3dc31.js";const T=t=>m.get(`?getPhoneBookData=${t}&token=${g()}`),y=t=>{const s=new FormData;s.set("token",g()),s.set("setPhoneBookData","1");for(const[a,f]of Object.entries(t))s.set(a,f);return m.post("?setPhoneBookData=1",s,{headers:{"Content-Type":"multipart/form-data"}})},c=$({defaultStore:{completed:!1,error:null,loading:!0,data:null},api:{get:T,post:y}}),A=()=>{const[t,s]=o.useState(null),[a,f]=o.useState(!1),[F,x]=o.useState(!1),{guid:l}=D(),i=a!=null?a:!1,[r,p]=o.useState(l),{data:u,error:S}=c.selectors.useForm(),{data:{dataUserApplication:e}}=j.useApplications();return o.useEffect(()=>{e&&p(l||(e==null?void 0:e.subdivisions[0].guid_staff))},[e]),o.useEffect(()=>{var d;if(u&&r){const h=(d=e==null?void 0:e.subdivisions)==null?void 0:d.find(k=>k.guid_staff===r);s(b(u,h))}},[r,u]),o.useEffect(()=>()=>{c.events.clearStore()},[]),r?n.jsx(v,{load:()=>{c.effects.getFormFx(r)},data:e&&u,error:S,children:n.jsx(B,{isDone:i,children:!!t&&n.jsxs(E,{noHeader:!0,children:[n.jsx(C,{...t,collapsed:i,setData:s}),n.jsx(M,{text:i?"Отправлено":"Отправить",action:()=>W(t,c.effects.postFormFx,x,c.events.changeCompleted),isLoading:F,completed:a,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:P(t),popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})}):null};export{A as default};
