import{p as d,e as U,x as a,s as r,r as x,j as t,q as g,bs as W,h as y,v as b,a5 as pe,K as ue,cN as me,c as xe}from"./vendor-48260ac4.js";import{m as ge,n as he,d as V,o as fe,p as je,q as w,u as $,h as H,r as E,t as B,v as K,w as Q,x as Ce,y as Se,z as ye,D as we,b as ve,E as ke,G as p,K as f,H as $e,J as Ee,L as S,N as Ge,O as be,Q as Ie,R as Pe,U as Ne,V as Fe,X as De,M as Te,Y as Ae,Z as R,_ as Le,a0 as Re,P as Me,a1 as _e}from"./index-7f995b81.js";import{e as I,s as ze,a as qe,b as X,c as j,d as Oe,f as P,h as Y,g as Ue,A as We,i as k,j as Ve,k as He,P as M}from"./student-85552cc4.js";const Z=d({name:"addCompetition",sid:"ebmam4"}),v=U(e=>ge(e.competitionName),{name:"addCompetitionFx",sid:"-cvy5ax"});a({and:[{clock:Z,target:v}],or:{sid:"-pbpeie"}});a({and:[{clock:v.failData,fn:e=>({message:he(e,"Не удалось добавить соревнование"),type:"failure",time:3e3}),target:V.evokePopUpMessage}],or:{sid:"-p9i84y"}});a({and:[{clock:v.doneData,fn:()=>({message:"Соревнование добавлено",type:"success",time:3e3}),target:V.evokePopUpMessage}],or:{sid:"-orwt5e"}});a({and:[{clock:v.doneData,target:I.load}],or:{sid:"-oabe5u"}});a({and:[{clock:v.doneData,target:fe.close}],or:{sid:"-nwkjbt"}});const Be=r.div.withConfig({componentId:"sc-apfm2h-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;justify-content:center;min-height:300px;@media (max-width:800px){min-height:40vh;}"]),Ke=()=>{const[e,s]=x.useState(""),n=()=>{Z({competitionName:e})};return t.jsxs(Be,{children:[t.jsx(je,{title:"Название",setValue:s,value:e}),t.jsx(w,{text:"Добавить",onClick:n})]})},Qe=[{field:"name",title:"Название"},{field:"name",title:"",render:e=>t.jsx(w,{onClick:()=>I.remove(e),text:"Удалить"})}],Xe=r.div.withConfig({componentId:"sc-17yyi1s-0"})(["width:100%;display:flex;flex-direction:column;gap:10px;margin-top:20px;"]),Ye=r.div.withConfig({componentId:"sc-17yyi1s-1"})(["display:flex;flex-direction:column;width:100%;gap:10px;"]);r.div.withConfig({componentId:"sc-17yyi1s-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;gap:10px;"]);const Ze=()=>{const[e]=g([ze.$competitions]),{open:s}=$(),n=()=>{s(t.jsx(Ke,{}))};return x.useEffect(()=>{I.load()},[]),t.jsx(Ye,{children:t.jsxs(Xe,{children:[t.jsx(H,{align:"left",size:4,children:"Соревнования"}),t.jsx(w,{onClick:n,text:"Добавить соревнование"}),t.jsx(E,{data:e.map(i=>({name:i})),columns:Qe,onRowClick:()=>{}})]})})},Je=r.div.withConfig({componentId:"sc-12vwvep-0"})(["display:flex;flex-direction:row;align-items:center;gap:10px;@media (max-width:768px){flex-wrap:wrap;}"]);var J=(e=>(e.Group="group.groupName",e.Course="course",e))(J||{});const _=[{id:0,title:"Не выбрано"},{id:1,title:"1 курс"},{id:2,title:"2 курс"},{id:3,title:"3 курс"},{id:4,title:"4 курс"}],et=()=>{var c;const[e,s]=g([qe.$filters,X.$isExam]),[n,i]=x.useState(((c=e["group.groupName"])==null?void 0:c.value)??"");return t.jsxs(Je,{children:[t.jsx(B,{leftIcon:t.jsx(W,{}),placeholder:"Номер группы",value:n,setValue:i,customMask:K.groupMask,onValueEmpty:()=>j.addFilter({name:"group.groupName",value:""}),onHintClick:o=>j.addFilter({name:"group.groupName",value:(o==null?void 0:o.id)??"",strict:!0}),request:Q,size:"big"}),t.jsx(Ce,{items:_,size:"big",placeholder:"Курс",selected:_.find(o=>{var h;return o.id===((h=e.course)==null?void 0:h.value)})??null,setSelected:o=>{if(o!=null&&o.id){j.addFilter({name:"course",value:o.id});return}j.addFilter({name:"course",value:""})}}),t.jsx(Se,{title:"Зачет",state:s,action:o=>Oe.setIsExam(o)})]})},N=d({name:"pageIndexChanged",sid:"-yqoz9l"}),ee=d({name:"pageLoaded",sid:"adwljo"}),tt=y(0,{name:"$page",sid:"ndbopj"}).on(N,(e,s)=>s);a({and:[{clock:ee,target:[P.load,ye.load]}],or:{sid:"8a9ft4"}});const te=d({name:"load",sid:"h6031v"}),se=b({and:{effect:async({currentUser:e})=>{const{data:s}=await we((e==null?void 0:e.guid)??"");return s.data},source:ve.user},or:{name:"loadFx",sid:"-fzko9u"}});a({and:[{clock:te,target:se}],or:{sid:"-b03ras"}});const st=y([],{name:"$myGroups",sid:"qqeqg2"}).on(se.doneData,(e,s)=>s);function z(){const[e]=g([st]);x.useEffect(()=>{te()},[]);const s=n=>{j.resetFilters(),j.addFilter({name:J.Group,value:n.groupName,strict:!0}),N(0)};return t.jsx(E,{onRowClick:s,data:e,columns:nt})}const nt=[{field:"groupName",title:"Группа"},{field:"curatorFullName",title:"Преподаватель"}],ot=(e,s)=>{let n=e;for(const i in s)n=n.replace(`:${i}`,s[i]);return n};r.div.withConfig({componentId:"sc-10c5ztk-0"})(["min-height:50px;display:flex;gap:5px;flex-direction:column;"]);const at=r.div.withConfig({componentId:"sc-10c5ztk-1"})(["","{width:500px;}"],ke.isNotMobile),it=({student:e})=>{const s=pe(),{close:n}=$(),i=()=>{s.push(ot(Ee,{studentId:e.studentGuid})),n()};return t.jsx(at,{children:t.jsxs(p,{d:"column",gap:"16px",ai:"flex-start",children:[t.jsxs(p,{d:"column",ai:"flex-start",gap:"2px",children:[t.jsx(f,{keyStr:"Группа",value:e.groupNumber}),t.jsx(f,{keyStr:"Баллы",value:e.totalPoints}),t.jsx(f,{keyStr:"Курс",value:e.course}),t.jsx(f,{keyStr:"ЛМС",value:e.lmsPoints}),t.jsx(f,{keyStr:"Группа здоровья",value:Y[e.healthGroup]}),t.jsx(f,{keyStr:"Специализация",value:Ue[e.specialization]})]}),t.jsx($e,{width:"100%",margin:"0"}),t.jsxs(p,{d:"column",gap:"4px",ai:"flex-start",children:[t.jsx(H,{align:"left",size:4,children:"Дата"}),t.jsx(We,{studentGuid:e.studentGuid})]}),t.jsx(w,{onClick:i,text:"Перейти к студенту",width:"100%"})]})})},rt=r.div.withConfig({componentId:"sc-12o9ec3-0"})(["display:grid;width:100%;"]),dt=r.div.withConfig({componentId:"sc-12o9ec3-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]),lt=r(p).withConfig({componentId:"sc-12o9ec3-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]),F=r.span.withConfig({componentId:"sc-12o9ec3-3"})(["color:",";"],({hasDebt:e})=>e&&S.red.main),ct=[{title:"ФИО",field:"fullName",priority:"one",showFull:!0,render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebt,children:s.fullName})},{title:"Группа",field:"groupNumber",priority:"one"},{title:"Посещений",field:"visits",priority:"two"},{title:"Баллы",field:"totalPoints",priority:"one"},{title:"Нормативы",field:"standardPoints",priority:"two"},{title:"ЛМС",field:"lmsPoints",priority:"two"},{title:"Группа здоровья",showFull:!0,field:"healthGroup",priority:"two",render:e=>{const s=Y[e];return t.jsx("span",{children:s})}}],pt=[{title:"ФИО",field:"name",render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebt,children:s.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,s)=>s.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],ne=d({name:"pageLoaded",sid:"-n45vlm"});a({and:[{clock:ne,target:P.load}],or:{sid:"t4c48d"}});const q=()=>{const{open:e}=$(),{students:s,totalCount:n,page:i,search:c,loading:o,isExam:h}=g({students:k.$pEStudents,loading:k.$loading,totalCount:k.$pEStudentsTotalCount,page:k.$pEStudentsPage,search:Ve.$search,isExam:X.$isExam});return x.useEffect(()=>{ne()},[]),t.jsx(rt,{children:t.jsxs(dt,{children:[t.jsxs(lt,{children:[t.jsx(Ge,{value:c,setValue:He.update,size:"big"}),t.jsx(et,{})]}),t.jsx(E,{loading:o,data:s,columns:h?pt:ct,onRowClick:C=>{e(t.jsx(it,{student:C}),C.fullName)}}),t.jsx(be,{condition:!0,align:"right",pages:Math.floor(n/Ie),currentPage:i,setCurrentPage:P.setPage})]})})},D=d({name:"endSemester",sid:"-50inz6"}),oe=d({name:"reset",sid:"-jpbmuk"}),G=U(async({studentId:e})=>(await Pe(e),{studentGuid:e}),{name:"endSemesterFx",sid:"yxjzgs"});var u=(e=>(e.LOADING="loading",e.SUCCESS="success",e.ERROR="error",e))(u||{});const m=y({},{name:"$statuses",sid:"-dggygt"}).reset(oe);a({and:[{clock:D,source:m,fn:(e,{studentId:s})=>({...e,[s]:"loading"}),target:m}],or:{sid:"77dp82"}});a({and:[{clock:G.doneData,source:m,fn:(e,{studentGuid:s})=>({...e,[s]:"success"}),target:m}],or:{sid:"7q2pec"}});a({and:[{clock:G.fail,source:m,fn:(e,{params:s})=>({...e,[s.studentId]:"error"}),target:m}],or:{sid:"88rpkm"}});a({and:[{clock:G.done,source:m,fn:(e,{params:s})=>({...e,[s.studentId]:"success"}),target:m}],or:{sid:"8rgpqw"}});a({and:[{clock:D,target:G}],or:{sid:"9lpedr"}});const ut={endSemester:D,reset:oe},ae={statuses:m},ie=d({name:"selectedGroupChanged",sid:"-yusgt0"}),re=d({name:"load",sid:"4qbbdm"}),T=d({name:"reset",sid:"g7h26n"}),de=d({name:"endSemesterForGroup",sid:"842241"}),A=y("",{name:"$selectedGroup",sid:"-n8kqn6"}).on(ie,(e,s)=>s).reset(T),L=b({and:{source:A,effect:async e=>{const{data:s}=await Ne(0,{group:{value:e}},200);return s.data.students}},or:{name:"loadFx",sid:"xfnq33"}});a({and:[{source:A,filter:Boolean,target:L}],or:{sid:"gule9"}});const le=y([],{name:"$pEStudents",sid:"-7tia7t"}).on(L.doneData,(e,s)=>s).reset(T),mt=ue({and:[L.pending,Boolean],or:{name:"$loading",sid:"ghro6d"}}),xt=b({and:{source:le,effect:async e=>{e.forEach(s=>ut.endSemester({studentId:s.studentGuid}))}},or:{name:"endSemesterForGroupFx",sid:"3q6tp7"}});a({and:[{clock:ae.statuses,filter:e=>Object.values(e).every(s=>s!==u.LOADING),target:re}],or:{sid:"10n6r9"}});a({and:[{clock:de,target:xt}],or:{sid:"1exu6n"}});const gt={load:re,reset:T,selectedGroupChanged:ie,endSemesterForGroup:de},ht={$loading:mt,$pEStudents:le,$selectedGroup:A},l={events:gt,stores:ht},ft={[u.LOADING]:"Загрузка",[u.ERROR]:"Не зачтено",[u.SUCCESS]:"Успешно"},jt={[u.LOADING]:t.jsx(Fe,{}),[u.ERROR]:t.jsx(me,{color:S.red.main}),[u.SUCCESS]:t.jsx(xe,{color:S.green.main})},Ct=r.span.withConfig({componentId:"sc-ph8uia-0"})(["color:var(--text);font-size:1em;"]),St=()=>{const[e,s]=g([ae.statuses,l.stores.$pEStudents]);return t.jsx(p,{p:"30px",d:"column",jc:"space-between",children:s.map(n=>t.jsxs(p,{w:"100%",gap:"16px",ai:"flex-start",jc:"space-between",children:[t.jsx(Ct,{children:n.fullName}),t.jsxs(p,{gap:"8px",w:"auto",children:[t.jsx(De,{align:"center",children:ft[e[n.studentGuid]??u.LOADING]}),jt[e[n.studentGuid]??u.LOADING]]})]},n.studentGuid))})},ce=d({name:"pageLoaded",sid:"4q0med"}),yt=d({name:"pageUnloaded",sid:"he5rd5"});a({and:[{clock:ce,target:l.events.load}],or:{sid:"74c8dr"}});a({and:[{clock:yt,target:l.events.reset}],or:{sid:"76jer7"}});const wt=r.div.withConfig({componentId:"sc-s6hadh-0"})(["display:grid;width:100%;"]),vt=r.div.withConfig({componentId:"sc-s6hadh-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]);r(p).withConfig({componentId:"sc-s6hadh-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]);const kt=r(p).withConfig({componentId:"sc-s6hadh-3"})([""]),$t=[{title:"ФИО",field:"name",render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebtFromPreviousSemester,children:s.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,s)=>s.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],O=()=>{const{open:e,close:s}=$(),{students:n,loading:i,selectedGroup:c}=g({students:l.stores.$pEStudents,loading:l.stores.$loading,selectedGroup:l.stores.$selectedGroup}),o=!!(n.length&&!i&&c),h=()=>{Ae.evokeConfirm({message:"Вы уверены, что хотите завершить семестр?",onConfirm:()=>{l.events.endSemesterForGroup(),e(t.jsx(St,{}))},onReject:()=>{s(),l.events.reset()}})};return x.useEffect(()=>(ce(),()=>{l.events.reset()}),[]),t.jsxs(wt,{children:[!o&&t.jsx(Te,{type:"alert",children:"Выберите группу чтобы провести зачет"}),t.jsxs(vt,{children:[t.jsxs(kt,{d:"row",jc:"space-between",p:"8px",children:[t.jsx(B,{leftIcon:t.jsx(W,{}),placeholder:"Номер группы",value:c,setValue:l.events.selectedGroupChanged,customMask:K.groupMask,onValueEmpty:()=>l.events.selectedGroupChanged(""),onHintClick:C=>C&&l.events.selectedGroupChanged(C.id),request:Q,size:"big"}),o&&t.jsx(w,{text:`Завершить семестр для ${c}`,width:"210px",background:S.green.main,textColor:S.white.main,onClick:h})]}),o&&t.jsx(E,{loading:i,data:n,columns:$t})]})]})},It=()=>{const[e,s,n]=g([R.peTeacher,tt,R.unavailable]);if(x.useEffect(()=>{ee()},[]),n)return t.jsx(Le,{text:"Сервис временно недоступен. Попробуйте позже"});const i=[M.AdminAccess,M.SuperUser].some(c=>{var o;return(o=e==null?void 0:e.permissions)==null?void 0:o.includes(c)})?[{title:"Студенты",content:t.jsx(q,{})},{title:"Управление",content:t.jsx(Ze,{})},{title:"Мои Группы",content:t.jsx(z,{})},{title:"Проведение зачета",content:t.jsx(O,{})}]:[{title:"Студенты",content:t.jsx(q,{})},{title:"Мои Группы",content:t.jsx(z,{})},{title:"Проведение зачета",content:t.jsx(O,{})}];return t.jsx(Re,{padding:"10px",children:t.jsx(Me,{children:t.jsxs(p,{d:"column",gap:"2px",ai:"flex-start",children:[t.jsx(_e,{appearance:!1,pages:i,currentPage:s,setCurrentPage:N}),i[s].content]})})})};export{It as default};
