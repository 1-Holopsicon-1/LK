import{j as i,a5 as p,q as x,r as d,cM as v,M as F}from"./vendor-48260ac4.js";import{aN as P,M as S,aO as f,aw as h,G as c,x as y,r as A,aP as I,ap as E,b as M,P as g,V as O,q as $,ax as L,aQ as R,aR as k}from"./index-77abc1a4.js";import{F as N}from"./index-e22433b3.js";const C=()=>[{title:"Дата",field:"createdAt",priority:"two",sort:!0,type:"date",align:"center",width:"120px"},{title:"Тип",field:"paymentIdentifier",priority:"three",width:"150px",showFull:!0,render:t=>t||"-"},{title:"Источник финансирования",field:"sourceOfFunding",showFull:!0,priority:"four",width:"150px",render:t=>t||"-"},{title:"Статус",field:"allowanceStatus",priority:"one",width:"165px",showFull:!0,catalogs:[...Object.values(P).map((t,n)=>({id:n.toString(),title:t}))??[]],render:t=>i.jsx(S,{type:t==="Completed"?"success":t==="Cancelled"?"failure":"alert",title:t||"—",align:"center",icon:null})},{title:"Комментарий",field:"commentary",render:t=>t||"-"},{title:"Файлы",field:"files",width:"100px",align:"center",showFull:!0,render:t=>t.application.length+t.other.length||"-"}],j=()=>{const t=p(),[n,r]=x([f.allowances,h.role.$data]),[s,o]=d.useState(()=>{const e=r&&r.find(a=>a.roles.includes("Initiator"));return e?{id:e.employeeId,title:e.division}:null}),l=d.useMemo(()=>r?r.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[r]);return r?i.jsxs(c,{gap:"16px",d:"column",children:[l.length>1&&i.jsx(c,{d:"column",jc:"flex-start",ai:"flex-start",children:i.jsx(y,{items:r.filter(e=>e.roles.includes("Initiator")).map(e=>({id:e.employeeId,title:e.division})),selected:s,setSelected:o})}),i.jsx(A,{loading:!n,columns:C(),data:s&&n?n[s.id].initiatorAllowances:null,maxOnPage:7,onRowClick:e=>{t.push(I+`/${s==null?void 0:s.id}/initiator/${e.id}`)}})]}):null},w=()=>{const t=p(),[n,r]=x([f.allowances,h.role.$data]),[s,o]=d.useState(()=>{const e=r&&r.find(a=>a.roles.includes("Approver"));return e?{id:e.employeeId,title:e.division}:null}),l=d.useMemo(()=>r?r.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[r]);return r?i.jsxs(c,{gap:"16px",d:"column",children:[l.length>1&&i.jsx(c,{d:"column",jc:"flex-start",ai:"flex-start",children:i.jsx(y,{items:l,selected:s,setSelected:o})}),i.jsx(A,{loading:!n,columns:C(),data:s&&n?n[s.id].approverAllowances:null,maxOnPage:7,onRowClick:e=>{t.push(I+`/${s==null?void 0:s.id}/approver/${e.id}`)}})]}):null},B=()=>{var m;const t=p(),{role:n}=v(),r=b=>{t.push(R+`/${b}`)},[s,o,l,e]=x([E.pageMounted,h.role.$pending,f.roles,M.user]),a=()=>{t.push(k)},u=!l.includes("Initiator")||!l.includes("Approver")||!((m=e==null?void 0:e.currentUser)!=null&&m.guid);return d.useEffect(()=>{u||s()},[u]),o?i.jsx(g,{children:i.jsx(c,{w:"100%",jc:"center",ai:"center",children:i.jsx(O,{})})}):u?i.jsx(N,{text:"У вас нет доступа к этому разделу"}):i.jsx(g,{topRightCornerElement:l.includes("Initiator")&&i.jsx($,{onClick:a,text:"Подать заявку",background:"var(--reallyBlue)",textColor:"#fff",icon:i.jsx(F,{}),minWidth:"35px",height:"36px",shrinkTextInMobile:!0}),children:l.length>1?i.jsx(L,{pages:[{id:"approver",title:"Согласование надбавок",content:i.jsx(w,{})},{id:"initiator",title:"Установление надбавок",content:i.jsx(j,{})}],currentPage:n==="initiator"?1:0,onChangePage:r,appearance:!1}):l[0]==="Initiator"?i.jsx(j,{}):i.jsx(w,{})})};export{B as default};
