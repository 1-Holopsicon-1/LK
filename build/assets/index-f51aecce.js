import{r as m,cM as f,j as p}from"./vendor-08ab745b.js";import{b4 as y,b7 as b,s as v,b8 as N,B as x,F as j,I as h,S as _,j as g,c as k}from"./index-0892b83f.js";const S=async(e,a,t)=>{t(!1);const l=a.map(n=>{if(Array.isArray(n.data[0])){const i=n.data.map(r=>Object.assign({},...r?.map(u=>{const c={};return u?.fieldName&&(c[u?.fieldName]=u?.value?.title?u?.value?.title:u?.value),c}))),o={};return o[e]=JSON.stringify(i),o}else return n.data.map(i=>{const o={};return i?.fieldName&&(o[i?.fieldName??""]=typeof i.value!="object"?i?.value:i.value.title),i.type==="multiselect"&&(o[i?.fieldName??""]=JSON.stringify(i?.value.map(r=>r.title))),o})}).flat(),s=Object.assign({},...l);!(await y.sendBufferHolidayWorkFx({employeeGuid:s.jobGuid,dates:[{date:s.holiday_work_date,dayOff:s.extra_holiday_date?s.extra_holiday_date:null,hours:+s.holiday_work_hours}]})).isError&&t(!0)},F=e=>{const a=e.find(l=>l.fieldName==="compensation");let t=null;return a?.value&&(a?.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(t="Compensation"),{compensation:t}},A=(e,a,t)=>{const{surname:l,name:s,patronymic:d}=e;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:l+" "+s+" "+d,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[t].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[t].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:b(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:a[t].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},O=()=>{const[e,a]=m.useState(null),{data:{dataUserApplication:t,dataWorkerApplication:l}}=v.useApplications(),{loading:s}=N.useBufferHolidayWork(),[d,n]=m.useState(!1),[i,o]=m.useState({}),r=d??!1,{id:u}=f(),c=+u;return m.useEffect(()=>{t&&l&&!s&&a(A(t,l,c))},[t,c,s]),m.useEffect(()=>{e&&t&&o(F(e.data))},[e]),p.jsx(x,{isDone:r,children:!!e&&!!a&&p.jsxs(j,{children:[p.jsx(h,{...e,collapsed:r,setData:a,specialFieldsNameConfig:i}),p.jsx(_,{text:"Отправить",action:()=>S(g.HOLIDAY_WORK,[e],n),isLoading:s,completed:d,setCompleted:n,repeatable:!1,buttonSuccessText:"Отправлено",isDone:r,isActive:k(e)&&(e.optionalCheckbox?.value??!0),alerts:!1})]})})};export{O as default};
