var R=Object.defineProperty,_=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var h=(i,t,a)=>t in i?R(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,A=(i,t)=>{for(var a in t||(t={}))G.call(t,a)&&h(i,a,t[a]);if(D)for(var a of D(t))I.call(t,a)&&h(i,a,t[a]);return i},w=(i,t)=>_(i,F(t));import{r as c,cM as O,j as g}from"./vendor-31894644.js";import{b6 as k,b2 as L,aW as q,b7 as B,s as E,B as J,F as M,I as V,S as z,j as H,c as P}from"./index-0f8b6250.js";const U=async(i,t,a)=>{var f,o;a(!1);const v=t.map(p=>{if(Array.isArray(p.data[0])){const e=p.data.map(l=>Object.assign({},...l==null?void 0:l.map(s=>{var y,b;const m={};return s!=null&&s.fieldName&&(m[s==null?void 0:s.fieldName]=(y=s==null?void 0:s.value)!=null&&y.title?(b=s==null?void 0:s.value)==null?void 0:b.title:s==null?void 0:s.value),m}))),d={};return d[i]=JSON.stringify(e),d}else return p.data.map(e=>{var l,s;const d={};return e!=null&&e.fieldName&&(d[(l=e==null?void 0:e.fieldName)!=null?l:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(d[(s=e==null?void 0:e.fieldName)!=null?s:""]=JSON.stringify(e==null?void 0:e.value.map(m=>m.title))),d})}).flat(),n=Object.assign({},...v),r=await k.postApplicationFx({guid:L(q()||"{}").IndividualGuid,jobGuid:n.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:n.last_day,isSendMail:n.get_tk==="По почте",isRetirement:!!n.isRetirement,address:n.get_tk_address,reason:n.reason.charAt(0).toLowerCase()+n.reason.slice(1)});!((o=(f=r==null?void 0:r.data)==null?void 0:f.dismissalResponse)!=null&&o.isError)&&a(!0)},W=(i,t,a,v,n,r,f,o,p,e,d,l,s)=>{const{surname:m,name:y,patronymic:b}=i;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:m+" "+y+" "+b,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:t[a].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:t[a].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:t[a].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:t[a].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:l,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:B(0),onChange:u=>{s(u)}},{title:"Причина",type:"text",value:e,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:u=>{d(u)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:v,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:u=>{n(u)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:o,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:u=>{p(u)}},{title:"Адрес для отправки трудовой книжки",value:r,fieldName:"get_tk_address",editable:!0,mask:!0,required:(o==null?void 0:o.title)=="По почте",visible:(o==null?void 0:o.title)=="По почте",onChange:u=>{f(u)}}]}},Y=()=>{var x,N;const[i,t]=c.useState(null),{data:{dataUserApplication:a,dataWorkerApplication:v},workerLoading:n}=E.useApplications(),[r,f]=c.useState(!1),[o,p]=c.useState(null),[e,d]=c.useState(!1),[l,s]=c.useState(null),[m,y]=c.useState("По собственному желанию"),[b,u]=c.useState(null),S=r!=null?r:!1,{id:C}=O(),j=+C;return c.useEffect(()=>{a&&v&&!n&&t(W(a,v,j,o,p,l,s,e,d,m,y,b,u))},[a,j,n,o,l,e,m,b]),g.jsx(J,{isDone:S,children:!!i&&!!t&&g.jsxs(M,{children:[g.jsx(V,w(A({},i),{collapsed:S,setData:t})),g.jsx(z,{text:"Отправить",action:()=>U(H.DISMISSAL,[i],f),isLoading:n,completed:r,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:P(i)&&((N=(x=i.optionalCheckbox)==null?void 0:x.value)!=null?N:!0),alerts:!1})]})})};export{Y as default};
