var N=Object.defineProperty,O=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var k=(t,e,s)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,E=(t,e)=>{for(var s in e||(e={}))_.call(e,s)&&k(t,s,e[s]);if(x)for(var s of x(e))W.call(e,s)&&k(t,s,e[s]);return t},P=(t,e)=>O(t,S(e));var p=(t,e,s)=>new Promise((m,o)=>{var d=i=>{try{a(s.next(i))}catch(n){o(n)}},u=i=>{try{a(s.throw(i))}catch(n){o(n)}},a=i=>i.done?m(i.value):Promise.resolve(i.value).then(d,u);a((s=s.apply(t,e)).next())});import{p as T,e as j,x as l,h as $,u as h,r as b,q as D,j as f}from"./vendor-00bea631.js";import{b1 as B,b2 as q,aW as G,b3 as F,b4 as I,s as H,B as J,F as L,I as U,S as z,j as C,c as M,b5 as R}from"./index-ed5dff92.js";const K=T({name:"loadBufferPartTimeEmployment",sid:"rqpj9r"}),Y=T({name:"sendBufferPartTimeEmployment",sid:"-1vo25s"}),A=j(()=>p(void 0,null,function*(){var e;const{data:t}=yield B.get(`InternalPartTime.GetAllHistory?PersonalGuid=${q((e=G())!=null?e:"").IndividualGuid}`);return t.orders}),{name:"loadBufferPartTimeEmploymentFx",sid:"lptsxp"});l({and:[{clock:K,target:A}],or:{sid:"-bwsfri"}});const y=j(t=>p(void 0,null,function*(){return(yield B.post("Weekend.AddWeekend",t)).data}),{name:"sendBufferPartTimeEmploymentFx",sid:"-26c53s"});l({and:[{clock:Y,target:y}],or:{sid:"-bguek1"}});const w=$([],{name:"$bufferPartTimeEmploymentOrders",sid:"-rtc3mi"}),Q=y.pending;l({and:[{clock:A.doneData,target:w}],or:{sid:"-bdjmzv"}});l({and:[{clock:y.doneData,fn:t=>{const e=t;return e.isError?{message:e.error,type:"hrFailure",time:3e5}:{message:"Форма отправлена успешно",type:"success",time:0}},target:F.evokePopUpMessage}],or:{sid:"-azss5u"}});l({and:[{clock:y.fail,fn:()=>({message:"Не удалось отправить форму.",type:"hrFailure",time:3e5}),target:F.evokePopUpMessage}],or:{sid:"-a29byt"}});const V={useBufferPartTimeEmployment:()=>({data:h(w),loading:h(Q)})},X=(t,e)=>{const{surname:s,name:m,patronymic:o}=t;return{title:"Заявление на трудоустройство по совместительству",data:[{title:"ФИО",value:s+" "+m+" "+o,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделениe, куда производится трудорустройство",type:"auto-complete-input",fieldName:"newPlaceOfWork",value:"",width:"100%",suggestions:e,required:!0,mask:!0,visible:!0,placeholder:"Начните вводить название подразделения"},{title:"Должность",value:null,fieldName:"post",mask:!0,editable:!0,required:!0},{title:"Ставка",type:"select",fieldName:"rate",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"0.5"},{id:2,title:"0.25"}]}]}},Z=(t,e,s)=>p(void 0,null,function*(){s(!1);const m=e.map(u=>{if(Array.isArray(u.data[0])){const a=u.data.map(n=>Object.assign({},...n==null?void 0:n.map(r=>{var g,v;const c={};return r!=null&&r.fieldName&&(c[r==null?void 0:r.fieldName]=(g=r==null?void 0:r.value)!=null&&g.title?(v=r==null?void 0:r.value)==null?void 0:v.title:r==null?void 0:r.value),c}))),i={};return i[t]=JSON.stringify(a),i}else return u.data.map(a=>{var n,r;const i={};return a!=null&&a.fieldName&&(i[(n=a==null?void 0:a.fieldName)!=null?n:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"&&(i[(r=a==null?void 0:a.fieldName)!=null?r:""]=JSON.stringify(a==null?void 0:a.value.map(c=>c.title))),i})}).flat(),o=Object.assign({},...m);!(yield I.sendBufferHolidayWorkFx({employeeGuid:o.jobGuid,dates:[{date:o.holiday_work_date,dayOff:o.extra_holiday_date?o.extra_holiday_date:null,hours:+o.holiday_work_hours}]})).isError&&s(!0)}),se=()=>{var i,n;const[t,e]=b.useState(null),{data:{dataUserApplication:s}}=H.useApplications(),{loading:m}=V.useBufferPartTimeEmployment(),[o,d]=b.useState(!1),u=o!=null?o:!1,a=D(R);return b.useEffect(()=>{s&&!m&&e(X(s,a))},[s,m]),f.jsx(J,{isDone:u,children:!!t&&!!e&&f.jsxs(L,{children:[f.jsx(U,P(E({},t),{collapsed:u,setData:e})),f.jsx(z,{text:"Отправить",action:()=>Z(C.HOLIDAY_WORK,[t],d),isLoading:m,completed:o,setCompleted:d,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:M(t)&&((n=(i=t.optionalCheckbox)==null?void 0:i.value)!=null?n:!0)})]})})};export{se as default};
