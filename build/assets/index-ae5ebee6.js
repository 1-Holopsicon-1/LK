import{r as d,cM as N,j as b}from"./vendor-08ab745b.js";import{b6 as D,b2 as h,aW as k,b7 as A,s as w,B as C,F as R,I as _,S as F,j as G,c as I}from"./index-0892b83f.js";const O=async(r,i,s)=>{s(!1);const c=i.map(o=>{if(Array.isArray(o.data[0])){const e=o.data.map(u=>Object.assign({},...u?.map(n=>{const m={};return n?.fieldName&&(m[n?.fieldName]=n?.value?.title?n?.value?.title:n?.value),m}))),l={};return l[r]=JSON.stringify(e),l}else return o.data.map(e=>{const l={};return e?.fieldName&&(l[e?.fieldName??""]=typeof e.value!="object"?e?.value:e.value.title),e.type==="multiselect"&&(l[e?.fieldName??""]=JSON.stringify(e?.value.map(u=>u.title))),l})}).flat(),t=Object.assign({},...c);!(await D.postApplicationFx({guid:h(k()||"{}").IndividualGuid,jobGuid:t.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:t.last_day,isSendMail:t.get_tk==="По почте",isRetirement:!!t.isRetirement,address:t.get_tk_address,reason:t.reason.charAt(0).toLowerCase()+t.reason.slice(1)}))?.data?.dismissalResponse?.isError&&s(!0)},T=(r,i,s,c,t,p,o,e,l,u,n,m,v)=>{const{surname:f,name:y,patronymic:g}=r;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:f+" "+y+" "+g,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:i[s].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:i[s].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:i[s].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:i[s].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:m,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:A(0),onChange:a=>{v(a)}},{title:"Причина",type:"text",value:u,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:a=>{n(a)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:c,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:a=>{t(a)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:e,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:a=>{l(a)}},{title:"Адрес для отправки трудовой книжки",value:p,fieldName:"get_tk_address",editable:!0,mask:!0,required:e?.title=="По почте",visible:e?.title=="По почте",onChange:a=>{o(a)}}]}},B=()=>{const[r,i]=d.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:c},workerLoading:t}=w.useApplications(),[p,o]=d.useState(!1),[e,l]=d.useState(null),[u,n]=d.useState(!1),[m,v]=d.useState(null),[f,y]=d.useState("По собственному желанию"),[g,a]=d.useState(null),S=p??!1,{id:x}=N(),j=+x;return d.useEffect(()=>{s&&c&&!t&&i(T(s,c,j,e,l,m,v,u,n,f,y,g,a))},[s,j,t,e,m,u,f,g]),b.jsx(C,{isDone:S,children:!!r&&!!i&&b.jsxs(R,{children:[b.jsx(_,{...r,collapsed:S,setData:i}),b.jsx(F,{text:"Отправить",action:()=>O(G.DISMISSAL,[r],o),isLoading:t,completed:p,setCompleted:o,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:I(r)&&(r.optionalCheckbox?.value??!0),alerts:!1})]})})};export{B as default};
