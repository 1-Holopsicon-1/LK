var _=Object.defineProperty,F=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var h=(i,a,t)=>a in i?_(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t,A=(i,a)=>{for(var t in a||(a={}))I.call(a,t)&&h(i,t,a[t]);if(D)for(var t of D(a))O.call(a,t)&&h(i,t,a[t]);return i},w=(i,a)=>F(i,G(a));var C=(i,a,t)=>new Promise((p,o)=>{var u=l=>{try{n(t.next(l))}catch(e){o(e)}},c=l=>{try{n(t.throw(l))}catch(e){o(e)}},n=l=>l.done?p(l.value):Promise.resolve(l.value).then(u,c);n((t=t.apply(i,a)).next())});import{r as b,cM as k,j as g}from"./vendor-00bea631.js";import{b6 as L,b2 as q,aW as B,b7 as E,s as J,B as M,F as V,I as z,S as H,j as P,c as U}from"./index-ed5dff92.js";const W=(i,a,t)=>C(void 0,null,function*(){var c,n;t(!1);const p=a.map(l=>{if(Array.isArray(l.data[0])){const e=l.data.map(r=>Object.assign({},...r==null?void 0:r.map(s=>{var y,v;const f={};return s!=null&&s.fieldName&&(f[s==null?void 0:s.fieldName]=(y=s==null?void 0:s.value)!=null&&y.title?(v=s==null?void 0:s.value)==null?void 0:v.title:s==null?void 0:s.value),f}))),m={};return m[i]=JSON.stringify(e),m}else return l.data.map(e=>{var r,s;const m={};return e!=null&&e.fieldName&&(m[(r=e==null?void 0:e.fieldName)!=null?r:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(m[(s=e==null?void 0:e.fieldName)!=null?s:""]=JSON.stringify(e==null?void 0:e.value.map(f=>f.title))),m})}).flat(),o=Object.assign({},...p),u=yield L.postApplicationFx({guid:q(B()||"{}").IndividualGuid,jobGuid:o.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:o.last_day,isSendMail:o.get_tk==="По почте",isRetirement:!!o.isRetirement,address:o.get_tk_address,reason:o.reason.charAt(0).toLowerCase()+o.reason.slice(1)});!((n=(c=u==null?void 0:u.data)==null?void 0:c.dismissalResponse)!=null&&n.isError)&&t(!0)}),K=(i,a,t,p,o,u,c,n,l,e,m,r,s)=>{const{surname:f,name:y,patronymic:v}=i;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:f+" "+y+" "+v,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:a[t].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:a[t].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:a[t].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:a[t].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:r,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:E(0),onChange:d=>{s(d)}},{title:"Причина",type:"text",value:e,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:d=>{m(d)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:p,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:d=>{o(d)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:n,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:d=>{l(d)}},{title:"Адрес для отправки трудовой книжки",value:u,fieldName:"get_tk_address",editable:!0,mask:!0,required:(n==null?void 0:n.title)=="По почте",visible:(n==null?void 0:n.title)=="По почте",onChange:d=>{c(d)}}]}},Z=()=>{var x,N;const[i,a]=b.useState(null),{data:{dataUserApplication:t,dataWorkerApplication:p},workerLoading:o}=J.useApplications(),[u,c]=b.useState(!1),[n,l]=b.useState(null),[e,m]=b.useState(!1),[r,s]=b.useState(null),[f,y]=b.useState("По собственному желанию"),[v,d]=b.useState(null),S=u!=null?u:!1,{id:R}=k(),j=+R;return b.useEffect(()=>{t&&p&&!o&&a(K(t,p,j,n,l,r,s,e,m,f,y,v,d))},[t,j,o,n,r,e,f,v]),g.jsx(M,{isDone:S,children:!!i&&!!a&&g.jsxs(V,{children:[g.jsx(z,w(A({},i),{collapsed:S,setData:a})),g.jsx(H,{text:"Отправить",action:()=>W(P.DISMISSAL,[i],c),isLoading:o,completed:u,setCompleted:c,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:U(i)&&((N=(x=i.optionalCheckbox)==null?void 0:x.value)!=null?N:!0),alerts:!1})]})})};export{Z as default};
