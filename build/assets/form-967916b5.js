var B=Object.defineProperty,E=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var g=(t,e,s)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,F=(t,e)=>{for(var s in e||(e={}))M.call(e,s)&&g(t,s,e[s]);if(m)for(var s of m(e))P.call(e,s)&&g(t,s,e[s]);return t},x=(t,e)=>E(t,C(e));import{r as a,cM as W,j as n}from"./vendor-d78621d5.js";import{$ as S,g as h,s as $,a as T,W as y,B as I,F as L,I as _,S as w,c as A}from"./index-9478e959.js";import{s as G}from"./send-form-0ce99d9b.js";import{c as H}from"./create-form-store-6d8b0155.js";const O=t=>S.get(`?getPhoneBookData=${t}&token=${h()}`),R=t=>{const e=new FormData;e.set("token",h()),e.set("setPhoneBookData","1");for(const[s,f]of Object.entries(t))e.set(s,f);return S.post("?setPhoneBookData=1",e,{headers:{"Content-Type":"multipart/form-data"}})},c=H({defaultStore:{completed:!1,error:null,loading:!0,data:null},api:{get:O,post:R}}),Q=()=>{const[t,e]=a.useState(null),[s,f]=a.useState(!1),[k,D]=a.useState(!1),{guid:l}=W(),i=s!=null?s:!1,[r,p]=a.useState(l),{data:u,error:j}=c.selectors.useForm(),{data:{dataUserApplication:o}}=$.useApplications();return a.useEffect(()=>{o&&p(l||(o==null?void 0:o.subdivisions[0].guid_staff))},[o]),a.useEffect(()=>{var d;if(u&&r){const b=(d=o==null?void 0:o.subdivisions)==null?void 0:d.find(v=>v.guid_staff===r);e(T(u,b))}},[r,u]),a.useEffect(()=>()=>{c.events.clearStore()},[]),r?n.jsx(y,{load:()=>{c.effects.getFormFx(r)},data:o&&u,error:j,children:n.jsx(I,{isDone:i,children:!!t&&n.jsxs(L,{noHeader:!0,children:[n.jsx(_,x(F({},t),{collapsed:i,setData:e})),n.jsx(w,{text:i?"Отправлено":"Отправить",action:()=>G(t,c.effects.postFormFx,D,c.events.changeCompleted),isLoading:k,completed:s,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:A(t),popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})}):null};export{Q as default};
