import{p as se,e as O,h as ie,f as b,s as p,r as a,j as t,af as ne,J as oe,q as $,a5 as re,cM as ae,L as ce}from"./vendor-48260ac4.js";import{$ as T,g as D,b as de,ai as V,X as g,l as f,an as J,L as h,S as q,ao as le,d as pe,G as P,a2 as E,ap as G,aq as ue,ar as xe,h as y,as as ge,at as fe,au as M,q as U,av as he,aw as R,V as me,W as we,P as ve,p as je,x as Se,ax as ye,ay as be}from"./index-2cc60c9e.js";const H=()=>T.get(`?getNotification&token=${D()}`),ke=e=>T.get(`?viewNotification=${e}&token=${D()}`),Ce=Object.freeze(Object.defineProperty({__proto__:null,get:H,view:ke},Symbol.toStringTag,{value:"Module"})),X=()=>T.get(`?getDocList&token=${D()}`).then(e=>({...e,data:e.data.map(s=>({...s,document:!0}))})),Ne=e=>T.get(`?viewDoc=${e}&token=${D()}`),Te=Object.freeze(Object.defineProperty({__proto__:null,get:X,view:Ne},Symbol.toStringTag,{value:"Module"})),W={type:null,personalNotifications:null,error:null,completed:!1},De=()=>({data:b(j).personalNotifications,loading:b(v.pending),error:b(j).error,completed:b(j).completed}),Ie=()=>b(j).type,Ae=se({name:"changeCompleted",sid:"vr0j8g"}),K=O(e=>e,{name:"setNotificationsType",sid:"-m97y8b"}),v=O(async()=>{const{type:e}=j.getState();if(e==="notifications")try{return(await H()).data}catch(s){throw new Error(s)}try{return{docs:(await X()).data}}catch(s){throw new Error(s)}},{name:"getPersonalNotificationsFx",sid:"pa84d1"}),C=O(async e=>{const{type:s}=j.getState(),i=s==="notifications"?Ce:Te;try{return await i.view(e),"ok"}catch{throw new Error("Ошибка загрузки данных")}},{name:"viewPersonalNotificationsFx",sid:"-64tonw"}),j=ie(W,{name:"$personalNotificationsStore",sid:"53pwkb"}).on(K,(e,s)=>({...e,type:s})).on(v,e=>({...e,error:null})).on(v.doneData,(e,s)=>({...e,personalNotifications:s})).on(v.failData,(e,s)=>({...e,error:s.message})).on(C.doneData,e=>({...e})).on(C.failData,(e,s)=>({...e,error:s.message})).on(Ae,(e,s)=>({...e,completed:s.completed})).on(de.userGuid,()=>({...W}));C.doneData.watch(()=>v());const Y={usePersonalNotifications:De,useType:Ie},w={setNotificationsType:K,getPersonalNotificationsFx:v,viewPersonalNotificationsFx:C},Le=(e,s,i)=>{const c={};let o=[];const d=n=>{if("document"in n){const{viewed:I,name:x}=n,k=(x==null?void 0:x.includes(e))||!e.length;return s==="all"&&k?!0:!I&&s!=="all"&&k}const{viewed:r,post:l,event:S}=n,u=(S==null?void 0:S.includes(e))||(l==null?void 0:l.includes(e))||!e.length;return s==="all"&&u?!0:!r&&s!=="all"&&u};return Object.entries(i).map(([n,r])=>{o=[],r.map(l=>{d(l)&&o.push(l)}),c[n]=o}),c},N=(e,s,i)=>{switch(e){case"Female":return i;default:return s}},Z=p.div.withConfig({componentId:"sc-rnm93p-0"})(["display:flex;flex-direction:column;gap:10px;width:100%;"]),Q=p.div.withConfig({componentId:"sc-rnm93p-1"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),Fe=p.div.withConfig({componentId:"sc-1g1tw42-0"})(["display:flex;width:100%;align-items:center;justify-content:space-between;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;@media (max-width:768px){flex-direction:column;}"]),$e=p.div.withConfig({componentId:"sc-1g1tw42-1"})(["display:flex;gap:10px;align-self:end;@media (max-width:768px){width:100%;gap:20px;}"]),Pe=({data:e})=>{const{data:{user:s}}=V.useUser(),[i,c]=a.useState(!1),[o,d]=a.useState(!1);return t.jsxs(Fe,{children:[t.jsxs(Z,{children:[t.jsx(Q,{children:e.event||e.post}),e.startDate&&e.endDate!=="0000-00-00"?t.jsxs(g,{children:["Период: ",f(e.startDate,"numeric")," - ",f(e.endDate,"numeric")]}):t.jsxs(g,{children:["Дата: ",f(e.startDate,"numeric")]})]}),t.jsxs($e,{children:[e.file&&t.jsx(J,{href:e.file,onClick:()=>null,text:"Скачать",width:"150px",icon:t.jsx(ne,{}),height:"35px",minHeight:"30px",background:h.grey.transparent2}),t.jsx(q,{text:e.viewed?N(s==null?void 0:s.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:()=>{c(!0),w.viewPersonalNotificationsFx(e.id),c(!1),d(!0)},height:"35px",width:"150px",buttonSuccessText:N(s==null?void 0:s.sex,"Ознакомлен","Ознакомлена"),isLoading:i,completed:o,setCompleted:d,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},Ee=p.div.withConfig({componentId:"sc-168uakk-0"})(["width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;display:flex;flex-direction:column;align-items:flex-end;"]),Oe=p.div.withConfig({componentId:"sc-168uakk-1"})(["display:flex;gap:8px;margin-top:5px;width:300px;@media (max-width:768px){max-width:100%;width:100%;}"]),Be=({data:e})=>{const{data:{user:s}}=V.useUser(),[i,c]=a.useState(!1),[o,d]=a.useState(!1),n=()=>{try{c(!0),w.viewPersonalNotificationsFx(e.id),le.clearById({id:`studdoc-${e.id}`,pageId:"doclist"}),c(!1),d(!0)}catch{pe.evokePopUpMessage({message:"Не удалось отправить данные",type:"failure"})}};return t.jsxs(Ee,{children:[t.jsxs(Z,{children:[t.jsx(Q,{children:e.name}),e.date&&t.jsxs(g,{children:["Дата: ",f(e.date,"numeric")]})]}),t.jsxs(Oe,{children:[e.link&&t.jsx(J,{href:e.link,onClick:()=>null,text:"Подробнее",width:"100%",icon:t.jsx(oe,{}),height:"35px",minHeight:"30px",background:h.grey.transparent2}),t.jsx(q,{text:e.viewed?N(s==null?void 0:s.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:n,height:"35px",width:"100%",buttonSuccessText:N(s==null?void 0:s.sex,"Ознакомлен","Ознакомлена"),isLoading:i,completed:o,setCompleted:d,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},F=({listNotification:e})=>{const s=Y.useType();return t.jsx(P,{d:"column",gap:"8px",children:e.length?e.map(i=>s==="notifications"?t.jsx(Pe,{data:i},i.id):t.jsx(Be,{data:i},i.id)):t.jsx(E,{text:"У вас нет приказов, с которыми вы еще не ознакомились"})})},_e={fiveToNine:"дней",one:"день",twoToFour:"дня",zero:"дней"},ze=({allowance:e})=>{const s=$(G.allowanceStatusChanged),i=$(ue.userSettings);return e?t.jsxs(Me,{children:[t.jsxs(xe,{children:[t.jsxs(y,{align:"left",size:3,children:[e.paymentIdentifier,", ",e.position]}),!!e.toConfirmDaysLeft&&t.jsxs(g,{fontSize:"1em",color:"var(--redMain)",children:["Осталось ",e.toConfirmDaysLeft," ",ge(e.toConfirmDaysLeft,_e)]}),e.orderStatus&&e.selfApprovalStatus==="Approved"&&t.jsxs(y,{align:"left",size:4,children:[fe[e.orderStatus]," ",e.orderTitle&&`(${e.orderTitle})`]}),e.selfApprovalStatus==="Approved"&&t.jsx(g,{fontSize:"1em",color:"var(--greenMain)",children:M[e.selfApprovalStatus]}),(e.selfApprovalStatus==="Declined"||e.selfApprovalStatus==="Expired")&&t.jsx(g,{fontSize:"1em",color:"var(--redMain)",children:M[e.selfApprovalStatus]}),t.jsxs(y,{align:"left",size:5,children:["Инициатор: ",e.initiatorName]}),t.jsxs(y,{align:"left",size:5,children:["Источник: ",e.sourceOfFunding]}),t.jsxs(y,{align:"left",size:5,children:["Сумма: ",e.sum," руб."]}),t.jsxs(g,{children:["Период: ",f(e.startDate,"numeric")," -"," ",f(e.endDate,"numeric")," "]}),t.jsxs(g,{children:["Дата: ",f(e.issueDate,"numeric")]})]}),(e.selfApprovalStatus==="Unknown"||e.selfApprovalStatus==="InProgress")&&t.jsxs(t.Fragment,{children:[t.jsxs(Ue,{children:[t.jsx(U,{text:"Отказаться",onClick:()=>s({allowanceId:e.allowanceId,isConfirmed:!1}),background:h.red.main,textColor:"white",height:"35px",width:"100%",isActive:!0}),t.jsx(U,{text:"Согласиться",onClick:()=>s({allowanceId:e.allowanceId,isConfirmed:!0}),background:h.green.main,textColor:"white",height:"35px",width:"100%",isActive:!0})]}),t.jsx(Re,{isLightTheme:(i==null?void 0:i.appearance.theme)===he.Light,children:t.jsx(g,{children:"Подтвердите надбавку в течение 3 рабочих дней"})})]})]}):null},Me=p.div.withConfig({componentId:"sc-ceiafc-0"})(["position:relative;width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);min-height:70px;display:flex;flex-direction:column;align-items:flex-end;overflow:hidden;"]),Ue=p.div.withConfig({componentId:"sc-ceiafc-1"})(["display:flex;gap:8px;margin:0.5rem 0;width:300px;@media (max-width:768px){max-width:100%;width:100%;}@media (max-width:380px){margin:1.5rem 0;}"]),Re=p.div.withConfig({componentId:"sc-ceiafc-2"})(["position:absolute;bottom:0;background-color:",";width:100%;color:",";left:0;text-align:center;"],h.orange.transparent3,({isLightTheme:e})=>e?h.orange.dark3:h.orange.light3),We=({searchQuery:e,filter:s})=>{const[i,c,o]=$([R.personalAllowances.data,R.personalAllowances.loading,G.personalAllowancesMounted]);a.useEffect(()=>{o()},[]);const d=a.useMemo(()=>{const n=e?i==null?void 0:i.filter(r=>r.position.includes(e)||r.paymentIdentifier.includes(e)||r.sourceOfFunding.includes(e)):i;return s&&(s==null?void 0:s.id)==="unread"?n==null?void 0:n.filter(r=>r.selfApprovalStatus==="Unknown"||r.selfApprovalStatus==="InProgress"):n},[i,e,s]);return c?t.jsx(P,{h:"100%",d:"column",ai:"center",jc:"center",children:t.jsx(me,{})}):t.jsx(P,{d:"column",gap:"8px",p:"0.25rem",children:d?d.length>0?d.map(n=>t.jsx(ze,{allowance:n},n.allowanceId)):t.jsx(E,{text:"Нет надбавок"}):t.jsx(E,{text:"Произошла ошибка"})})},Ve=p.div.withConfig({componentId:"sc-xrueg0-0"})(["display:flex;justify-content:center;gap:10px;width:100%;"]),Je=[{id:"all",title:"Все"},{id:"unread",title:"Непрочитанные"}],qe=[{id:"all",title:"Все"},{id:"vacation",title:"Отпуск"},{id:"fire",title:"Увольнение"},{id:"businesstrip",title:"Командировка"}],Ke=({docsType:e})=>{const s=re(),{type:i}=ae(),c=m=>s.push(be+"/"+m),{data:o,error:d}=Y.usePersonalNotifications(),[n,r]=a.useState(),[l,S]=a.useState(""),[u,I]=a.useState({id:"all",title:"Все"}),[x,k]=a.useState({id:"all",title:"Все"});a.useEffect(()=>{r(JSON.parse(JSON.stringify(o)))},[o]),a.useEffect(()=>{o&&r(Le(l,(u==null?void 0:u.id)??"",JSON.parse(JSON.stringify(o))))},[u,l]),a.useEffect(()=>{w.setNotificationsType(i),w.getPersonalNotificationsFx()},[i]);const ee=m=>{c(m)},B=a.useMemo(()=>{const m=(o==null?void 0:o.vacation)||[],_=(o==null?void 0:o.businesstrip)||[],z=(o==null?void 0:o.fire)||[];switch(x==null?void 0:x.id){case"all":return[...m,..._,...z].sort((A,L)=>{const te=A.notificationType==="docs"?new Date(A.date):new Date(A.startDate||"");return(L.notificationType==="docs"?new Date(L.date):new Date(L.startDate||"")).getTime()<te.getTime()?-1:1});case"vacation":return m;case"fire":return z;case"businesstrip":return _;default:return[]}},[o,x]);return t.jsx(we,{load:()=>{w.setNotificationsType(i),w.getPersonalNotificationsFx()},error:d,data:n,children:t.jsxs(ve,{children:[t.jsxs(Ve,{children:[t.jsx(je,{value:l,setValue:S,placeholder:"Поиск",leftIcon:t.jsx(ce,{})}),t.jsx(Se,{items:i==="notifications"?qe:Je,selected:i==="notifications"?x:u,setSelected:i==="notifications"?k:I})]}),e?(n==null?void 0:n.docs)&&t.jsx(F,{listNotification:n==null?void 0:n.docs}):t.jsx(ye,{onChangePage:ee,currentPage:i==="allowances"?2:i==="notifications"?1:0,pages:[{id:"docs",title:"Приказы",content:(n==null?void 0:n.docs)&&t.jsx(F,{listNotification:n==null?void 0:n.docs})},{id:"notifications",title:"Кадровые уведомления",content:B.length?t.jsx(F,{listNotification:B}):void 0},{id:"allowances",title:"Надбавки",content:t.jsx(We,{filter:u,searchQuery:l})}]})]})})};export{Ke as N};
