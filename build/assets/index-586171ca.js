var h=Object.defineProperty,j=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var b=(l,e,t)=>e in l?h(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,N=(l,e)=>{for(var t in e||(e={}))g.call(e,t)&&b(l,t,e[t]);if(y)for(var t of y(e))S.call(e,t)&&b(l,t,e[t]);return l},x=(l,e)=>j(l,k(e));var _=(l,e,t)=>new Promise((o,d)=>{var r=s=>{try{i(t.next(s))}catch(u){d(u)}},n=s=>{try{i(t.throw(s))}catch(u){d(u)}},i=s=>s.done?o(s.value):Promise.resolve(s.value).then(r,n);i((t=t.apply(l,e)).next())});import{r as f,cN as F,j as p}from"./vendor-91dd51cf.js";import{b4 as A,b7 as w,s as C,b8 as D,B as O,F as B,I as H,S as W,j as q,c as E}from"./index-2caaee2c.js";const G=(l,e,t)=>_(void 0,null,function*(){t(!1);const o=e.map(n=>{if(Array.isArray(n.data[0])){const i=n.data.map(u=>Object.assign({},...u==null?void 0:u.map(a=>{var v,c;const m={};return a!=null&&a.fieldName&&(m[a==null?void 0:a.fieldName]=a!=null&&(v=a.value)!==null&&v!==void 0&&v.title?a==null||(c=a.value)===null||c===void 0?void 0:c.title:a==null?void 0:a.value),m}))),s={};return s[l]=JSON.stringify(i),s}else return n.data.map(i=>{var u,a;const s={};return i!=null&&i.fieldName&&(s[(u=i==null?void 0:i.fieldName)!=null?u:""]=typeof i.value!="object"?i==null?void 0:i.value:i.value.title),i.type==="multiselect"&&(s[(a=i==null?void 0:i.fieldName)!=null?a:""]=JSON.stringify(i==null?void 0:i.value.map(v=>v.title))),s})}).flat(),d=Object.assign({},...o);!(yield A.sendBufferHolidayWorkFx({employeeGuid:d.jobGuid,dates:[{date:d.holiday_work_date,dayOff:d.extra_holiday_date?d.extra_holiday_date:null,hours:+d.holiday_work_hours}]})).isError&&t(!0)}),I=l=>{const e=l.find(o=>o.fieldName==="compensation");let t=null;return e!=null&&e.value&&(e==null?void 0:e.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(t="Compensation"),{compensation:t}},R=(l,e,t)=>{const{surname:o,name:d,patronymic:r}=l;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:o+" "+d+" "+r,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:e[t].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:e[t].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:w(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:e[t].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},L=()=>{var m;var l;const[e,t]=f.useState(null),{data:{dataUserApplication:o,dataWorkerApplication:d}}=C.useApplications(),{loading:r}=D.useBufferHolidayWork(),[n,i]=f.useState(!1),[s,u]=f.useState({}),a=n!=null?n:!1,{id:v}=F(),c=+v;return f.useEffect(()=>{o&&d&&!r&&t(R(o,d,c))},[o,c,r]),f.useEffect(()=>{e&&o&&u(I(e.data))},[e]),p.jsx(O,{isDone:a,children:!!e&&!!t&&p.jsxs(B,{children:[p.jsx(H,x(N({},e),{collapsed:a,setData:t,specialFieldsNameConfig:s})),p.jsx(W,{text:"Отправить",action:()=>G(q.HOLIDAY_WORK,[e],i),isLoading:r,completed:n,setCompleted:i,repeatable:!1,buttonSuccessText:"Отправлено",isDone:a,isActive:E(e)&&((m=(l=e.optionalCheckbox)===null||l===void 0?void 0:l.value)!=null?m:!0),alerts:!1})]})})};export{L as default};
