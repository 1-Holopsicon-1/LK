import{r as c,bU as D,j as x}from"./vendor-4af360a6.js";import{ay as S,az as N,av as j,a2 as _,aA as h,ar as E,F as O,I as A,S as C,d as F,N as T}from"./index-3edf5efe.js";const I=async(i,a,s)=>{s(!1);const f=a.map(d=>{if(Array.isArray(d.data[0])){const e=d.data.map(o=>Object.assign({},...o==null?void 0:o.map(t=>{var p,r;const m={};return t!=null&&t.fieldName&&(m[t==null?void 0:t.fieldName]=(p=t==null?void 0:t.value)!=null&&p.title?(r=t==null?void 0:t.value)==null?void 0:r.title:t==null?void 0:t.value),m}))),n={};return n[i]=JSON.stringify(e),n}else return d.data.map(e=>{const n={};return e!=null&&e.fieldName&&(n[(e==null?void 0:e.fieldName)??""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(n[(e==null?void 0:e.fieldName)??""]=JSON.stringify(e==null?void 0:e.value.map(o=>o.title))),n})}).flat(),u=Object.assign({},...f),l=await S.sendBufferMedicalExaminationFx({employeeGuid:u.jobGuid,start:u.extra_examination_date,end:u.isRetirement?u.extra_examination_date_2:u.extra_examination_date});l!=null&&l.isError&&s(!0)},R=i=>{const a=i.find(s=>s.fieldName==="isRetirement");return a!=null&&a.value&&a!=null&&a.value?{reason:"Compensation2"}:{reason:null}},k=(i,a,s,f,u,l,d)=>{const{surname:e,name:n,patronymic:o}=i,t=f?new Date(f):new Date,m=new Date(t.getTime()+24*60*60*1e3);return N(a[s].jobGuid.toString())==="true"&&t.getDay()===5?m.setDate(t.getDate()+1):(t.getDay()===5||t.getDay()===6||t.getDay()===0)&&m.setDate(t.getDate()+(8-t.getDay())%7),{title:"Заявление о диспансеризации",data:[{title:"ФИО",value:e+" "+n+" "+o,fieldName:"fio",type:"simple-text",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[s].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[s].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата прохождения диспансеризации",type:"date",value:f,fieldName:"extra_examination_date",editable:!0,onChange:r=>{u(r)},mask:!0,required:!0,maxValueLength:1,minValueInput:j(0)},{title:"Я являюсь получателем пенсии по старости или пенсии за выслугу лет или мне осталось менее 5 лет до этого",type:"hr-checkbox",value:l||"",fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:r=>{d(r)}},{title:"Второй день отдыха",type:"date",value:m.toISOString().substr(0,10),fieldName:"extra_examination_date_2",editable:!1,mask:!0,required:!1,specialType:"Compensation2",maxValueLength:1},{title:"",type:"simple-text",value:a[s].jobGuid.toString(),fieldName:"jobGuid"}]}},w=()=>{var b;const[i,a]=c.useState(null),[s,f]=c.useState(null),[u]=c.useState(null),[l,d]=c.useState(null),{data:{dataUserApplication:e,dataWorkerApplication:n}}=_.useApplications(),{loading:o}=h.useBufferMedicalExamination(),[t,m]=c.useState({}),[p,r]=c.useState(!1),g=p??!1,{id:v}=D(),y=+v;return c.useEffect(()=>{e&&n&&!o&&a(k(e,n,y,s,f,l,d))},[e,y,o,s,u,l]),c.useEffect(()=>{i&&e&&m(R(i.data))},[i]),x.jsx(E,{isDone:g,children:!!i&&!!a&&x.jsxs(O,{children:[x.jsx(A,{...i,collapsed:g,setData:a,specialFieldsNameConfig:t}),x.jsx(C,{text:"Отправить",action:()=>I(F.HOLIDAY_WORK,[i],r),isLoading:o,completed:p,setCompleted:r,repeatable:!1,buttonSuccessText:"Отправлено",isDone:g,isActive:T(i)&&(((b=i.optionalCheckbox)==null?void 0:b.value)??!0),alerts:!1})]})})};export{w as default};
