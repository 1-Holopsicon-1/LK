var w=Object.defineProperty,N=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var x=(t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,k=(t,e)=>{for(var s in e||(e={}))S.call(e,s)&&x(t,s,e[s]);if(v)for(var s of v(e))_.call(e,s)&&x(t,s,e[s]);return t},E=(t,e)=>N(t,O(e));import{p as h,e as T,x as d,h as W,u as P,r as y,n as $,j as c}from"./vendor-31894644.js";import{b1 as j,b2 as D,aW as G,b3 as B,b4 as I,s as q,B as H,F as J,I as L,S as U,j as z,c as C,b5 as M}from"./index-0f8b6250.js";const R=h({name:"loadBufferPartTimeEmployment",sid:"rqpj9r"}),K=h({name:"sendBufferPartTimeEmployment",sid:"-1vo25s"}),F=T(async()=>{var e;const{data:t}=await j.get("InternalPartTime.GetAllHistory?PersonalGuid=".concat(D((e=G())!=null?e:"").IndividualGuid));return t.orders},{name:"loadBufferPartTimeEmploymentFx",sid:"lptsxp"});d({and:[{clock:R,target:F}],or:{sid:"-bwsfri"}});const p=T(async t=>(await j.post("Weekend.AddWeekend",t)).data,{name:"sendBufferPartTimeEmploymentFx",sid:"-26c53s"});d({and:[{clock:K,target:p}],or:{sid:"-bguek1"}});const A=W([],{name:"$bufferPartTimeEmploymentOrders",sid:"-rtc3mi"}),Y=p.pending;d({and:[{clock:F.doneData,target:A}],or:{sid:"-bdjmzv"}});d({and:[{clock:p.doneData,fn:t=>{const e=t;return e.isError?{message:e.error,type:"hrFailure",time:3e5}:{message:"Форма отправлена успешно",type:"success",time:0}},target:B.evokePopUpMessage}],or:{sid:"-azss5u"}});d({and:[{clock:p.fail,fn:()=>({message:"Не удалось отправить форму.",type:"hrFailure",time:3e5}),target:B.evokePopUpMessage}],or:{sid:"-a29byt"}});const Q={useBufferPartTimeEmployment:()=>({data:P(A),loading:P(Y)})},V=(t,e)=>{const{surname:s,name:m,patronymic:i}=t;return{title:"Заявление на трудоустройство по совместительству",data:[{title:"ФИО",value:s+" "+m+" "+i,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделениe, куда производится трудорустройство",type:"auto-complete-input",fieldName:"newPlaceOfWork",value:"",width:"100%",suggestions:e,required:!0,mask:!0,visible:!0,placeholder:"Начните вводить название подразделения"},{title:"Должность",value:null,fieldName:"post",mask:!0,editable:!0,required:!0},{title:"Ставка",type:"select",fieldName:"rate",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"0.5"},{id:2,title:"0.25"}]}]}},X=async(t,e,s)=>{s(!1);const m=e.map(u=>{if(Array.isArray(u.data[0])){const a=u.data.map(n=>Object.assign({},...n==null?void 0:n.map(r=>{var b,g;const l={};return r!=null&&r.fieldName&&(l[r==null?void 0:r.fieldName]=(b=r==null?void 0:r.value)!=null&&b.title?(g=r==null?void 0:r.value)==null?void 0:g.title:r==null?void 0:r.value),l}))),o={};return o[t]=JSON.stringify(a),o}else return u.data.map(a=>{var n,r;const o={};return a!=null&&a.fieldName&&(o[(n=a==null?void 0:a.fieldName)!=null?n:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"&&(o[(r=a==null?void 0:a.fieldName)!=null?r:""]=JSON.stringify(a==null?void 0:a.value.map(l=>l.title))),o})}).flat(),i=Object.assign({},...m);!(await I.sendBufferHolidayWorkFx({employeeGuid:i.jobGuid,dates:[{date:i.holiday_work_date,dayOff:i.extra_holiday_date?i.extra_holiday_date:null,hours:+i.holiday_work_hours}]})).isError&&s(!0)},ae=()=>{var o,n;const[t,e]=y.useState(null),{data:{dataUserApplication:s}}=q.useApplications(),{loading:m}=Q.useBufferPartTimeEmployment(),[i,f]=y.useState(!1),u=i!=null?i:!1,a=$(M);return y.useEffect(()=>{s&&!m&&e(V(s,a))},[s,m]),c.jsx(H,{isDone:u,children:!!t&&!!e&&c.jsxs(J,{children:[c.jsx(L,E(k({},t),{collapsed:u,setData:e})),c.jsx(U,{text:"Отправить",action:()=>X(z.HOLIDAY_WORK,[t],f),isLoading:m,completed:i,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:C(t)&&((n=(o=t.optionalCheckbox)==null?void 0:o.value)!=null?n:!0)})]})})};export{ae as default};
