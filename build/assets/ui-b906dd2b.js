import{p as a,e as i,x as t,h as c,v as oe,m as de,cP as ie,K as F,r as M,q as ce,cQ as re,cR as le,j as A}from"./vendor-9c916fad.js";import{a5 as me,a6 as ge,o as w,n as m,d as o,U as ue,a7 as pe,a8 as fe,a9 as ve,aa as ke,ab as $e,ac as xe,ad as Pe,Z as De,G as ye,p as Ae,q as Se,l as z,L as q}from"./index-40546281.js";const O=a({name:"addVisit",sid:"3ybve7"}),_=a({name:"removeVisit",sid:"w1vlkj"}),r=i(async e=>(await me(e),e),{name:"addVisitFx",sid:"-lbpib"}),g=i(async({id:e})=>(await ge(e),e),{name:"removeVisitFx",sid:"-wpy18p"}),Fe=g.pending,we=r.pending;t({and:[{clock:O,target:r}],or:{sid:"-tzueuh"}});t({and:[{clock:r.doneData,target:w.close}],or:{sid:"-txn8h1"}});t({and:[{clock:r.failData,fn:e=>({message:m(e,"Не удалось добавить посещение"),type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-tvg23l"}});t({and:[{clock:r.doneData,fn:()=>({message:"Посещение добавлено",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-tey8ar"}});t({and:[{clock:_,target:g}],or:{sid:"-sygehx"}});t({and:[{clock:g.doneData,fn:()=>({message:"Посещение удалено",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-skpjnw"}});t({and:[{clock:g.failData,fn:e=>({message:m(e,"Не удалось удалить посещение"),type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-sfrebn"}});const Ve={addVisit:O,removeVisit:_},$={addVisitFx:r,removeVisitFx:g},Re={pendingRemoveVisit:Fe,pendingAddVisit:we},G=a({name:"update",sid:"-tu363b"}),he=c("",{name:"$search",sid:"gw0gkq"}).on(G,(e,s)=>s),je={update:G},Ue={$search:he},B=a({name:"addFilter",sid:"3pahp2"}),V=a({name:"resetFilters",sid:"sk6sju"}),J=c({},{name:"$filters",sid:"im200n"}).on(Ue.$search,(e,s)=>({...e,fullName:{value:s}})).on(B,(e,{name:s,value:n,strict:l})=>{const d={...e};return n?{...d,[s]:{value:n,strict:l}}:(delete d[s],d)});t({and:[{clock:V,target:J.reinit}],or:{sid:"-drxh28"}});t({and:[{clock:V,fn:()=>"",target:je.update}],or:{sid:"-dpqaos"}});const R={$filters:J},Ge={addFilter:B,resetFilters:V},N=a({name:"setIsExam",sid:"shha4n"}),be=c(!1,{name:"$isExam",sid:"4al1my"}).on(N,(e,s)=>s),Be={$isExam:be},Je={setIsExam:N},h=a({name:"load",sid:"-ip5e0a"}),W=a({name:"setPage",sid:"266xmv"}),j=c(0,{name:"$pEStudentsPage",sid:"x1jwze"}).on(W,(e,s)=>s).on(R.$filters,()=>0),x=oe({and:{source:{page:j,filters:R.$filters},effect:async({filters:e,page:s})=>{const{data:n}=await ue(s,e);return n.data}},or:{name:"loadPageFx",sid:"-u9ar2s"}});de({sid:"-mlc78y",fn:()=>ie({source:F({and:[j,R.$filters],or:{name:"source",sid:"-ne89m1"}}),timeout:200,target:h}),name:"none",method:"debounce"});t({and:[{clock:h,target:x}],or:{sid:"-mil8a5"}});const S=c([],{name:"$pEStudents",sid:"-a7h5qn"}).on(x.doneData,(e,s)=>s.students),Ce=c(0,{name:"$pEStudentsTotalCount",sid:"-hptisk"}).on(x.doneData,(e,s)=>s.totalCount),Me=F({and:[x.pending,Boolean],or:{name:"$loading",sid:"-way26q"}});t({and:[{clock:$.addVisitFx.doneData,source:S,filter:(e,{studentGuid:s})=>e.some(n=>n.studentGuid===s),fn:(e,s)=>{const n=JSON.parse(JSON.stringify(e)),l=n.find(d=>d.studentGuid===s.studentGuid);return++l.visits,n},target:S}],or:{sid:"-m36zo1"}});const Ne={load:h,setPage:W},We={$loading:Me,$pEStudents:S,$pEStudentsPage:j,$pEStudentsTotalCount:Ce},K=a({name:"addAdditionPoints",sid:"-gfwajq"}),L=a({name:"removeAdditionPoints",sid:"s7fafn"}),u=i(async({id:e})=>{await pe(e)},{name:"removeAdditionPointsFx",sid:"-yz8fw7"});t({and:[{clock:L,target:u}],or:{sid:"-8u8zpu"}});const ze=u.pending,p=i(async e=>(await fe(e),e),{name:"addAdditionPointsFx",sid:"htakn7"});t({and:[{clock:K,target:p}],or:{sid:"-8dr5x0"}});t({and:[{clock:p.doneData,target:w.close}],or:{sid:"-8bjzjk"}});t({and:[{clock:p.doneData,fn:()=>({message:"Баллы добавлены",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-7xt4pj"}});t({and:[{clock:p.failData,fn:e=>({message:m(e,"Не удалось добавить баллы"),type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-7suzda"}});t({and:[{clock:u.doneData,fn:()=>({message:"Баллы удалены",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-7cd5kg"}});t({and:[{clock:u.failData,fn:()=>({message:"Не удалось удалить баллы",type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"-6vvbrm"}});const Ke={addAdditionPoints:K,removeAdditionPoints:L},E={addAdditionPointsFx:p,removeAdditionPointsFx:u},Le={pendingRemoveAdditionPoints:ze},Q=a({name:"addRegulationPoints",sid:"r944lm"}),Z=a({name:"removeRegulationPoints",sid:"2sncem"}),f=i(async({id:e})=>{await ve(e)},{name:"removeRegulationPointsFx",sid:"-krrp8n"});t({and:[{clock:Z,target:f}],or:{sid:"mz5r9q"}});const qe=f.pending,v=i(async e=>(await ke(e),e),{name:"addRegulationPointsFx",sid:"-dsdequ"});t({and:[{clock:Q,target:v}],or:{sid:"nfnl2k"}});t({and:[{clock:v.doneData,target:w.close}],or:{sid:"nhurg0"}});t({and:[{clock:v.doneData,fn:()=>({message:"Норматив добавлен",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"nvlma1"}});t({and:[{clock:v.failData,fn:e=>({message:m(e,"Не удалось добавить норматив"),type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"o0jrma"}});t({and:[{clock:f.doneData,fn:()=>({message:"Норматив удален",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"oh1lf4"}});t({and:[{clock:f.failData,fn:()=>({message:"Не удалось удалить норматив",type:"failure"}),target:o.evokePopUpMessage}],or:{sid:"oxjf7y"}});const Qe={addRegulationPoints:Q,removeRegulationPoints:Z},I={addRegulationPointsFx:v,removeRegulationPointsFx:f},Ze={pendingRemoveRegulationPoints:qe},H=a({name:"setCurrentStudentId",sid:"-zg7btr"}),X=a({name:"resetStudentId",sid:"a7gg5p"}),Y=a({name:"reload",sid:"ulism3"}),P=i(async e=>{const{data:s}=await $e(e);return s.data},{name:"loadCurrentStudent",sid:"-m2nl7c"});t({and:[{clock:H,target:P}],or:{sid:"-eaew06"}});const U=c(null,{name:"$selectedStudent",sid:"4jeuz1"}).reset(X),Ee=F({and:[$.addVisitFx.pending,P.pending,Boolean],or:{name:"$loading",sid:"3fk060"}});t({and:[{clock:[$.addVisitFx.doneData,$.removeVisitFx.doneData,E.addAdditionPointsFx.doneData,E.removeAdditionPointsFx.doneData,I.addRegulationPointsFx.doneData,I.removeRegulationPointsFx.doneData],target:Y}],or:{sid:"-dvkfzf"}});t({and:[{clock:Y,source:U,filter:e=>!!e,fn:e=>e.studentGuid,target:P}],or:{sid:"-dtd9lz"}});t({and:[{clock:P.doneData,target:U}],or:{sid:"-ddz0zv"}});const He={$selectedStudent:U,$loading:Ee},Xe={setCurrentStudentId:H,resetStudentId:X},T=a({name:"load",sid:"-1nsq63"}),ee=a({name:"remove",sid:"wecpac"}),te=i(async()=>{const{data:e}=await xe();return e.competitions},{name:"loadFx",sid:"-d34r01"}),D=i(async e=>(await Pe(e),e),{name:"removeFx",sid:"y5v9by"});t({and:[{clock:ee,target:D}],or:{sid:"q9j9ts"}});t({and:[{clock:D.failData,fn:e=>({message:m(e,"Не удалось удалить соревнование"),type:"failure",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"qna4nt"}});t({and:[{clock:D.doneData,fn:()=>({message:"Соревнование удалено",type:"success",time:3e3}),target:o.evokePopUpMessage}],or:{sid:"r3rygn"}});t({and:[{clock:T,target:te}],or:{sid:"r8q3sw"}});const Ie=c([],{name:"$competitions",sid:"dxwaax"}).on(te.doneData,(e,s)=>s).on(D.doneData,(e,s)=>e.filter(n=>n!==s)),Ye={load:T,remove:ee},Te={$competitions:Ie};var k=(e=>(e.AdminAccess="AdminAccess",e.DefaultAccess="DefaultAccess",e.OnlineCourseAccess="OnlineCourseAccess",e.SecretaryAccess="SecretaryAccess",e.SuperUser="SuperUser",e))(k||{});const et=({studentGuid:e})=>{const[s,n]=M.useState(new Date().toISOString()),[l,d]=ce([Re.pendingAddVisit,De.peTeacher]),y=new Date(s),se=[k.AdminAccess,k.SuperUser,k.SecretaryAccess].some(ne=>{var C;return(C=d==null?void 0:d.permissions)==null?void 0:C.includes(ne)}),b=(re(y,{start:le(new Date,1),end:new Date})||se)&&y.getDay()!==0&&y.getDay()!==1;M.useEffect(()=>{n(new Date().toISOString())},[e]);const ae=()=>{Ve.addVisit({studentGuid:e,date:z(s,"numeric")})};return A.jsxs(ye,{gap:"4px",ai:"flex-start",children:[A.jsx(Ae,{alertMessage:b?"":"Не допустимая дата",type:"date",setValue:n,value:s,hideCross:!0}),A.jsx(Se,{isActive:b&&!l,text:`Добавить посещение ${z(s,"numeric")}`,onClick:ae,width:"100%",background:q.blue.main,textColor:q.white.main})]})};export{et as A,k as P,R as a,Be as b,Ge as c,Je as d,Ye as e,Ne as f,We as g,Ue as h,je as i,Re as j,Ve as k,He as l,Le as m,Ke as n,Qe as o,Ze as p,Xe as q,Te as s};
