import{r as c,cM as b,j as y}from"./vendor-8312535b.js";import{b4 as v,b7 as N,s as x,b8 as j,B as h,F as _,I as g,S as k,j as S,c as A}from"./index-3ed27df5.js";const F=async(i,a,s)=>{s(!1);const u=a.map(m=>{if(Array.isArray(m.data[0])){const e=m.data.map(o=>Object.assign({},...o==null?void 0:o.map(t=>{var f,p;const r={};return t!=null&&t.fieldName&&(r[t==null?void 0:t.fieldName]=(f=t==null?void 0:t.value)!=null&&f.title?(p=t==null?void 0:t.value)==null?void 0:p.title:t==null?void 0:t.value),r}))),n={};return n[i]=JSON.stringify(e),n}else return m.data.map(e=>{var o,t;const n={};return e!=null&&e.fieldName&&(n[(o=e==null?void 0:e.fieldName)!=null?o:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(n[(t=e==null?void 0:e.fieldName)!=null?t:""]=JSON.stringify(e==null?void 0:e.value.map(r=>r.title))),n})}).flat(),l=Object.assign({},...u);!(await v.sendBufferHolidayWorkFx({employeeGuid:l.jobGuid,dates:[{date:l.holiday_work_date,dayOff:l.extra_holiday_date?l.extra_holiday_date:null,hours:+l.holiday_work_hours}]})).isError&&s(!0)},w=i=>{const a=i.find(u=>u.fieldName==="compensation");let s=null;return a!=null&&a.value&&(a==null?void 0:a.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(s="Compensation"),{compensation:s}},D=(i,a,s)=>{const{surname:u,name:l,patronymic:d}=i;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:u+" "+l+" "+d,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[s].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[s].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:N(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:a[s].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},C=()=>{var f,p;const[i,a]=c.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:u}}=x.useApplications(),{loading:l}=j.useBufferHolidayWork(),[d,m]=c.useState(!1),[e,n]=c.useState({}),o=d!=null?d:!1,{id:t}=b(),r=+t;return c.useEffect(()=>{s&&u&&!l&&a(D(s,u,r))},[s,r,l]),c.useEffect(()=>{i&&s&&n(w(i.data))},[i]),y.jsx(h,{isDone:o,children:!!i&&!!a&&y.jsxs(_,{children:[y.jsx(g,{...i,collapsed:o,setData:a,specialFieldsNameConfig:e}),y.jsx(k,{text:"Отправить",action:()=>F(S.HOLIDAY_WORK,[i],m),isLoading:l,completed:d,setCompleted:m,repeatable:!1,buttonSuccessText:"Отправлено",isDone:o,isActive:A(i)&&((p=(f=i.optionalCheckbox)==null?void 0:f.value)!=null?p:!0),alerts:!1})]})})};export{C as default};
