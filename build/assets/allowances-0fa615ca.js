import{j as t,a5 as p,q as x,r as c,cM as b,M as I}from"./vendor-48260ac4.js";import{aO as C,M as j,ax as a,G as u,x as g,r as w,aP as y,aq as M,b as P,P as f,V as F,q as S,ay as E,aQ as O,aR as R}from"./index-2b19a53a.js";import{F as k}from"./index-35fcd8b3.js";import{D as L}from"./dev-mode-message-f756a5e9.js";const A=()=>[{title:"Дата",field:"createdAt",priority:"one",sort:!0,type:"date",align:"center",width:"120px"},{title:"Тип",field:"paymentIdentifier",priority:"one",width:"150px",showFull:!0,render:s=>s||"-"},{title:"Источник финансирования",field:"sourceOfFunding",priority:"three",showFull:!0,width:"150px",render:s=>s||"-"},{title:"Статус",field:"allowanceStatus",priority:"one",width:"165px",showFull:!0,catalogs:[...Object.values(C).map((s,n)=>({id:n.toString(),title:s}))??[]],render:s=>t.jsx(j,{type:s==="Completed"?"success":s==="Cancelled"?"failure":"alert",title:s||"—",align:"center",icon:null})},{title:"Комментарий",field:"commentary",priority:"two",render:s=>s||"-"},{title:"Файлы",field:"files",priority:"two",width:"100px",align:"center",showFull:!0,render:s=>s.application.length+s.other.length||"-"}],h=()=>{const s=p(),[n,r]=x([a.allowances,a.jobRoles]),[i,d]=c.useState(()=>{const e=r&&r.find(l=>l.roles.includes("Initiator"));return e?{id:e.employeeId,title:e.division}:null}),o=c.useMemo(()=>r?r.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[r]);return r?t.jsxs(u,{gap:"16px",d:"column",children:[o.length>1&&t.jsx(u,{d:"column",jc:"flex-start",ai:"flex-start",children:t.jsx(g,{items:r.filter(e=>e.roles.includes("Initiator")).map(e=>({id:e.employeeId,title:e.division})),selected:i,setSelected:d})}),t.jsx(w,{loading:!n,columns:A(),data:i&&n?n[i.id].initiatorAllowances:null,maxOnPage:7,onRowClick:e=>{s.push(y+`/${i==null?void 0:i.id}/initiator/${e.id}`)}})]}):null},m=()=>{const s=p(),[n,r]=x([a.allowances,a.jobRoles]),[i,d]=c.useState(()=>{const e=r&&r.find(l=>l.roles.includes("Approver"));return e?{id:e.employeeId,title:e.division}:null}),o=c.useMemo(()=>r?r.filter(e=>e.roles.includes("Approver")).map(e=>({id:e.employeeId,title:e.division})):[],[r]);return r?t.jsxs(u,{gap:"16px",d:"column",children:[o.length>1&&t.jsx(u,{d:"column",jc:"flex-start",ai:"flex-start",children:t.jsx(g,{items:o,selected:i,setSelected:d})}),t.jsx(w,{loading:!n,columns:A(),data:i&&n?n[i.id].approverAllowances:null,maxOnPage:7,onRowClick:e=>{s.push(y+`/${i==null?void 0:i.id}/approver/${e.id}`)}})]}):null},W=()=>{const s=p(),{role:n}=b(),r=v=>{s.push(O+`/${v}`)},[i,d,o]=x([M.pageMounted,a.rolesPending,a.roles,P.user]),e=()=>{s.push(R)},l=o.includes("Initiator")||o.includes("Approver");return c.useEffect(()=>{l&&i()},[l]),d?t.jsx(f,{children:t.jsx(u,{w:"100%",jc:"center",ai:"center",children:t.jsx(F,{})})}):l?t.jsxs(f,{topRightCornerElement:o.includes("Initiator")&&t.jsx(S,{onClick:e,text:"Подать заявку",background:"var(--reallyBlue)",textColor:"#fff",icon:t.jsx(I,{}),minWidth:"35px",height:"36px",shrinkTextInMobile:!0}),children:[t.jsx(j,{type:"info",children:t.jsxs("p",{children:["Инструкция для инициаторов доступна"," ",t.jsx("a",{href:"https://e.mospolytech.ru/old/storage/files/Ustanovlenie_nadbavok_(dlya_initsiatorov).pdf",target:"_blank",rel:"noreferrer",children:"по ссылке"}),"."]})}),t.jsx(L,{}),o.length>1?t.jsx(E,{pages:[{id:"approver",title:"Согласование надбавок",content:t.jsx(m,{})},{id:"initiator",title:"Установление надбавок",content:t.jsx(h,{})}],currentPage:n==="initiator"?1:0,onChangePage:r,appearance:!1}):o[0]==="Initiator"?t.jsx(h,{}):t.jsx(m,{})]}):t.jsx(k,{text:"У вас нет доступа к этому разделу"})};export{W as default};
