import{r as f,bX as v,j as c}from"./vendor-2324f29b.js";import{av as b,az as N,a6 as x,aB as h,aw as j,F as _,I as g,S as k,d as S,U as w}from"./index-386db3e9.js";const A=async(i,a,s)=>{s(!1);const o=a.map(n=>{if(Array.isArray(n.data[0])){const e=n.data.map(u=>Object.assign({},...u==null?void 0:u.map(t=>{var p,y;const m={};return t!=null&&t.fieldName&&(m[t==null?void 0:t.fieldName]=(p=t==null?void 0:t.value)!=null&&p.title?(y=t==null?void 0:t.value)==null?void 0:y.title:t==null?void 0:t.value),m}))),d={};return d[i]=JSON.stringify(e),d}else return n.data.map(e=>{const d={};return e!=null&&e.fieldName&&(d[(e==null?void 0:e.fieldName)??""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(d[(e==null?void 0:e.fieldName)??""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))),d})}).flat(),l=Object.assign({},...o);!(await b.sendBufferHolidayWorkFx({employeeGuid:l.jobGuid,dates:[{date:l.holiday_work_date,dayOff:l.extra_holiday_date?l.extra_holiday_date:null,hours:+l.holiday_work_hours}]})).isError&&s(!0)},F=i=>{const a=i.find(o=>o.fieldName==="compensation");let s=null;return a!=null&&a.value&&(a==null?void 0:a.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(s="Compensation"),{compensation:s}},D=(i,a,s)=>{const{surname:o,name:l,patronymic:r}=i;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:o+" "+l+" "+r,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[s].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[s].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:N(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:a[s].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},C=()=>{var p;const[i,a]=f.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:o}}=x.useApplications(),{loading:l}=h.useBufferHolidayWork(),[r,n]=f.useState(!1),[e,d]=f.useState({}),u=r??!1,{id:t}=v(),m=+t;return f.useEffect(()=>{s&&o&&!l&&a(D(s,o,m))},[s,m,l]),f.useEffect(()=>{i&&s&&d(F(i.data))},[i]),c.jsx(j,{isDone:u,children:!!i&&!!a&&c.jsxs(_,{children:[c.jsx(g,{...i,collapsed:u,setData:a,specialFieldsNameConfig:e}),c.jsx(k,{text:"Отправить",action:()=>A(S.HOLIDAY_WORK,[i],n),isLoading:l,completed:r,setCompleted:n,repeatable:!1,buttonSuccessText:"Отправлено",isDone:u,isActive:w(i)&&(((p=i.optionalCheckbox)==null?void 0:p.value)??!0),alerts:!1})]})})};export{C as default};
