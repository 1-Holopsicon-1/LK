var h=Object.defineProperty,S=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var j=(s,a,t)=>a in s?h(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,N=(s,a)=>{for(var t in a||(a={}))D.call(a,t)&&j(s,t,a[t]);if(v)for(var t of v(a))A.call(a,t)&&j(s,t,a[t]);return s},_=(s,a)=>S(s,g(a));var x=(s,a,t)=>new Promise((u,l)=>{var n=o=>{try{e(t.next(o))}catch(r){l(r)}},d=o=>{try{e(t.throw(o))}catch(r){l(r)}},e=o=>o.done?u(o.value):Promise.resolve(o.value).then(n,d);e((t=t.apply(s,a)).next())});import{r as c,cM as I,j as m}from"./vendor-d78621d5.js";import{be as F,b7 as p,s as k,bf as w,B,F as T,I as q,S as H,j as E,c as G}from"./index-9478e959.js";const O=(s,a,t)=>x(void 0,null,function*(){t(!1);const u=a.map(d=>{if(Array.isArray(d.data[0])){const e=d.data.map(r=>Object.assign({},...r==null?void 0:r.map(i=>{var y,b;const f={};return i!=null&&i.fieldName&&(f[i==null?void 0:i.fieldName]=(y=i==null?void 0:i.value)!=null&&y.title?(b=i==null?void 0:i.value)==null?void 0:b.title:i==null?void 0:i.value),f}))),o={};return o[s]=JSON.stringify(e),o}else return d.data.map(e=>{var r,i;const o={};return e!=null&&e.fieldName&&(o[(r=e==null?void 0:e.fieldName)!=null?r:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(o[(i=e==null?void 0:e.fieldName)!=null?i:""]=JSON.stringify(e==null?void 0:e.value.map(f=>f.title))),o})}).flat(),l=Object.assign({},...u);!(yield F.sendBufferHolidayTransferFx({employeeGuid:l.jobGuid,reason:l.reason,period:{from:{startDate:l.holiday_old_start,endDate:l.holiday_old_end},to:{startDate:l.holiday_new_start,endDate:l.holiday_new_end}}})).isError&&t(!0)}),V=(s,a,t)=>{const{surname:u,name:l,patronymic:n}=s;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:u+" "+l+" "+n,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[t].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[t].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"",type:"simple-text",value:a[t].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},M=()=>{var i,f;const[s,a]=c.useState(null),{data:{dataUserApplication:t,dataWorkerApplication:u}}=k.useApplications(),{loading:l}=w.useBufferHolidayTransfer(),[n,d]=c.useState(!1),e=n!=null?n:!1,{id:o}=I(),r=+o;return c.useEffect(()=>{t&&u&&!l&&a(V(t,u,r))},[t,r,l]),m.jsx(B,{isDone:e,children:!!s&&!!a&&m.jsxs(T,{children:[m.jsx(q,_(N({},s),{collapsed:e,setData:a})),m.jsx(H,{text:"Отправить",action:()=>O(E.DISMISSAL,[s],d),isLoading:l,completed:n,setCompleted:d,repeatable:!1,buttonSuccessText:"Отправлено",isDone:e,isActive:G(s)&&((f=(i=s.optionalCheckbox)==null?void 0:i.value)!=null?f:!0),alerts:!1})]})})};export{M as default};
