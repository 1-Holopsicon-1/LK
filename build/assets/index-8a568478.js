import{r as c,j as D}from"./vendor-8312535b.js";import{b9 as N,ba as h,b7 as _,s as k,bb as E,P as A,B as C,F as T,I as B,S as F,c as I}from"./index-3ed27df5.js";import{g as O,a as w}from"./get-default-subdivision-17957fb0.js";const G=async(a,i,s)=>{s(!1);const y=i.map(m=>{if(Array.isArray(m.data[0])){const e=m.data.map(o=>Object.assign({},...o==null?void 0:o.map(t=>{var x,d;const u={};return t!=null&&t.fieldName&&(u[t==null?void 0:t.fieldName]=(x=t==null?void 0:t.value)!=null&&x.title?(d=t==null?void 0:t.value)==null?void 0:d.title:t==null?void 0:t.value),u}))),n={};return n[a]=JSON.stringify(e),n}else return m.data.map(e=>{var o,t;const n={};return e!=null&&e.fieldName&&(n[(o=e==null?void 0:e.fieldName)!=null?o:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(n[(t=e==null?void 0:e.fieldName)!=null?t:""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))),n})}).flat(),l=Object.assign({},...y),p=await N.sendBufferMedicalExaminationFx({employeeGuid:l.jobGuid,start:l.extra_examination_date,end:l.isRetirement?l.extra_examination_date_2:l.extra_examination_date});!(p!=null&&p.isError)&&s(!0)},R=a=>{const i=a.find(s=>s.fieldName==="isRetirement");return i!=null&&i.value&&i!=null&&i.value?{reason:"Compensation2"}:{reason:null}},q=(a,i,s,y,l,p,m,e,n,o)=>{const{surname:t,name:u,patronymic:x,subdivisions:d}=a,r=s?new Date(s):new Date,S=n||"",b=m||O(d),g=new Date(r.getTime()+24*60*60*1e3);return h(S)==="true"&&r.getDay()===5?g.setDate(r.getDate()+1):(r.getDay()===5||r.getDay()===6||r.getDay()===0)&&g.setDate(r.getDate()+(8-r.getDay())%7),{title:"Заявление о диспансеризации",data:[{title:"ФИО",value:t+" "+u+" "+x,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделение/должность",value:b,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:w(d),isSpecificSelect:!0,onChange:f=>{e(f),o(f.id)}},{title:"Дата прохождения диспансеризации",type:"date",value:s,fieldName:"extra_examination_date",editable:!0,onChange:f=>{y(f)},mask:!0,required:!0,maxValueLength:1,minValueInput:_(0)},{title:"Я являюсь получателем пенсии по старости или пенсии за выслугу лет или мне осталось менее 5 лет до этого",type:"hr-checkbox",value:l||"",fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:f=>{p(f)}},{title:"Второй день отдыха",type:"date",value:g.toISOString().substr(0,10),fieldName:"extra_examination_date_2",editable:!1,mask:!0,required:!1,specialType:"Compensation2",maxValueLength:1},{title:"",type:"simple-text",value:S,fieldName:"jobGuid",visible:!1}]}},L=()=>{var f,j;const[a,i]=c.useState(null),[s,y]=c.useState(null),[l]=c.useState(null),[p,m]=c.useState(null),[e,n]=c.useState(null),[o,t]=c.useState(null),{data:{dataUserApplication:u,dataWorkerApplication:x}}=k.useApplications(),{loading:d}=E.useBufferMedicalExamination(),[r,S]=c.useState({}),[b,g]=c.useState(!1),v=b!=null?b:!1;return c.useEffect(()=>{u&&x&&!d&&i(q(u,x,s,y,o,t,e,n,p,m))},[u,d,s,l,o]),c.useEffect(()=>{a&&u&&S(R(a.data))},[a]),D.jsx(A,{children:D.jsx(C,{isDone:v,children:!!a&&!!i&&D.jsxs(T,{children:[D.jsx(B,{...a,collapsed:v,setData:i,specialFieldsNameConfig:r}),D.jsx(F,{text:"Отправить",action:()=>G("",[a],g),isLoading:d,completed:b,setCompleted:g,repeatable:!1,buttonSuccessText:"Отправлено",isDone:v,isActive:I(a)&&((j=(f=a.optionalCheckbox)==null?void 0:f.value)!=null?j:!0),alerts:!1})]})})})};export{L as default};
