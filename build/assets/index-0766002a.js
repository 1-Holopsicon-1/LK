import{s as p,m as D,bY as T,j as e,Z as A,r as x,bS as y}from"./vendor-35c3991b.js";import{o as v,p as H,q as W,r as S,A as X,t as _,u as q,s as B,e as Y,v as L,w as Z,h as G,x as k}from"./ui-0db464c6.js";import{x as O,t as g,Z as j,v as $,r as P,_ as K,O as f,l as z,w as R,M as Q,T as U,E as tt,a0 as et,X as st,P as it,Y as nt,G as lt}from"./index-46a096a9.js";import{U as ot,C as dt}from"./styled-eb00b56a.js";var u=(t=>(t.Activist="ACTIVIST",t.Competition="COMPETITION",t.ExternalFitness="EXTERNAL_FITNESS",t.GTO="GTO",t.InternalTeam="INTERNAL_TEAM",t.OnlineWork="ONLINE_WORK",t.Science="SCIENCE",t))(u||{});const rt=p(O)`
    flex: 1;
`,at=p.div`
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 10px;
`,ut=D(j.peTeacher,W.pendingRemoveVisit,(t,o)=>{var l;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},...(l=t==null?void 0:t.permissions)!=null&&l.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const i=d,s=T(new Date(i.date),new Date)<-7,c=[v.AdminAccess,v.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return i.teacherGuid===(t==null?void 0:t.id)&&!s||c?e.jsx(g,{width:"100%",text:"Удалить",isActive:!o,onClick:()=>{H.removeVisit({id:i.id.toString()})}}):null}}]:[]]}),ct=()=>{var n;const[t,o,l]=A([S.$selectedStudent,ut,j.peTeacher]);return t?e.jsxs(at,{children:[!!((n=l==null?void 0:l.permissions)!=null&&n.length)&&e.jsx(X,{studentGuid:t.studentGuid}),e.jsx(rt,{columns:o,data:t.visitsHistory})]}):null},w=[{id:u.Activist,title:"Активист"},{id:u.ExternalFitness,title:"Внешний фитнес"},{id:u.Competition,title:"Соревнование"},{id:u.GTO,title:"ГТО"},{id:u.InternalTeam,title:"Сборная"},{id:u.OnlineWork,title:"Работа в LMS"},{id:u.Science,title:"Научная работа"}],mt=D(j.peTeacher,q.pendingRemoveAdditionPoints,(t,o)=>{var l;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Тип работ",field:"workType",render:(n,d)=>{const i=w.find(({id:s})=>s===n);return(i==null?void 0:i.id)===u.Competition?d.comment:i==null?void 0:i.title}},{title:"Количество баллов",field:"points"},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},{title:"Комментарий",field:"comment",priority:"five",render:(n,d)=>{const i=w.find(({id:s})=>s===d.workType);return(i==null?void 0:i.id)!==u.Competition?d.comment:null}},...(l=t==null?void 0:t.permissions)!=null&&l.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const i=d,s=T(new Date(i.date),new Date)<-7,c=[v.AdminAccess,v.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return i.teacherGuid===(t==null?void 0:t.id)&&!s||c?e.jsx(g,{width:"100%",text:"Удалить",isActive:!o,onClick:()=>_.removeAdditionPoints({id:i.id.toString()})}):null}}]:[]]}),xt=p.div`
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 10px;
`,pt=()=>{const[t,o]=A([S.$selectedStudent,B.$competitions]),[l,n]=x.useState(null),[d,i]=x.useState(new Date().toISOString()),[s,c]=x.useState(null),[r,a]=x.useState("0"),[C,b]=x.useState(""),F=()=>{_.addAdditionPoints({comment:(s==null?void 0:s.id)===u.Competition?(l==null?void 0:l.title)??"":C,date:z(d,"numeric"),pointsAmount:Number(r),studentGuid:t==null?void 0:t.studentGuid,workType:s==null?void 0:s.id})};x.useEffect(()=>{Y.load()},[]),x.useEffect(()=>{(s==null?void 0:s.id)===u.Competition&&r==="0"&&a("5"),(s==null?void 0:s.id)===u.InternalTeam&&r==="0"&&a("50")},[s==null?void 0:s.id]);const h=new Date(d),I=h.getDay()!==0&&h.getDay()!==1,J=o.map(N=>({id:N,title:N}));return e.jsxs(xt,{children:[e.jsx($,{width:"100%",size:"big",title:"Тип работ",items:w,selected:s,setSelected:c}),(s==null?void 0:s.id)===u.Competition&&e.jsx($,{width:"100%",size:"big",title:"Соревнование",items:J,selected:l,setSelected:n}),e.jsx(P,{alertMessage:I?"":"Не допустимая дата",size:"big",title:"Дата",setValue:i,value:d,type:"date"}),e.jsx(P,{width:"100%",size:"big",title:"Количество баллов",setValue:a,value:r,type:"number",stepSize:1,minValue:1}),(s==null?void 0:s.id)!==u.Competition&&e.jsx(K,{width:"100%",setValue:b,value:C,title:"Комментарий"}),e.jsx(g,{isActive:I,text:"Добавить",onClick:F,background:f.blue.main,textColor:f.white.main,width:"100%"})]})},ft=p.div`
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: 10px;
`,St=p(O)`
    flex: 1;
`,gt=()=>{var i;const[t,o,l]=A([S.$selectedStudent,mt,j.peTeacher]),{open:n}=R(),d=()=>{n(e.jsx(pt,{}),"Дополнительные баллы")};return t?e.jsxs(ft,{children:[!!((i=l==null?void 0:l.permissions)!=null&&i.length)&&e.jsx(g,{text:"Добавить дополнительные баллы",onClick:d,background:f.blue.main,textColor:f.white.main}),e.jsx(St,{columns:o,data:t.pointsHistory})]}):null};var m=(t=>(t.FlexionAndExtensionOfArms="FLEXION_AND_EXTENSION_OF_ARMS",t.JumpingRopeJumps="JUMPING_ROPE_JUMPS",t.Jumps="JUMPS",t.PullUps="PULL_UPS",t.ShuttleRun="SHUTTLE_RUN",t.Squats="SQUATS",t.Tilts="TILTS",t.TorsoLifts="TORSO_LIFTS",t.Other="OTHER",t))(m||{});const M=[{id:m.FlexionAndExtensionOfArms,title:"Сгибание и разгибание рук"},{id:m.JumpingRopeJumps,title:"Прыжки со скакалкой"},{id:m.Jumps,title:"Прыжок в длину"},{id:m.PullUps,title:"Подтягивания(Вис)"},{id:m.ShuttleRun,title:"Челночный бег"},{id:m.Squats,title:"Приседания"},{id:m.Tilts,title:"Наклон"},{id:m.TorsoLifts,title:"Подъемы туловища"},{id:m.Other,title:"Другое"}],jt=p.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    height: 100%;
`,vt=()=>{const t=A(S.$selectedStudent),[o,l]=x.useState(new Date().toISOString()),[n,d]=x.useState(null),[i,s]=x.useState("0"),[c,r]=x.useState(""),a=()=>{L.addRegulationPoints({date:z(o,"numeric"),pointsAmount:Number(i),studentGuid:t==null?void 0:t.studentGuid,standardType:n==null?void 0:n.id,isOverride:!1,comment:(n==null?void 0:n.id)===m.Other?c??"":""})},C=new Date(o),b=C.getDay()!==0&&C.getDay()!==1;return e.jsxs(jt,{children:[e.jsx($,{width:"100%",size:"big",title:"Тип работ",items:M,selected:n,setSelected:d}),(n==null?void 0:n.id)===m.Other&&e.jsx(P,{width:"100%",size:"big",title:"Комментарий",setValue:r,value:c}),e.jsx(P,{alertMessage:b?"":"Не допустимая дата",size:"big",title:"Дата",setValue:l,value:o,type:"date",width:"100%"}),e.jsx(P,{width:"100%",size:"big",title:"Количество баллов",setValue:s,value:i,type:"number",stepSize:1,minValue:1}),e.jsx(g,{text:"Добавить",isActive:b,onClick:a,background:f.blue.main,textColor:f.white.main,width:"100%"})]})},At=p(O)`
    flex: 1;
`,Ct=p.div`
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 10px;
`,Pt=D(j.peTeacher,Z.pendingRemoveRegulationPoints,(t,o)=>{var l;return[{title:"Дата",field:"date",type:"date",sort:!0},{title:"Норматив",field:"standardType",render:(n,d)=>{var i;return n===m.Other?d.comment:(i=M.find(({id:s})=>s===n))==null?void 0:i.title}},{title:"Количество баллов",field:"points"},{title:"Преподаватель",field:"teacher",render:n=>n.fullName},{title:"Комментарий",field:"comment",priority:"five"},...(l=t==null?void 0:t.permissions)!=null&&l.length?[{title:"Действия",field:"actions",onClick:()=>null,render:(n,d)=>{const i=d,s=T(new Date(i.date),new Date)<-30,c=[v.AdminAccess,v.SuperUser].some(r=>{var a;return(a=t==null?void 0:t.permissions)==null?void 0:a.includes(r)});return i.teacherGuid===(t==null?void 0:t.id)&&!s||c?e.jsx(g,{width:"100%",text:"Удалить",isActive:!o,onClick:()=>L.removeRegulationPoints({id:i.id.toString()})}):null}}]:[]]}),bt=()=>{var c;const[t,o,l]=A([S.$selectedStudent,Pt,j.peTeacher]),{open:n}=R(),d=!!t&&G(t),i=()=>{n(e.jsx(vt,{}),"Добавить норматив")},s=Number(d)<20;return t?e.jsxs(Ct,{children:[!t&&s&&e.jsx(Q,{type:"alert",children:"Чтобы добавить норматив, у студента должно быть хотя бы 20 баллов"}),!!((c=l==null?void 0:l.permissions)!=null&&c.length)&&e.jsx(g,{text:"Добавить норматив",onClick:i,background:f.blue.main,textColor:f.white.main,isActive:!s}),e.jsx(At,{data:t.standardsHistory,columns:o})]}):null},V=[{title:"Посещения",content:e.jsx(ct,{})},{title:"Нормативы ",content:e.jsx(bt,{})},{title:"Дополнительные баллы ",content:e.jsx(gt,{})}],E=({label:t,value:o})=>e.jsxs(Et,{children:[e.jsx(U,{size:3,children:t}),e.jsx($t,{children:o})]}),Et=p.div`
    display: flex;
    flex-direction: column;
    align-items: center;
    row-gap: 4px;
    border-radius: 4px;
    padding: 12px;
    background-color: var(--theme-2);

    flex: 1;
`,$t=p.span``,ht=()=>{const{studentId:t}=y(),[o,{currentUser:l},n,d]=A([S.$selectedStudent,lt,j.isLoading,S.$loading]),i=(l==null?void 0:l.user_status)==="staff"?t:(l==null?void 0:l.guid)??"",[s,c]=x.useState(0);return x.useEffect(()=>(k.setCurrentStudentId(i),tt.load(),()=>k.resetStudentId()),[i]),!o&&i&&!n&&!d?e.jsx(et,{text:"Нет данных"}):o?e.jsx(st,{padding:"10px",children:e.jsxs(it,{children:[e.jsx(U,{size:3,align:"left",children:o.fullName}),e.jsxs(ot,{children:[e.jsx(E,{label:"Группа",value:o.groupNumber}),e.jsx(E,{label:"Баллы",value:G(o).toString()}),e.jsx(E,{label:"Курс",value:o.course.toString()}),e.jsx(E,{label:"ЛМС",value:o.pointsHistory.filter(r=>r.workType===u.OnlineWork).reduce((r,a)=>r+a.points,0).toString()})]}),e.jsx(nt,{appearance:!1,pages:V,currentPage:s,setCurrentPage:c}),e.jsx(dt,{children:V[s].content})]})}):null};export{ht as default};
