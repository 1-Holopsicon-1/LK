import{j as e,L as W,bs as N,ce as G,s as v,aa as $,a6 as F,bw as q,r as j,a5 as z,cI as A,cU as B,co as J,cp as K,aW as Q}from"./vendor-08ab745b.js";import{ai as O,t as X,v as Y,w as Z,ch as ee,L as se,X as H,G as w,bT as _,q as D,H as te,ci as k,bx as ae,cj as ne,ck as re,cl as ie,u as oe,cm as V,cn as p,bV as y,co as T,cp as U,d as ce,cq as le,E as ue,aJ as de,W as he,P as pe,a0 as xe,cr as fe,cs as Se,ct as ge}from"./index-0892b83f.js";import{E as me}from"./index-2b4ce2cf.js";const Ee=({value:s,setValue:c,onHintClick:o,onValueEmpty:l})=>{const t=/\d/.test(s),{data:{user:a}}=O.useUser(),u=async n=>t?await Z(n):await ee(n,"",1,20);return e.jsx(X,{value:s,width:"100%",setValue:c,onHintClick:o(t),placeholder:"Поиск",customMask:t?Y.groupMask:void 0,transformRequest:t?void 0:n=>n.fio,request:u,leftIcon:s.length===0?e.jsx(W,{}):t?e.jsx(N,{}):e.jsx(G,{}),onValueEmpty:a?.user_status==="staff"?l:void 0})},je=v($).withConfig({componentId:"sc-17n125n-0"})(["color:var(--text);padding:15px 15px;max-width:140px;width:100%;opacity:",";border-radius:10px;background:",";color:",";&:hover{filter:brightness(0.97);}"],({disabled:s})=>s?.5:1,({isCurrent:s})=>s?se.blue.transparent3:"transparent",({isCurrent:s})=>s?"var(--blue)":"var(--grey)"),we=v.div.withConfig({componentId:"sc-17n125n-1"})(["display:flex;align-items:center;justify-content:center;svg{width:20px;min-width:20px;height:20px;}"]),Ce=v.div.withConfig({componentId:"sc-17n125n-2"})(["font-weight:",";font-size:0.9rem;"],({isCurrent:s})=>s?500:400),Me=({route:s,collapsed:c=!1,disabled:o=!1,isCurrent:l=!1})=>{if(!s)return e.jsx(H,{children:"Ссылка не определена"});const{path:t,title:a,icon:u,color:n,shortTitle:r}=s,h=S=>{if(o)return S.preventDefault()};return e.jsx(je,{collapsed:c,disabled:o,isCurrent:l,to:t,title:r??a,color:n,onClick:h,children:e.jsxs(w,{gap:"8px",children:[e.jsx(we,{children:u}),!c&&e.jsx(Ce,{isCurrent:l,children:r??a})]})})},P=({handleReturnToMySchedule:s,baseSearchValue:c,handleValue:o,onHintClick:l,isSideMenuOpen:t})=>{const{data:{searchValue:a,filter:u}}=_.useSchedule(),n=F(),{data:{user:r}}=O.useUser(),h=r?.user_status==="staff";return e.jsxs(e.Fragment,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(H,{children:"Группа или преподаватель"}),e.jsx(Ee,{value:a,setValue:o,onHintClick:l})]}),c!==a&&e.jsx(D,{text:t&&"Мое расписание",onClick:s,icon:e.jsx(q,{}),background:"var(--block)",textColor:"var(--blue)"}),e.jsx(te,{margin:"16px 0",width:"100%"}),e.jsx(w,{d:"column",gap:"2px",ai:"flex-start",children:Object.keys(k??{}).map(S=>{const d=k[S],{id:i,path:g}=d,x=u?`${g}/${u}`:g;return i==="schedule-session"&&h?null:e.jsx(Me,{collapsed:!t,isCurrent:n.pathname===x,route:{...d,path:x}},i)})})]})},ke=()=>{const{data:{user:s}}=O.useUser(),{data:{filter:c,view:o,errorInData:l}}=_.useSchedule(),{isTablet:t,isMobile:a}=ae(),[u,n]=j.useState(!0),r=F(),h=z(),S=r.pathname!==ne,d=r.pathname.split("/"),i=d.length===4?d[d.length-1]:null,g=i?/\d/.test(i):!1,x=s?.user_status==="staff"?s?.fullName??"":s?.group??"",C=r.pathname.includes(re),b=r.pathname.includes(ie),E=C||b,{open:I}=oe(),m=()=>{c&&h.push(T(U,{page:r.pathname.split("/")[2]})),p.setSearchValue(x),p.setFilter(""),p.resetExternalSchedule()};j.useLayoutEffect(()=>{o===V.month&&!E&&p.changeView(V.day)},[o,E]),j.useEffect(()=>{n(!(a||t))},[t,a]),j.useEffect(()=>{i?(p.setFilter(i),p.setSearchValue(i),g?y.getGroupScheduleFx({group:i}):y.getTeacherScheduleFx({fullName:i})):m()},[i]),j.useEffect(()=>()=>{p.resetExternalSchedule()},[]);const R=()=>{y.getScheduleFx(s)},M=()=>f=>{f?.id===s?.group&&m(),f?.id&&(r.pathname.split("/")[2]==="retake"?h.push(T(U,{page:"current",filter:f.value})):h.push(T(U,{page:r.pathname.split("/")[2],filter:f.value})))},L=f=>{p.setSearchValue(f)};return{isSideMenuOpen:u,shouldShowSlider:S,isMobile:a,isSessionPage:C,baseSearchValue:x,showMonth:E,handleErrorClick:()=>{ce.evokePopUpMessage({message:l,type:"failure",time:le.ten_seconds})},handleValue:L,onHintClick:M,handleReturnToMySchedule:m,handleLoad:R,handleOpenSideMenu:()=>{a?I(e.jsx(w,{d:"column",gap:"8px",ai:"flex-start",children:e.jsx(P,{isSideMenuOpen:!0,baseSearchValue:x,handleReturnToMySchedule:m,onHintClick:M,handleValue:L})})):n(f=>!f)}}},ve=v.div.withConfig({componentId:"sc-sh5ff8-0"})(["min-width:",";width:",";padding-right:10px;height:calc(100vh - var(--header-height) - 112px);display:flex;z-index:10;gap:8px;flex-direction:column;align-items:",";","{display:none;}"],({isSideMenuOpen:s})=>s?"210px":"60px",({isSideMenuOpen:s})=>s?"210px":"60px",({isSideMenuOpen:s})=>s?"flex-start":"center",ue.isMobile),be=s=>e.jsx(ve,{isSideMenuOpen:s.isSideMenuOpen,children:e.jsx(P,{...s})}),Oe=()=>{const{data:{view:s,schedule:c,externalSchedule:o,errorInData:l},loading:t,error:a}=_.useSchedule(),{allRoutes:u}=de.useMenu(),{isSideMenuOpen:n,shouldShowSlider:r,showMonth:h,baseSearchValue:S,isMobile:d,onHintClick:i,handleValue:g,handleReturnToMySchedule:x,handleLoad:C,handleOpenSideMenu:b,handleErrorClick:E}=ke();return e.jsx(he,{loading:t,load:C,error:a,data:t?o:c,children:e.jsx(pe,{topCenterElement:r&&e.jsx(xe,{size:"small",sliderWidth:"240px",pages:h?fe:Se,currentPage:s,appearance:!d,setCurrentPage:p.changeView}),topRightCornerElement:e.jsxs(w,{w:"fit-content",gap:"20px",children:[e.jsx(me,{visible:!!l,onClick:E}),e.jsx(D,{icon:d?e.jsx(A,{}):e.jsx(B,{}),width:"36px",height:"36px",onClick:b})]}),children:u&&e.jsxs(w,{gap:"16px",ai:"flex-start",children:[!d&&e.jsx(be,{isSideMenuOpen:n,baseSearchValue:S,handleReturnToMySchedule:x,onHintClick:i,handleValue:g}),e.jsxs(J,{children:[Object.keys(k??{}).map(I=>{const{path:m,id:R,Component:M}=k[I];return e.jsx(K,{path:m,children:e.jsx(M,{})},R)}),e.jsx(Q,{to:ge})]})]})})})};export{Oe as default};
