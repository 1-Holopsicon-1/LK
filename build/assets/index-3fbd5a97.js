var le=Object.defineProperty,de=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var H=(e,t,o)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))ue.call(t,o)&&H(e,o,t[o]);if(J)for(var o of J(t))fe.call(t,o)&&H(e,o,t[o]);return e},w=(e,t)=>de(e,pe(t));var E=(e,t,o)=>new Promise((l,i)=>{var r=c=>{try{a(o.next(c))}catch(u){i(u)}},n=c=>{try{a(o.throw(c))}catch(u){i(u)}},a=c=>c.done?l(c.value):Promise.resolve(c.value).then(r,n);a((o=o.apply(e,t)).next())});import{p as xe,e as R,h as he,f as b,s as p,r as d,j as s,af as ge,J as me,n as O,a5 as we,cM as ve,L as je}from"./vendor-0c8c29fe.js";import{$,g as A,an as C,b as Se,ai as K,X as m,l as j,ao as Z,L as S,S as Q,ap as ye,d as Te,G as _,a2 as B,aq as v,ar as ee,as as ke,at as Ne,h as N,au as be,av as G,q,aw as De,ax as Ce,ay as X,V as Ie,W as Fe,P as $e,p as Ae,x as Le,az as Me,aA as Pe}from"./index-179b6f61.js";import{D as Ee}from"./dev-mode-message-0aa0e975.js";const te=()=>$.get("?getNotification&token=".concat(A())),ze=e=>$.get("?viewNotification=".concat(e,"&token=").concat(A())),Oe=Object.freeze(Object.defineProperty({__proto__:null,get:te,view:ze},Symbol.toStringTag,{value:"Module"})),se=()=>$.get("?getDocList&token=".concat(A())).then(e=>C(C({},e),{},{data:e.data.map(t=>C(C({},t),{},{document:!0}))})),_e=e=>$.get("?viewDoc=".concat(e,"&token=").concat(A())),Be=Object.freeze(Object.defineProperty({__proto__:null,get:se,view:_e},Symbol.toStringTag,{value:"Module"})),Y={type:null,personalNotifications:null,error:null,completed:!1},Re=()=>({data:b(k).personalNotifications,loading:b(T.pending),error:b(k).error,completed:b(k).completed}),Ue=()=>b(k).type,We=xe({name:"changeCompleted",sid:"vr0j8g"}),oe=R(e=>e,{name:"setNotificationsType",sid:"-m97y8b"}),T=R(()=>E(void 0,null,function*(){const{type:e}=k.getState();if(e==="notifications")try{return(yield te()).data}catch(t){throw new Error(t)}try{return{docs:(yield se()).data}}catch(t){throw new Error(t)}}),{name:"getPersonalNotificationsFx",sid:"pa84d1"}),I=R(e=>E(void 0,null,function*(){const{type:t}=k.getState(),o=t==="notifications"?Oe:Be;try{return yield o.view(e),"ok"}catch(l){throw new Error("Ошибка загрузки данных")}}),{name:"viewPersonalNotificationsFx",sid:"-64tonw"}),k=he(Y,{name:"$personalNotificationsStore",sid:"53pwkb"}).on(oe,(e,t)=>w(g({},e),{type:t})).on(T,e=>w(g({},e),{error:null})).on(T.doneData,(e,t)=>w(g({},e),{personalNotifications:t})).on(T.failData,(e,t)=>w(g({},e),{error:t.message})).on(I.doneData,e=>g({},e)).on(I.failData,(e,t)=>w(g({},e),{error:t.message})).on(We,(e,t)=>w(g({},e),{completed:t.completed})).on(Se.userGuid,()=>g({},Y));I.doneData.watch(()=>T());const ne={usePersonalNotifications:Re,useType:Ue},y={setNotificationsType:oe,getPersonalNotificationsFx:T,viewPersonalNotificationsFx:I},Ve=(e,t,o)=>{const l={};let i=[];const r=n=>{if("document"in n){const{viewed:L,name:x}=n,D=(x==null?void 0:x.includes(e))||!e.length;return t==="all"&&D?!0:!L&&t!=="all"&&D}const{viewed:a,post:c,event:u}=n,f=(u==null?void 0:u.includes(e))||(c==null?void 0:c.includes(e))||!e.length;return t==="all"&&f?!0:!a&&t!=="all"&&f};return Object.entries(o).map(([n,a])=>{i=[],a.map(c=>{r(c)&&i.push(c)}),l[n]=i}),l},F=(e,t,o)=>{switch(e){case"Female":return o;default:return t}},ie=p.div.withConfig({componentId:"sc-rnm93p-0"})(["display:flex;flex-direction:column;gap:10px;width:100%;"]),re=p.div.withConfig({componentId:"sc-rnm93p-1"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),Je=p.div.withConfig({componentId:"sc-1g1tw42-0"})(["display:flex;width:100%;align-items:center;justify-content:space-between;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;@media (max-width:768px){flex-direction:column;}"]),He=p.div.withConfig({componentId:"sc-1g1tw42-1"})(["display:flex;gap:10px;align-self:end;@media (max-width:768px){width:100%;gap:20px;}"]),Ge=({data:e})=>{const{data:{user:t}}=K.useUser(),[o,l]=d.useState(!1),[i,r]=d.useState(!1);return s.jsxs(Je,{children:[s.jsxs(ie,{children:[s.jsx(re,{children:e.event||e.post}),e.startDate&&e.endDate!=="0000-00-00"?s.jsxs(m,{children:["Период: ",j(e.startDate,"numeric")," - ",j(e.endDate,"numeric")]}):s.jsxs(m,{children:["Дата: ",j(e.startDate,"numeric")]})]}),s.jsxs(He,{children:[e.file&&s.jsx(Z,{href:e.file,onClick:()=>null,text:"Скачать",width:"150px",icon:s.jsx(ge,{}),height:"35px",minHeight:"30px",background:S.grey.transparent2}),s.jsx(Q,{text:e.viewed?F(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:()=>{l(!0),y.viewPersonalNotificationsFx(e.id),l(!1),r(!0)},height:"35px",width:"150px",buttonSuccessText:F(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"),isLoading:o,completed:i,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},qe=p.div.withConfig({componentId:"sc-168uakk-0"})(["width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;display:flex;flex-direction:column;align-items:flex-end;"]),Xe=p.div.withConfig({componentId:"sc-168uakk-1"})(["display:flex;gap:8px;margin-top:5px;width:300px;@media (max-width:768px){max-width:100%;width:100%;}"]),Ye=({data:e})=>{const{data:{user:t}}=K.useUser(),[o,l]=d.useState(!1),[i,r]=d.useState(!1),n=()=>{try{l(!0),y.viewPersonalNotificationsFx(e.id),ye.clearById({id:`studdoc-${e.id}`,pageId:"doclist"}),l(!1),r(!0)}catch(a){Te.evokePopUpMessage({message:"Не удалось отправить данные",type:"failure"})}};return s.jsxs(qe,{children:[s.jsxs(ie,{children:[s.jsx(re,{children:e.name}),e.date&&s.jsxs(m,{children:["Дата: ",j(e.date,"numeric")]})]}),s.jsxs(Xe,{children:[e.link&&s.jsx(Z,{href:e.link,onClick:()=>null,text:"Подробнее",width:"100%",icon:s.jsx(me,{}),height:"35px",minHeight:"30px",background:S.grey.transparent2}),s.jsx(Q,{text:e.viewed?F(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:n,height:"35px",width:"100%",buttonSuccessText:F(t==null?void 0:t.sex,"Ознакомлен","Ознакомлена"),isLoading:o,completed:i,setCompleted:r,isActive:!0,isDone:e.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},z=({listNotification:e})=>{const t=ne.useType();return s.jsx(_,{d:"column",gap:"8px",children:e.length?e.map(o=>t==="notifications"?s.jsx(Ge,{data:o},o.id):s.jsx(Ye,{data:o},o.id)):s.jsx(B,{text:"У вас нет приказов, с которыми вы еще не ознакомились"})})},Ke=e=>{const t=new Date().getTime()-new Date(e).getTime(),o=Math.floor(t/1e3);if(o<60&&o>=1)return`${o} ${v(o,Ze)}`;const l=Math.floor(o/60);if(l<60&&l>=1)return`${l} ${v(l,Qe)}`;const i=Math.floor(l/60);if(i<24&&i>=1)return`${i} ${v(i,et)}`;const r=Math.floor(i/24);if(r>=1&&r<7)return`${r} ${v(r,tt)}`;const n=Math.floor(r/7);if(n>=1&&n<4)return`${n} ${v(n,st)}`;const a=Math.floor(r/30);if(a>=1&&a<12)return`${a} ${v(a,ot)}`;const c=Math.floor(r/365);return`${c} ${v(c,nt)}`},Ze={zero:"секунд",one:"секунду",twoToFour:"секунды",fiveToNine:"секунд"},Qe={zero:"минут",one:"минута",twoToFour:"минуты",fiveToNine:"минут"},et={zero:"часов",one:"час",twoToFour:"часа",fiveToNine:"часов"},tt={zero:"дней",one:"день",twoToFour:"дня",fiveToNine:"дней"},st={zero:"недель",one:"неделя",twoToFour:"недели",fiveToNine:"недель"},ot={zero:"месяцев",one:"месяц",twoToFour:"месяца",fiveToNine:"месяцев"},nt={zero:"лет",one:"год",twoToFour:"года",fiveToNine:"лет"},it=({allowance:e})=>{const t=O(ee.allowanceStatusChanged),o=O(ke.userSettings);return e?s.jsxs(rt,{children:[s.jsxs(Ne,{children:[s.jsxs(N,{align:"left",size:3,children:[e.paymentIdentifier,", ",e.position]}),e.orderStatus&&e.selfApprovalStatus==="Approved"&&s.jsx(N,{align:"left",size:4,children:be[e.orderStatus]}),e.selfApprovalStatus==="Approved"&&s.jsx(m,{fontSize:"1em",color:"var(--greenMain)",children:G[e.selfApprovalStatus]}),(e.selfApprovalStatus==="Declined"||e.selfApprovalStatus==="Expired")&&s.jsx(m,{fontSize:"1em",color:"var(--redMain)",children:G[e.selfApprovalStatus]}),s.jsxs(N,{align:"left",size:5,children:["Инициатор: ",e.initiatorName]}),s.jsxs(N,{align:"left",size:5,children:["Источник: ",e.sourceOfFunding]}),s.jsxs(N,{align:"left",size:5,children:["Сумма: ",e.sum," руб."]}),s.jsxs(m,{children:["Период: ",j(e.startDate,"numeric")," -"," ",j(e.endDate,"numeric")," "]}),s.jsxs(m,{children:["Дата: ",j(e.issueDate,"numeric")]})]}),(e.selfApprovalStatus==="Unknown"||e.selfApprovalStatus==="InProgress")&&s.jsxs(s.Fragment,{children:[s.jsxs(at,{children:[s.jsx(q,{text:"Отказаться",onClick:()=>t({allowanceId:e.allowanceId,isConfirmed:!1}),background:S.red.main,textColor:"white",height:"35px",width:"100%",isActive:!0}),s.jsx(q,{text:"Согласиться",onClick:()=>t({allowanceId:e.allowanceId,isConfirmed:!0}),background:S.green.main,textColor:"white",height:"35px",width:"100%",isActive:!0})]}),s.jsx(ct,{isLightTheme:(o==null?void 0:o.appearance.theme)===De.Light,children:s.jsxs(m,{children:["Подтвердите надбавку в течение 1 дня."," ",Ce(e.confirmationEndDate)&&`Осталось ${Ke(e.confirmationEndDate)}`]})})]})]}):null},rt=p.div.withConfig({componentId:"sc-ceiafc-0"})(["position:relative;width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);min-height:70px;display:flex;flex-direction:column;align-items:flex-end;overflow:hidden;"]),at=p.div.withConfig({componentId:"sc-ceiafc-1"})(["display:flex;gap:8px;margin:0.5rem 0;width:300px;@media (max-width:768px){max-width:100%;width:100%;}@media (max-width:380px){margin:1.5rem 0;}"]),ct=p.div.withConfig({componentId:"sc-ceiafc-2"})(["position:absolute;bottom:0;background-color:",";width:100%;color:",";left:0;text-align:center;"],S.orange.transparent3,({isLightTheme:e})=>e?S.orange.dark3:S.orange.light3),lt=({searchQuery:e,filter:t})=>{const[o,l,i]=O([X.personalAllowances.data,X.personalAllowances.loading,ee.personalAllowancesMounted]);d.useEffect(()=>{i()},[]);const r=d.useMemo(()=>{const n=e?o==null?void 0:o.filter(a=>a.position.includes(e)||a.paymentIdentifier.includes(e)||a.sourceOfFunding.includes(e)):o;return t&&(t==null?void 0:t.id)==="unread"?n==null?void 0:n.filter(a=>a.selfApprovalStatus==="Unknown"||a.selfApprovalStatus==="InProgress"):n},[o,e,t]);return l?s.jsx(_,{h:"100%",d:"column",ai:"center",jc:"center",children:s.jsx(Ie,{})}):s.jsxs(_,{d:"column",gap:"8px",p:"0.25rem",children:[s.jsx(Ee,{}),r?r.length>0?r.map(n=>s.jsx(it,{allowance:n},n.allowanceId)):s.jsx(B,{text:"Нет надбавок"}):s.jsx(B,{text:"Произошла ошибка"})]})},dt=p.div.withConfig({componentId:"sc-xrueg0-0"})(["display:flex;justify-content:center;gap:10px;width:100%;"]),pt=[{id:"all",title:"Все"},{id:"unread",title:"Непрочитанные"}],ut=[{id:"all",title:"Все"},{id:"vacation",title:"Отпуск"},{id:"fire",title:"Увольнение"},{id:"businesstrip",title:"Командировка"}],wt=({docsType:e})=>{const t=we(),{type:o}=ve(),l=h=>t.push(Pe+"/"+h),{data:i,error:r}=ne.usePersonalNotifications(),[n,a]=d.useState(),[c,u]=d.useState(""),[f,L]=d.useState({id:"all",title:"Все"}),[x,D]=d.useState({id:"all",title:"Все"});d.useEffect(()=>{a(JSON.parse(JSON.stringify(i)))},[i]),d.useEffect(()=>{var h;i&&a(Ve(c,(h=f==null?void 0:f.id)!=null?h:"",JSON.parse(JSON.stringify(i))))},[f,c]),d.useEffect(()=>{y.setNotificationsType(o),y.getPersonalNotificationsFx()},[o]);const ae=h=>{l(h)},U=d.useMemo(()=>{const h=(i==null?void 0:i.vacation)||[],W=(i==null?void 0:i.businesstrip)||[],V=(i==null?void 0:i.fire)||[];switch(x==null?void 0:x.id){case"all":return[...h,...W,...V].sort((M,P)=>{const ce=M.notificationType==="docs"?new Date(M.date):new Date(M.startDate||"");return(P.notificationType==="docs"?new Date(P.date):new Date(P.startDate||"")).getTime()<ce.getTime()?-1:1});case"vacation":return h;case"fire":return V;case"businesstrip":return W;default:return[]}},[i,x]);return s.jsx(Fe,{load:()=>{y.setNotificationsType(o),y.getPersonalNotificationsFx()},error:r,data:n,children:s.jsxs($e,{children:[s.jsxs(dt,{children:[s.jsx(Ae,{value:c,setValue:u,placeholder:"Поиск",leftIcon:s.jsx(je,{})}),s.jsx(Le,{items:o==="notifications"?ut:pt,selected:o==="notifications"?x:f,setSelected:o==="notifications"?D:L})]}),e?(n==null?void 0:n.docs)&&s.jsx(z,{listNotification:n==null?void 0:n.docs}):s.jsx(Me,{onChangePage:ae,currentPage:o==="allowances"?2:o==="notifications"?1:0,pages:[{id:"docs",title:"Приказы",content:(n==null?void 0:n.docs)&&s.jsx(z,{listNotification:n==null?void 0:n.docs})},{id:"notifications",title:"Кадровые уведомления",content:U.length?s.jsx(z,{listNotification:U}):void 0},{id:"allowances",title:"Надбавки",content:s.jsx(lt,{filter:f,searchQuery:c})}]})]})})};export{wt as N};
