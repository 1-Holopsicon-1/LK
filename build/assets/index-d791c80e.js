import{p as J,e as P,h as V,f as w,s as c,r as a,j as i,ac as H,E as Q,G as Z}from"./vendor-c0388033.js";import{$ as b,g as D,b as q,a3 as B,Q as F,l as N,a8 as O,L as A,S as R,a9 as K,d as X,G as Y,Z as tt,W as et,P as it,o as st,t as nt,aa as ot}from"./index-5a009515.js";const M=()=>b.get(`?getNotification&token=${D()}`),at=t=>b.get(`?viewNotification=${t}&token=${D()}`),rt=Object.freeze(Object.defineProperty({__proto__:null,get:M,view:at},Symbol.toStringTag,{value:"Module"})),U=()=>b.get(`?getDocList&token=${D()}`).then(t=>({...t,data:t.data.map(e=>({...e,document:!0}))})),ct=t=>b.get(`?viewDoc=${t}&token=${D()}`),lt=Object.freeze(Object.defineProperty({__proto__:null,get:U,view:ct},Symbol.toStringTag,{value:"Module"})),_={type:null,personalNotifications:null,error:null,completed:!1},dt=()=>({data:w(h).personalNotifications,loading:w(f.pending),error:w(h).error,completed:w(h).completed}),pt=()=>w(h).type,ut=J(),W=P(t=>t),f=P(async()=>{const{type:t}=h.getState();if(t==="notifications")try{return(await M()).data}catch(e){throw new Error(e)}try{return{docs:(await U()).data}}catch(e){throw new Error(e)}}),S=P(async t=>{const{type:e}=h.getState(),n=e==="notifications"?rt:lt;try{return await n.view(t),"ok"}catch{throw new Error("Ошибка загрузки данных")}}),h=V(_).on(W,(t,e)=>({...t,type:e})).on(f,t=>({...t,error:null})).on(f.doneData,(t,e)=>({...t,personalNotifications:e})).on(f.failData,(t,e)=>({...t,error:e.message})).on(S.doneData,t=>({...t})).on(S.failData,(t,e)=>({...t,error:e.message})).on(ut,(t,e)=>({...t,completed:e.completed})).on(q.userGuid,()=>({..._}));S.doneData.watch(()=>f());const z={usePersonalNotifications:dt,useType:pt},x={setNotificationsType:W,getPersonalNotificationsFx:f,viewPersonalNotificationsFx:S},gt=(t,e,n)=>{const s={};let r=[];const o=l=>{if("document"in l){const{viewed:g,name:m}=l,y=(m==null?void 0:m.includes(t))||!t.length;return e==="all"&&y?!0:!g&&e!=="all"&&y}const{viewed:p,post:u,event:d}=l,v=(d==null?void 0:d.includes(t))||(u==null?void 0:u.includes(t))||!t.length;return e==="all"&&v?!0:!p&&e!=="all"&&v};return Object.entries(n).map(([l,p])=>{r=[],p.map(u=>{o(u)&&r.push(u)}),s[l]=r}),s},k=(t,e,n)=>{switch(t){case"Female":return n;default:return e}},xt=c.div.withConfig({componentId:"sc-1g1tw42-0"})(["display:flex;width:100%;align-items:center;justify-content:space-between;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;@media (max-width:768px){flex-direction:column;}"]),ft=c.div.withConfig({componentId:"sc-1g1tw42-1"})(["width:100%;display:flex;flex-direction:column;gap:10px;"]),ht=c.div.withConfig({componentId:"sc-1g1tw42-2"})(["display:flex;gap:10px;align-self:end;@media (max-width:768px){width:100%;gap:20px;}"]),mt=c.div.withConfig({componentId:"sc-1g1tw42-3"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),wt=({data:t})=>{const{data:{user:e}}=B.useUser(),[n,s]=a.useState(!1),[r,o]=a.useState(!1);return i.jsxs(xt,{children:[i.jsxs(ft,{children:[i.jsx(mt,{children:t.event||t.post}),t.startDate&&t.endDate!=="0000-00-00"?i.jsxs(F,{children:["Период: ",N(t.startDate,"numeric")," - ",N(t.endDate,"numeric")]}):i.jsxs(F,{children:["Дата: ",N(t.startDate,"numeric")]})]}),i.jsxs(ht,{children:[t.file&&i.jsx(O,{href:t.file,onClick:()=>null,text:"Скачать",width:"150px",icon:i.jsx(H,{}),height:"35px",minHeight:"30px",background:A.grey.transparent2}),i.jsx(R,{text:t.viewed?k(e==null?void 0:e.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:()=>{s(!0),x.viewPersonalNotificationsFx(t.id),s(!1),o(!0)},height:"35px",width:"150px",buttonSuccessText:k(e==null?void 0:e.sex,"Ознакомлен","Ознакомлена"),isLoading:n,completed:r,setCompleted:o,isActive:!0,isDone:t.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},vt=c.div.withConfig({componentId:"sc-168uakk-0"})(["width:100%;padding:20px;border-radius:var(--brLight);background:var(--block-content);box-shadow:var(--block-shadow);row-gap:20px;min-height:70px;display:flex;flex-direction:column;align-items:flex-end;"]),yt=c.div.withConfig({componentId:"sc-168uakk-1"})(["display:flex;flex-direction:column;gap:10px;width:100%;"]),jt=c.div.withConfig({componentId:"sc-168uakk-2"})(["display:flex;gap:8px;margin-top:5px;width:300px;@media (max-width:768px){max-width:100%;width:100%;}"]),Nt=c.div.withConfig({componentId:"sc-168uakk-3"})(["font-style:normal;font-weight:500;font-size:15px;line-height:18px;"]),St=({data:t})=>{const{data:{user:e}}=B.useUser(),[n,s]=a.useState(!1),[r,o]=a.useState(!1),l=()=>{try{s(!0),x.viewPersonalNotificationsFx(t.id),K.clearById({id:`studdoc-${t.id}`,pageId:"doclist"}),s(!1),o(!0)}catch{X.evokePopUpMessage({message:"Не удалось отправить данные",type:"failure"})}};return i.jsxs(vt,{children:[i.jsxs(yt,{children:[i.jsx(Nt,{children:t.name}),t.date&&i.jsxs(F,{children:["Дата: ",N(t.date,"numeric")]})]}),i.jsxs(jt,{children:[t.link&&i.jsx(O,{href:t.link,onClick:()=>null,text:"Подробнее",width:"100%",icon:i.jsx(Q,{}),height:"35px",minHeight:"30px",background:A.grey.transparent2}),i.jsx(R,{text:t.viewed?k(e==null?void 0:e.sex,"Ознакомлен","Ознакомлена"):"Ознакомиться",action:l,height:"35px",width:"100%",buttonSuccessText:k(e==null?void 0:e.sex,"Ознакомлен","Ознакомлена"),isLoading:n,completed:r,setCompleted:o,isActive:!0,isDone:t.viewed,repeatable:!1,popUpFailureMessage:"Вы уже ознакомились"})]})]})},I=({listNotification:t})=>{const e=z.useType();return i.jsx(Y,{d:"column",gap:"8px",children:t.length?t.map(n=>e==="notifications"?i.jsx(wt,{data:n},n.id):i.jsx(St,{data:n},n.id)):i.jsx(tt,{text:"У вас нет приказов, с которыми вы еще не ознакомились"})})},kt=c.div.withConfig({componentId:"sc-xrueg0-0"})(["display:flex;justify-content:center;gap:10px;width:100%;"]),bt=c.div.withConfig({componentId:"sc-xrueg0-1"})([".slider-list-notification{margin-top:12px;width:100%;}"]),Dt=[{id:"all",title:"Все"},{id:"unread",title:"Непрочитанные"}],Ct=[{id:"all",title:"Все"},{id:"vacation",title:"Отпуск"},{id:"fire",title:"Увольнение"},{id:"businesstrip",title:"Командировка"}],Pt=({docsType:t})=>{const{data:e,error:n}=z.usePersonalNotifications(),[s,r]=a.useState(),[o,l]=a.useState("docs"),[p,u]=a.useState(""),[d,v]=a.useState({id:"all",title:"Все"}),[g,m]=a.useState({id:"all",title:"Все"});a.useEffect(()=>{r(JSON.parse(JSON.stringify(e)))},[e]),a.useEffect(()=>{e&&r(gt(p,(d==null?void 0:d.id)??"",JSON.parse(JSON.stringify(e))))},[d,p]),a.useEffect(()=>{x.setNotificationsType(o),x.getPersonalNotificationsFx()},[o]);const y=j=>{l(j)},E=a.useMemo(()=>{const j=(e==null?void 0:e.vacation)||[],L=(e==null?void 0:e.businesstrip)||[],$=(e==null?void 0:e.fire)||[];switch(g==null?void 0:g.id){case"all":return[...j,...L,...$].sort((C,T)=>{const G=C.notificationType==="docs"?new Date(C.date):new Date(C.startDate||"");return(T.notificationType==="docs"?new Date(T.date):new Date(T.startDate||"")).getTime()<G.getTime()?-1:1});case"vacation":return j;case"fire":return $;case"businesstrip":return L;default:return[]}},[e,g]);return i.jsx(et,{load:()=>{x.setNotificationsType(o),x.getPersonalNotificationsFx()},error:n,data:s,children:i.jsx(bt,{children:i.jsxs(it,{children:[i.jsxs(kt,{children:[i.jsx(st,{value:p,setValue:u,placeholder:"Поиск",leftIcon:i.jsx(Z,{})}),i.jsx(nt,{items:o==="notifications"?Ct:Dt,selected:o==="notifications"?g:d,setSelected:o==="notifications"?m:v})]}),t&&(s!=null&&s.docs)?i.jsx(I,{listNotification:s==null?void 0:s.docs}):i.jsx(ot,{onChangePage:y,pages:[{id:"docs",title:"Приказы",content:(s==null?void 0:s.docs)&&i.jsx(I,{listNotification:s==null?void 0:s.docs})},{id:"notifications",title:"Кадровые уведомления",content:E.length?i.jsx(I,{listNotification:E}):void 0},{title:"Надбавки",condition:void 0,content:void 0}],className:"slider-list-notification"})]})})})};export{Pt as N};
