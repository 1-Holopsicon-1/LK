var A=Object.defineProperty,N=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var x=(t,e,o)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,h=(t,e)=>{for(var o in e||(e={}))$.call(e,o)&&x(t,o,e[o]);if(k)for(var o of k(e))S.call(e,o)&&x(t,o,e[o]);return t},E=(t,e)=>N(t,O(e));var p=(t,e,o)=>new Promise((d,r)=>{var u=i=>{try{a(o.next(i))}catch(n){r(n)}},l=i=>{try{a(o.throw(i))}catch(n){r(n)}},a=i=>i.done?d(i.value):Promise.resolve(i.value).then(u,l);a((o=o.apply(t,e)).next())});import{p as T,e as j,x as c,h as W,u as P,r as b,q as D,j as f}from"./vendor-33947725.js";import{b0 as q,b1 as B,b2 as G,aV as I,b3 as F,s as J,B as C,F as H,I as L,S as U,j as z,c as M,b4 as R}from"./index-958ef795.js";const K=(t,e,o)=>p(void 0,null,function*(){o(!1);const d=e.map(l=>{if(Array.isArray(l.data[0])){const a=l.data.map(n=>Object.assign({},...n==null?void 0:n.map(s=>{var m,y;const g={};return s!=null&&s.fieldName&&(g[s==null?void 0:s.fieldName]=s!=null&&(m=s.value)!==null&&m!==void 0&&m.title?s==null||(y=s.value)===null||y===void 0?void 0:y.title:s==null?void 0:s.value),g}))),i={};return i[t]=JSON.stringify(a),i}else return l.data.map(a=>{var i;const n={};if(a!=null&&a.fieldName&&(n[(i=a==null?void 0:a.fieldName)!==null&&i!==void 0?i:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"){var s;n[(s=a==null?void 0:a.fieldName)!==null&&s!==void 0?s:""]=JSON.stringify(a==null?void 0:a.value.map(m=>m.title))}return n})}).flat(),r=Object.assign({},...d);!(yield q.sendBufferHolidayWorkFx({employeeGuid:r.jobGuid,dates:[{date:r.holiday_work_date,dayOff:r.extra_holiday_date?r.extra_holiday_date:null,hours:+r.holiday_work_hours}]})).isError&&o(!0)}),V=T({name:"loadBufferPartTimeEmployment",sid:"rqpj9r"}),Y=T({name:"sendBufferPartTimeEmployment",sid:"-1vo25s"}),_=j(()=>p(void 0,null,function*(){var t;const{data:e}=yield B.get(`InternalPartTime.GetAllHistory?PersonalGuid=${G((t=I())!==null&&t!==void 0?t:"").IndividualGuid}`);return e.orders}),{name:"loadBufferPartTimeEmploymentFx",sid:"lptsxp"});c({and:[{clock:V,target:_}],or:{sid:"-bwsfri"}});const v=j(t=>p(void 0,null,function*(){return(yield B.post("Weekend.AddWeekend",t)).data}),{name:"sendBufferPartTimeEmploymentFx",sid:"-26c53s"});c({and:[{clock:Y,target:v}],or:{sid:"-bguek1"}});const w=W([],{name:"$bufferPartTimeEmploymentOrders",sid:"-rtc3mi"}),Q=v.pending;c({and:[{clock:_.doneData,target:w}],or:{sid:"-bdjmzv"}});c({and:[{clock:v.doneData,fn:t=>{const e=t;return e.isError?{message:e.error,type:"hrFailure",time:3e5}:{message:"Форма отправлена успешно",type:"success",time:0}},target:F.evokePopUpMessage}],or:{sid:"-azss5u"}});c({and:[{clock:v.fail,fn:()=>({message:"Не удалось отправить форму.",type:"hrFailure",time:3e5}),target:F.evokePopUpMessage}],or:{sid:"-a29byt"}});const X={useBufferPartTimeEmployment:()=>({data:P(w),loading:P(Q)})},Z=(t,e)=>{const{surname:o,name:d,patronymic:r}=t;return{title:"Заявление на трудоустройство по совместительству",data:[{title:"ФИО",value:o+" "+d+" "+r,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделениe, куда производится трудорустройство",type:"auto-complete-input",fieldName:"newPlaceOfWork",value:"",width:"100%",suggestions:e,required:!0,mask:!0,visible:!0,placeholder:"Начните вводить название подразделения"},{title:"Должность",value:null,fieldName:"post",mask:!0,editable:!0,required:!0},{title:"Ставка",type:"select",fieldName:"rate",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"0.5"},{id:2,title:"0.25"}]}]}},oe=()=>{var t,e;const[o,d]=b.useState(null),{data:{dataUserApplication:r}}=J.useApplications(),{loading:u}=X.useBufferPartTimeEmployment(),[l,a]=b.useState(!1),i=l!=null?l:!1,n=D(R);return b.useEffect(()=>{r&&!u&&d(Z(r,n))},[r,u]),f.jsx(C,{isDone:i,children:!!o&&!!d&&f.jsxs(H,{children:[f.jsx(L,E(h({},o),{collapsed:i,setData:d})),f.jsx(U,{text:"Отправить",action:()=>K(z.HOLIDAY_WORK,[o],a),isLoading:u,completed:l,setCompleted:a,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:M(o)&&((t=(e=o.optionalCheckbox)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:!0)})]})})};export{oe as default};
