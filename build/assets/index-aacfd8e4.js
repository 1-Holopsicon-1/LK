var G=Object.defineProperty;var B=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var I=(t,e,n)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$=(t,e)=>{for(var n in e||(e={}))J.call(e,n)&&I(t,n,e[n]);if(B)for(var n of B(e))_.call(e,n)&&I(t,n,e[n]);return t};import{m as y,I as K,a4 as E,p as g,h,x as r,n as O,r as q,j as a,F as X,a2 as Z,a1 as ee,s as te}from"./vendor-31894644.js";import{g as k,$ as b,d as U,B as N,F as T,G as ne,V as ae,h as se,M as re,q as z,i as ie,S as de,p as V,L as oe}from"./index-0f8b6250.js";import{c as ce}from"./create-checkbox-field-7ee03f25.js";const le=async()=>{new FormData().set("token",k());const{data:e}=await b.get("?getChildren&token=".concat(k()));return e},ue=async t=>{const e=new FormData;e.set("token",k()),e.set("children",JSON.stringify(t));const{data:n}=await b.post("?saveChildren=1",e,{headers:{"Content-Type":"multipart/form-data"}});if(n.result!=="ok")throw new Error(n.errors);return n},he=async({id:t})=>{const{data:e}=await b.get("?deleteChildren=".concat(t,"&token=").concat(k()));if(e.result!=="ok")throw new Error(e.errors);return e};function M(t){return!Number.isNaN(Number(t))}const m=y({sid:"enrs6o",fn:()=>K({handler:le}),name:"getChildrensQuery",method:"createQuery"}),p=y({sid:"mx4uph",fn:()=>E({handler:ue}),name:"saveChildrensMutation",method:"createMutation"}),S=y({sid:"-6tjplu",fn:()=>E({handler:he}),name:"deleteChildrenMutation",method:"createMutation"}),d=g({name:"pageMounted",sid:"e105tx"}),F=g({name:"addChildren",sid:"vq20kt"}),L=g({name:"editChildren",sid:"-z09dni"}),P=g({name:"childrensSaved",sid:"-adnm0b"}),A=g({name:"childrenDeleted",sid:"-96ogy1"}),me=h(0,{name:"$counter",sid:"-74wf4c"}).on(F,t=>t+1).reset(d),s=h([{fio:"",birthdate:"",id:"n0",created:new Date().toISOString()}],{name:"$newChildrens",sid:"m7jjrt"}).reset([d,p.finished.success]),Q=h(!1,{name:"$isActive",sid:"-y11xyo"}).reset(d),R=h([],{name:"$allChildrens",sid:"-hsharx"}).reset(d),W=h(pe(14),{name:"$minDate",sid:"-u2pdam"}).reset(d),H=h(ge(2),{name:"$maxDate",sid:"-2shav5"}).reset(d),D=ce({reset:d});r({and:[{clock:d,target:m.start}],or:{sid:"-bk0ip1"}});r({and:[{clock:F,source:{newChildrens:s,counter:me},fn:({newChildrens:t,counter:e})=>[...t,{fio:"",birthdate:"",id:"n"+e.toString(),created:new Date().toISOString()}],target:s}],or:{sid:"-bhtcbl"}});r({and:[{clock:A,filter:({id:t})=>M(t),target:S.start}],or:{sid:"-aldhba"}});r({and:[{clock:A,filter:(t,{id:e})=>!M(e),source:s,fn:(t,{id:e})=>t.filter(n=>n.id!==e),target:s}],or:{sid:"-a5z8p6"}});r({and:[{clock:L,source:s,fn:(t,{id:e,data:n})=>t.map(i=>i.id===e?$($({},i),n):i),target:s}],or:{sid:"-9odtpm"}});r({and:[{clock:[m.$data,s],source:{saved:m.$data,newChildrens:s},fn:({saved:t,newChildrens:e})=>[...t||[],...e],target:R}],or:{sid:"-968m4p"}});r({and:[{clock:P,source:s,target:p.start}],or:{sid:"-8o3ejs"}});r({and:[{clock:[s,D.value],source:{newChildrens:s,confirmed:D.value,minDate:W,maxDate:H},fn:({newChildrens:t,confirmed:e,minDate:n,maxDate:i})=>t.every(o=>o.birthdate&&new Date(o.birthdate)>=new Date(n)&&new Date(o.birthdate)<=new Date(i)&&o.fio)&&e,target:Q}],or:{sid:"-youmyr"}});r({and:[{clock:[p.$succeeded,S.$succeeded],target:m.start}],or:{sid:"-y4i90e"}});r({and:[{clock:p.$succeeded,fn:()=>({type:"success",message:"Данные сохранены"}),target:U.evokePopUpMessage}],or:{sid:"-xqre6d"}});r({and:[{clock:S.$succeeded,fn:()=>({type:"success",message:"Данные сохранены"}),target:U.evokePopUpMessage}],or:{sid:"-xatcyw"}});const l={childrens:R,confirmed:D.value,loading:m.$pending,saving:p.$pending,isActive:Q,minDate:W,maxDate:H},u={pageMounted:d,addChildren:F,saveChildrens:P,deleteChildren:A,editChildren:L,confirm:D.setValue};function ge(t){const e=new Date;return new Date(e.getFullYear()-t,e.getMonth(),e.getDate()+1).toISOString().split("T")[0]}function pe(t){const e=new Date;return new Date(e.getFullYear()-t,e.getMonth(),e.getDate()+2).toISOString().split("T")[0]}const we=()=>{const[t,e,n,i,o,f,w,j,x]=O([u.pageMounted,l.loading,l.childrens,u.addChildren,u.saveChildrens,l.saving,l.isActive,l.confirmed,u.confirm]),[c,Y]=q.useState(!1),C=c!=null?c:!1;return q.useEffect(()=>{t()},[]),e?a.jsx(N,{isDone:C,children:a.jsx(T,{noHeader:!0,children:a.jsx(ne,{w:"100%",jc:"center",ai:"center",children:a.jsx(ae,{})})})}):a.jsx(N,{isDone:C,children:a.jsxs(T,{noHeader:!0,children:[a.jsx(se,{size:3,align:"left",children:"Состав семьи"}),a.jsx(re,{type:"info",title:"Как заполнить",icon:a.jsx(X,{}),children:"Укажите ваших детей и внуков в возрасте от 2 до 14 лет"}),[...n].map(v=>a.jsx(fe,{id:v.id,fio:v.fio,birthdate:v.birthdate},v.id)),a.jsx(z,{icon:a.jsx(Z,{}),text:"Добавить",onClick:()=>i(),background:"transparent"}),a.jsx(ie,{checked:j,setChecked:x,text:"Подтверждаю достоверность внесенных данных"}),a.jsx(de,{text:C?"Отправлено":"Отправить",action:()=>{o()},isLoading:f,completed:c,setCompleted:Y,repeatable:!1,buttonSuccessText:"Отправлено",isDone:C,isActive:w,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})},fe=({id:t,fio:e,birthdate:n})=>{const[i,o,f,w,j]=O([l.saving,u.deleteChildren,u.editChildren,l.minDate,l.maxDate]),x=!M(t);return a.jsxs(xe,{children:[a.jsx(V,{placeholder:"ФИО",value:e,setValue:c=>{f({id:t,data:{fio:c,birthdate:n}})},required:!0,isActive:x}),a.jsx(V,{type:"date",placeholder:"Дата рождения",value:n,setValue:c=>{f({id:t,data:{fio:e,birthdate:c}})},required:!0,width:"30%",minWidth:"150px",isActive:x,minValue:w,maxValue:j}),a.jsx(z,{icon:a.jsx(ee,{}),textColor:oe.red.main,onClick:()=>o({id:t}),background:"transparent",isActive:!i})]})},xe=te.div.withConfig({componentId:"sc-1tg60zq-0"})(["display:flex;align-items:flex-end;column-gap:5px;"]);export{we as default};
