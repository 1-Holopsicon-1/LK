var B=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var P=(e,n,a)=>n in e?B(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,U=(e,n)=>{for(var a in n||(n={}))Q.call(n,a)&&P(e,a,n[a]);if(D)for(var a of D(n))X.call(n,a)&&P(e,a,n[a]);return e},W=(e,n)=>J(e,K(n));var N=(e,n,a)=>new Promise((d,r)=>{var i=t=>{try{c(a.next(t))}catch(o){r(o)}},u=t=>{try{c(a.throw(t))}catch(o){r(o)}},c=t=>t.done?d(t.value):Promise.resolve(t.value).then(i,u);c((a=a.apply(e,n)).next())});import{j as s,L as Y,bs as Z,ce as ee,s as I,aa as se,a6 as $,bw as te,r as w,a5 as ae,cI as ne,cU as re,co as ie,cp as ce,aW as oe}from"./vendor-00bea631.js";import{ai as V,t as le,v as de,w as ue,ch as he,L as pe,X as q,G as C,bT as T,q as z,H as xe,ci as b,bx as fe,cj as Se,ck as ge,cl as me,u as Ee,cm as G,cn as x,bV as O,co as _,cp as L,d as je,cq as we,E as Ce,aJ as Me,W as ke,P as ve,a0 as be,cr as Ie,cs as Re,ct as ye}from"./index-ed5dff92.js";import{E as Ue}from"./index-39b26607.js";const Oe=({value:e,setValue:n,onHintClick:a,onValueEmpty:d})=>{const r=/\d/.test(e),{data:{user:i}}=V.useUser(),u=c=>N(void 0,null,function*(){return r?yield ue(c):yield he(c,"",1,20)});return s.jsx(le,{value:e,width:"100%",setValue:n,onHintClick:a(r),placeholder:"Поиск",customMask:r?de.groupMask:void 0,transformRequest:r?void 0:c=>c.fio,request:u,leftIcon:e.length===0?s.jsx(Y,{}):r?s.jsx(Z,{}):s.jsx(ee,{}),onValueEmpty:(i==null?void 0:i.user_status)==="staff"?d:void 0})},_e=I(se).withConfig({componentId:"sc-17n125n-0"})(["color:var(--text);padding:15px 15px;max-width:140px;width:100%;opacity:",";border-radius:10px;background:",";color:",";&:hover{filter:brightness(0.97);}"],({disabled:e})=>e?.5:1,({isCurrent:e})=>e?pe.blue.transparent3:"transparent",({isCurrent:e})=>e?"var(--blue)":"var(--grey)"),Le=I.div.withConfig({componentId:"sc-17n125n-1"})(["display:flex;align-items:center;justify-content:center;svg{width:20px;min-width:20px;height:20px;}"]),Ve=I.div.withConfig({componentId:"sc-17n125n-2"})(["font-weight:",";font-size:0.9rem;"],({isCurrent:e})=>e?500:400),Te=({route:e,collapsed:n=!1,disabled:a=!1,isCurrent:d=!1})=>{if(!e)return s.jsx(q,{children:"Ссылка не определена"});const{path:r,title:i,icon:u,color:c,shortTitle:t}=e,o=f=>{if(a)return f.preventDefault()};return s.jsx(_e,{collapsed:n,disabled:a,isCurrent:d,to:r,title:t!=null?t:i,color:c,onClick:o,children:s.jsxs(C,{gap:"8px",children:[s.jsx(Le,{children:u}),!n&&s.jsx(Ve,{isCurrent:d,children:t!=null?t:i})]})})},A=({handleReturnToMySchedule:e,baseSearchValue:n,handleValue:a,onHintClick:d,isSideMenuOpen:r})=>{var f;const{data:{searchValue:i,filter:u}}=T.useSchedule(),c=$(),{data:{user:t}}=V.useUser(),o=(t==null?void 0:t.user_status)==="staff";return s.jsxs(s.Fragment,{children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(q,{children:"Группа или преподаватель"}),s.jsx(Oe,{value:i,setValue:a,onHintClick:d})]}),n!==i&&s.jsx(z,{text:r&&"Мое расписание",onClick:e,icon:s.jsx(te,{}),background:"var(--block)",textColor:"var(--blue)"}),s.jsx(xe,{margin:"16px 0",width:"100%"}),s.jsx(C,{d:"column",gap:"2px",ai:"flex-start",children:Object.keys((f=b)!=null?f:{}).map(p=>{const l=b[p],{id:m,path:S}=l,g=u?`${S}/${u}`:S;return m==="schedule-session"&&o?null:s.jsx(Te,{collapsed:!r,isCurrent:c.pathname===g,route:W(U({},l),{path:g})},m)})})]})},Fe=()=>{var F,H;const{data:{user:e}}=V.useUser(),{data:{filter:n,view:a,errorInData:d}}=T.useSchedule(),{isTablet:r,isMobile:i}=fe(),[u,c]=w.useState(!0),t=$(),o=ae(),f=t.pathname!==Se,p=t.pathname.split("/"),l=p.length===4?p[p.length-1]:null,m=l?/\d/.test(l):!1,S=(e==null?void 0:e.user_status)==="staff"?(F=e==null?void 0:e.fullName)!=null?F:"":(H=e==null?void 0:e.group)!=null?H:"",g=t.pathname.includes(ge),R=t.pathname.includes(me),j=g||R,{open:M}=Ee(),E=()=>{n&&o.push(_(L,{page:t.pathname.split("/")[2]})),x.setSearchValue(S),x.setFilter(""),x.resetExternalSchedule()};w.useLayoutEffect(()=>{a===G.month&&!j&&x.changeView(G.day)},[a,j]),w.useEffect(()=>{c(!(i||r))},[r,i]),w.useEffect(()=>{l?(x.setFilter(l),x.setSearchValue(l),m?O.getGroupScheduleFx({group:l}):O.getTeacherScheduleFx({fullName:l})):E()},[l]),w.useEffect(()=>()=>{x.resetExternalSchedule()},[]);const y=()=>{O.getScheduleFx(e)},k=()=>h=>{(h==null?void 0:h.id)===(e==null?void 0:e.group)&&E(),h!=null&&h.id&&(t.pathname.split("/")[2]==="retake"?o.push(_(L,{page:"current",filter:h.value})):o.push(_(L,{page:t.pathname.split("/")[2],filter:h.value})))},v=h=>{x.setSearchValue(h)};return{isSideMenuOpen:u,shouldShowSlider:f,isMobile:i,isSessionPage:g,baseSearchValue:S,showMonth:j,handleErrorClick:()=>{je.evokePopUpMessage({message:d,type:"failure",time:we.ten_seconds})},handleValue:v,onHintClick:k,handleReturnToMySchedule:E,handleLoad:y,handleOpenSideMenu:()=>{i?M(s.jsx(C,{d:"column",gap:"8px",ai:"flex-start",children:s.jsx(A,{isSideMenuOpen:!0,baseSearchValue:S,handleReturnToMySchedule:E,onHintClick:k,handleValue:v})})):c(h=>!h)}}},He=I.div.withConfig({componentId:"sc-sh5ff8-0"})(["min-width:",";width:",";padding-right:10px;height:calc(100vh - var(--header-height) - 112px);display:flex;z-index:10;gap:8px;flex-direction:column;align-items:",";","{display:none;}"],({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"flex-start":"center",Ce.isMobile),De=e=>s.jsx(He,{isSideMenuOpen:e.isSideMenuOpen,children:s.jsx(A,U({},e))}),ze=()=>{var M;const{data:{view:e,schedule:n,externalSchedule:a,errorInData:d},loading:r,error:i}=T.useSchedule(),{allRoutes:u}=Me.useMenu(),{isSideMenuOpen:c,shouldShowSlider:t,showMonth:o,baseSearchValue:f,isMobile:p,onHintClick:l,handleValue:m,handleReturnToMySchedule:S,handleLoad:g,handleOpenSideMenu:R,handleErrorClick:j}=Fe();return s.jsx(ke,{loading:r,load:g,error:i,data:r?a:n,children:s.jsx(ve,{topCenterElement:t&&s.jsx(be,{size:"small",sliderWidth:"240px",pages:o?Ie:Re,currentPage:e,appearance:!p,setCurrentPage:x.changeView}),topRightCornerElement:s.jsxs(C,{w:"fit-content",gap:"20px",children:[s.jsx(Ue,{visible:!!d,onClick:j}),s.jsx(z,{icon:p?s.jsx(ne,{}):s.jsx(re,{}),width:"36px",height:"36px",onClick:R})]}),children:u&&s.jsxs(C,{gap:"16px",ai:"flex-start",children:[!p&&s.jsx(De,{isSideMenuOpen:c,baseSearchValue:f,handleReturnToMySchedule:S,onHintClick:l,handleValue:m}),s.jsxs(ie,{children:[Object.keys((M=b)!=null?M:{}).map(E=>{const{path:y,id:k,Component:v}=b[E];return s.jsx(ce,{path:y,children:s.jsx(v,{})},k)}),s.jsx(oe,{to:ye})]})]})})})};export{ze as default};
