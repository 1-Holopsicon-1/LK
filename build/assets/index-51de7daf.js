var M=Object.defineProperty;var g=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var h=(s,e,t)=>e in s?M(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,j=(s,e)=>{for(var t in e||(e={}))T.call(e,t)&&h(s,t,e[t]);if(g)for(var t of g(e))B.call(e,t)&&h(s,t,e[t]);return s};var v=(s,e,t)=>new Promise((c,o)=>{var l=i=>{try{r(t.next(i))}catch(d){o(d)}},a=i=>{try{r(t.throw(i))}catch(d){o(d)}},r=i=>i.done?c(i.value):Promise.resolve(i.value).then(l,a);r((t=t.apply(s,e)).next())});import{s as N,j as n,r as m,M as E}from"./vendor-d78621d5.js";import{$ as U,g as L,aE as H,aF as A,h as V,X as _,aG as I,aH as F,K as y,r as R,ap as p,l as u,ai as K,W as q,_ as G,P as O,q as X,an as P,H as J,x as Q}from"./index-9478e959.js";const Y=()=>v(void 0,null,function*(){return(yield U.get(`?getVacations&token=${L()}`)).data}),b=H({api:{get:Y},errorMessage:()=>"Возникла ошибка с получением графика отпусков!"}),Z=N(A).withConfig({componentId:"sc-13iobzb-0"})(["border-radius:var(--brLight);background:var(--block-content);position:relative;.background{font-size:6em;position:absolute;bottom:0px;right:10px;font-weight:bold;opacity:0.5;}.content{height:100%;display:flex;align-items:flex-end;}"]),k=({children:s,title:e,text:t,width:c,height:o,background:l,padding:a})=>n.jsxs(Z,{alignItems:"flex-start",gap:"10px",orientation:"vertical",width:c!=null?c:"15vw",minHeight:o!=null?o:"150px",maxHeight:o!=null?o:"150px",padding:a,children:[n.jsx(V,{size:4,align:"left",children:e}),n.jsx(_,{visible:!!t,fontSize:"0.9em",children:I(t!=null?t:"",60)}),l&&n.jsx("div",{className:"background",children:l}),s&&n.jsx("div",{className:"content",children:s})]}),x={fiveToNine:"дней",one:"день",twoToFour:"дня",zero:"дней"},ee=[{title:"Плановые периоды отпуска",field:"plannedVacationPeriods",showFull:!0},{title:"Фактические периоды отпуска",field:"actualVacationPeriods",showFull:!0},{title:"Остаток отпуска",field:"unusedVacationPeriods",showFull:!0}],te=s=>{const{division:e,post:t,vacations:c,allActualVacationPeriods:o,allPlannedVacationPeriods:l,allUnusedVacationPeriods:a}=oe(s);return n.jsxs(n.Fragment,{children:[n.jsxs(F,{children:[n.jsx(y,{keyStr:"Подразделение",value:e}),n.jsx(y,{keyStr:"Должность",value:t})]}),n.jsx(R,{columns:ee,data:c,footer:()=>({allPlannedVacationPeriods:f(l),allActualVacationPeriods:f(o),allUnusedVacationPeriods:f(a)})})]})};function f(s){return`Всего: ${s} ${p(Math.trunc(s||0),x)}`}function oe(s){const{fact:e,plan:t,unused:c,division:o,post:l}=s;return{division:o,post:l,vacations:ae(e,t,c),allActualVacationPeriods:e.reduce((a,{numdays:r})=>(a+=+r,a),0),allPlannedVacationPeriods:t.reduce((a,{numdays:r})=>(a+=+r,a),0),allUnusedVacationPeriods:c.reduce((a,{numdays:r})=>(a+=+r,a),0)}}function ae(s,e,t){const c=Math.max(s.length,e.length,t.length),o=[];for(let l=0;l<c;l++){const a=s[l],r=e[l],i=t[l],d={actualVacationPeriods:"",plannedVacationPeriods:"",unusedVacationPeriods:""},C=u(a==null?void 0:a.from,"numeric"),S=u(a==null?void 0:a.to,"numeric"),w=u(r==null?void 0:r.from,"numeric"),W=u(r==null?void 0:r.to,"numeric"),z=u(i==null?void 0:i.from,"numeric"),D=u(i==null?void 0:i.to,"numeric");a&&(d.actualVacationPeriods=`${C} - ${S} (${a.numdays} ${p(Number(a.numdays)||0,x)})`),r&&(d.plannedVacationPeriods=`${w} - ${W} (${r.numdays} ${p(Number(r.numdays)||0,x)})`),i&&(d.unusedVacationPeriods=`${z} - ${D} (${i.numdays} ${p(Math.trunc(Number(i.numdays))||0,x)})`),o.push(d)}return o}const $={fiveWorkDays:"https://e.mospolytech.ru/old/storage/files/Proizvodstvennyj_kalendar_na_2024_god_dlya_pyatidnevnoj_rabochej_nedeli.pdf",sixWorkDays:"https://e.mospolytech.ru/old/storage/files/Proizvodstvennyj_kalendar_na_2024_god_dlya_shestidnevnoj_rabochej.pdf"},ne=()=>{var r;const{data:{user:s}}=K.useUser(),{data:e,error:t}=b.selectors.useData(),c=m.useMemo(()=>(e==null?void 0:e.map((i,d)=>({id:d,title:i.division})))||[],[e]),[o,l]=m.useState((r=c[0])!=null?r:{});m.useEffect(()=>{o!=null&&o.id||l(c[0])},[o==null?void 0:o.id,l,c]);const a=e==null?void 0:e[Number((o==null?void 0:o.id)||0)];return n.jsx(q,{load:b.effects.getFx,error:t,data:e,children:n.jsx(G,{alignItems:"flex-start",children:n.jsxs(O,{topRightCornerElement:n.jsx(X,{onClick:()=>{window.location.replace("https://e.mospolytech.ru/old/index.php?p=vacation")},text:"Заполнить график",background:"var(--reallyBlue)",textColor:"#fff",icon:n.jsx(E,{}),minWidth:"35px",height:"36px"}),children:[n.jsx(_,{width:"100%",maxWidth:"100%",children:"Производственный календарь на 2024 год"}),n.jsxs(F,{scroll:!1,direction:"horizontal",gap:12,wrapOnMobile:!0,children:[n.jsx(k,{title:"Для пятидневной рабочей недели",height:"120px",width:"50%",background:"5",padding:"20px 40px 20px 20px",children:n.jsx(P,{onClick:()=>null,href:$.fiveWorkDays,textColor:"var(--reallyBlue)",text:"Подробнее",background:"transparent",padding:"10px 0"})}),n.jsx(k,{title:"Для шестидневной рабочей недели",height:"120px",width:"50%",background:"6",padding:"20px 40px 20px 20px",children:n.jsx(P,{onClick:()=>null,href:$.sixWorkDays,textColor:"var(--reallyBlue)",text:"Подробнее",background:"transparent",padding:"10px 0"})})]}),n.jsx(J,{}),n.jsx(V,{size:3,align:"left",children:"Сведения о трудоустройстве"}),!!(s!=null&&s.id)&&n.jsx(Q,{width:"fit-content",items:c,selected:o,setSelected:l}),a&&n.jsx(te,j({},a))]})})})},le=()=>n.jsx(ne,{});export{le as default};
