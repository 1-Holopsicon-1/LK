var A=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var N=(e,a,n)=>a in e?A(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,O=(e,a)=>{for(var n in a||(a={}))J.call(a,n)&&N(e,n,a[n]);if(H)for(var n of H(a))X.call(a,n)&&N(e,n,a[n]);return e},P=(e,a)=>K(e,Q(a));var W=(e,a,n)=>new Promise((d,r)=>{var i=t=>{try{o(n.next(t))}catch(l){r(l)}},u=t=>{try{o(n.throw(t))}catch(l){r(l)}},o=t=>t.done?d(t.value):Promise.resolve(t.value).then(i,u);o((n=n.apply(e,a)).next())});import{j as s,L as Y,bq as Z,cc as ee,s as I,aa as se,a6 as $,bu as te,r as v,a5 as ne,cG as ae,d4 as re,cm as ie,cn as oe,aT as le}from"./vendor-249420f4.js";import{a9 as T,i as ce,j as de,k as ue,b_ as he,t as pe,E as z,r as C,bz as V,B as q,D as xe,b$ as b,aN as fe,c0 as Se,c1 as ge,c2 as me,u as Ee,c3 as G,c4 as x,bB as _,c5 as U,c6 as L,e as je,c7 as ve,q as Ce,an as we,W as Me,N as ke,O as be,c8 as Ie,c9 as Re,ca as ye}from"./index-72b1dbf4.js";import{E as Oe}from"./index-aa9d6572.js";const _e=({value:e,setValue:a,onHintClick:n,onValueEmpty:d})=>{const r=/\d/.test(e),{data:{user:i}}=T.useUser(),u=o=>W(void 0,null,function*(){return r?yield ue(o):yield he(o,"",1,20)});return s.jsx(ce,{value:e,width:"100%",setValue:a,onHintClick:n(r),placeholder:"Поиск",customMask:r?de.groupMask:void 0,transformRequest:r?void 0:o=>o.fio,request:u,leftIcon:e.length===0?s.jsx(Y,{}):r?s.jsx(Z,{}):s.jsx(ee,{}),onValueEmpty:(i==null?void 0:i.user_status)==="staff"?d:void 0})},Ue=I(se).withConfig({componentId:"sc-17n125n-0"})(["color:var(--text);padding:15px 15px;max-width:140px;width:100%;opacity:",";border-radius:10px;background:",";color:",";&:hover{filter:brightness(0.97);}"],({disabled:e})=>e?.5:1,({isCurrent:e})=>e?pe.blue.transparent3:"transparent",({isCurrent:e})=>e?"var(--blue)":"var(--grey)"),Le=I.div.withConfig({componentId:"sc-17n125n-1"})(["display:flex;align-items:center;justify-content:center;svg{width:20px;min-width:20px;height:20px;}"]),Te=I.div.withConfig({componentId:"sc-17n125n-2"})(["font-weight:",";font-size:0.9rem;"],({isCurrent:e})=>e?500:400),Ve=({route:e,collapsed:a=!1,disabled:n=!1,isCurrent:d=!1})=>{if(!e)return s.jsx(z,{children:"Ссылка не определена"});const{path:r,title:i,icon:u,color:o,shortTitle:t}=e,l=f=>{if(n)return f.preventDefault()};return s.jsx(Ue,{collapsed:a,disabled:n,isCurrent:d,to:r,title:t!=null?t:i,color:o,onClick:l,children:s.jsxs(C,{gap:"8px",children:[s.jsx(Le,{children:u}),!a&&s.jsx(Te,{isCurrent:d,children:t!=null?t:i})]})})},B=({handleReturnToMySchedule:e,baseSearchValue:a,handleValue:n,onHintClick:d,isSideMenuOpen:r})=>{var f;const{data:{searchValue:i,filter:u}}=V.useSchedule(),o=$(),{data:{user:t}}=T.useUser(),l=(t==null?void 0:t.user_status)==="staff";return s.jsxs(s.Fragment,{children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(z,{children:"Группа или преподаватель"}),s.jsx(_e,{value:i,setValue:n,onHintClick:d})]}),a!==i&&s.jsx(q,{text:r&&"Мое расписание",onClick:e,icon:s.jsx(te,{}),background:"var(--block)",textColor:"var(--blue)"}),s.jsx(xe,{margin:"16px 0",width:"100%"}),s.jsx(C,{d:"column",gap:"2px",ai:"flex-start",children:Object.keys((f=b)!=null?f:{}).map(p=>{const c=b[p],{id:m,path:S}=c,g=u?`${S}/${u}`:S;return m==="schedule-session"&&l?null:s.jsx(Ve,{collapsed:!r,isCurrent:o.pathname===g,route:P(O({},c),{path:g})},m)})})]})},Fe=()=>{var F,D;const{data:{user:e}}=T.useUser(),{data:{filter:a,view:n,errorInData:d}}=V.useSchedule(),{isTablet:r,isMobile:i}=fe(),[u,o]=v.useState(!0),t=$(),l=ne(),f=t.pathname!==Se,p=t.pathname.split("/"),c=p.length===4?p[p.length-1]:null,m=c?/\d/.test(c):!1,S=(e==null?void 0:e.user_status)==="staff"?(F=e==null?void 0:e.fullName)!=null?F:"":(D=e==null?void 0:e.group)!=null?D:"",g=t.pathname.includes(ge),R=t.pathname.includes(me),j=g||R,{open:w}=Ee(),E=()=>{a&&l.push(U(L,{page:t.pathname.split("/")[2]})),x.setSearchValue(S),x.setFilter(""),x.resetExternalSchedule()};v.useLayoutEffect(()=>{n===G.month&&!j&&x.changeView(G.day)},[n,j]),v.useEffect(()=>{o(!(i||r))},[r,i]),v.useEffect(()=>{c?(x.setFilter(c),x.setSearchValue(c),m?_.getGroupScheduleFx({group:c}):_.getTeacherScheduleFx({fullName:c})):E()},[c]),v.useEffect(()=>()=>{x.resetExternalSchedule()},[]);const y=()=>{_.getScheduleFx(e)},M=()=>h=>{(h==null?void 0:h.id)===(e==null?void 0:e.group)&&E(),h!=null&&h.id&&(t.pathname.split("/")[2]==="retake"?l.push(U(L,{page:"current",filter:h.value})):l.push(U(L,{page:t.pathname.split("/")[2],filter:h.value})))},k=h=>{x.setSearchValue(h)};return{isSideMenuOpen:u,shouldShowSlider:f,isMobile:i,isSessionPage:g,baseSearchValue:S,showMonth:j,handleErrorClick:()=>{je.evokePopUpMessage({message:d,type:"failure",time:ve.ten_seconds})},handleValue:k,onHintClick:M,handleReturnToMySchedule:E,handleLoad:y,handleOpenSideMenu:()=>{i?w(s.jsx(C,{d:"column",gap:"8px",ai:"flex-start",children:s.jsx(B,{isSideMenuOpen:!0,baseSearchValue:S,handleReturnToMySchedule:E,onHintClick:M,handleValue:k})})):o(h=>!h)}}},De=I.div.withConfig({componentId:"sc-sh5ff8-0"})(["min-width:",";width:",";padding-right:10px;height:calc(100vh - var(--header-height) - 112px);display:flex;z-index:10;gap:8px;flex-direction:column;align-items:",";","{display:none;}"],({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"210px":"60px",({isSideMenuOpen:e})=>e?"flex-start":"center",Ce.isMobile),He=e=>s.jsx(De,{isSideMenuOpen:e.isSideMenuOpen,children:s.jsx(B,O({},e))}),qe=()=>{var w;const{data:{view:e,schedule:a,externalSchedule:n,errorInData:d},loading:r,error:i}=V.useSchedule(),{allRoutes:u}=we.useMenu(),{isSideMenuOpen:o,shouldShowSlider:t,showMonth:l,baseSearchValue:f,isMobile:p,onHintClick:c,handleValue:m,handleReturnToMySchedule:S,handleLoad:g,handleOpenSideMenu:R,handleErrorClick:j}=Fe();return s.jsx(Me,{loading:r,load:g,error:i,data:r?n:a,children:s.jsx(ke,{topCenterElement:t&&s.jsx(be,{size:"small",sliderWidth:"240px",pages:l?Ie:Re,currentPage:e,appearance:!p,setCurrentPage:x.changeView}),topRightCornerElement:s.jsxs(C,{w:"fit-content",gap:"20px",children:[s.jsx(Oe,{visible:!!d,onClick:j}),s.jsx(q,{icon:p?s.jsx(ae,{}):s.jsx(re,{}),width:"36px",height:"36px",onClick:R})]}),children:u&&s.jsxs(C,{gap:"16px",ai:"flex-start",children:[!p&&s.jsx(He,{isSideMenuOpen:o,baseSearchValue:f,handleReturnToMySchedule:S,onHintClick:c,handleValue:m}),s.jsxs(ie,{children:[Object.keys((w=b)!=null?w:{}).map(E=>{const{path:y,id:M,Component:k}=b[E];return s.jsx(oe,{path:y,children:s.jsx(k,{})},M)}),s.jsx(le,{to:ye})]})]})})})};export{qe as default};
