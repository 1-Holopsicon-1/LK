import{q as l,j as t,r as p}from"./vendor-48260ac4.js";import{aY as o,G as x,i as y,h as T,X as w,p as A,aw as b,ap as V,aZ as q,aO as S,B as E,F as I,V as O,S as $,x as k,a1 as N,a_ as B,a$ as U,N as P,b0 as R,d as W,as as D}from"./index-d80b411e.js";import{F as z}from"./index-8c876568.js";const _=({subordinate:{employeeId:e,employeeName:r,divisionName:a,position:n,employmentType:u,rate:i}})=>{const{addItem:m,removeItem:j,setValue:d,value:g}=l(o.employees),s=g.find(c=>c.id===e),h=!!s;return t.jsxs(x,{gap:"0.5rem",onClick:()=>h?j(e):m(e),cursor:"pointer",brad:"0.5rem",hoverBackground:"var(--theme-5)",p:"0.5rem",ai:"flex-start",children:[t.jsx(y,{checked:h,setChecked:()=>h?j(e):m(e)}),t.jsxs(x,{gap:"0.5rem",d:"column",ai:"flex-start",children:[t.jsx(T,{align:"left",size:4,children:r}),t.jsx(w,{children:a}),t.jsx(w,{children:n}),t.jsxs(w,{children:[u,i&&` (ставка: ${i})`]}),h&&t.jsxs(x,{jc:"space-between",ai:"flex-end",gap:"0.5rem",onClick:c=>c.stopPropagation(),cursor:"auto",children:[t.jsx(A,{title:"Сумма",value:(s==null?void 0:s.sum)||"",setValue:c=>{s&&d({...s,sum:c})},type:"number",required:!0,width:"38%",placeholder:"Сумма выплаты",isActive:h}),t.jsx(A,{title:"Дата начала",value:(s==null?void 0:s.startDate)||"",setValue:c=>{s&&d({...s,startDate:c})},type:"date",required:!0,width:"30%",isActive:h}),t.jsx(A,{title:"Дата окончания",value:(s==null?void 0:s.endDate)||"",setValue:c=>{s&&d({...s,endDate:c})},type:"date",required:!0,width:"30%",minValue:s==null?void 0:s.startDate,isActive:h})]})]})]})},ie=()=>{const[e,r,a,n,u,i,m,j]=l([b.role.$pending,V.createSupplement,q.createSupplement.$pending,V.pageMounted,S.roles,S.completed,V.setCompleted,S.isActive]),d=i??!1,g=!u.includes("Initiator");return p.useEffect(()=>{g||n()},[]),e?t.jsx(E,{isDone:d,children:t.jsx(I,{noHeader:!0,children:t.jsx(x,{w:"100%",jc:"center",ai:"center",children:t.jsx(O,{})})})}):g?t.jsx(z,{text:"У вас нет доступа к этому разделу"}):t.jsx(E,{isDone:d,children:t.jsxs(I,{noHeader:!0,children:[t.jsx(H,{}),t.jsx(Y,{}),t.jsx(G,{}),t.jsx(J,{}),t.jsx(X,{}),t.jsx(Z,{}),t.jsx(K,{}),t.jsx(te,{}),t.jsx($,{text:d?"Отправлено":"Отправить",action:r,isLoading:a,completed:i,setCompleted:m,repeatable:!1,buttonSuccessText:"Отправлено",isDone:d,isActive:j,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})};function H(){const{value:e,setValue:r}=l(o.job),a=l(b.role.$data);if(!a)return null;const n=p.useMemo(()=>a.filter(u=>u.roles.includes("Initiator")).map(u=>({id:u.employeeId,title:u.division})),a);return p.useEffect(()=>{n.length===1&&r(n[0])},[n]),t.jsx(k,{title:"Должность / Подразделение",items:n,selected:n.length===1?n[0]:e,setSelected:r,isActive:n.length>1,required:!0,width:"100%"})}function Y(){const e=l(S.sourcesOfFunding),{value:r,setValue:a}=l(o.sourceOfFunding);return p.useEffect(()=>{e.length===1&&a(e[0])},[e]),t.jsx(k,{title:"Источник финансирования",items:e,selected:r,setSelected:a,isActive:e.length>1,width:"100%",withSearch:!0,placeholder:"Источник финансирования"})}function G(){const e=l(S.paymentIdentifiers),{value:r,setValue:a}=l(o.paymentIdentifier);return p.useEffect(()=>{e.length===1&&a(e[0])},[e]),t.jsx(k,{title:"Вид набавки",items:e,selected:r,setSelected:a,isActive:e.length>1,required:!0,width:"100%",withSearch:!0,placeholder:"Вид набавки"})}function J(){const{startDate:e,setStartDate:r,endDate:a,setEndDate:n}=l(o.period);return t.jsxs(x,{jc:"space-between",gap:"0.5rem",children:[t.jsx(A,{title:"Дата начала",value:e,setValue:r,type:"date",required:!0,width:"49%"}),t.jsx(A,{title:"Дата окончания",value:a,setValue:n,type:"date",required:!0,width:"49%",minValue:e})]})}function X(){const{value:e,setValue:r}=l(o.commentary);return t.jsx(N,{title:"Комментарий",placeholder:"Комментарий",value:e,setValue:r})}function Z(){const[e,r,a,n,u]=l([S.employees,o.employees.value,o.employees.allSelected,o.employees.selectAll,o.employees.deselectAll]),{value:i}=l(o.job),[m,j]=p.useState(!0),[d,g]=p.useState(!1),[s,h]=p.useState(""),[c,L]=p.useState(!1),M=p.useMemo(()=>{if(!e||!i)return[];const v=r.map(f=>f.id),C=c?e[i==null?void 0:i.id].filter(f=>v.includes(f.employeeId)):e[i==null?void 0:i.id];if(!s)return C;const F=s.toLowerCase();return C.filter(f=>f.employeeName.toLowerCase().includes(F)||f.divisionName.toLowerCase().includes(F)||f.position.toLowerCase().includes(F))},[e,i,s,c,r]);return t.jsxs(B,{openArea:m,children:[t.jsx(U,{title:"Сотрудники",included:d,optional:!1,setOpenArea:j,setIncluded:g,collapsed:!1,openArea:m}),t.jsx("div",{className:"inputs",children:i&&e?t.jsxs(x,{gap:"1.5rem",ai:"flex-start",d:"column",children:[t.jsx(P,{value:s,setValue:h,placeholder:"Поиск по сотрудникам"}),t.jsxs(x,{gap:"0.5rem",ai:"flex-start",d:"column",children:[t.jsx(y,{checked:c,setChecked:L,text:"Отобразить только выбранных"}),t.jsx(y,{checked:a,setChecked:v=>{v?n(e[i==null?void 0:i.id].map(C=>C.employeeId)):u()},text:"Выбрать всех"})]}),t.jsx(x,{gap:"1rem",ai:"flex-start",d:"column",children:M.map(v=>t.jsx(_,{subordinate:v},v.employeeId))})]}):t.jsx(w,{children:"Выберите должность"})})]})}function K(){const{value:e,setValue:r}=l(o.files),a=l(q.uploadFile.$pending);return t.jsx(R,{files:e,formats:["doc","pdf","docx"],setFiles:n=>{if(e.length<n.length&&e.some(u=>u.name===n[n.length-1].name)){W.evokePopUpMessage({message:"Имя файла не может повторятся",type:"failure"});return}r(n)},isActive:!a})}const Q={fiveToNine:"сотрудников",one:"сотрудник",twoToFour:"сотрудника",zero:"сотрудников"},ee={fiveToNine:"Добавлено",one:"Добавлен",twoToFour:"Добавлено",zero:"Добавлено"};function te(){const e=l(o.employees.value);return t.jsxs(w,{children:[D(Math.trunc(e==null?void 0:e.length),ee)," ",e==null?void 0:e.length," ",D(Math.trunc(e==null?void 0:e.length),Q)]})}export{ie as default};
