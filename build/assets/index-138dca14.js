import{p as d,e as q,x as o,s as a,r as m,j as t,n as x,bs as O,h as S,v as b,a5 as ce,K as pe,cN as ue,c as me}from"./vendor-08ab745b.js";import{m as xe,n as ge,d as W,o as he,p as fe,q as y,u as k,h as V,r as $,t as H,v as B,w as K,x as je,y as Ce,z as Se,D as ye,b as ve,E as we,G as c,K as g,H as ke,J as $e,L as C,N as Ee,O as Ge,Q as be,R as Ie,U as Pe,V as Ne,X as Fe,M as De,Y as Te,Z as Ae,_ as Le,P as Re,a0 as Me}from"./index-0892b83f.js";import{e as I,s as _e,a as ze,b as Q,c as h,d as Ue,f as P,h as X,g as qe,A as Oe,i as w,j as We,k as Ve,P as R}from"./student-518215af.js";const Y=d({name:"addCompetition",sid:"ebmam4"}),v=q(e=>xe(e.competitionName),{name:"addCompetitionFx",sid:"-cvy5ax"});o({and:[{clock:Y,target:v}],or:{sid:"-pbpeie"}});o({and:[{clock:v.failData,fn:e=>({message:ge(e,"Не удалось добавить соревнование"),type:"failure",time:3e3}),target:W.evokePopUpMessage}],or:{sid:"-p9i84y"}});o({and:[{clock:v.doneData,fn:()=>({message:"Соревнование добавлено",type:"success",time:3e3}),target:W.evokePopUpMessage}],or:{sid:"-orwt5e"}});o({and:[{clock:v.doneData,target:I.load}],or:{sid:"-oabe5u"}});o({and:[{clock:v.doneData,target:he.close}],or:{sid:"-nwkjbt"}});const He=a.div.withConfig({componentId:"sc-apfm2h-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;justify-content:center;min-height:300px;@media (max-width:800px){min-height:40vh;}"]),Be=()=>{const[e,s]=m.useState(""),n=()=>{Y({competitionName:e})};return t.jsxs(He,{children:[t.jsx(fe,{title:"Название",setValue:s,value:e}),t.jsx(y,{text:"Добавить",onClick:n})]})},Ke=[{field:"name",title:"Название"},{field:"name",title:"",render:e=>t.jsx(y,{onClick:()=>I.remove(e),text:"Удалить"})}],Qe=a.div.withConfig({componentId:"sc-17yyi1s-0"})(["width:100%;display:flex;flex-direction:column;gap:10px;margin-top:20px;"]),Xe=a.div.withConfig({componentId:"sc-17yyi1s-1"})(["display:flex;flex-direction:column;width:100%;gap:10px;"]);a.div.withConfig({componentId:"sc-17yyi1s-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;gap:10px;"]);const Ye=()=>{const[e]=x([_e.$competitions]),{open:s}=k(),n=()=>{s(t.jsx(Be,{}))};return m.useEffect(()=>{I.load()},[]),t.jsx(Xe,{children:t.jsxs(Qe,{children:[t.jsx(V,{align:"left",size:4,children:"Соревнования"}),t.jsx(y,{onClick:n,text:"Добавить соревнование"}),t.jsx($,{data:e.map(r=>({name:r})),columns:Ke,onRowClick:()=>{}})]})})},Ze=a.div.withConfig({componentId:"sc-12vwvep-0"})(["display:flex;flex-direction:row;align-items:center;gap:10px;@media (max-width:768px){flex-wrap:wrap;}"]);var Z=(e=>(e.Group="group.groupName",e.Course="course",e))(Z||{});const M=[{id:0,title:"Не выбрано"},{id:1,title:"1 курс"},{id:2,title:"2 курс"},{id:3,title:"3 курс"},{id:4,title:"4 курс"}],Je=()=>{const[e,s]=x([ze.$filters,Q.$isExam]),[n,r]=m.useState(e["group.groupName"]?.value??"");return t.jsxs(Ze,{children:[t.jsx(H,{leftIcon:t.jsx(O,{}),placeholder:"Номер группы",value:n,setValue:r,customMask:B.groupMask,onValueEmpty:()=>h.addFilter({name:"group.groupName",value:""}),onHintClick:i=>h.addFilter({name:"group.groupName",value:i?.id??"",strict:!0}),request:K,size:"big"}),t.jsx(je,{items:M,size:"big",placeholder:"Курс",selected:M.find(i=>i.id===e.course?.value)??null,setSelected:i=>{if(i?.id){h.addFilter({name:"course",value:i.id});return}h.addFilter({name:"course",value:""})}}),t.jsx(Ce,{title:"Зачет",state:s,action:i=>Ue.setIsExam(i)})]})},N=d({name:"pageIndexChanged",sid:"-yqoz9l"}),J=d({name:"pageLoaded",sid:"adwljo"}),et=S(0,{name:"$page",sid:"ndbopj"}).on(N,(e,s)=>s);o({and:[{clock:J,target:[P.load,Se.load]}],or:{sid:"8a9ft4"}});const ee=d({name:"load",sid:"h6031v"}),te=b({and:{effect:async({currentUser:e})=>{const{data:s}=await ye(e?.guid??"");return s.data},source:ve.user},or:{name:"loadFx",sid:"-fzko9u"}});o({and:[{clock:ee,target:te}],or:{sid:"-b03ras"}});const tt=S([],{name:"$myGroups",sid:"qqeqg2"}).on(te.doneData,(e,s)=>s);function _(){const[e]=x([tt]);m.useEffect(()=>{ee()},[]);const s=n=>{h.resetFilters(),h.addFilter({name:Z.Group,value:n.groupName,strict:!0}),N(0)};return t.jsx($,{onRowClick:s,data:e,columns:st})}const st=[{field:"groupName",title:"Группа"},{field:"curatorFullName",title:"Преподаватель"}],nt=(e,s)=>{let n=e;for(const r in s)n=n.replace(`:${r}`,s[r]);return n};a.div.withConfig({componentId:"sc-10c5ztk-0"})(["min-height:50px;display:flex;gap:5px;flex-direction:column;"]);const ot=a.div.withConfig({componentId:"sc-10c5ztk-1"})(["","{width:500px;}"],we.isNotMobile),at=({student:e})=>{const s=ce(),{close:n}=k(),r=()=>{s.push(nt($e,{studentId:e.studentGuid})),n()};return t.jsx(ot,{children:t.jsxs(c,{d:"column",gap:"16px",ai:"flex-start",children:[t.jsxs(c,{d:"column",ai:"flex-start",gap:"2px",children:[t.jsx(g,{keyStr:"Группа",value:e.groupNumber}),t.jsx(g,{keyStr:"Баллы",value:e.totalPoints}),t.jsx(g,{keyStr:"Курс",value:e.course}),t.jsx(g,{keyStr:"ЛМС",value:e.lmsPoints}),t.jsx(g,{keyStr:"Группа здоровья",value:X[e.healthGroup]}),t.jsx(g,{keyStr:"Специализация",value:qe[e.specialization]})]}),t.jsx(ke,{width:"100%",margin:"0"}),t.jsxs(c,{d:"column",gap:"4px",ai:"flex-start",children:[t.jsx(V,{align:"left",size:4,children:"Дата"}),t.jsx(Oe,{studentGuid:e.studentGuid})]}),t.jsx(y,{onClick:r,text:"Перейти к студенту",width:"100%"})]})})},rt=a.div.withConfig({componentId:"sc-12o9ec3-0"})(["display:grid;width:100%;"]),it=a.div.withConfig({componentId:"sc-12o9ec3-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]),dt=a(c).withConfig({componentId:"sc-12o9ec3-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]),F=a.span.withConfig({componentId:"sc-12o9ec3-3"})(["color:",";"],({hasDebt:e})=>e&&C.red.main),lt=[{title:"ФИО",field:"fullName",priority:"one",showFull:!0,render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebt,children:s.fullName})},{title:"Группа",field:"groupNumber",priority:"one"},{title:"Посещений",field:"visits",priority:"two"},{title:"Баллы",field:"totalPoints",priority:"one"},{title:"Нормативы",field:"standardPoints",priority:"two"},{title:"ЛМС",field:"lmsPoints",priority:"two"},{title:"Группа здоровья",showFull:!0,field:"healthGroup",priority:"two",render:e=>{const s=X[e];return t.jsx("span",{children:s})}}],ct=[{title:"ФИО",field:"name",render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebt,children:s.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,s)=>s.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],se=d({name:"pageLoaded",sid:"-n45vlm"});o({and:[{clock:se,target:P.load}],or:{sid:"t4c48d"}});const z=()=>{const{open:e}=k(),{students:s,totalCount:n,page:r,search:i,loading:f,isExam:G}=x({students:w.$pEStudents,loading:w.$loading,totalCount:w.$pEStudentsTotalCount,page:w.$pEStudentsPage,search:We.$search,isExam:Q.$isExam});return m.useEffect(()=>{se()},[]),t.jsx(rt,{children:t.jsxs(it,{children:[t.jsxs(dt,{children:[t.jsx(Ee,{value:i,setValue:Ve.update,size:"big"}),t.jsx(Je,{})]}),t.jsx($,{loading:f,data:s,columns:G?ct:lt,onRowClick:j=>{e(t.jsx(at,{student:j}),j.fullName)}}),t.jsx(Ge,{condition:!0,align:"right",pages:Math.floor(n/be),currentPage:r,setCurrentPage:P.setPage})]})})},D=d({name:"endSemester",sid:"-50inz6"}),ne=d({name:"reset",sid:"-jpbmuk"}),E=q(async({studentId:e})=>(await Ie(e),{studentGuid:e}),{name:"endSemesterFx",sid:"yxjzgs"});var p=(e=>(e.LOADING="loading",e.SUCCESS="success",e.ERROR="error",e))(p||{});const u=S({},{name:"$statuses",sid:"-dggygt"}).reset(ne);o({and:[{clock:D,source:u,fn:(e,{studentId:s})=>({...e,[s]:"loading"}),target:u}],or:{sid:"77dp82"}});o({and:[{clock:E.doneData,source:u,fn:(e,{studentGuid:s})=>({...e,[s]:"success"}),target:u}],or:{sid:"7q2pec"}});o({and:[{clock:E.fail,source:u,fn:(e,{params:s})=>({...e,[s.studentId]:"error"}),target:u}],or:{sid:"88rpkm"}});o({and:[{clock:E.done,source:u,fn:(e,{params:s})=>({...e,[s.studentId]:"success"}),target:u}],or:{sid:"8rgpqw"}});o({and:[{clock:D,target:E}],or:{sid:"9lpedr"}});const pt={endSemester:D,reset:ne},oe={statuses:u},ae=d({name:"selectedGroupChanged",sid:"-yusgt0"}),re=d({name:"load",sid:"4qbbdm"}),T=d({name:"reset",sid:"g7h26n"}),ie=d({name:"endSemesterForGroup",sid:"842241"}),A=S("",{name:"$selectedGroup",sid:"-n8kqn6"}).on(ae,(e,s)=>s).reset(T),L=b({and:{source:A,effect:async e=>{const{data:s}=await Pe(0,{group:{value:e}},200);return s.data.students}},or:{name:"loadFx",sid:"xfnq33"}});o({and:[{source:A,filter:Boolean,target:L}],or:{sid:"gule9"}});const de=S([],{name:"$pEStudents",sid:"-7tia7t"}).on(L.doneData,(e,s)=>s).reset(T),ut=pe({and:[L.pending,Boolean],or:{name:"$loading",sid:"ghro6d"}}),mt=b({and:{source:de,effect:async e=>{e.forEach(s=>pt.endSemester({studentId:s.studentGuid}))}},or:{name:"endSemesterForGroupFx",sid:"3q6tp7"}});o({and:[{clock:oe.statuses,filter:e=>Object.values(e).every(s=>s!==p.LOADING),target:re}],or:{sid:"10n6r9"}});o({and:[{clock:ie,target:mt}],or:{sid:"1exu6n"}});const xt={load:re,reset:T,selectedGroupChanged:ae,endSemesterForGroup:ie},gt={$loading:ut,$pEStudents:de,$selectedGroup:A},l={events:xt,stores:gt},ht={[p.LOADING]:"Загрузка",[p.ERROR]:"Не зачтено",[p.SUCCESS]:"Успешно"},ft={[p.LOADING]:t.jsx(Ne,{}),[p.ERROR]:t.jsx(ue,{color:C.red.main}),[p.SUCCESS]:t.jsx(me,{color:C.green.main})},jt=a.span.withConfig({componentId:"sc-ph8uia-0"})(["color:var(--text);font-size:1em;"]),Ct=()=>{const[e,s]=x([oe.statuses,l.stores.$pEStudents]);return t.jsx(c,{p:"30px",d:"column",jc:"space-between",children:s.map(n=>t.jsxs(c,{w:"100%",gap:"16px",ai:"flex-start",jc:"space-between",children:[t.jsx(jt,{children:n.fullName}),t.jsxs(c,{gap:"8px",w:"auto",children:[t.jsx(Fe,{align:"center",children:ht[e[n.studentGuid]??p.LOADING]}),ft[e[n.studentGuid]??p.LOADING]]})]},n.studentGuid))})},le=d({name:"pageLoaded",sid:"4q0med"}),St=d({name:"pageUnloaded",sid:"he5rd5"});o({and:[{clock:le,target:l.events.load}],or:{sid:"74c8dr"}});o({and:[{clock:St,target:l.events.reset}],or:{sid:"76jer7"}});const yt=a.div.withConfig({componentId:"sc-s6hadh-0"})(["display:grid;width:100%;"]),vt=a.div.withConfig({componentId:"sc-s6hadh-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]);a(c).withConfig({componentId:"sc-s6hadh-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]);const wt=a(c).withConfig({componentId:"sc-s6hadh-3"})([""]),kt=[{title:"ФИО",field:"name",render:(e,s)=>t.jsx(F,{hasDebt:s.hasDebtFromPreviousSemester,children:s.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,s)=>s.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],U=()=>{const{open:e,close:s}=k(),{students:n,loading:r,selectedGroup:i}=x({students:l.stores.$pEStudents,loading:l.stores.$loading,selectedGroup:l.stores.$selectedGroup}),f=!!(n.length&&!r&&i),G=()=>{Te.evokeConfirm({message:"Вы уверены, что хотите завершить семестр?",onConfirm:()=>{l.events.endSemesterForGroup(),e(t.jsx(Ct,{}))},onReject:()=>{s(),l.events.reset()}})};return m.useEffect(()=>(le(),()=>{l.events.reset()}),[]),t.jsxs(yt,{children:[!f&&t.jsx(De,{type:"alert",children:"Выберите группу чтобы провести зачет"}),t.jsxs(vt,{children:[t.jsxs(wt,{d:"row",jc:"space-between",p:"8px",children:[t.jsx(H,{leftIcon:t.jsx(O,{}),placeholder:"Номер группы",value:i,setValue:l.events.selectedGroupChanged,customMask:B.groupMask,onValueEmpty:()=>l.events.selectedGroupChanged(""),onHintClick:j=>j&&l.events.selectedGroupChanged(j.id),request:K,size:"big"}),f&&t.jsx(y,{text:`Завершить семестр для ${i}`,width:"210px",background:C.green.main,textColor:C.white.main,onClick:G})]}),f&&t.jsx($,{loading:r,data:n,columns:kt})]})]})},bt=()=>{const[e,s]=x([Ae.peTeacher,et]);m.useEffect(()=>{J()},[]);const n=[R.AdminAccess,R.SuperUser].some(r=>e?.permissions?.includes(r))?[{title:"Студенты",content:t.jsx(z,{})},{title:"Управление",content:t.jsx(Ye,{})},{title:"Мои Группы",content:t.jsx(_,{})},{title:"Проведение зачета",content:t.jsx(U,{})}]:[{title:"Студенты",content:t.jsx(z,{})},{title:"Мои Группы",content:t.jsx(_,{})},{title:"Проведение зачета",content:t.jsx(U,{})}];return t.jsx(Le,{padding:"10px",children:t.jsx(Re,{children:t.jsxs(c,{d:"column",gap:"2px",ai:"flex-start",children:[t.jsx(Me,{appearance:!1,pages:n,currentPage:s,setCurrentPage:N}),n[s].content]})})})};export{bt as default};
