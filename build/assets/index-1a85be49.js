var fe=Object.defineProperty,je=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var U=(e,t,n)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,S=(e,t)=>{for(var n in t||(t={}))Ce.call(t,n)&&U(e,n,t[n]);if(O)for(var n of O(t))Se.call(t,n)&&U(e,n,t[n]);return e},y=(e,t)=>je(e,ve(t));var w=(e,t,n)=>new Promise((o,r)=>{var p=l=>{try{a(n.next(l))}catch(F){r(F)}},h=l=>{try{a(n.throw(l))}catch(F){r(F)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(p,h);a((n=n.apply(e,t)).next())});import{p as c,e as Q,x as i,s as d,r as f,j as s,q as j,bs as X,h as k,v as T,a5 as ye,K as we,cN as $e,c as ke}from"./vendor-00bea631.js";import{m as Ee,n as Ge,d as Y,o as be,p as Ie,q as E,u as I,h as Z,r as P,t as J,v as ee,w as te,x as Pe,y as Ne,z as Fe,D as Te,b as De,E as Ae,G as m,K as v,H as _e,J as Le,L as $,N as Re,O as Me,Q as ze,R as qe,U as Oe,V as Ue,X as We,M as Ve,Y as He,Z as Be,_ as Ke,P as Qe,a0 as Xe}from"./index-d824e111.js";import{e as D,s as Ye,a as Ze,b as se,c as C,d as Je,f as A,h as ne,g as et,A as tt,i as b,j as st,k as nt,P as W}from"./student-cd697d04.js";const oe=c({name:"addCompetition",sid:"ebmam4"}),G=Q(e=>Ee(e.competitionName),{name:"addCompetitionFx",sid:"-cvy5ax"});i({and:[{clock:oe,target:G}],or:{sid:"-pbpeie"}});i({and:[{clock:G.failData,fn:e=>({message:Ge(e,"Не удалось добавить соревнование"),type:"failure",time:3e3}),target:Y.evokePopUpMessage}],or:{sid:"-p9i84y"}});i({and:[{clock:G.doneData,fn:()=>({message:"Соревнование добавлено",type:"success",time:3e3}),target:Y.evokePopUpMessage}],or:{sid:"-orwt5e"}});i({and:[{clock:G.doneData,target:D.load}],or:{sid:"-oabe5u"}});i({and:[{clock:G.doneData,target:be.close}],or:{sid:"-nwkjbt"}});const ot=d.div.withConfig({componentId:"sc-apfm2h-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;justify-content:center;min-height:300px;@media (max-width:800px){min-height:40vh;}"]),at=()=>{const[e,t]=f.useState(""),n=()=>{oe({competitionName:e})};return s.jsxs(ot,{children:[s.jsx(Ie,{title:"Название",setValue:t,value:e}),s.jsx(E,{text:"Добавить",onClick:n})]})},it=[{field:"name",title:"Название"},{field:"name",title:"",render:e=>s.jsx(E,{onClick:()=>D.remove(e),text:"Удалить"})}],rt=d.div.withConfig({componentId:"sc-17yyi1s-0"})(["width:100%;display:flex;flex-direction:column;gap:10px;margin-top:20px;"]),dt=d.div.withConfig({componentId:"sc-17yyi1s-1"})(["display:flex;flex-direction:column;width:100%;gap:10px;"]);d.div.withConfig({componentId:"sc-17yyi1s-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;gap:10px;"]);const lt=()=>{const[e]=j([Ye.$competitions]),{open:t}=I(),n=()=>{t(s.jsx(at,{}))};return f.useEffect(()=>{D.load()},[]),s.jsx(dt,{children:s.jsxs(rt,{children:[s.jsx(Z,{align:"left",size:4,children:"Соревнования"}),s.jsx(E,{onClick:n,text:"Добавить соревнование"}),s.jsx(P,{data:e.map(o=>({name:o})),columns:it,onRowClick:()=>{}})]})})},ct=d.div.withConfig({componentId:"sc-12vwvep-0"})(["display:flex;flex-direction:row;align-items:center;gap:10px;@media (max-width:768px){flex-wrap:wrap;}"]);var ae=(e=>(e.Group="group.groupName",e.Course="course",e))(ae||{});const V=[{id:0,title:"Не выбрано"},{id:1,title:"1 курс"},{id:2,title:"2 курс"},{id:3,title:"3 курс"},{id:4,title:"4 курс"}],ut=()=>{var p,h;var e;const[t,n]=j([Ze.$filters,se.$isExam]),[o,r]=f.useState((p=(e=t["group.groupName"])===null||e===void 0?void 0:e.value)!=null?p:"");return s.jsxs(ct,{children:[s.jsx(J,{leftIcon:s.jsx(X,{}),placeholder:"Номер группы",value:o,setValue:r,customMask:ee.groupMask,onValueEmpty:()=>C.addFilter({name:"group.groupName",value:""}),onHintClick:a=>{var l;return C.addFilter({name:"group.groupName",value:(l=a==null?void 0:a.id)!=null?l:"",strict:!0})},request:te,size:"big"}),s.jsx(Pe,{items:V,size:"big",placeholder:"Курс",selected:(h=V.find(a=>{var l;return a.id===((l=t.course)===null||l===void 0?void 0:l.value)}))!=null?h:null,setSelected:a=>{if(a!=null&&a.id){C.addFilter({name:"course",value:a.id});return}C.addFilter({name:"course",value:""})}}),s.jsx(Ne,{title:"Зачет",state:n,action:a=>Je.setIsExam(a)})]})},_=c({name:"pageIndexChanged",sid:"-yqoz9l"}),ie=c({name:"pageLoaded",sid:"adwljo"}),pt=k(0,{name:"$page",sid:"ndbopj"}).on(_,(e,t)=>t);i({and:[{clock:ie,target:[A.load,Fe.load]}],or:{sid:"8a9ft4"}});const re=c({name:"load",sid:"h6031v"}),de=T({and:{effect:t=>w(void 0,[t],function*({currentUser:e}){var o;const{data:n}=yield Te((o=e==null?void 0:e.guid)!=null?o:"");return n.data}),source:De.user},or:{name:"loadFx",sid:"-fzko9u"}});i({and:[{clock:re,target:de}],or:{sid:"-b03ras"}});const mt=k([],{name:"$myGroups",sid:"qqeqg2"}).on(de.doneData,(e,t)=>t);function H(){const[e]=j([mt]);f.useEffect(()=>{re()},[]);const t=n=>{C.resetFilters(),C.addFilter({name:ae.Group,value:n.groupName,strict:!0}),_(0)};return s.jsx(P,{onRowClick:t,data:e,columns:xt})}const xt=[{field:"groupName",title:"Группа"},{field:"curatorFullName",title:"Преподаватель"}],gt=(e,t)=>{let n=e;for(const o in t)n=n.replace(`:${o}`,t[o]);return n};d.div.withConfig({componentId:"sc-10c5ztk-0"})(["min-height:50px;display:flex;gap:5px;flex-direction:column;"]);const ht=d.div.withConfig({componentId:"sc-10c5ztk-1"})(["","{width:500px;}"],Ae.isNotMobile),ft=({student:e})=>{const t=ye(),{close:n}=I(),o=()=>{t.push(gt(Le,{studentId:e.studentGuid})),n()};return s.jsx(ht,{children:s.jsxs(m,{d:"column",gap:"16px",ai:"flex-start",children:[s.jsxs(m,{d:"column",ai:"flex-start",gap:"2px",children:[s.jsx(v,{keyStr:"Группа",value:e.groupNumber}),s.jsx(v,{keyStr:"Баллы",value:e.totalPoints}),s.jsx(v,{keyStr:"Курс",value:e.course}),s.jsx(v,{keyStr:"ЛМС",value:e.lmsPoints}),s.jsx(v,{keyStr:"Группа здоровья",value:ne[e.healthGroup]}),s.jsx(v,{keyStr:"Специализация",value:et[e.specialization]})]}),s.jsx(_e,{width:"100%",margin:"0"}),s.jsxs(m,{d:"column",gap:"4px",ai:"flex-start",children:[s.jsx(Z,{align:"left",size:4,children:"Дата"}),s.jsx(tt,{studentGuid:e.studentGuid})]}),s.jsx(E,{onClick:o,text:"Перейти к студенту",width:"100%"})]})})},jt=d.div.withConfig({componentId:"sc-12o9ec3-0"})(["display:grid;width:100%;"]),vt=d.div.withConfig({componentId:"sc-12o9ec3-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]),Ct=d(m).withConfig({componentId:"sc-12o9ec3-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]),L=d.span.withConfig({componentId:"sc-12o9ec3-3"})(["color:",";"],({hasDebt:e})=>e&&$.red.main),St=[{title:"ФИО",field:"fullName",priority:"one",showFull:!0,render:(e,t)=>s.jsx(L,{hasDebt:t.hasDebt,children:t.fullName})},{title:"Группа",field:"groupNumber",priority:"one"},{title:"Посещений",field:"visits",priority:"two"},{title:"Баллы",field:"totalPoints",priority:"one"},{title:"Нормативы",field:"standardPoints",priority:"two"},{title:"ЛМС",field:"lmsPoints",priority:"two"},{title:"Группа здоровья",showFull:!0,field:"healthGroup",priority:"two",render:e=>{const t=ne[e];return s.jsx("span",{children:t})}}],yt=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(L,{hasDebt:t.hasDebt,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],le=c({name:"pageLoaded",sid:"-n45vlm"});i({and:[{clock:le,target:A.load}],or:{sid:"t4c48d"}});const B=()=>{const{open:e}=I(),{students:t,totalCount:n,page:o,search:r,loading:p,isExam:h}=j({students:b.$pEStudents,loading:b.$loading,totalCount:b.$pEStudentsTotalCount,page:b.$pEStudentsPage,search:st.$search,isExam:se.$isExam});return f.useEffect(()=>{le()},[]),s.jsx(jt,{children:s.jsxs(vt,{children:[s.jsxs(Ct,{children:[s.jsx(Re,{value:r,setValue:nt.update,size:"big"}),s.jsx(ut,{})]}),s.jsx(P,{loading:p,data:t,columns:h?yt:St,onRowClick:a=>{e(s.jsx(ft,{student:a}),a.fullName)}}),s.jsx(Me,{condition:!0,align:"right",pages:Math.floor(n/ze),currentPage:o,setCurrentPage:A.setPage})]})})},R=c({name:"endSemester",sid:"-50inz6"}),ce=c({name:"reset",sid:"-jpbmuk"}),N=Q(t=>w(void 0,[t],function*({studentId:e}){return yield qe(e),{studentGuid:e}}),{name:"endSemesterFx",sid:"yxjzgs"});var x=(e=>(e.LOADING="loading",e.SUCCESS="success",e.ERROR="error",e))(x||{});const g=k({},{name:"$statuses",sid:"-dggygt"}).reset(ce);i({and:[{clock:R,source:g,fn:(e,{studentId:t})=>y(S({},e),{[t]:"loading"}),target:g}],or:{sid:"77dp82"}});i({and:[{clock:N.doneData,source:g,fn:(e,{studentGuid:t})=>y(S({},e),{[t]:"success"}),target:g}],or:{sid:"7q2pec"}});i({and:[{clock:N.fail,source:g,fn:(e,{params:t})=>y(S({},e),{[t.studentId]:"error"}),target:g}],or:{sid:"88rpkm"}});i({and:[{clock:N.done,source:g,fn:(e,{params:t})=>y(S({},e),{[t.studentId]:"success"}),target:g}],or:{sid:"8rgpqw"}});i({and:[{clock:R,target:N}],or:{sid:"9lpedr"}});const wt={endSemester:R,reset:ce},ue={statuses:g},pe=c({name:"selectedGroupChanged",sid:"-yusgt0"}),me=c({name:"load",sid:"4qbbdm"}),M=c({name:"reset",sid:"g7h26n"}),xe=c({name:"endSemesterForGroup",sid:"842241"}),z=k("",{name:"$selectedGroup",sid:"-n8kqn6"}).on(pe,(e,t)=>t).reset(M),q=T({and:{source:z,effect:e=>w(void 0,null,function*(){const{data:t}=yield Oe(0,{group:{value:e}},200);return t.data.students})},or:{name:"loadFx",sid:"xfnq33"}});i({and:[{source:z,filter:Boolean,target:q}],or:{sid:"gule9"}});const ge=k([],{name:"$pEStudents",sid:"-7tia7t"}).on(q.doneData,(e,t)=>t).reset(M),$t=we({and:[q.pending,Boolean],or:{name:"$loading",sid:"ghro6d"}}),kt=T({and:{source:ge,effect:e=>w(void 0,null,function*(){e.forEach(t=>wt.endSemester({studentId:t.studentGuid}))})},or:{name:"endSemesterForGroupFx",sid:"3q6tp7"}});i({and:[{clock:ue.statuses,filter:e=>Object.values(e).every(t=>t!==x.LOADING),target:me}],or:{sid:"10n6r9"}});i({and:[{clock:xe,target:kt}],or:{sid:"1exu6n"}});const Et={load:me,reset:M,selectedGroupChanged:pe,endSemesterForGroup:xe},Gt={$loading:$t,$pEStudents:ge,$selectedGroup:z},u={events:Et,stores:Gt},bt={[x.LOADING]:"Загрузка",[x.ERROR]:"Не зачтено",[x.SUCCESS]:"Успешно"},It={[x.LOADING]:s.jsx(Ue,{}),[x.ERROR]:s.jsx($e,{color:$.red.main}),[x.SUCCESS]:s.jsx(ke,{color:$.green.main})},Pt=d.span.withConfig({componentId:"sc-ph8uia-0"})(["color:var(--text);font-size:1em;"]),Nt=()=>{const[e,t]=j([ue.statuses,u.stores.$pEStudents]);return s.jsx(m,{p:"30px",d:"column",jc:"space-between",children:t.map(n=>{var o,r;return s.jsxs(m,{w:"100%",gap:"16px",ai:"flex-start",jc:"space-between",children:[s.jsx(Pt,{children:n.fullName}),s.jsxs(m,{gap:"8px",w:"auto",children:[s.jsx(We,{align:"center",children:bt[(o=e[n.studentGuid])!=null?o:x.LOADING]}),It[(r=e[n.studentGuid])!=null?r:x.LOADING]]})]},n.studentGuid)})})},he=c({name:"pageLoaded",sid:"4q0med"}),Ft=c({name:"pageUnloaded",sid:"he5rd5"});i({and:[{clock:he,target:u.events.load}],or:{sid:"74c8dr"}});i({and:[{clock:Ft,target:u.events.reset}],or:{sid:"76jer7"}});const Tt=d.div.withConfig({componentId:"sc-s6hadh-0"})(["display:grid;width:100%;"]),Dt=d.div.withConfig({componentId:"sc-s6hadh-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]);d(m).withConfig({componentId:"sc-s6hadh-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]);const At=d(m).withConfig({componentId:"sc-s6hadh-3"})([""]),_t=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(L,{hasDebt:t.hasDebtFromPreviousSemester,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],K=()=>{const{open:e,close:t}=I(),{students:n,loading:o,selectedGroup:r}=j({students:u.stores.$pEStudents,loading:u.stores.$loading,selectedGroup:u.stores.$selectedGroup}),p=!!(n.length&&!o&&r),h=()=>{He.evokeConfirm({message:"Вы уверены, что хотите завершить семестр?",onConfirm:()=>{u.events.endSemesterForGroup(),e(s.jsx(Nt,{}))},onReject:()=>{t(),u.events.reset()}})};return f.useEffect(()=>(he(),()=>{u.events.reset()}),[]),s.jsxs(Tt,{children:[!p&&s.jsx(Ve,{type:"alert",children:"Выберите группу чтобы провести зачет"}),s.jsxs(Dt,{children:[s.jsxs(At,{d:"row",jc:"space-between",p:"8px",children:[s.jsx(J,{leftIcon:s.jsx(X,{}),placeholder:"Номер группы",value:r,setValue:u.events.selectedGroupChanged,customMask:ee.groupMask,onValueEmpty:()=>u.events.selectedGroupChanged(""),onHintClick:a=>a&&u.events.selectedGroupChanged(a.id),request:te,size:"big"}),p&&s.jsx(E,{text:`Завершить семестр для ${r}`,width:"210px",background:$.green.main,textColor:$.white.main,onClick:h})]}),p&&s.jsx(P,{loading:o,data:n,columns:_t})]})]})},qt=()=>{const[e,t]=j([Be.peTeacher,pt]);f.useEffect(()=>{ie()},[]);const n=[W.AdminAccess,W.SuperUser].some(o=>{var r;return e==null||(r=e.permissions)===null||r===void 0?void 0:r.includes(o)})?[{title:"Студенты",content:s.jsx(B,{})},{title:"Управление",content:s.jsx(lt,{})},{title:"Мои Группы",content:s.jsx(H,{})},{title:"Проведение зачета",content:s.jsx(K,{})}]:[{title:"Студенты",content:s.jsx(B,{})},{title:"Мои Группы",content:s.jsx(H,{})},{title:"Проведение зачета",content:s.jsx(K,{})}];return s.jsx(Ke,{padding:"10px",children:s.jsx(Qe,{children:s.jsxs(m,{d:"column",gap:"2px",ai:"flex-start",children:[s.jsx(Xe,{appearance:!1,pages:n,currentPage:t,setCurrentPage:_}),n[t].content]})})})};export{qt as default};
