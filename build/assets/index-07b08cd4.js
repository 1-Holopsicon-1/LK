import{r as c,cM as v,j as m}from"./vendor-8312535b.js";import{be as j,b7 as p,s as N,bf as _,B as x,F as h,I as S,S as g,j as D,c as A}from"./index-3ed27df5.js";const I=async(i,o,s)=>{s(!1);const d=o.map(f=>{if(Array.isArray(f.data[0])){const e=f.data.map(l=>Object.assign({},...l==null?void 0:l.map(t=>{var y,b;const u={};return t!=null&&t.fieldName&&(u[t==null?void 0:t.fieldName]=(y=t==null?void 0:t.value)!=null&&y.title?(b=t==null?void 0:t.value)==null?void 0:b.title:t==null?void 0:t.value),u}))),r={};return r[i]=JSON.stringify(e),r}else return f.data.map(e=>{var l,t;const r={};return e!=null&&e.fieldName&&(r[(l=e==null?void 0:e.fieldName)!=null?l:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(r[(t=e==null?void 0:e.fieldName)!=null?t:""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))),r})}).flat(),a=Object.assign({},...d);!(await j.sendBufferHolidayTransferFx({employeeGuid:a.jobGuid,reason:a.reason,period:{from:{startDate:a.holiday_old_start,endDate:a.holiday_old_end},to:{startDate:a.holiday_new_start,endDate:a.holiday_new_end}}})).isError&&s(!0)},F=(i,o,s)=>{const{surname:d,name:a,patronymic:n}=i;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:d+" "+a+" "+n,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:o[s].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:o[s].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"",type:"simple-text",value:o[s].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},B=()=>{var t,u;const[i,o]=c.useState(null),{data:{dataUserApplication:s,dataWorkerApplication:d}}=N.useApplications(),{loading:a}=_.useBufferHolidayTransfer(),[n,f]=c.useState(!1),e=n!=null?n:!1,{id:r}=v(),l=+r;return c.useEffect(()=>{s&&d&&!a&&o(F(s,d,l))},[s,l,a]),m.jsx(x,{isDone:e,children:!!i&&!!o&&m.jsxs(h,{children:[m.jsx(S,{...i,collapsed:e,setData:o}),m.jsx(g,{text:"Отправить",action:()=>I(D.DISMISSAL,[i],f),isLoading:a,completed:n,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:e,isActive:A(i)&&((u=(t=i.optionalCheckbox)==null?void 0:t.value)!=null?u:!0),alerts:!1})]})})};export{B as default};
