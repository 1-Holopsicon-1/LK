import{s as l,j as n,r as D,cV as $,n as J,R as _}from"./vendor-08ab745b.js";import{G as w,E as p,cv as F,cw as Q,cx as E,L as Z,cy as ee,cz as te,bx as B,bM as H,cA as ne,cB as ae,a2 as G,cC as re,bL as se,cD as oe,cE as ie,cF as ce,ar as le,av as N,cG as de,X as U,cH as he,u as pe,cI as ge,l as ue,cJ as xe,cK as me,cn as fe,cm as De}from"./index-0892b83f.js";const T=({isCurrent:e,isCurrentChosenDay:t})=>{if(t&&!e)return"var(--text)";if(e&&t)return"var(--reallyBlue)"},W=({isCurrent:e,isCurrentChosenDay:t})=>e&&t?"#fff":t?"var(--invert-text)":e?"var(--blue)":"var(--text)",we=l(w).withConfig({componentId:"sc-178gzfm-0"})(["padding-left:var(--time-width);"]),ye=l.div.withConfig({componentId:"sc-178gzfm-1"})(["width:100%;font-weight:500;height:44px;border-radius:4px;font-size:0.86rem;cursor:pointer;&:hover{background:var(--theme-3);}&::before,&::after{content:'';display:",";height:calc(100% - 64px);top:54px;width:1.5px;position:absolute;background:var(--theme-4);}&::after{right:0;}","{font-size:0.8rem;height:",";&::after,&::before{top:90px;height:calc(100% - 100px);}}"],({showColumns:e})=>e?"block":"none",p.isMobile,({showDates:e})=>e?"80px":"50px"),be=l(w).withConfig({componentId:"sc-178gzfm-2"})(["margin:2px 0;","{flex-direction:column;margin:6px 0;}"],p.isMobile),ve=l.span.withConfig({componentId:"sc-178gzfm-3"})(["margin-left:auto;margin-right:",";background:",";color:",";padding:5px;border-radius:25px;","{margin-right:auto;padding:4px;}"],({showDates:e})=>e?"0":"auto",({showDates:e})=>!e&&T,({showDates:e})=>e?"var(--grey)":W,p.isMobile),Ce=l.span.withConfig({componentId:"sc-178gzfm-4"})(["height:26px;min-width:26px;display:flex;justify-content:center;align-items:center;border-radius:100px;margin-right:auto;margin-left:2px;background:",";color:",";font-weight:",";","{margin-left:auto;margin-top:4px;font-size:",";}"],T,W,({isCurrent:e,isCurrentChosenDay:t})=>e&&t&&"600",p.isMobile,({isCurrent:e})=>e&&"0.8rem"),ke=l.div.withConfig({componentId:"sc-9mih1d-0"})(["display:flex;align-items:center;gap:4px;margin:0 auto;width:fit-content;"]),V=l.div.withConfig({componentId:"sc-9mih1d-1"})(["width:6px;height:6px;border-radius:10px;background:",";@media (max-width:768px){width:5px;height:5px;}"],({background:e})=>e),Y=({subjects:e})=>e?n.jsx(ke,{children:e.map(t=>n.jsx(V,{background:t.color.main},t.startTime))}):null,je=()=>{const e=new Date;let t=F(e);e.getDay()===0&&(t=Q(e,1));const r=Object.keys(E).reduce((s,i)=>(s[E[i].short]="",s),{});for(let s=0;s<6;s++){const i=t.toLocaleDateString("ru-RU",{day:"2-digit"});t.setDate(t.getDate()+1),r[Object.keys(r)[s]]=i}return r},O=({showDates:e,showColumns:t,currentChosenDay:r,onDayClick:s,events:i})=>{const c=je();return n.jsx(we,{jc:"space-between",children:Object.keys(c).map((a,o)=>{const d=c[a],h=o===r;return n.jsxs(ye,{showDates:e,showColumns:t,onClick:s&&(()=>s?.(o)),children:[n.jsxs(be,{children:[n.jsx(ve,{isCurrent:+d===new Date().getDate(),isCurrentChosenDay:!e&&h,showDates:e,children:a}),e&&n.jsx(Ce,{isCurrentChosenDay:h,isCurrent:+d===new Date().getDate(),children:d})]}),i&&e&&n.jsx(Y,{subjects:i[Object.keys(i)[o]]}),i&&!e&&i[Object.keys(i)[o]].length>0&&n.jsx(w,{jc:"center",children:n.jsx(V,{background:Z.grey.main})})]},a)})})},q=({interval:e,showDates:t,events:r,onDayClick:s})=>{const i=e[0]*60,c=ee();return{handleOpenModal:te(),onDayClick:s,shift:i,showDates:t,interval:e,events:r,scale:c}},A=e=>e!==void 0?e:new Date().getDay()===0?0:new Date().getDay()-1,Ie=({events:e,currentChosenDay:t,showDates:r=!0,interval:s=[0,23]})=>{const{isSmallDesktop:i}=B(),{scale:c,shift:a,events:o,handleOpenModal:d}=q({interval:s,events:e}),[h,f]=D.useState(null),[u,x]=D.useState(A(t)),g=D.useRef(null);D.useEffect(()=>{if(e){const m=Object.keys(e??{})[u],C=e[m].find(X=>H(X,!0))??null;f(C)}else f(null)},[e]);const y=h?`${h.startTime} - ${ne(h.startTime,h.duration)}`:"9:00",v=D.useCallback(m=>{i?d(m):f(m)},[i]),b=m=>{const C=Math.floor(m.currentTarget.scrollLeft/m.currentTarget.clientWidth);x(C)},R=m=>{g.current&&(g.current.scrollLeft=g.current.clientWidth*m)};return D.useLayoutEffect(()=>{R(A(t))},[g,t]),{currentDay:u,events:o,carouselRef:g,interval:s,scale:c,shift:a,showDates:r,chosenEvent:h,timeInterval:y,currentChosenDay:t,handleDayClick:R,handleCarouselScroll:b,onEventClick:v}},L="calc(100vh - var(--header-height) - 110px)",z="calc(100vh - var(--header-height) - 185px)",K="calc(100vh - var(--header-height) - 170px);",P=l(w).withConfig({componentId:"sc-13irvko-0"})(["--time-width:55px;","{--time-width:35px;}"],p.isMobile),Ee=l(P).withConfig({componentId:"sc-b5gqbc-0"})(["height:",";","{height:",";}","{height:",";}"],L,p.isTablet,K,p.isMobile,z),Me=l.div.withConfig({componentId:"sc-b5gqbc-1"})(["min-width:340px;max-width:340px;height:calc(100vh - 220px);z-index:10;background:var(--block-content);border-radius:10px;top:0;overflow:hidden;box-shadow:var(--block-shadow);","{display:none;}"],p.isSmallTesktop),Se=l.div.withConfig({componentId:"sc-b5gqbc-2"})(["overflow-y:hidden;overflow-x:auto;height:100%;width:100%;gap:32px;display:flex;scroll-snap-type:x mandatory;&{.calendar-wrapper{scroll-snap-align:center;min-width:100%;}}"]),Te=e=>{const{currentDay:t,events:r,carouselRef:s,interval:i,scale:c,shift:a,chosenEvent:o,showDates:d,timeInterval:h,handleDayClick:f,handleCarouselScroll:u,onEventClick:x}=Ie(e);return n.jsxs(Ee,{d:"column",gap:"12px",children:[n.jsx(O,{onDayClick:f,currentChosenDay:t,showDates:d,showColumns:!1,events:r}),n.jsxs(w,{h:"100%",gap:"18px",children:[n.jsx(Se,{onScroll:u,ref:s,children:Object.keys(r??{}).map((g,y)=>{const v=r?.[g];return n.jsx(ae,{events:v,interval:i,scale:c,weekday:y+1,currentDay:t,shift:a,onEventClick:x},g)})}),n.jsx(Me,{children:o?n.jsx(re,{isNextEvent:se(r?.saturday,o,!0),timeInterval:h,color:o.color,name:o.title,place:o.place,link:o.link,groups:o.groups,weekday:o.weekday,teachers:o.people,dateInterval:o.dateInterval,rooms:o.rooms??[],isCurrentEvent:H(o,!0)}):n.jsx(G,{text:"Ничего не выбрано",image:n.jsx($,{})})})]})]})},We=l(P).withConfig({componentId:"sc-13hlrk1-0"})(["height:",";position:relative;","{height:",";}","{height:",";}"],L,p.isTablet,K,p.isMobile,z),Oe=e=>{const{handleOpenModal:t,onDayClick:r,shift:s,scale:i,showDates:c,interval:a,events:o}=q(e);return n.jsxs(We,{d:"column",children:[n.jsx(O,{onDayClick:r,showDates:c,showColumns:!0,events:o}),n.jsxs(oe,{children:[n.jsx(ie,{interval:a,scale:i}),Object.keys(E).map((d,h)=>n.jsx(ce,{showTime:!1,weekDay:h+1,shortInfo:!0,events:o?.[d],scale:i,shift:s,currentEvent:null,interval:a,onClick:t},d))]})]})},M=e=>{const t=new Date(e),r=t.getDate()-(t.getDay()-1)+6;return new Date(t.setDate(r))},k=(e,t)=>{const s=(t.getTime()-e.getTime())/(1e3*3600*24);return s-Math.floor(s/6.55)+1},Le=l.div.withConfig({componentId:"sc-1xp14d0-0"})(["width:100%;display:flex;flex-direction:column;height:",";position:relative;","{height:",";}"],L,p.isMobile,z),ze=l.div.withConfig({componentId:"sc-1xp14d0-1"})(["display:flex;flex-direction:row;flex-wrap:wrap;border-left:1px solid var(--theme-3);border-top:1px solid var(--theme-3);border-bottom:1px solid var(--theme-3);overflow-y:auto;scroll-snap-type:y mandatory;scroll-padding-top:100px;","{&::-webkit-scrollbar{display:none;}}","{border:none;scroll-padding-top:50px;}"],p.isMiddleTesktop,p.isMobile),Re=l.div.withConfig({componentId:"sc-1xp14d0-2"})(["padding:6px;width:1000px;max-width:calc(100% / 6);height:calc((100vh / 6) - 6px);background:transparent;border-right:1px solid var(--almostTransparentOpposite);border-bottom:1px solid var(--almostTransparentOpposite);display:flex;flex-direction:column;align-items:center;opacity:",";background:",";scroll-snap-align:center;","{padding:12px;gap:4px;height:calc((100vw / 6) - 5.5px);border-right:none;}"],({disabled:e})=>e?"0.4":"1",({disabled:e})=>e?"var(--theme-1t)":"transparent",p.isMobile),Ne=l.div.withConfig({componentId:"sc-1xp14d0-3"})(["width:100%;font-size:0.9rem;font-weight:500;display:flex;align-items:center;","{justify-content:center;}"],p.isMobile),Ae=l.div.withConfig({componentId:"sc-1xp14d0-4"})(["height:26px;width:26px;display:flex;justify-content:center;align-items:center;border-radius:30px;background:",";color:",";"],T,W),_e=l.div.withConfig({componentId:"sc-1xp14d0-5"})(["position:sticky;width:100%;height:50px;font-size:1.2rem;font-weight:500;top:0px;padding:10px;z-index:100;margin:4px 0;background:var(--block);","{background:var(--theme);}"],p.isMobile),S=(e,t)=>e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear(),Fe=l(w).withConfig({componentId:"sc-1mwhn0h-0"})(["padding:4px;border-radius:4px;cursor:pointer;&:hover{filter:brightness(0.92);}"]),Be=l.div.withConfig({componentId:"sc-1mwhn0h-1"})(["font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:0.8rem;opacity:0.8;color:",";"],({textColor:e})=>e),He=e=>{const{title:t,color:r,onClick:s,startTime:i}=e,c=J(le.userSettings),a=c?.appearance.theme===N.Light?r.dark3:r.light3,o=c?.appearance.theme===N.Light?r.transparent3:r.transparent2,d=()=>s?.(e);return n.jsxs(Fe,{textColor:a,background:o,gap:"6px",onClick:d,children:[n.jsx(de,{isCurrentEvent:!1,color:r}),n.jsx(Be,{textColor:a,children:t}),n.jsx(U,{fontSize:"0.7rem",children:i})]})},j=4,Ge=(e,t)=>{const r=he(t);return r==="sunday"?[]:e?.[r].filter(s=>s.endDate?t>=s.startDate&&t<=s.endDate:S(s.startDate,t))},Ue=({daysAmount:e,startDate:t,events:r,addOneOnWeekends:s,handleEventClick:i,disabled:c=!1})=>{if(e<0||isNaN(e))return n.jsx(G,{text:"Неправильная длина календаря"});const a=new Date(t),{isMobile:o}=B(),{open:d}=pe(),h=(f,u)=>()=>{d(n.jsx(me,{isCurrentDay:!1,dayEvents:f,day:u}),u)};return n.jsx(n.Fragment,{children:Array(e).fill(0).map((f,u)=>{if(u!==0)a.getDay()===6&&s?a.setDate(a.getDate()+2):a.setDate(a.getDate()+1);else if(a.getDay()===0)return null;const x=Ge(r,a),g=M(a),y=a.getDay()===1&&g.getMonth()!==a.getMonth(),v=g.getMonth()===a.getMonth()&&u===0&&a.getDay()===1||a.getDay()===1&&a.getDate()===1;return n.jsxs(_.Fragment,{children:[(v||y)&&n.jsx(_e,{children:ge(y?M(a).toLocaleDateString("ru-RU",{month:"long"}):a.toLocaleDateString("ru-RU",{month:"long"}))}),n.jsxs(Re,{disabled:c,onClick:h(x,ue(a)),children:[n.jsxs(Ne,{children:[n.jsxs(Ae,{isCurrentChosenDay:S(a,new Date),isCurrent:S(a,new Date),children:[xe(a.getDate())," "]}),!o&&a.getDate()===1&&a.toLocaleDateString("ru-RU",{month:"short"})]}),!o&&n.jsxs(w,{d:"column",ai:"flex-start",gap:"0px",children:[x?.slice(0,j)?.map(b=>n.jsx(He,{...b,onClick:i},b.title+b.startTime+b.dateInterval)),(x?.length??0)>j&&n.jsxs(U,{children:["И еще ",(x?.length??0)-j]})]}),o&&n.jsx(Y,{subjects:x})]})]},a.toLocaleDateString("ru-RU"))})})},I=_.memo(Ue),Ve=({events:e,startDate:t,endDate:r,onDayClick:s})=>{const i=new Date(t),c=new Date(r),a=F(i),o=c.getDay()!==0?M(c):c,d=k(i,c);return n.jsxs(Le,{children:[n.jsx(O,{showColumns:!1,events:null,onDayClick:s}),n.jsxs(ze,{children:[n.jsx(I,{daysAmount:k(a,i)-1,startDate:a,events:e,disabled:!0,addOneOnWeekends:!1}),n.jsx(I,{daysAmount:d,startDate:i,events:e,addOneOnWeekends:!0}),n.jsx(I,{daysAmount:k(c,o)-1,startDate:new Date(c.getFullYear(),c.getMonth(),c.getDate()+1),events:e,disabled:!0,addOneOnWeekends:!1})]})]})},Ke=({events:e,view:t,showDates:r,startDate:s,endDate:i})=>{const[c,a]=D.useState(void 0),o=h=>{fe.changeView(De.day),a(h)},d=[n.jsx(Te,{currentChosenDay:c,events:e,interval:[9,22],showDates:r},"day"),n.jsx(Oe,{events:e,interval:[9,22],showDates:r,onDayClick:o},"week"),n.jsx(Ve,{events:e,startDate:s,endDate:i,onDayClick:o},"month")];return n.jsx(n.Fragment,{children:d[t]})};export{Ke as T};
