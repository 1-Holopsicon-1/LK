import{r as f,cM as y,j as m}from"./vendor-08ab745b.js";import{be as b,b7 as p,s as v,bf as j,B as N,F as _,I as x,S as h,j as S,c as g}from"./index-0892b83f.js";const D=async(s,i,a)=>{a(!1);const r=i.map(o=>{if(Array.isArray(o.data[0])){const e=o.data.map(n=>Object.assign({},...n?.map(d=>{const c={};return d?.fieldName&&(c[d?.fieldName]=d?.value?.title?d?.value?.title:d?.value),c}))),l={};return l[s]=JSON.stringify(e),l}else return o.data.map(e=>{const l={};return e?.fieldName&&(l[e?.fieldName??""]=typeof e.value!="object"?e?.value:e.value.title),e.type==="multiselect"&&(l[e?.fieldName??""]=JSON.stringify(e?.value.map(n=>n.title))),l})}).flat(),t=Object.assign({},...r);!(await b.sendBufferHolidayTransferFx({employeeGuid:t.jobGuid,reason:t.reason,period:{from:{startDate:t.holiday_old_start,endDate:t.holiday_old_end},to:{startDate:t.holiday_new_start,endDate:t.holiday_new_end}}})).isError&&a(!0)},A=(s,i,a)=>{const{surname:r,name:t,patronymic:u}=s;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:r+" "+t+" "+u,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:i[a].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:i[a].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"",type:"simple-text",value:i[a].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},k=()=>{const[s,i]=f.useState(null),{data:{dataUserApplication:a,dataWorkerApplication:r}}=v.useApplications(),{loading:t}=j.useBufferHolidayTransfer(),[u,o]=f.useState(!1),e=u??!1,{id:l}=y(),n=+l;return f.useEffect(()=>{a&&r&&!t&&i(A(a,r,n))},[a,n,t]),m.jsx(N,{isDone:e,children:!!s&&!!i&&m.jsxs(_,{children:[m.jsx(x,{...s,collapsed:e,setData:i}),m.jsx(h,{text:"Отправить",action:()=>D(S.DISMISSAL,[s],o),isLoading:t,completed:u,setCompleted:o,repeatable:!1,buttonSuccessText:"Отправлено",isDone:e,isActive:g(s)&&(s.optionalCheckbox?.value??!0),alerts:!1})]})})};export{k as default};
