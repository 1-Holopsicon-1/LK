var H=Object.defineProperty,O=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var A=(o,t,e)=>t in o?H(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,I=(o,t)=>{for(var e in t||(t={}))T.call(t,e)&&A(o,e,t[e]);if(k)for(var e of k(t))q.call(t,e)&&A(o,e,t[e]);return o},w=(o,t)=>O(o,P(t));var B=(o,t,e)=>new Promise((c,l)=>{var y=s=>{try{a(e.next(s))}catch(n){l(n)}},u=s=>{try{a(e.throw(s))}catch(n){l(n)}},a=s=>s.done?c(s.value):Promise.resolve(s.value).then(y,u);a((e=e.apply(o,t)).next())});import{r,j as S}from"./vendor-93473b96.js";import{bb as E,b6 as N,s as G,bc as J,P as W,B as $,F as R,I as V,S as L,c as U}from"./index-7eec75d1.js";import{g as z,a as K}from"./get-default-subdivision-17957fb0.js";const M=(o,t,e)=>B(void 0,null,function*(){e(!1);const c=t.map(u=>{if(Array.isArray(u.data[0])){const a=u.data.map(n=>Object.assign({},...n==null?void 0:n.map(i=>{var p,f;const v={};return i!=null&&i.fieldName&&(v[i==null?void 0:i.fieldName]=i!=null&&(p=i.value)!==null&&p!==void 0&&p.title?i==null||(f=i.value)===null||f===void 0?void 0:f.title:i==null?void 0:i.value),v}))),s={};return s[o]=JSON.stringify(a),s}else return u.data.map(a=>{var s;const n={};if(a!=null&&a.fieldName&&(n[(s=a==null?void 0:a.fieldName)!==null&&s!==void 0?s:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"){var i;n[(i=a==null?void 0:a.fieldName)!==null&&i!==void 0?i:""]=JSON.stringify(a==null?void 0:a.value.map(p=>p.title))}return n})}).flat(),l=Object.assign({},...c);l.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?l.holiday_type=1:l.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?l.holiday_type=2:l.holiday_type=="Отпуск без сохранения заработной платы"?l.holiday_type=3:l.holiday_type=="Отпуск по коллективному договору"&&(l.holiday_type=4),!(yield E.sendBufferHolidayPlanningFx({employeeGuid:l.jobGuid,type:l.holiday_type,start:l.holiday_start,end:l.holiday_end})).isError&&e(!0)}),Q=o=>{const t=o.find(e=>e.fieldName==="holiday_type");return t!=null&&t.value&&(t==null?void 0:t.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},X=(o,t,e,c,l,y,u,a,s,n,i,p,f,v)=>{const{surname:_,name:x,patronymic:m,subdivisions:b}=o,h=e||new Date().toISOString(),D=l||new Date().toISOString(),C=u||"",g=f||"",j=i||z(b);return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:_+" "+x+" "+m,fieldName:"fio",visible:!0},{title:"Подразделение/должность",value:j,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:K(b),isSpecificSelect:!0,onChange:d=>{p(d),v(d.id)}},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:s,editable:!0,required:!0,onChange:d=>{n(d)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:C,editable:!0,required:!0,onChange:d=>{const F=new Date(Date.parse(h));F.setDate(F.getDate()+5),a(d),y(N(d?+d.data:0,F.toString()))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:e,fieldName:"holiday_start",editable:!0,mask:!0,onChange:d=>{c(d),y(d)},required:!0,minValueInput:N(5)},{title:"",type:"simple-text",value:g,fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:D,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:d=>{y(d)},minValueInput:l||N(0),maxValueInput:N(u?+u.data:365,h)}]}},ae=()=>{var o,t;const[e,c]=r.useState(null),[l,y]=r.useState(null),[u,a]=r.useState(null),[s,n]=r.useState(null),[i,p]=r.useState(null),[f,v]=r.useState(null),[_,x]=r.useState(null),{data:{dataUserApplication:m,dataWorkerApplication:b}}=G.useApplications(),{loading:h}=J.useBufferHolidayPlanning(),[D,C]=r.useState({}),[g,j]=r.useState(!1),d=g!=null?g:!1;return r.useEffect(()=>{m&&b&&!h&&c(X(m,b,l,y,i,p,f,v,_,x,s,n,u,a))},[m,h,l,f,_,u,s]),r.useEffect(()=>{e&&m&&C(Q(e.data))},[e]),S.jsx(W,{children:S.jsx($,{isDone:d,children:!!e&&!!c&&S.jsxs(R,{children:[S.jsx(V,w(I({},e),{collapsed:d,setData:c,specialFieldsNameConfig:D})),S.jsx(L,{text:"Отправить",action:()=>M("",[e],j),isLoading:h,completed:g,setCompleted:j,repeatable:!1,buttonSuccessText:"Отправлено",isDone:d,isActive:U(e,D)&&((o=(t=e.optionalCheckbox)===null||t===void 0?void 0:t.value)!==null&&o!==void 0?o:!0),alerts:!1})]})})})};export{ae as default};
