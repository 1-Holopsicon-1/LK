import{r as o,j as b}from"./vendor-08ab745b.js";import{b9 as j,ba as N,b7 as h,s as _,bb as F,P as k,B as E,F as A,I as C,S as T,c as B}from"./index-0892b83f.js";import{g as I,a as O}from"./get-default-subdivision-17957fb0.js";const w=async(e,l,a)=>{a(!1);const x=l.map(c=>{if(Array.isArray(c.data[0])){const t=c.data.map(d=>Object.assign({},...d?.map(r=>{const u={};return r?.fieldName&&(u[r?.fieldName]=r?.value?.title?r?.value?.title:r?.value),u}))),s={};return s[e]=JSON.stringify(t),s}else return c.data.map(t=>{const s={};return t?.fieldName&&(s[t?.fieldName??""]=typeof t.value!="object"?t?.value:t.value.title),t.type==="multiselect"&&(s[t?.fieldName??""]=JSON.stringify(t?.value.map(d=>d.title))),s})}).flat(),i=Object.assign({},...x);!(await j.sendBufferMedicalExaminationFx({employeeGuid:i.jobGuid,start:i.extra_examination_date,end:i.isRetirement?i.extra_examination_date_2:i.extra_examination_date}))?.isError&&a(!0)},G=e=>{const l=e.find(a=>a.fieldName==="isRetirement");return l?.value&&l?.value?{reason:"Compensation2"}:{reason:null}},R=(e,l,a,x,i,g,c,t,s,d)=>{const{surname:r,name:u,patronymic:y,subdivisions:m}=e,n=a?new Date(a):new Date,D=s||"",S=c||I(m),f=new Date(n.getTime()+24*60*60*1e3);return N(D)==="true"&&n.getDay()===5?f.setDate(n.getDate()+1):(n.getDay()===5||n.getDay()===6||n.getDay()===0)&&f.setDate(n.getDate()+(8-n.getDay())%7),{title:"Заявление о диспансеризации",data:[{title:"ФИО",value:r+" "+u+" "+y,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделение/должность",value:S,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:O(m),isSpecificSelect:!0,onChange:p=>{t(p),d(p.id)}},{title:"Дата прохождения диспансеризации",type:"date",value:a,fieldName:"extra_examination_date",editable:!0,onChange:p=>{x(p)},mask:!0,required:!0,maxValueLength:1,minValueInput:h(0)},{title:"Я являюсь получателем пенсии по старости или пенсии за выслугу лет или мне осталось менее 5 лет до этого",type:"hr-checkbox",value:i||"",fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:p=>{g(p)}},{title:"Второй день отдыха",type:"date",value:f.toISOString().substr(0,10),fieldName:"extra_examination_date_2",editable:!1,mask:!0,required:!1,specialType:"Compensation2",maxValueLength:1},{title:"",type:"simple-text",value:D,fieldName:"jobGuid",visible:!1}]}},W=()=>{const[e,l]=o.useState(null),[a,x]=o.useState(null),[i]=o.useState(null),[g,c]=o.useState(null),[t,s]=o.useState(null),[d,r]=o.useState(null),{data:{dataUserApplication:u,dataWorkerApplication:y}}=_.useApplications(),{loading:m}=F.useBufferMedicalExamination(),[n,D]=o.useState({}),[S,f]=o.useState(!1),v=S??!1;return o.useEffect(()=>{u&&y&&!m&&l(R(u,y,a,x,d,r,t,s,g,c))},[u,m,a,i,d]),o.useEffect(()=>{e&&u&&D(G(e.data))},[e]),b.jsx(k,{children:b.jsx(E,{isDone:v,children:!!e&&!!l&&b.jsxs(A,{children:[b.jsx(C,{...e,collapsed:v,setData:l,specialFieldsNameConfig:n}),b.jsx(T,{text:"Отправить",action:()=>w("",[e],f),isLoading:m,completed:S,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:v,isActive:B(e)&&(e.optionalCheckbox?.value??!0),alerts:!1})]})})})};export{W as default};
