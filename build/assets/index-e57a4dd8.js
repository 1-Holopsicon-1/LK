var f=(e,t,s)=>new Promise((i,r)=>{var a=p=>{try{v(s.next(p))}catch(y){r(y)}},l=p=>{try{v(s.throw(p))}catch(y){r(y)}},v=p=>p.done?i(p.value):Promise.resolve(p.value).then(a,l);v((s=s.apply(e,t)).next())});import{d as ne,p as d,h,bO as S,k as x,N as oe,f as w,x as g,cG as ae,i as c,r as ie,j as n,cH as re}from"./vendor-8a1e4858.js";import{n as F,o as M,p as ce,q as de,f as le,r as pe,k as ue,t as me,l as ve,T as he,v as ge,I as k,w as L,i as $e}from"./index-8977d86c.js";const ye="https://api.mospolytech.ru/ticketsservice",A=ne.create({baseURL:ye}),fe=e=>f(void 0,null,function*(){var t,s,i,r;const a=new FormData;a.append("ApplicantName",e.applicantName),a.append("Description",e.description),a.append("ServiceAreaId",e.serviceAreaId),a.append("ServiceId",e.serviceId),a.append("ServiceCategoryId",e.serviceCategoryId),a.append("Phone",(t=e.phone)!==null&&t!==void 0?t:""),a.append("Location",(s=e.location)!==null&&s!==void 0?s:""),a.append("Room",(i=e.room)!==null&&i!==void 0?i:""),a.append("Email",(r=e.email)!==null&&r!==void 0?r:"");const{data:l}=yield A.post("/tickets",a,{headers:{"Content-Type":"multipart/form-data"}});return l}),xe=()=>f(void 0,null,function*(){const{data:e}=yield A.get("/handbooks/locations");return e}),je=()=>f(void 0,null,function*(){const{data:e}=yield A.get("/handbooks/service-areas");return e}),Se=t=>f(void 0,[t],function*({serviceArea:e}){const{data:s}=yield A.get(`/handbooks/${e}`);return s}),u=d({name:"pageMounted",sid:"c5fr4t"}),B=d({name:"sendForm",sid:"-dc3oa1"}),E=d({name:"setFiles",sid:"-521qo1"}),q=d({name:"setName",sid:"3yh40o"}),Q=d({name:"setPhone",sid:"-hbpn1l"}),R=d({name:"setEmail",sid:"-8nd6m0"}),V=d({name:"setNote",sid:"azuum"}),C=d({name:"setServiceType",sid:"se3d14"}),P=d({name:"setServiceId",sid:"wut57c"}),D=d({name:"setService",sid:"dv3frd"}),z=d({name:"setLocation",sid:"fnth5a"}),U=d({name:"setRoom",sid:"epp4qo"}),G=h([],{name:"$files",sid:"7o5dze"}).on(E,(e,t)=>t).reset(u),H=h("",{name:"$note",sid:"hv8y42"}).on(V,(e,t)=>t).reset(u),O=h("",{name:"$name",sid:"newouw"}).on(q,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{if(!t)return"";const{name:s,surname:i,patronymic:r}=t;return`${s} ${i} ${r}`}),W=h("",{name:"$phone",sid:"4dnykb"}).on(Q,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.phone)!==null&&s!==void 0?s:""}),J=h("",{name:"$email",sid:"e03nsa"}).on(R,(e,t)=>t).on(F.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.email)!==null&&s!==void 0?s:""}),N=S(C,null,{name:"$serviceType",sid:"-u2770n"}).reset(u),ke=S(P,null,{name:"$serviceId",sid:"-r202nb"}).reset(u),K=S(D,null,{name:"$service",sid:"x108et"}).reset([u,N]),X=S(U,"",{name:"$room",sid:"-ati4pj"}).reset(u),Y=h(null,{name:"$location",sid:"-gtyhi"}).on(z,(e,t)=>t).reset(u),Z=h("",{name:"$applicationNumber",sid:"-d4zgb5"}).reset(u),$=x({sid:"1f87w0",fn:()=>oe({handler:fe}),name:"sendFormMutation",method:"createMutation"}),I=x({sid:"-svpciu",fn:()=>w({handler:xe}),name:"locationsQuery",method:"createQuery"}),_=x({sid:"j139hu",fn:()=>w({handler:je}),name:"serviceAreasQuery",method:"createQuery"}),j=x({sid:"t6qo74",fn:()=>w({handler:Se}),name:"servicesQuery",method:"createQuery"});g({and:[{clock:u,target:[$.reset,M.getUserDataApplicationsFx,I.start,_.start]}],or:{sid:"-y6uhel"}});g({and:[{clock:g({and:[{clock:N,filter:Boolean}],or:{name:"clock",sid:"-sp5ly6"}}),fn:({id:e})=>({serviceArea:e.toString()}),target:j.start}],or:{sid:"-xt3mkk"}});g({and:[{clock:B,source:{services:j.$data,files:G,name:O,phone:W,email:J,note:H,serviceType:N,service:K,location:Y,room:X},filter:({serviceType:e,service:t,services:s,name:i,phone:r,email:a})=>!!i&&!!r&&!!a&&!!e&&!!s&&!!t,fn:({services:e,files:t,name:s,phone:i,email:r,note:a,service:l,location:v,room:p,serviceType:y})=>{var T,b;const ee=(T=(b=e.find(te=>te.items.find(se=>se.id===l.id.toString())))===null||b===void 0?void 0:b.id)!==null&&T!==void 0?T:"";return{applicantName:s,description:a,email:r,phone:i,location:v==null?void 0:v.title,room:p,files:t,serviceAreaId:y.id.toString(),serviceId:l.id.toString(),serviceCategoryId:ee}},target:$.start}],or:{sid:"-xayezn"}});g({and:[{clock:$.finished.success,fn:({result:e})=>e.ticketId,target:Z}],or:{sid:"fmsib7"}});g({and:[{clock:$.$failed,fn:()=>({message:"Произошла ошибка. Попробуйте позднее",type:"failure"}),target:ce.evokePopUpMessage}],or:{sid:"g26qxb"}});const m={pageMounted:u,setFiles:E,setName:q,setPhone:Q,setEmail:R,setNote:V,setServiceType:C,setServiceId:P,setService:D,setLocation:z,setRoom:U,sendForm:B},o={locations:I.$data,serviceAreas:_.$data,services:j.$data,servicesLoading:j.$pending,pageLoading:x({sid:"vq5dwf",fn:()=>ae(I.$pending,_.$pending,M.getUserDataApplicationsFx.pending),name:"pageLoading",method:"or"}),files:G,note:H,name:O,phone:W,email:J,serviceType:N,serviceId:ke,service:K,location:Y,room:X,loading:$.$pending,done:$.$succeeded,applicationNumber:Z},qe=()=>{const[e,t,s,i]=c([m.pageMounted,o.done,o.applicationNumber,o.pageLoading]),r=c(de.isAuthenticated);return ie.useEffect(()=>{e()},[]),i?n.jsx(le,{h:"100%",d:"column",ai:"center",jc:"center",children:n.jsx(pe,{})}):n.jsx(ue,{padding:"1rem",style:{overflow:"auto",alignItems:"start"},children:n.jsxs(me,{noHeader:!0,children:[!r&&n.jsx(ve,{}),n.jsx(he,{size:4,align:"left",children:"Техническое обслуживание"}),t?n.jsxs(n.Fragment,{children:["Спасибо! Ваш номер заявки ",s,"."]}):n.jsxs(n.Fragment,{children:[n.jsx(Ne,{}),n.jsx(Te,{}),n.jsx(be,{}),n.jsx(we,{}),n.jsx(Fe,{}),n.jsx(Ie,{}),n.jsx(_e,{}),n.jsx(Ae,{}),n.jsx(Le,{})]})]})})},Ae=()=>{const[e,t]=c([o.note,m.setNote]);return n.jsx(ge,{placeholder:"Опишите проблему и точное местоположение",required:!0,title:"Описание заявки",value:e,setValue:t})},Ne=()=>{const[e,t]=c([o.name,m.setName]);return n.jsx(k,{title:"Фамилия Имя Отчество",placeholder:"Введите ФИО",required:!0,value:e,setValue:t})},Te=()=>{const[e,t]=c([o.phone,m.setPhone]);return n.jsx(k,{title:"Контактный телефон (сотовый в формате +7-ххх-ххх-хх-хх или внутренний в формате хххх)",placeholder:"Введите контактный телефон",type:"tel",value:e,setValue:t,required:!0})},be=()=>{const[e,t]=c([o.email,m.setEmail]);return n.jsx(k,{title:"Адрес электронной почты",placeholder:"Введите адрес электронной почты",value:e,type:"email",setValue:t,required:!0})},Ie=()=>{const[e]=c([o.serviceAreas]),[t,s]=c([o.serviceType,m.setServiceType]);return n.jsx(L,{title:"Выберите направление заявки",placeholder:"Выберите направление заявки",required:!0,isActive:!!e,width:"100%",items:e||[],selected:t,setSelected:s})},_e=()=>{const[e,t]=c([o.serviceType,o.services]),[s,i]=c([o.service,m.setService]);return n.jsx(L,{title:"Выберите необходимый сервис",placeholder:"Начните вводить название сервиса",isActive:!!e&&!!t,required:!0,width:"100%",items:t||[],selected:s,setSelected:i,withSearch:!0})},we=()=>{const[e,t]=c([o.location,m.setLocation]),s=re(o.locations,r=>{var a;return(a=r==null?void 0:r.map(l=>({id:l.name,title:l.name})))!==null&&a!==void 0?a:[]}),[i]=c([o.serviceType]);return n.jsx(L,{title:"Локация, где необходимо выполнить заявку",placeholder:"Начните вводить локацию",required:(i==null?void 0:i.id)==="campus",width:"100%",isActive:!!(s!=null&&s.length),items:s!=null?s:[],selected:e,setSelected:t,withSearch:!0})},Fe=()=>{const[e,t]=c([o.room,m.setRoom]);return n.jsx(k,{title:"№ аудитории",placeholder:"Введите № аудитории",value:e,setValue:t})},Le=()=>{const[e,t,s,i,r,a,l,v,p]=c([m.sendForm,o.done,o.loading,o.note,o.name,o.phone,o.email,o.serviceType,o.service]);return n.jsx($e,{text:t?"Отправлено":"Отправить",action:e,isLoading:s,completed:t,setCompleted:()=>{},repeatable:!1,buttonSuccessText:"Отправлено",isDone:t,isActive:!!i&&!!r&&!!a&&!!l&&!!v&&!!p,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})};export{qe as default};
