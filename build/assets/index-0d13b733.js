var j=Object.defineProperty,h=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var v=(a,e,t)=>e in a?j(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,N=(a,e)=>{for(var t in e||(e={}))g.call(e,t)&&v(a,t,e[t]);if(b)for(var t of b(e))k.call(e,t)&&v(a,t,e[t]);return a},x=(a,e)=>h(a,_(e));import{r as c,cM as S,j as y}from"./vendor-31894644.js";import{b4 as A,b7 as F,s as w,b8 as D,B as O,F as B,I as C,S as H,j as W,c as q}from"./index-0f8b6250.js";const E=async(a,e,t)=>{t(!1);const u=e.map(m=>{if(Array.isArray(m.data[0])){const i=m.data.map(o=>Object.assign({},...o==null?void 0:o.map(s=>{var f,p;const r={};return s!=null&&s.fieldName&&(r[s==null?void 0:s.fieldName]=(f=s==null?void 0:s.value)!=null&&f.title?(p=s==null?void 0:s.value)==null?void 0:p.title:s==null?void 0:s.value),r}))),n={};return n[a]=JSON.stringify(i),n}else return m.data.map(i=>{var o,s;const n={};return i!=null&&i.fieldName&&(n[(o=i==null?void 0:i.fieldName)!=null?o:""]=typeof i.value!="object"?i==null?void 0:i.value:i.value.title),i.type==="multiselect"&&(n[(s=i==null?void 0:i.fieldName)!=null?s:""]=JSON.stringify(i==null?void 0:i.value.map(r=>r.title))),n})}).flat(),l=Object.assign({},...u);!(await A.sendBufferHolidayWorkFx({employeeGuid:l.jobGuid,dates:[{date:l.holiday_work_date,dayOff:l.extra_holiday_date?l.extra_holiday_date:null,hours:+l.holiday_work_hours}]})).isError&&t(!0)},G=a=>{const e=a.find(u=>u.fieldName==="compensation");let t=null;return e!=null&&e.value&&(e==null?void 0:e.value).title==="Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"&&(t="Compensation"),{compensation:t}},I=(a,e,t)=>{const{surname:u,name:l,patronymic:d}=a;return{title:"Заявление о привлечении к работе в выходной день",data:[{title:"ФИО",type:"simple-text",value:u+" "+l+" "+d,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:e[t].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:e[t].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата привлечения к работе",type:"date",value:null,fieldName:"holiday_work_date",editable:!0,mask:!0,required:!0,minValueInput:F(0)},{title:"Количество часов",type:"select",fieldName:"holiday_work_hours",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"1"},{id:1,title:"2"},{id:2,title:"3"},{id:3,title:"4"},{id:4,title:"5"},{id:5,title:"6"},{id:6,title:"7"},{id:7,title:"8"}]},{title:"Причина",value:"Служебная необходимость",fieldName:"reason",editable:!0,mask:!0,required:!0},{title:"Вид компенсации",type:"select",fieldName:"compensation",value:null,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Оплатить работу в выходной день в двойном размере"},{id:1,title:"Оплатить работу в выходной день в одинарном размере с предоставлением другого дня отдыха"}]},{title:"Дата дополнительного дня отдыха",type:"date",value:"",fieldName:"extra_holiday_date",editable:!0,mask:!0,required:!1,specialType:"Compensation"},{title:"",type:"simple-text",value:e[t].jobGuid.toString(),fieldName:"jobGuid",visible:!1}]}},L=()=>{var f,p;const[a,e]=c.useState(null),{data:{dataUserApplication:t,dataWorkerApplication:u}}=w.useApplications(),{loading:l}=D.useBufferHolidayWork(),[d,m]=c.useState(!1),[i,n]=c.useState({}),o=d!=null?d:!1,{id:s}=S(),r=+s;return c.useEffect(()=>{t&&u&&!l&&e(I(t,u,r))},[t,r,l]),c.useEffect(()=>{a&&t&&n(G(a.data))},[a]),y.jsx(O,{isDone:o,children:!!a&&!!e&&y.jsxs(B,{children:[y.jsx(C,x(N({},a),{collapsed:o,setData:e,specialFieldsNameConfig:i})),y.jsx(H,{text:"Отправить",action:()=>E(W.HOLIDAY_WORK,[a],m),isLoading:l,completed:d,setCompleted:m,repeatable:!1,buttonSuccessText:"Отправлено",isDone:o,isActive:q(a)&&((p=(f=a.optionalCheckbox)==null?void 0:f.value)!=null?p:!0),alerts:!1})]})})};export{L as default};
