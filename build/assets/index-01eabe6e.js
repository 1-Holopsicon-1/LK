var ge=Object.defineProperty,he=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var q=(e,t,n)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))je.call(t,n)&&q(e,n,t[n]);if(z)for(var n of z(t))Ce.call(t,n)&&q(e,n,t[n]);return e},w=(e,t)=>he(e,fe(t));import{p as l,e as B,x as i,s as r,r as g,j as s,n as h,bs as K,h as k,v as N,a5 as Se,K as ye,cN as we,c as ve}from"./vendor-31894644.js";import{m as ke,n as $e,d as Q,o as Ee,p as Ge,q as $,u as b,h as X,r as I,t as Y,v as Z,w as J,x as be,y as Ie,z as Pe,D as Ne,b as Fe,E as De,G as p,K as j,H as Te,J as Ae,L as v,N as Le,O as Re,Q as Me,R as _e,U as ze,V as qe,X as Oe,M as Ue,Y as We,Z as Ve,_ as He,P as Be,a0 as Ke}from"./index-0f8b6250.js";import{e as F,s as Qe,a as Xe,b as ee,c as C,d as Ye,f as D,h as te,g as Ze,A as Je,i as G,j as et,k as tt,P as O}from"./student-53688337.js";const se=l({name:"addCompetition",sid:"ebmam4"}),E=B(e=>ke(e.competitionName),{name:"addCompetitionFx",sid:"-cvy5ax"});i({and:[{clock:se,target:E}],or:{sid:"-pbpeie"}});i({and:[{clock:E.failData,fn:e=>({message:$e(e,"Не удалось добавить соревнование"),type:"failure",time:3e3}),target:Q.evokePopUpMessage}],or:{sid:"-p9i84y"}});i({and:[{clock:E.doneData,fn:()=>({message:"Соревнование добавлено",type:"success",time:3e3}),target:Q.evokePopUpMessage}],or:{sid:"-orwt5e"}});i({and:[{clock:E.doneData,target:F.load}],or:{sid:"-oabe5u"}});i({and:[{clock:E.doneData,target:Ee.close}],or:{sid:"-nwkjbt"}});const st=r.div.withConfig({componentId:"sc-apfm2h-0"})(["display:flex;flex-direction:column;align-items:center;gap:10px;justify-content:center;min-height:300px;@media (max-width:800px){min-height:40vh;}"]),nt=()=>{const[e,t]=g.useState(""),n=()=>{se({competitionName:e})};return s.jsxs(st,{children:[s.jsx(Ge,{title:"Название",setValue:t,value:e}),s.jsx($,{text:"Добавить",onClick:n})]})},ot=[{field:"name",title:"Название"},{field:"name",title:"",render:e=>s.jsx($,{onClick:()=>F.remove(e),text:"Удалить"})}],at=r.div.withConfig({componentId:"sc-17yyi1s-0"})(["width:100%;display:flex;flex-direction:column;gap:10px;margin-top:20px;"]),it=r.div.withConfig({componentId:"sc-17yyi1s-1"})(["display:flex;flex-direction:column;width:100%;gap:10px;"]);r.div.withConfig({componentId:"sc-17yyi1s-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;gap:10px;"]);const rt=()=>{const[e]=h([Qe.$competitions]),{open:t}=b(),n=()=>{t(s.jsx(nt,{}))};return g.useEffect(()=>{F.load()},[]),s.jsx(it,{children:s.jsxs(at,{children:[s.jsx(X,{align:"left",size:4,children:"Соревнования"}),s.jsx($,{onClick:n,text:"Добавить соревнование"}),s.jsx(I,{data:e.map(o=>({name:o})),columns:ot,onRowClick:()=>{}})]})})},dt=r.div.withConfig({componentId:"sc-12vwvep-0"})(["display:flex;flex-direction:row;align-items:center;gap:10px;@media (max-width:768px){flex-wrap:wrap;}"]);var ne=(e=>(e.Group="group.groupName",e.Course="course",e))(ne||{});const U=[{id:0,title:"Не выбрано"},{id:1,title:"1 курс"},{id:2,title:"2 курс"},{id:3,title:"3 курс"},{id:4,title:"4 курс"}],lt=()=>{var d,x,f;const[e,t]=h([Xe.$filters,ee.$isExam]),[n,o]=g.useState((x=(d=e["group.groupName"])==null?void 0:d.value)!=null?x:"");return s.jsxs(dt,{children:[s.jsx(Y,{leftIcon:s.jsx(K,{}),placeholder:"Номер группы",value:n,setValue:o,customMask:Z.groupMask,onValueEmpty:()=>C.addFilter({name:"group.groupName",value:""}),onHintClick:a=>{var S;return C.addFilter({name:"group.groupName",value:(S=a==null?void 0:a.id)!=null?S:"",strict:!0})},request:J,size:"big"}),s.jsx(be,{items:U,size:"big",placeholder:"Курс",selected:(f=U.find(a=>{var S;return a.id===((S=e.course)==null?void 0:S.value)}))!=null?f:null,setSelected:a=>{if(a!=null&&a.id){C.addFilter({name:"course",value:a.id});return}C.addFilter({name:"course",value:""})}}),s.jsx(Ie,{title:"Зачет",state:t,action:a=>Ye.setIsExam(a)})]})},T=l({name:"pageIndexChanged",sid:"-yqoz9l"}),oe=l({name:"pageLoaded",sid:"adwljo"}),ct=k(0,{name:"$page",sid:"ndbopj"}).on(T,(e,t)=>t);i({and:[{clock:oe,target:[D.load,Pe.load]}],or:{sid:"8a9ft4"}});const ae=l({name:"load",sid:"h6031v"}),ie=N({and:{effect:async({currentUser:e})=>{var n;const{data:t}=await Ne((n=e==null?void 0:e.guid)!=null?n:"");return t.data},source:Fe.user},or:{name:"loadFx",sid:"-fzko9u"}});i({and:[{clock:ae,target:ie}],or:{sid:"-b03ras"}});const pt=k([],{name:"$myGroups",sid:"qqeqg2"}).on(ie.doneData,(e,t)=>t);function W(){const[e]=h([pt]);g.useEffect(()=>{ae()},[]);const t=n=>{C.resetFilters(),C.addFilter({name:ne.Group,value:n.groupName,strict:!0}),T(0)};return s.jsx(I,{onRowClick:t,data:e,columns:ut})}const ut=[{field:"groupName",title:"Группа"},{field:"curatorFullName",title:"Преподаватель"}],mt=(e,t)=>{let n=e;for(const o in t)n=n.replace(":".concat(o),t[o]);return n};r.div.withConfig({componentId:"sc-10c5ztk-0"})(["min-height:50px;display:flex;gap:5px;flex-direction:column;"]);const xt=r.div.withConfig({componentId:"sc-10c5ztk-1"})(["","{width:500px;}"],De.isNotMobile),gt=({student:e})=>{const t=Se(),{close:n}=b(),o=()=>{t.push(mt(Ae,{studentId:e.studentGuid})),n()};return s.jsx(xt,{children:s.jsxs(p,{d:"column",gap:"16px",ai:"flex-start",children:[s.jsxs(p,{d:"column",ai:"flex-start",gap:"2px",children:[s.jsx(j,{keyStr:"Группа",value:e.groupNumber}),s.jsx(j,{keyStr:"Баллы",value:e.totalPoints}),s.jsx(j,{keyStr:"Курс",value:e.course}),s.jsx(j,{keyStr:"ЛМС",value:e.lmsPoints}),s.jsx(j,{keyStr:"Группа здоровья",value:te[e.healthGroup]}),s.jsx(j,{keyStr:"Специализация",value:Ze[e.specialization]})]}),s.jsx(Te,{width:"100%",margin:"0"}),s.jsxs(p,{d:"column",gap:"4px",ai:"flex-start",children:[s.jsx(X,{align:"left",size:4,children:"Дата"}),s.jsx(Je,{studentGuid:e.studentGuid})]}),s.jsx($,{onClick:o,text:"Перейти к студенту",width:"100%"})]})})},ht=r.div.withConfig({componentId:"sc-12o9ec3-0"})(["display:grid;width:100%;"]),ft=r.div.withConfig({componentId:"sc-12o9ec3-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]),jt=r(p).withConfig({componentId:"sc-12o9ec3-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]),A=r.span.withConfig({componentId:"sc-12o9ec3-3"})(["color:",";"],({hasDebt:e})=>e&&v.red.main),Ct=[{title:"ФИО",field:"fullName",priority:"one",showFull:!0,render:(e,t)=>s.jsx(A,{hasDebt:t.hasDebt,children:t.fullName})},{title:"Группа",field:"groupNumber",priority:"one"},{title:"Посещений",field:"visits",priority:"two"},{title:"Баллы",field:"totalPoints",priority:"one"},{title:"Нормативы",field:"standardPoints",priority:"two"},{title:"ЛМС",field:"lmsPoints",priority:"two"},{title:"Группа здоровья",showFull:!0,field:"healthGroup",priority:"two",render:e=>{const t=te[e];return s.jsx("span",{children:t})}}],St=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(A,{hasDebt:t.hasDebt,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],re=l({name:"pageLoaded",sid:"-n45vlm"});i({and:[{clock:re,target:D.load}],or:{sid:"t4c48d"}});const V=()=>{const{open:e}=b(),{students:t,totalCount:n,page:o,search:d,loading:x,isExam:f}=h({students:G.$pEStudents,loading:G.$loading,totalCount:G.$pEStudentsTotalCount,page:G.$pEStudentsPage,search:et.$search,isExam:ee.$isExam});return g.useEffect(()=>{re()},[]),s.jsx(ht,{children:s.jsxs(ft,{children:[s.jsxs(jt,{children:[s.jsx(Le,{value:d,setValue:tt.update,size:"big"}),s.jsx(lt,{})]}),s.jsx(I,{loading:x,data:t,columns:f?St:Ct,onRowClick:a=>{e(s.jsx(gt,{student:a}),a.fullName)}}),s.jsx(Re,{condition:!0,align:"right",pages:Math.floor(n/Me),currentPage:o,setCurrentPage:D.setPage})]})})},L=l({name:"endSemester",sid:"-50inz6"}),de=l({name:"reset",sid:"-jpbmuk"}),P=B(async({studentId:e})=>(await _e(e),{studentGuid:e}),{name:"endSemesterFx",sid:"yxjzgs"});var u=(e=>(e.LOADING="loading",e.SUCCESS="success",e.ERROR="error",e))(u||{});const m=k({},{name:"$statuses",sid:"-dggygt"}).reset(de);i({and:[{clock:L,source:m,fn:(e,{studentId:t})=>w(y({},e),{[t]:"loading"}),target:m}],or:{sid:"77dp82"}});i({and:[{clock:P.doneData,source:m,fn:(e,{studentGuid:t})=>w(y({},e),{[t]:"success"}),target:m}],or:{sid:"7q2pec"}});i({and:[{clock:P.fail,source:m,fn:(e,{params:t})=>w(y({},e),{[t.studentId]:"error"}),target:m}],or:{sid:"88rpkm"}});i({and:[{clock:P.done,source:m,fn:(e,{params:t})=>w(y({},e),{[t.studentId]:"success"}),target:m}],or:{sid:"8rgpqw"}});i({and:[{clock:L,target:P}],or:{sid:"9lpedr"}});const yt={endSemester:L,reset:de},le={statuses:m},ce=l({name:"selectedGroupChanged",sid:"-yusgt0"}),pe=l({name:"load",sid:"4qbbdm"}),R=l({name:"reset",sid:"g7h26n"}),ue=l({name:"endSemesterForGroup",sid:"842241"}),M=k("",{name:"$selectedGroup",sid:"-n8kqn6"}).on(ce,(e,t)=>t).reset(R),_=N({and:{source:M,effect:async e=>{const{data:t}=await ze(0,{group:{value:e}},200);return t.data.students}},or:{name:"loadFx",sid:"xfnq33"}});i({and:[{source:M,filter:Boolean,target:_}],or:{sid:"gule9"}});const me=k([],{name:"$pEStudents",sid:"-7tia7t"}).on(_.doneData,(e,t)=>t).reset(R),wt=ye({and:[_.pending,Boolean],or:{name:"$loading",sid:"ghro6d"}}),vt=N({and:{source:me,effect:async e=>{e.forEach(t=>yt.endSemester({studentId:t.studentGuid}))}},or:{name:"endSemesterForGroupFx",sid:"3q6tp7"}});i({and:[{clock:le.statuses,filter:e=>Object.values(e).every(t=>t!==u.LOADING),target:pe}],or:{sid:"10n6r9"}});i({and:[{clock:ue,target:vt}],or:{sid:"1exu6n"}});const kt={load:pe,reset:R,selectedGroupChanged:ce,endSemesterForGroup:ue},$t={$loading:wt,$pEStudents:me,$selectedGroup:M},c={events:kt,stores:$t},Et={[u.LOADING]:"Загрузка",[u.ERROR]:"Не зачтено",[u.SUCCESS]:"Успешно"},Gt={[u.LOADING]:s.jsx(qe,{}),[u.ERROR]:s.jsx(we,{color:v.red.main}),[u.SUCCESS]:s.jsx(ve,{color:v.green.main})},bt=r.span.withConfig({componentId:"sc-ph8uia-0"})(["color:var(--text);font-size:1em;"]),It=()=>{const[e,t]=h([le.statuses,c.stores.$pEStudents]);return s.jsx(p,{p:"30px",d:"column",jc:"space-between",children:t.map(n=>{var o,d;return s.jsxs(p,{w:"100%",gap:"16px",ai:"flex-start",jc:"space-between",children:[s.jsx(bt,{children:n.fullName}),s.jsxs(p,{gap:"8px",w:"auto",children:[s.jsx(Oe,{align:"center",children:Et[(o=e[n.studentGuid])!=null?o:u.LOADING]}),Gt[(d=e[n.studentGuid])!=null?d:u.LOADING]]})]},n.studentGuid)})})},xe=l({name:"pageLoaded",sid:"4q0med"}),Pt=l({name:"pageUnloaded",sid:"he5rd5"});i({and:[{clock:xe,target:c.events.load}],or:{sid:"74c8dr"}});i({and:[{clock:Pt,target:c.events.reset}],or:{sid:"76jer7"}});const Nt=r.div.withConfig({componentId:"sc-s6hadh-0"})(["display:grid;width:100%;"]),Ft=r.div.withConfig({componentId:"sc-s6hadh-1"})(["display:flex;flex-direction:column;align-items:flex-end;gap:10px;justify-content:flex-end;"]);r(p).withConfig({componentId:"sc-s6hadh-2"})(["gap:8px;@media (max-width:768px){flex-direction:column;}"]);const Dt=r(p).withConfig({componentId:"sc-s6hadh-3"})([""]),Tt=[{title:"ФИО",field:"name",render:(e,t)=>s.jsx(A,{hasDebt:t.hasDebtFromPreviousSemester,children:t.fullName}),showFull:!0,priority:"one"},{title:"Группа",field:"groupNumber",priority:"three"},{title:"Баллы",field:"totalPoints",priority:"two"},{title:"Зачтено",field:"isDone",render:(e,t)=>t.totalPoints>=50?"Зачтено":"Не зачтено",priority:"one"}],H=()=>{const{open:e,close:t}=b(),{students:n,loading:o,selectedGroup:d}=h({students:c.stores.$pEStudents,loading:c.stores.$loading,selectedGroup:c.stores.$selectedGroup}),x=!!(n.length&&!o&&d),f=()=>{We.evokeConfirm({message:"Вы уверены, что хотите завершить семестр?",onConfirm:()=>{c.events.endSemesterForGroup(),e(s.jsx(It,{}))},onReject:()=>{t(),c.events.reset()}})};return g.useEffect(()=>(xe(),()=>{c.events.reset()}),[]),s.jsxs(Nt,{children:[!x&&s.jsx(Ue,{type:"alert",children:"Выберите группу чтобы провести зачет"}),s.jsxs(Ft,{children:[s.jsxs(Dt,{d:"row",jc:"space-between",p:"8px",children:[s.jsx(Y,{leftIcon:s.jsx(K,{}),placeholder:"Номер группы",value:d,setValue:c.events.selectedGroupChanged,customMask:Z.groupMask,onValueEmpty:()=>c.events.selectedGroupChanged(""),onHintClick:a=>a&&c.events.selectedGroupChanged(a.id),request:J,size:"big"}),x&&s.jsx($,{text:"Завершить семестр для ".concat(d),width:"210px",background:v.green.main,textColor:v.white.main,onClick:f})]}),x&&s.jsx(I,{loading:o,data:n,columns:Tt})]})]})},_t=()=>{const[e,t]=h([Ve.peTeacher,ct]);g.useEffect(()=>{oe()},[]);const n=[O.AdminAccess,O.SuperUser].some(o=>{var d;return(d=e==null?void 0:e.permissions)==null?void 0:d.includes(o)})?[{title:"Студенты",content:s.jsx(V,{})},{title:"Управление",content:s.jsx(rt,{})},{title:"Мои Группы",content:s.jsx(W,{})},{title:"Проведение зачета",content:s.jsx(H,{})}]:[{title:"Студенты",content:s.jsx(V,{})},{title:"Мои Группы",content:s.jsx(W,{})},{title:"Проведение зачета",content:s.jsx(H,{})}];return s.jsx(He,{padding:"10px",children:s.jsx(Be,{children:s.jsxs(p,{d:"column",gap:"2px",ai:"flex-start",children:[s.jsx(Ke,{appearance:!1,pages:n,currentPage:t,setCurrentPage:T}),n[t].content]})})})};export{_t as default};
