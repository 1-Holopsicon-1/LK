var C=Object.defineProperty,E=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var _=(s,t,e)=>t in s?C(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,h=(s,t)=>{for(var e in t||(t={}))T.call(t,e)&&_(s,e,t[e]);if(N)for(var e of N(t))B.call(t,e)&&_(s,e,t[e]);return s},k=(s,t)=>E(s,A(t));var F=(s,t,e)=>new Promise((f,l)=>{var v=o=>{try{a(e.next(o))}catch(n){l(n)}},r=o=>{try{a(e.throw(o))}catch(n){l(n)}},a=o=>o.done?f(o.value):Promise.resolve(o.value).then(v,r);a((e=e.apply(s,t)).next())});import{r as m,j as D}from"./vendor-33947725.js";import{b9 as I,ba as O,b7 as w,s as G,bb as R,P as q,B as J,F as M,I as W,S as $,c as L}from"./index-03c4ccbf.js";import{g as V,a as P}from"./get-default-subdivision-17957fb0.js";const H=(s,t,e)=>F(void 0,null,function*(){e(!1);const f=t.map(r=>{if(Array.isArray(r.data[0])){const a=r.data.map(n=>Object.assign({},...n==null?void 0:n.map(i=>{var d,b;const c={};return i!=null&&i.fieldName&&(c[i==null?void 0:i.fieldName]=i!=null&&(d=i.value)!==null&&d!==void 0&&d.title?i==null||(b=i.value)===null||b===void 0?void 0:b.title:i==null?void 0:i.value),c}))),o={};return o[s]=JSON.stringify(a),o}else return r.data.map(a=>{var o;const n={};if(a!=null&&a.fieldName&&(n[(o=a==null?void 0:a.fieldName)!==null&&o!==void 0?o:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"){var i;n[(i=a==null?void 0:a.fieldName)!==null&&i!==void 0?i:""]=JSON.stringify(a==null?void 0:a.value.map(d=>d.title))}return n})}).flat(),l=Object.assign({},...f),v=yield I.sendBufferMedicalExaminationFx({employeeGuid:l.jobGuid,start:l.extra_examination_date,end:l.isRetirement?l.extra_examination_date_2:l.extra_examination_date});!(v!=null&&v.isError)&&e(!0)}),U=s=>{const t=s.find(e=>e.fieldName==="isRetirement");return t!=null&&t.value&&t!=null&&t.value?{reason:"Compensation2"}:{reason:null}},z=(s,t,e,f,l,v,r,a,o,n)=>{const{surname:i,name:d,patronymic:b,subdivisions:c}=s,u=e?new Date(e):new Date,x=o||"",S=r||V(c),g=new Date(u.getTime()+24*60*60*1e3);return O(x)==="true"&&u.getDay()===5?g.setDate(u.getDate()+1):(u.getDay()===5||u.getDay()===6||u.getDay()===0)&&g.setDate(u.getDate()+(8-u.getDay())%7),{title:"Заявление о диспансеризации",data:[{title:"ФИО",value:i+" "+d+" "+b,fieldName:"fio",type:"simple-text",visible:!0},{title:"Подразделение/должность",value:S,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:P(c),isSpecificSelect:!0,onChange:p=>{a(p),n(p.id)}},{title:"Дата прохождения диспансеризации",type:"date",value:e,fieldName:"extra_examination_date",editable:!0,onChange:p=>{f(p)},mask:!0,required:!0,maxValueLength:1,minValueInput:w(0)},{title:"Я являюсь получателем пенсии по старости или пенсии за выслугу лет или мне осталось менее 5 лет до этого",type:"hr-checkbox",value:l||"",fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:p=>{v(p)}},{title:"Второй день отдыха",type:"date",value:g.toISOString().substr(0,10),fieldName:"extra_examination_date_2",editable:!1,mask:!0,required:!1,specialType:"Compensation2",maxValueLength:1},{title:"",type:"simple-text",value:x,fieldName:"jobGuid",visible:!1}]}},Z=()=>{var s,t;const[e,f]=m.useState(null),[l,v]=m.useState(null),[r]=m.useState(null),[a,o]=m.useState(null),[n,i]=m.useState(null),[d,b]=m.useState(null),{data:{dataUserApplication:c,dataWorkerApplication:u}}=G.useApplications(),{loading:x}=R.useBufferMedicalExamination(),[S,g]=m.useState({}),[y,p]=m.useState(!1),j=y!=null?y:!1;return m.useEffect(()=>{c&&u&&!x&&f(z(c,u,l,v,d,b,n,i,a,o))},[c,x,l,r,d]),m.useEffect(()=>{e&&c&&g(U(e.data))},[e]),D.jsx(q,{children:D.jsx(J,{isDone:j,children:!!e&&!!f&&D.jsxs(M,{children:[D.jsx(W,k(h({},e),{collapsed:j,setData:f,specialFieldsNameConfig:S})),D.jsx($,{text:"Отправить",action:()=>H("",[e],p),isLoading:x,completed:y,setCompleted:p,repeatable:!1,buttonSuccessText:"Отправлено",isDone:j,isActive:L(e)&&((s=(t=e.optionalCheckbox)===null||t===void 0?void 0:t.value)!==null&&s!==void 0?s:!0),alerts:!1})]})})})};export{Z as default};
