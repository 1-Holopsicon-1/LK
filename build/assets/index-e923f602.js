var Q=Object.defineProperty,H=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(e,t,a)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,u=(e,t)=>{for(var a in t||(t={}))U.call(t,a)&&E(e,a,t[a]);if(A)for(var a of A(t))q.call(t,a)&&E(e,a,t[a]);return e},p=(e,t)=>H(e,L(t));import{p as j,h as z,m as M,I as T,x as f,n as G,r,j as i}from"./vendor-31894644.js";import{f as W,g as w,$ as D,d as P,s as X,B as Y,F as J,I as v,S as K,dd as V,j as Z,c as y}from"./index-0f8b6250.js";const I=[{id:0,title:"Брат"},{id:1,title:"Сестра"},{id:2,title:"Бабушка"},{id:3,title:"Дедушка"},{id:4,title:"Тетя"},{id:5,title:"Дядя"},{id:6,title:"Другое"}],ee=(e,{email:t,phone:a})=>({title:"Контактные данные",data:[{title:"ФИО",value:"".concat(e.surname," ").concat(e.name," ").concat(e.patronymic),fieldName:"fio",width:"100%",editable:!1},{title:"Телефон",value:a,fieldName:"phone",type:"tel",width:"100%",editable:!0,required:!0,mask:!0},{title:"Email",value:t,fieldName:"email",type:"email",width:"100%",editable:!0,required:!0}]}),R=(e,t,{m_fio:a,m_phone:s,m_job:o,f_fio:C,f_phone:n,f_job:g})=>({title:"Контактные данные родителей (".concat(e,")"),data:[{title:"Телефон",value:e==="Мать"?s:n,fieldName:t+"phone",type:"tel",width:"100%",editable:!0,mask:!0},{title:"ФИО",value:e==="Мать"?a:C,fieldName:t+"fio",width:"100%",editable:!0},{title:"Место работы",value:e==="Мать"?o:g,fieldName:t+"job",width:"100%",editable:!0}]}),te=({relative:e,r_phone:t,r_fio:a,r_job:s})=>({title:"Контактные данные родственников",data:[{title:"Член семьи",value:W(I,e),fieldName:"relative",type:"select",items:I,width:"100%",editable:!0},{title:"Телефон",value:t,fieldName:"r_phone",type:"tel",width:"100%",editable:!0,mask:!0},{title:"ФИО",value:a,fieldName:"r_fio",width:"100%",editable:!0},{title:"Место работы",value:s,fieldName:"r_job",width:"100%",editable:!0}]}),ae=e=>e.some(t=>t.data.some(a=>Array.isArray(a)?a.some(s=>s.value):typeof a=="boolean"?a:a.value)),se=async e=>{const t=new FormData;t.set("token",w());for(const[s,o]of Object.entries(e))t.set(s,o);const{data:a}=await D.post("?saveFamilyContacts=1&token=".concat(w()),t,{headers:{"Content-Type":"multipart/form-data"}});if(a.result!=="ok")throw new Error(a.error_text);return a},oe=async()=>(await D.get("?getFamilyContacts&token=".concat(w()))).data,B=j({name:"getContacts",sid:"-vkg98w"}),O=j({name:"saveContacts",sid:"zdvs7"}),x=j({name:"formCompleted",sid:"-legib6"}),le=z(!1,{name:"$completed",sid:"yhj3np"}).on(x,(e,t)=>t),$=M({sid:"-kw7m1y",fn:()=>T({handler:oe}),name:"getFamilyContactsQuery",method:"createQuery"}),h=M({sid:"-3lw42o",fn:()=>T({handler:se}),name:"saveFamilyContactsMutation",method:"createQuery"});f({and:[{clock:B,target:$.start}],or:{sid:"-di6jlk"}});f({and:[{clock:O,target:h.start}],or:{sid:"-dfzd84"}});f({and:[{clock:h.$succeeded,fn:()=>({message:"Данные успешно сохранены",type:"success"}),target:P.evokePopUpMessage}],or:{sid:"-d28ie3"}});f({and:[{clock:h.$succeeded,target:x}],or:{sid:"-cmah6m"}});f({and:[{clock:h.$failed,fn:()=>({message:"Не удалось сохранить данные. Попробуйте еще раз",type:"failure"}),target:P.evokePopUpMessage}],or:{sid:"-ck3at6"}});const k={contacts:$.$data,completed:le,loading:$.$pending},b={getContacts:B,saveContacts:O,formCompleted:x},ie="m_",ne="f_",me=()=>{const[e,t,a,s,o,C]=G([k.contacts,b.getContacts,b.saveContacts,k.loading,k.completed,b.formCompleted]),[n,g]=r.useState(null),[c,N]=r.useState(null),[d,S]=r.useState(null),[m,_]=r.useState(null),l=o!=null?o:!1,{data:{dataUserApplication:F}}=X.useApplications();return r.useEffect(()=>{t()},[]),r.useEffect(()=>{F&&e&&(g(ee(F,e)),N(R("Мать",ie,e)),S(R("Отец",ne,e)),_(te(e)))},[F,e]),i.jsx(Y,{isDone:l,children:!!n&&!!c&&!!d&&!!m&&i.jsxs(J,{noHeader:!0,children:[i.jsx(v,p(u({},n),{collapsed:l,setData:g})),i.jsx(v,p(u({},c),{collapsed:l,setData:N})),i.jsx(v,p(u({},d),{collapsed:l,setData:S})),i.jsx(v,p(u({},m),{collapsed:l,setData:_})),i.jsx(K,{text:l?"Отправлено":"Отправить",action:()=>{a(V(Z.FAMILY_CONTACTS,[n,c,d,m]))},isLoading:s,completed:o,setCompleted:C,repeatable:!1,buttonSuccessText:"Отправлено",isDone:l,isActive:y(n)&&y(c)&&y(d)&&y(m)&&ae([c,d,m]),popUpFailureMessage:"Для отправки формы необходимо, чтобы хотя бы одно поле было заполнено",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})};export{me as default};
