import{r as m,ag as S,b7 as j,j as x,C as N}from"./vendor-198a3a64.js";import{av as _,aw as h,ar as C,ad as E,ax as O,an as A,F as T,B as F,as as I,I as R,S as k,d as B,y as L}from"./index-7ac35755.js";const w=async(s,a,i)=>{i(!1);const c=a.map(f=>{if(Array.isArray(f.data[0])){const e=f.data.map(o=>Object.assign({},...o==null?void 0:o.map(t=>{var p,l;const r={};return t!=null&&t.fieldName&&(r[t==null?void 0:t.fieldName]=(p=t==null?void 0:t.value)!=null&&p.title?(l=t==null?void 0:t.value)==null?void 0:l.title:t==null?void 0:t.value),r}))),n={};return n[s]=JSON.stringify(e),n}else return f.data.map(e=>{const n={};return e!=null&&e.fieldName&&(n[(e==null?void 0:e.fieldName)??""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(n[(e==null?void 0:e.fieldName)??""]=JSON.stringify(e==null?void 0:e.value.map(o=>o.title))),n})}).flat(),u=Object.assign({},...c);!(await _.sendBufferMedicalExaminationFx({employeeGuid:u.jobGuid,start:u.extra_examination_date,end:u.isRetirement?u.extra_examination_date_2:u.extra_examination_date})).isError&&i(!0)},G=s=>{const a=s.find(i=>i.fieldName==="isRetirement");return a!=null&&a.value&&a!=null&&a.value?{reason:"Compensation2"}:{reason:null}},H=(s,a,i,c,u,d,f)=>{const{surname:e,name:n,patronymic:o}=s,t=c?new Date(c):new Date,r=new Date(t.getTime()+24*60*60*1e3);return h(a[i].jobGuid.toString())==="true"&&t.getDay()===5?r.setDate(t.getDate()+1):(t.getDay()===5||t.getDay()===6||t.getDay()===0)&&r.setDate(t.getDate()+(8-t.getDay())%7),{title:"Заявление о диспансеризации",data:[{title:"ФИО",value:e+" "+n+" "+o,fieldName:"fio",type:"simple-text",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:a[i].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:a[i].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Дата прохождения диспансеризации",type:"date",value:c,fieldName:"extra_examination_date",editable:!0,onChange:l=>{u(l)},mask:!0,required:!0,maxValueLength:1,minValueInput:C(0)},{title:"Я являюсь получателем пенсии по старости или пенсии за выслугу лет или мне осталось менее 5 лет до этого",type:"hr-checkbox",value:d||"",fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:l=>{f(l)}},{title:"Второй день отдыха",type:"date",value:r.toISOString().substr(0,10),fieldName:"extra_examination_date_2",editable:!1,mask:!0,required:!1,specialType:"Compensation2",maxValueLength:1},{title:"",type:"simple-text",value:a[i].jobGuid.toString(),fieldName:"jobGuid"}]}},P=()=>{var b;const[s,a]=m.useState(null),[i,c]=m.useState(null),[u]=m.useState(null),[d,f]=m.useState(null),{data:{dataUserApplication:e,dataWorkerApplication:n}}=E.useApplications(),{loading:o}=O.useBufferMedicalExamination(),[t,r]=m.useState({}),[p,l]=m.useState(!1),g=p??!1,v=S(),{id:D}=j(),y=+D;return m.useEffect(()=>{e&&n&&!o&&a(H(e,n,y,i,c,d,f))},[e,y,o,i,u,d]),m.useEffect(()=>{s&&e&&r(G(s.data))},[s]),x.jsx(A,{isDone:g,children:!!s&&!!a&&x.jsxs(T,{children:[x.jsx(F,{text:"Назад к кадровым заявлениям",icon:x.jsx(N,{}),onClick:()=>v.push(I),background:"transparent",textColor:"var(--blue)"}),x.jsx(R,{...s,collapsed:g,setData:a,specialFieldsNameConfig:t}),x.jsx(k,{text:"Отправить",action:()=>w(B.HOLIDAY_WORK,[s],l),isLoading:o,completed:p,setCompleted:l,repeatable:!1,buttonSuccessText:"Отправлено",isDone:g,isActive:L(s)&&(((b=s.optionalCheckbox)==null?void 0:b.value)??!0),alerts:!1})]})})};export{P as default};
