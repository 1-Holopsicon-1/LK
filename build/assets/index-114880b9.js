var y=(e,t,s)=>new Promise((i,r)=>{var a=p=>{try{c(s.next(p))}catch(h){r(h)}},m=p=>{try{c(s.throw(p))}catch(h){r(h)}},c=p=>p.done?i(p.value):Promise.resolve(p.value).then(a,m);c((s=s.apply(e,t)).next())});import{d as oe,p as d,h as g,bO as k,k as j,N as ae,f as _,x as f,cG as ie,i as l,r as re,j as n,cH as ce}from"./vendor-04d91f24.js";import{n as w,o as B,p as le,q as de,f as pe,r as ue,k as me,t as ve,l as he,T as M,v as ge,I as A,w as L,x as fe,i as $e}from"./index-60431b6d.js";const xe="https://api.mospolytech.ru/ticketsservice",F=oe.create({baseURL:xe}),ye=e=>y(void 0,null,function*(){var t,s,i,r;const a=new FormData;if(a.append("ApplicantName",e.applicantName),a.append("Description",e.description),a.append("ServiceAreaId",e.serviceAreaId),a.append("ServiceId",e.serviceId),a.append("ServiceCategoryId",e.serviceCategoryId),a.append("Phone",(t=e.phone)!==null&&t!==void 0?t:""),a.append("Location",(s=e.location)!==null&&s!==void 0?s:""),a.append("Room",(i=e.room)!==null&&i!==void 0?i:""),a.append("Email",(r=e.email)!==null&&r!==void 0?r:""),e.files)for(let c=0;c<e.files.length;c++)a.append("Files",e.files[c]);const{data:m}=yield F.post("/tickets",a,{headers:{"Content-Type":"multipart/form-data"}});return m}),je=()=>y(void 0,null,function*(){const{data:e}=yield F.get("/handbooks/locations");return e}),Se=()=>y(void 0,null,function*(){const{data:e}=yield F.get("/handbooks/service-areas");return e}),ke=t=>y(void 0,[t],function*({serviceArea:e}){const{data:s}=yield F.get(`/handbooks/${e}`);return s}),v=d({name:"pageMounted",sid:"c5fr4t"}),E=d({name:"sendForm",sid:"-dc3oa1"}),Q=d({name:"setFiles",sid:"-521qo1"}),R=d({name:"setName",sid:"3yh40o"}),V=d({name:"setPhone",sid:"-hbpn1l"}),C=d({name:"setEmail",sid:"-8nd6m0"}),P=d({name:"setNote",sid:"azuum"}),z=d({name:"setServiceType",sid:"se3d14"}),D=d({name:"setServiceId",sid:"wut57c"}),q=d({name:"setService",sid:"dv3frd"}),U=d({name:"setLocation",sid:"fnth5a"}),G=d({name:"setRoom",sid:"epp4qo"}),H=g([],{name:"$files",sid:"7o5dze"}).on(Q,(e,t)=>t).reset(v),O=g("",{name:"$note",sid:"hv8y42"}).on(P,(e,t)=>t).reset(v),W=g("",{name:"$name",sid:"newouw"}).on(R,(e,t)=>t).on(w.applications,(e,{dataUserApplication:t})=>{if(!t)return"";const{name:s,surname:i,patronymic:r}=t;return`${i} ${s} ${r}`}),J=g("",{name:"$phone",sid:"4dnykb"}).on(V,(e,t)=>t).on(w.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.phone)!==null&&s!==void 0?s:""}),K=g("",{name:"$email",sid:"e03nsa"}).on(C,(e,t)=>t).on(w.applications,(e,{dataUserApplication:t})=>{var s;return(s=t==null?void 0:t.email)!==null&&s!==void 0?s:""}),N=k(z,null,{name:"$serviceType",sid:"-u2770n"}).reset(v),Ae=k(D,null,{name:"$serviceId",sid:"-r202nb"}).reset(v),X=k(q,null,{name:"$service",sid:"x108et"}).reset([v,N]),Y=k(G,"",{name:"$room",sid:"-ati4pj"}).reset(v),Z=g(null,{name:"$location",sid:"-gtyhi"}).on(U,(e,t)=>t).reset(v),ee=g("",{name:"$applicationNumber",sid:"-d4zgb5"}).reset(v),$=j({sid:"1f87w0",fn:()=>ae({handler:ye}),name:"sendFormMutation",method:"createMutation"}),b=j({sid:"-svpciu",fn:()=>_({handler:je}),name:"locationsQuery",method:"createQuery"}),T=j({sid:"j139hu",fn:()=>_({handler:Se}),name:"serviceAreasQuery",method:"createQuery"}),S=j({sid:"t6qo74",fn:()=>_({handler:ke}),name:"servicesQuery",method:"createQuery"});f({and:[{clock:v,target:[$.reset,B.getUserDataApplicationsFx,b.start,T.start]}],or:{sid:"-y6uhel"}});f({and:[{clock:f({and:[{clock:N,filter:Boolean}],or:{name:"clock",sid:"-sp5ly6"}}),fn:({id:e})=>({serviceArea:e.toString()}),target:S.start}],or:{sid:"-xt3mkk"}});f({and:[{clock:E,source:{services:S.$data,files:H,name:W,phone:J,email:K,note:O,serviceType:N,service:X,location:Z,room:Y},filter:({serviceType:e,service:t,services:s,name:i,phone:r,email:a,location:m,room:c})=>!!i&&!!r&&!!a&&!!e&&!!s&&!!t&&!!m&&!!c,fn:({services:e,files:t,name:s,phone:i,email:r,note:a,service:m,location:c,room:p,serviceType:h})=>{var x,I;const te=(x=(I=e.find(se=>se.items.find(ne=>ne.id===m.id.toString())))===null||I===void 0?void 0:I.id)!==null&&x!==void 0?x:"";return{applicantName:s,description:a,email:r,phone:i,location:c==null?void 0:c.title,room:p,files:t,serviceAreaId:h.id.toString(),serviceId:m.id.toString(),serviceCategoryId:te}},target:$.start}],or:{sid:"-xayezn"}});f({and:[{clock:$.finished.success,fn:({result:e})=>e.ticketId,target:ee}],or:{sid:"fnw3hx"}});f({and:[{clock:$.$failed,fn:()=>({message:"Произошла ошибка. Попробуйте позднее",type:"failure"}),target:le.evokePopUpMessage}],or:{sid:"g3ac41"}});const u={pageMounted:v,setFiles:Q,setName:R,setPhone:V,setEmail:C,setNote:P,setServiceType:z,setServiceId:D,setService:q,setLocation:U,setRoom:G,sendForm:E},o={locations:b.$data,serviceAreas:T.$data,services:S.$data,servicesLoading:S.$pending,pageLoading:j({sid:"wo8mot",fn:()=>ie(b.$pending,T.$pending,B.getUserDataApplicationsFx.pending),name:"pageLoading",method:"or"}),files:H,note:O,name:W,phone:J,email:K,serviceType:N,serviceId:Ae,service:X,location:Z,room:Y,loading:$.$pending,done:$.$succeeded,applicationNumber:ee},Ve=()=>{const[e,t,s,i]=l([u.pageMounted,o.done,o.applicationNumber,o.pageLoading]),r=l(de.isAuthenticated);return re.useEffect(()=>{e()},[]),i?n.jsx(pe,{h:"100%",d:"column",ai:"center",jc:"center",children:n.jsx(ue,{})}):n.jsx(me,{padding:"1rem",style:{overflow:"auto",alignItems:"start"},children:n.jsxs(ve,{noHeader:!0,children:[!r&&n.jsx(he,{}),n.jsx(M,{size:4,align:"left",children:"Техническое обслуживание"}),t?n.jsxs(n.Fragment,{children:["Спасибо! Ваш номер заявки ",s,"."]}):n.jsxs(n.Fragment,{children:[n.jsx(Ne,{}),n.jsx(Ie,{}),n.jsx(be,{}),n.jsx(Te,{}),n.jsx(_e,{}),n.jsx(we,{}),n.jsx(Le,{}),n.jsx(Fe,{}),n.jsx(Be,{}),n.jsx(Me,{})]})]})})},Fe=()=>{const[e,t]=l([o.note,u.setNote]);return n.jsx(ge,{placeholder:"Опишите проблему и точное местоположение",required:!0,title:"Описание заявки",value:e,setValue:t})},Ne=()=>{const[e,t]=l([o.name,u.setName]);return n.jsx(A,{title:"Фамилия Имя Отчество",placeholder:"Введите ФИО",required:!0,value:e,setValue:t})},Ie=()=>{const[e,t]=l([o.phone,u.setPhone]);return n.jsx(A,{title:"Контактный телефон (сотовый в формате +7-ххх-ххх-хх-хх или внутренний в формате хххх)",placeholder:"Введите контактный телефон",type:"tel",value:e,setValue:t,required:!0})},be=()=>{const[e,t]=l([o.email,u.setEmail]);return n.jsx(A,{title:"Адрес электронной почты",placeholder:"Введите адрес электронной почты",value:e,type:"email",setValue:t,required:!0})},Te=()=>{const[e]=l([o.serviceAreas]),[t,s]=l([o.serviceType,u.setServiceType]);return n.jsx(L,{title:"Выберите направление заявки",placeholder:"Выберите направление заявки",required:!0,isActive:!!e,width:"100%",items:e||[],selected:t,setSelected:s})},_e=()=>{const[e,t]=l([o.serviceType,o.services]),[s,i]=l([o.service,u.setService]);return n.jsx(L,{title:"Выберите необходимый сервис",placeholder:"Начните вводить название сервиса",isActive:!!e&&!!t,required:!0,width:"100%",items:t||[],selected:s,setSelected:i,withSearch:!0})},we=()=>{const[e,t]=l([o.location,u.setLocation]),s=ce(o.locations,i=>{var r;return(r=i==null?void 0:i.map(a=>({id:a.name,title:a.name})))!==null&&r!==void 0?r:[]});return n.jsx(L,{title:"Локация, где необходимо выполнить заявку",placeholder:"Начните вводить локацию",required:!0,width:"100%",isActive:!!(s!=null&&s.length),items:s!=null?s:[],selected:e,setSelected:t,withSearch:!0})},Le=()=>{const[e,t]=l([o.room,u.setRoom]);return n.jsx(A,{title:"№ аудитории",placeholder:"Введите № аудитории",value:e,setValue:t,required:!0})},Be=()=>{const[e,t]=l([o.files,u.setFiles]);return n.jsxs(n.Fragment,{children:[n.jsx(M,{size:4,align:"left",bottomGap:"5px",children:"Приложите файлы"}),n.jsx(fe,{files:e,setFiles:t,isActive:!0})]})},Me=()=>{const[e,t,s,i,r,a,m,c,p,h,x]=l([u.sendForm,o.done,o.loading,o.note,o.name,o.phone,o.email,o.serviceType,o.service,o.location,o.room]);return n.jsx($e,{text:t?"Отправлено":"Отправить",action:e,isLoading:s,completed:t,setCompleted:()=>{},repeatable:!1,buttonSuccessText:"Отправлено",isDone:t,isActive:!!i&&!!r&&!!a&&!!m&&!!c&&!!p&&!!h&&!!x,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})};export{Ve as default};
