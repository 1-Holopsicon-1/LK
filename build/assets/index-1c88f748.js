var H=Object.defineProperty,O=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(i,e,t)=>e in i?H(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,w=(i,e)=>{for(var t in e||(e={}))T.call(e,t)&&I(i,t,e[t]);if(k)for(var t of k(e))q.call(e,t)&&I(i,t,e[t]);return i},B=(i,e)=>O(i,P(e));var F=(i,e,t)=>new Promise((y,l)=>{var c=o=>{try{a(t.next(o))}catch(d){l(d)}},u=o=>{try{a(t.throw(o))}catch(d){l(d)}},a=o=>o.done?y(o.value):Promise.resolve(o.value).then(c,u);a((t=t.apply(i,e)).next())});import{r,j as _}from"./vendor-0c8c29fe.js";import{bd as E,b8 as A,s as G,be as J,P as W,B as R,F as V,I as L,S as U,c as $}from"./index-179b6f61.js";import{g as z,a as K}from"./get-default-subdivision-17957fb0.js";const M=(i,e,t)=>F(void 0,null,function*(){t(!1);const y=e.map(u=>{if(Array.isArray(u.data[0])){const a=u.data.map(d=>Object.assign({},...d==null?void 0:d.map(s=>{var f,m;const p={};return s!=null&&s.fieldName&&(p[s==null?void 0:s.fieldName]=(f=s==null?void 0:s.value)!=null&&f.title?(m=s==null?void 0:s.value)==null?void 0:m.title:s==null?void 0:s.value),p}))),o={};return o[i]=JSON.stringify(a),o}else return u.data.map(a=>{var d,s;const o={};return a!=null&&a.fieldName&&(o[(d=a==null?void 0:a.fieldName)!=null?d:""]=typeof a.value!="object"?a==null?void 0:a.value:a.value.title),a.type==="multiselect"&&(o[(s=a==null?void 0:a.fieldName)!=null?s:""]=JSON.stringify(a==null?void 0:a.value.map(p=>p.title))),o})}).flat(),l=Object.assign({},...y);l.holiday_type=="Ежегодный (основной) оплачиваемый отпуск"?l.holiday_type=1:l.holiday_type=="Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"?l.holiday_type=2:l.holiday_type=="Отпуск без сохранения заработной платы"?l.holiday_type=3:l.holiday_type=="Отпуск по коллективному договору"&&(l.holiday_type=4),!(yield E.sendBufferHolidayPlanningFx({employeeGuid:l.jobGuid,type:l.holiday_type,start:l.holiday_start,end:l.holiday_end})).isError&&t(!0)}),Q=i=>{const e=i.find(t=>t.fieldName==="holiday_type");return e!=null&&e.value&&(e==null?void 0:e.value).title==="Отпуск по коллективному договору"?{coll_dog:"collDog"}:{coll_dog:null}},X=(i,e,t,y,l,c,u,a,o,d,s,p,f,m)=>{const{surname:g,name:D,patronymic:b,subdivisions:S}=i,N=t||new Date().toISOString(),h=l||new Date().toISOString(),j=u||"",v=f||"",x=s||z(S);return{title:"Заявление о предоставлении отпуска",data:[{title:"ФИО",type:"simple-text",value:g+" "+D+" "+b,fieldName:"fio",visible:!0},{title:"Подразделение/должность",value:x,fieldName:"guid_staff",editable:!0,width:"100",required:!0,type:"select",items:K(S),isSpecificSelect:!0,onChange:n=>{p(n),m(n.id)}},{title:"Вид отпуска",type:"select",fieldName:"holiday_type",value:o,editable:!0,required:!0,onChange:n=>{d(n)},width:"100%",items:[{id:0,title:"Ежегодный (основной) оплачиваемый отпуск"},{id:1,title:"Ежегодный дополнительный оплачиваемый отпуск (в т.ч. учебный)"},{id:2,title:"Отпуск без сохранения заработной платы"},{id:3,title:"Отпуск по коллективному договору"}]},{title:"Категория для предоставления отпуска",type:"select",fieldName:"holiday_type_coll",value:j,editable:!0,required:!0,onChange:n=>{const C=new Date(Date.parse(N));C.setDate(C.getDate()+5),a(n),c(A(n?+n.data:0,C.toString()))},width:"100%",specialType:"collDog",items:[{id:0,title:"Работникам, имеющим двоих и более детей в возрасте до 14 лет",data:3},{id:1,title:"Работникам, имеющим ребенка-инвалида в возрасте до 18 лет",data:5},{id:2,title:"Одиноким матерям (отцам)",data:5},{id:3,title:"Работникам в случаях рождения ребенка, регистрации брака, смерти близких родственников",data:3},{id:4,title:"Работникам, сопровождающим детей младшего школьного возраста в школу в первый день учебного года",data:1},{id:5,title:"Работникам, имеющим общий стаж работы в Университете от 20 до 25 лет",data:1},{id:6,title:"Работникам, имеющим общий стаж работы в Университете от 25 до 30 лет",data:2},{id:7,title:"Работникам, имеющим общий стаж работы в Университете от 30 до 35 лет",data:3},{id:8,title:"Работникам, имеющим общий стаж работы в Университете свыше 35 лет",data:4}]},{title:"Начало отпуска:",type:"date",value:t,fieldName:"holiday_start",editable:!0,mask:!0,onChange:n=>{y(n),c(n)},required:!0,minValueInput:A(5)},{title:"",type:"simple-text",value:v,fieldName:"jobGuid",visible:!1},{title:"Окончание отпуска:",type:"date",value:h,fieldName:"holiday_end",editable:!0,mask:!0,required:!0,onChange:n=>{c(n)},minValueInput:l||A(0),maxValueInput:A(u?+u.data:365,N)}]}},ae=()=>{var x,n;const[i,e]=r.useState(null),[t,y]=r.useState(null),[l,c]=r.useState(null),[u,a]=r.useState(null),[o,d]=r.useState(null),[s,p]=r.useState(null),[f,m]=r.useState(null),{data:{dataUserApplication:g,dataWorkerApplication:D}}=G.useApplications(),{loading:b}=J.useBufferHolidayPlanning(),[S,N]=r.useState({}),[h,j]=r.useState(!1),v=h!=null?h:!1;return r.useEffect(()=>{g&&D&&!b&&e(X(g,D,t,y,o,d,s,p,f,m,u,a,l,c))},[g,b,t,s,f,l,u]),r.useEffect(()=>{i&&g&&N(Q(i.data))},[i]),_.jsx(W,{children:_.jsx(R,{isDone:v,children:!!i&&!!e&&_.jsxs(V,{children:[_.jsx(L,B(w({},i),{collapsed:v,setData:e,specialFieldsNameConfig:S})),_.jsx(U,{text:"Отправить",action:()=>M("",[i],j),isLoading:b,completed:h,setCompleted:j,repeatable:!1,buttonSuccessText:"Отправлено",isDone:v,isActive:$(i,S)&&((n=(x=i.optionalCheckbox)==null?void 0:x.value)!=null?n:!0),alerts:!1})]})})})};export{ae as default};
