var P=(e,i,n)=>new Promise((r,s)=>{var a=p=>{try{c(n.next(p))}catch(j){s(j)}},b=p=>{try{c(n.throw(p))}catch(j){s(j)}},c=p=>p.done?r(p.value):Promise.resolve(p.value).then(a,b);c((n=n.apply(e,i)).next())});import{s as d,j as t,d5 as U,d6 as X,r as m,R as K,d7 as V}from"./vendor-0c8c29fe.js";import{$ as J,g as Z,aF as Q,bC as u,l as A,cU as k,cV as D,u as ee,G as l,bS as te,cW as ne,X as f,bD as ie,cX as re,h as v,K as h,cY as se,H as oe,cZ as I,bR as E,L as g,c_ as O,ai as ae,W as ce,P as de,x as le,a2 as q,bq as pe}from"./index-179b6f61.js";const xe=e=>P(void 0,null,function*(){var i;let{semestr:n}=e;return(i=yield J.get("?getAcademicPerformance&semestr=".concat(n,"&token=").concat(Z())))===null||i===void 0||(i=i.data)===null||i===void 0?void 0:i.academicPerformance});function F(e){const i={};for(const n of e)i[n.exam_type]?i[n.exam_type].push(n):i[n.exam_type]=[n];return i}function G(e,i){const n=e+Math.floor((i-1)/2);return`${n}/${n+1}`}function ue(e,i,n){return n===-1?e.filter(r=>(r==null?void 0:r.year)===G(i,Number(r.semestr))):e==null?void 0:e.filter(r=>(r==null?void 0:r.year)===G(i,n))}const W=Q({api:{get:xe},prepareData:F}),C=(e,i)=>{const n=new Date(e).getMonth();return n>1&&n<8?+i*2:+i*2-1},he=e=>{const i=C(new Date().toISOString(),e),n=[];for(let r=1;r<=i;r++)n.push({id:r,title:`${r} семестр`});return n.push({id:-1,title:"Все семестры"}),n},ge=(e,i)=>F(i.filter(n=>u(n.name).includes(u(e))||u(n.teacher).includes(u(e))||u(A(n.exam_date)).includes(u(e))||u(n.bill_num).includes(u(e)))),z=(e,i)=>{var n;return e?i?k[e]||k.default:((n=k[e])==null?void 0:n.main)||k.default.main:"var(--grey)"},me=e=>e.split(" ").reduce((i,n,r)=>(r===0?i.push(n):i.push(`${n[0]}.`),i),[]).join(" "),fe=d.div.withConfig({componentId:"sc-1mqkodv-0"})(["display:flex;align-items:center;justify-content:center;color:",";width:",";height:22px;min-width:22px;min-height:22px;border-radius:50%;svg{width:100%;height:100%;}"],({grade:e})=>z(e),({superWide:e})=>e?"105px":"22px"),je=({grade:e})=>t.jsx(fe,{grade:e,superWide:e==="Не явился",children:e==="Не явился"?e:e&&(D[e]>2?t.jsx(U,{}):t.jsx(X,{}))}),be=d.div.withConfig({componentId:"sc-blq100-0"})(["width:100%;display:flex;min-height:60px;align-items:center;justify-content:space-between;padding:15px 0;box-sizing:border-box;cursor:pointer;opacity:",";"],({isGraded:e})=>e?1:.4),ke=d.div.withConfig({componentId:"sc-blq100-1"})(["display:flex;margin-right:10px;font-weight:500;hyphens:auto;@media (max-width:1000px){min-width:0px;}"]),we=d.strong.withConfig({componentId:"sc-blq100-2"})(["color:",";font-weight:600;width:",";display:flex;justify-content:flex-end;"],({color:e})=>e,({superWide:e})=>e?"105px":"30px"),ye=({item:e,type:i})=>{const{open:n}=ee(),{name:r,grade:s}=e,a=z(s),b=()=>e.grade&&n(t.jsx(Ce,{item:e,color:z(s,!0)}));return t.jsxs(be,{onClick:b,isGraded:!!e.grade,children:[t.jsxs(l,{gap:"16px",children:[t.jsx(te,{color:a,borderRadius:"9px",children:ne(r)}),t.jsxs(l,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(ke,{children:r}),t.jsx(f,{children:t.jsx(ie,{words:[me(e.teacher),A(e.exam_date)]})})]})]}),t.jsx(we,{color:a,superWide:s==="Не явился",children:i==="Зачет"?t.jsx(je,{grade:s}):s==="Не явился"?"Не явился":s&&D[s]})]})},Se=d.div.withConfig({componentId:"sc-7hxibl-0"})(["width:400px;@media (max-width:800px){width:100%;}"]),ve=d.div.withConfig({componentId:"sc-7hxibl-1"})(["margin:20px 0;"]),Ce=({item:e,color:i})=>t.jsxs(Se,{children:[t.jsx(re,{subjectName:e.name,color:i,noPadding:!0}),t.jsx(ve,{children:t.jsx(v,{size:3,align:"left",children:e.name})}),t.jsx(h,{keyStr:"Курс",value:e.course}),t.jsx(h,{keyStr:"Форма аттестации",value:e.exam_type}),t.jsx(h,{keyStr:"Дата проведения",value:A(e.exam_date)}),t.jsx(h,{keyStr:"Оценка",value:e.grade}),t.jsx(h,{keyStr:"Номер ведомости",value:e.bill_num}),t.jsx(h,{keyStr:"Семестр",value:C(e.exam_date,+e.course)}),t.jsx(h,{keyStr:"Кафедра",value:e.chair}),t.jsx(h,{keyStr:"Преподаватель",value:t.jsx(se,{id:void 0,type:"staff",name:e.teacher}),direction:"vertical"})]}),Ie=({items:e,type:i})=>t.jsx(t.Fragment,{children:e.map((n,r)=>t.jsxs(K.Fragment,{children:[t.jsx(ye,{item:n,type:i}),r!==e.length-1&&t.jsx(oe,{margin:"0",width:"100%"})]},n.id))}),ze=m.memo(Ie),Ae=({items:e,loading:i})=>{var n;return e?i?t.jsxs(l,{d:"column",ai:"flex-start",gap:"12px",children:[t.jsx(I,{shape:"rect",size:{width:"100px",height:"30px"}}),t.jsx(E,{quantity:5,avatarShape:"rect"}),t.jsx(I,{shape:"rect",size:{width:"100px",height:"30px"}}),t.jsx(E,{quantity:10,avatarShape:"rect"})]}):t.jsx(l,{d:"column",gap:"20px",children:(n=Object.keys(e))==null?void 0:n.map(r=>t.jsxs(l,{d:"column",children:[t.jsxs(v,{size:3,align:"left",width:"fit-content",children:[r,t.jsx(f,{children:e[r].length})]}),t.jsx(ze,{items:e[r]||[],type:r,loading:i})]},r))}):null},De=m.memo(Ae);function Fe(e){const i={5:0,4:0,3:0,2:0},n=e.filter(r=>!!r.grade&&r.exam_type!=="Зачет").length;return e.forEach(({grade:r,exam_type:s})=>{s!=="Зачет"&&r!==void 0&&i[D[r]]++}),n===0?i:Object.keys(i).reduce((r,s)=>(r[+s]=i[+s]/n,r),{})}const _e=d.div.withConfig({componentId:"sc-1gg99m8-0"})(["overflow:hidden;width:100%;display:flex;gap:2px;height:10px;background:var(--block-content);"]),w=d.div.withConfig({componentId:"sc-1gg99m8-1"})(["width:",";height:10px;background:",";display:flex;border-radius:2px;justify-content:center;align-items:center;color:#fff;font-weight:500;display:",";"],({percent:e})=>`calc(${e} * 100%)`,({color:e})=>e,({percent:e})=>e===0&&"none"),y=d(l).withConfig({componentId:"sc-1gg99m8-2"})(["opacity:",";"],({percentage:e})=>e===0&&"0.2"),S=d.div.withConfig({componentId:"sc-1gg99m8-3"})(["min-width:10px;width:10px;height:10px;border-radius:2px;background:",";"],({color:e})=>e),$e=({data:e,loading:i})=>{if(!e)return null;if(i)return t.jsx(I,{margin:"0",shape:"rect",size:{width:"100%",height:"12px"}});const n=Fe(e);return t.jsxs(l,{d:"column",gap:"10px",children:[t.jsxs(_e,{children:[t.jsx(w,{percent:n[5],color:g.green.main}),t.jsx(w,{percent:n[4],color:g.blue.main}),t.jsx(w,{percent:n[3],color:g.orange.main}),t.jsx(w,{percent:n[2],color:g.red.main})]}),t.jsxs(l,{gap:"30px",children:[t.jsxs(y,{percentage:n[5],gap:"4px",w:"fit-content",children:[t.jsx(S,{color:g.green.main}),t.jsxs(f,{children:["5 - ",(n[5]*100).toFixed(1),"%"]})]}),t.jsxs(y,{percentage:n[4],gap:"4px",w:"fit-content",children:[t.jsx(S,{color:g.blue.main}),t.jsxs(f,{children:["4 - ",(n[4]*100).toFixed(1),"%"]})]}),t.jsxs(y,{percentage:n[3],gap:"4px",w:"fit-content",children:[t.jsx(S,{color:g.orange.main}),t.jsxs(f,{children:["3 - ",(n[3]*100).toFixed(1),"%"]})]}),t.jsxs(y,{percentage:n[2],gap:"4px",w:"fit-content",children:[t.jsx(S,{color:g.red.main}),t.jsxs(f,{children:["2 - ",(n[2]*100).toFixed(1),"%"]})]})]})]})},Be=d.div.withConfig({componentId:"sc-1p3ekrb-0"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#246655,#46b99b,#46a4b9);background-size:600% 600%;-webkit-animation:AStudentBackground 10s ease infinite;-moz-animation:AStudentBackground 10s ease infinite;animation:AStudentBackground 10s ease infinite;img{filter:drop-shadow(2px 4px 25px black);}@-webkit-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AStudentBackground{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),Ne=d.div.withConfig({componentId:"sc-1p3ekrb-1"})(["border-radius:6px;color:#fff;display:flex;align-items:center;justify-content:space-between;width:100%;padding:16px;background:linear-gradient(270deg,#243766,#4657b9,#46a4b9,#5d46b9);background-size:800% 800%;-webkit-animation:AnimationName 10s ease infinite;-moz-animation:AnimationName 10s ease infinite;animation:AnimationName 10s ease infinite;@-webkit-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@-moz-keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}@keyframes AnimationName{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}"]),Pe=e=>{if(!e)return"empty";let i=0,n=!1;for(let r=0;r<e.length;r++){const{grade:s}=e[r];if(!s)return"empty";s!=="Отлично"&&s!=="Хорошо"&&s!=="Зачтено"&&(n=!0),s!=="Зачтено"&&s!=="Отлично"&&i++}return n?"empty":i===1?"almost":i>1?"empty":"a-student"},Ee=({data:e})=>{const i=Pe(e);return i==="empty"?null:i==="almost"?t.jsxs(Ne,{children:[t.jsxs(l,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(v,{size:3,align:"left",children:"Почти отличник"}),t.jsx(f,{fontSize:"1rem",children:"В следующий раз повезет"})]}),t.jsx(O,{src:"https://media2.giphy.com/media/Iblv3w6yvj9DTMwCsJ/giphy.gif?cid=6c09b952zc1sjle3291d5t30ls5aqkl8kw1xrr1klyc7h5gk&ep=v1_stickers_related&rid=giphy.gif&ct=g",width:"70px",height:"70px",loading:!1})]}):t.jsxs(Be,{children:[t.jsxs(l,{d:"column",ai:"flex-start",gap:"4px",children:[t.jsx(v,{size:3,align:"left",children:"В этом семестре ты отличник!"}),t.jsx(f,{fontSize:"1rem",children:"Наши поздравления!"})]}),t.jsx(O,{src:"https://i.pinimg.com/originals/d3/c6/8a/d3c68aeb6f9ead3e57f80f12d12304b8.gif",width:"70px",height:"70px",loading:!1})]})},We=()=>{var $,B;const{data:e,loading:i,error:n}=W.selectors.useData(),{data:{user:r}}=ae.useUser(),s=m.useMemo(()=>{var o;return he((o=r==null?void 0:r.course)!=null?o:0)},[r]),[a,b]=m.useState({id:C(new Date().toString(),($=r==null?void 0:r.course)!=null?$:1),title:C(new Date().toString(),(B=r==null?void 0:r.course)!=null?B:1).toString()+" семестр"}),[c,p]=m.useState(null),j=c&&!Object.keys(c!=null?c:{}).find(o=>(o==null?void 0:o.length)!==0)&&!i,L=`${(a==null?void 0:a.id)!==-1?a==null?void 0:a.id:""}`,_=o=>{W.effects.getFx({semestr:o?`${(o==null?void 0:o.id)!==-1?o==null?void 0:o.id:""}`:L})},[x,M]=m.useState(null),[R,T]=m.useState(null);m.useEffect(()=>{if(r&&e){const o=Number(a==null?void 0:a.id),Y=Number(r==null?void 0:r.enterYear.split("/")[0]),N=ue(e,Y,o);M(N),T(F(N))}},[e]);const H=(x==null?void 0:x.length)===0&&!i;return t.jsx(ce,{loading:i,load:_,error:n,data:x,children:t.jsx(de,{topRightCornerElement:!!(r!=null&&r.id)&&t.jsx(le,{onClick:_,width:"150px",items:s,selected:a,setSelected:b}),children:H||!x?t.jsx(q,{text:"Данных за этот семестр нет, попробуйте другой!"}):t.jsxs(t.Fragment,{children:[!c&&!i&&t.jsx(Ee,{data:x}),t.jsx(pe,{whereToSearch:x,searchEngine:ge,setResult:p,placeholder:"Поиск предметов",loadingOnType:!0}),j&&t.jsx(q,{text:"По данному запросу ничего не найдено",image:t.jsx(V,{})}),!j&&t.jsxs(l,{d:"column",gap:"40px",children:[t.jsx($e,{data:x,loading:i}),t.jsx(De,{items:c!=null?c:R,loading:i})]})]})})})};export{We as default};
