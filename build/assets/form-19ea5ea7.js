import{r as o,bS as k,j as r}from"./vendor-35c3991b.js";import{g as D}from"./get-form-30ba56ae.js";import{$ as m,g,f as j,s as v,W as B,B as E,F as C,I as P,S as W,b as $}from"./index-46a096a9.js";import{s as M}from"./send-form-6070792d.js";import"./find-current-in-select-ba4611d5.js";const T=t=>m.get(`?getPhoneBookData=${t}&token=${g()}`),y=t=>{const s=new FormData;s.set("token",g()),s.set("setPhoneBookData","1");for(const[c,f]of Object.entries(t))s.set(c,f);return m.post("?setPhoneBookData=1",s,{headers:{"Content-Type":"multipart/form-data"}})},n=j({defaultStore:{completed:!1,error:null,loading:!0,data:null},api:{get:T,post:y}}),G=()=>{const[t,s]=o.useState(null),[c,f]=o.useState(!1),[F,S]=o.useState(!1),{guid:l}=k(),i=c??!1,[a,p]=o.useState(l),{data:u,error:x}=n.selectors.useForm(),{data:{dataUserApplication:e}}=v.useApplications();return o.useEffect(()=>{e&&p(l||(e==null?void 0:e.subdivisions[0].guid_staff))},[e]),o.useEffect(()=>{var d;if(u&&a){const b=(d=e==null?void 0:e.subdivisions)==null?void 0:d.find(h=>h.guid_staff===a);s(D(u,b))}},[a,u]),o.useEffect(()=>()=>{n.events.clearStore()},[]),a?r.jsx(B,{load:()=>{n.effects.getFormFx(a)},data:e&&u,error:x,children:r.jsx(E,{isDone:i,children:!!t&&r.jsxs(C,{noHeader:!0,children:[r.jsx(P,{...t,collapsed:i,setData:s}),r.jsx(W,{text:i?"Отправлено":"Отправить",action:()=>M(t,n.effects.postFormFx,S,n.events.changeCompleted),isLoading:F,completed:c,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:i,isActive:$(t),popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})}):null};export{G as default};
