import{s as l,j as n,r as b,cV as J,n as Q,R as _}from"./vendor-8312535b.js";import{G as y,E as p,cv as F,cw as Z,cx as E,L as ee,cy as te,cz as ne,bx as B,bM as H,cA as re,cB as ae,a2 as G,cC as oe,bL as se,cD as ie,cE as ce,cF as le,ar as de,av as N,cG as he,X as U,cH as pe,u as ge,cI as ue,l as xe,cJ as me,cK as fe,cn as De,cm as we}from"./index-3ed27df5.js";const W=({isCurrent:e,isCurrentChosenDay:t})=>{if(t&&!e)return"var(--text)";if(e&&t)return"var(--reallyBlue)"},O=({isCurrent:e,isCurrentChosenDay:t})=>e&&t?"#fff":t?"var(--invert-text)":e?"var(--blue)":"var(--text)",be=l(y).withConfig({componentId:"sc-178gzfm-0"})(["padding-left:var(--time-width);"]),ye=l.div.withConfig({componentId:"sc-178gzfm-1"})(["width:100%;font-weight:500;height:44px;border-radius:4px;font-size:0.86rem;cursor:pointer;&:hover{background:var(--theme-3);}&::before,&::after{content:'';display:",";height:calc(100% - 64px);top:54px;width:1.5px;position:absolute;background:var(--theme-4);}&::after{right:0;}","{font-size:0.8rem;height:",";&::after,&::before{top:90px;height:calc(100% - 100px);}}"],({showColumns:e})=>e?"block":"none",p.isMobile,({showDates:e})=>e?"80px":"50px"),Ce=l(y).withConfig({componentId:"sc-178gzfm-2"})(["margin:2px 0;","{flex-direction:column;margin:6px 0;}"],p.isMobile),je=l.span.withConfig({componentId:"sc-178gzfm-3"})(["margin-left:auto;margin-right:",";background:",";color:",";padding:5px;border-radius:25px;","{margin-right:auto;padding:4px;}"],({showDates:e})=>e?"0":"auto",({showDates:e})=>!e&&W,({showDates:e})=>e?"var(--grey)":O,p.isMobile),ke=l.span.withConfig({componentId:"sc-178gzfm-4"})(["height:26px;min-width:26px;display:flex;justify-content:center;align-items:center;border-radius:100px;margin-right:auto;margin-left:2px;background:",";color:",";font-weight:",";","{margin-left:auto;margin-top:4px;font-size:",";}"],W,O,({isCurrent:e,isCurrentChosenDay:t})=>e&&t&&"600",p.isMobile,({isCurrent:e})=>e&&"0.8rem"),ve=l.div.withConfig({componentId:"sc-9mih1d-0"})(["display:flex;align-items:center;gap:4px;margin:0 auto;width:fit-content;"]),V=l.div.withConfig({componentId:"sc-9mih1d-1"})(["width:6px;height:6px;border-radius:10px;background:",";@media (max-width:768px){width:5px;height:5px;}"],({background:e})=>e),Y=({subjects:e})=>e?n.jsx(ve,{children:e.map(t=>n.jsx(V,{background:t.color.main},t.startTime))}):null,Ie=()=>{const e=new Date;let t=F(e);e.getDay()===0&&(t=Z(e,1));const a=Object.keys(E).reduce((o,i)=>(o[E[i].short]="",o),{});for(let o=0;o<6;o++){const i=t.toLocaleDateString("ru-RU",{day:"2-digit"});t.setDate(t.getDate()+1),a[Object.keys(a)[o]]=i}return a},L=({showDates:e,showColumns:t,currentChosenDay:a,onDayClick:o,events:i})=>{const c=Ie();return n.jsx(be,{jc:"space-between",children:Object.keys(c).map((r,s)=>{const d=c[r],h=s===a;return n.jsxs(ye,{showDates:e,showColumns:t,onClick:o&&(()=>o==null?void 0:o(s)),children:[n.jsxs(Ce,{children:[n.jsx(je,{isCurrent:+d===new Date().getDate(),isCurrentChosenDay:!e&&h,showDates:e,children:r}),e&&n.jsx(ke,{isCurrentChosenDay:h,isCurrent:+d===new Date().getDate(),children:d})]}),i&&e&&n.jsx(Y,{subjects:i[Object.keys(i)[s]]}),i&&!e&&i[Object.keys(i)[s]].length>0&&n.jsx(y,{jc:"center",children:n.jsx(V,{background:ee.grey.main})})]},r)})})},q=({interval:e,showDates:t,events:a,onDayClick:o})=>{const i=e[0]*60,c=te();return{handleOpenModal:ne(),onDayClick:o,shift:i,showDates:t,interval:e,events:a,scale:c}},A=e=>e!==void 0?e:new Date().getDay()===0?0:new Date().getDay()-1,Me=({events:e,currentChosenDay:t,showDates:a=!0,interval:o=[0,23]})=>{const{isSmallDesktop:i}=B(),{scale:c,shift:r,events:s,handleOpenModal:d}=q({interval:o,events:e}),[h,f]=b.useState(null),[m,g]=b.useState(A(t)),x=b.useRef(null);b.useEffect(()=>{var u;if(e){const D=Object.keys(e!=null?e:{})[m],X=(u=e[D].find($=>H($,!0)))!=null?u:null;f(X)}else f(null)},[e]);const w=h?`${h.startTime} - ${re(h.startTime,h.duration)}`:"9:00",j=b.useCallback(u=>{i?d(u):f(u)},[i]),C=u=>{const D=Math.floor(u.currentTarget.scrollLeft/u.currentTarget.clientWidth);g(D)},k=u=>{x.current&&(x.current.scrollLeft=x.current.clientWidth*u)};return b.useLayoutEffect(()=>{k(A(t))},[x,t]),{currentDay:m,events:s,carouselRef:x,interval:o,scale:c,shift:r,showDates:a,chosenEvent:h,timeInterval:w,currentChosenDay:t,handleDayClick:k,handleCarouselScroll:C,onEventClick:j}},z="calc(100vh - var(--header-height) - 110px)",R="calc(100vh - var(--header-height) - 185px)",K="calc(100vh - var(--header-height) - 170px);",P=l(y).withConfig({componentId:"sc-13irvko-0"})(["--time-width:55px;","{--time-width:35px;}"],p.isMobile),Ee=l(P).withConfig({componentId:"sc-b5gqbc-0"})(["height:",";","{height:",";}","{height:",";}"],z,p.isTablet,K,p.isMobile,R),Se=l.div.withConfig({componentId:"sc-b5gqbc-1"})(["min-width:340px;max-width:340px;height:calc(100vh - 220px);z-index:10;background:var(--block-content);border-radius:10px;top:0;overflow:hidden;box-shadow:var(--block-shadow);","{display:none;}"],p.isSmallTesktop),Te=l.div.withConfig({componentId:"sc-b5gqbc-2"})(["overflow-y:hidden;overflow-x:auto;height:100%;width:100%;gap:32px;display:flex;scroll-snap-type:x mandatory;&{.calendar-wrapper{scroll-snap-align:center;min-width:100%;}}"]),We=e=>{var x;const{currentDay:t,events:a,carouselRef:o,interval:i,scale:c,shift:r,chosenEvent:s,showDates:d,timeInterval:h,handleDayClick:f,handleCarouselScroll:m,onEventClick:g}=Me(e);return n.jsxs(Ee,{d:"column",gap:"12px",children:[n.jsx(L,{onDayClick:f,currentChosenDay:t,showDates:d,showColumns:!1,events:a}),n.jsxs(y,{h:"100%",gap:"18px",children:[n.jsx(Te,{onScroll:m,ref:o,children:Object.keys(a!=null?a:{}).map((w,j)=>{const C=a==null?void 0:a[w];return n.jsx(ae,{events:C,interval:i,scale:c,weekday:j+1,currentDay:t,shift:r,onEventClick:g},w)})}),n.jsx(Se,{children:s?n.jsx(oe,{isNextEvent:se(a==null?void 0:a.saturday,s,!0),timeInterval:h,color:s.color,name:s.title,place:s.place,link:s.link,groups:s.groups,weekday:s.weekday,teachers:s.people,dateInterval:s.dateInterval,rooms:(x=s.rooms)!=null?x:[],isCurrentEvent:H(s,!0)}):n.jsx(G,{text:"Ничего не выбрано",image:n.jsx(J,{})})})]})]})},Oe=l(P).withConfig({componentId:"sc-13hlrk1-0"})(["height:",";position:relative;","{height:",";}","{height:",";}"],z,p.isTablet,K,p.isMobile,R),Le=e=>{const{handleOpenModal:t,onDayClick:a,shift:o,scale:i,showDates:c,interval:r,events:s}=q(e);return n.jsxs(Oe,{d:"column",children:[n.jsx(L,{onDayClick:a,showDates:c,showColumns:!0,events:s}),n.jsxs(ie,{children:[n.jsx(ce,{interval:r,scale:i}),Object.keys(E).map((d,h)=>n.jsx(le,{showTime:!1,weekDay:h+1,shortInfo:!0,events:s==null?void 0:s[d],scale:i,shift:o,currentEvent:null,interval:r,onClick:t},d))]})]})},S=e=>{const t=new Date(e),a=t.getDate()-(t.getDay()-1)+6;return new Date(t.setDate(a))},v=(e,t)=>{const o=(t.getTime()-e.getTime())/(1e3*3600*24);return o-Math.floor(o/6.55)+1},ze=l.div.withConfig({componentId:"sc-1xp14d0-0"})(["width:100%;display:flex;flex-direction:column;height:",";position:relative;","{height:",";}"],z,p.isMobile,R),Re=l.div.withConfig({componentId:"sc-1xp14d0-1"})(["display:flex;flex-direction:row;flex-wrap:wrap;border-left:1px solid var(--theme-3);border-top:1px solid var(--theme-3);border-bottom:1px solid var(--theme-3);overflow-y:auto;scroll-snap-type:y mandatory;scroll-padding-top:100px;","{&::-webkit-scrollbar{display:none;}}","{border:none;scroll-padding-top:50px;}"],p.isMiddleTesktop,p.isMobile),Ne=l.div.withConfig({componentId:"sc-1xp14d0-2"})(["padding:6px;width:1000px;max-width:calc(100% / 6);height:calc((100vh / 6) - 6px);background:transparent;border-right:1px solid var(--almostTransparentOpposite);border-bottom:1px solid var(--almostTransparentOpposite);display:flex;flex-direction:column;align-items:center;opacity:",";background:",";scroll-snap-align:center;","{padding:12px;gap:4px;height:calc((100vw / 6) - 5.5px);border-right:none;}"],({disabled:e})=>e?"0.4":"1",({disabled:e})=>e?"var(--theme-1t)":"transparent",p.isMobile),Ae=l.div.withConfig({componentId:"sc-1xp14d0-3"})(["width:100%;font-size:0.9rem;font-weight:500;display:flex;align-items:center;","{justify-content:center;}"],p.isMobile),_e=l.div.withConfig({componentId:"sc-1xp14d0-4"})(["height:26px;width:26px;display:flex;justify-content:center;align-items:center;border-radius:30px;background:",";color:",";"],W,O),Fe=l.div.withConfig({componentId:"sc-1xp14d0-5"})(["position:sticky;width:100%;height:50px;font-size:1.2rem;font-weight:500;top:0px;padding:10px;z-index:100;margin:4px 0;background:var(--block);","{background:var(--theme);}"],p.isMobile),T=(e,t)=>e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear(),Be=l(y).withConfig({componentId:"sc-1mwhn0h-0"})(["padding:4px;border-radius:4px;cursor:pointer;&:hover{filter:brightness(0.92);}"]),He=l.div.withConfig({componentId:"sc-1mwhn0h-1"})(["font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:0.8rem;opacity:0.8;color:",";"],({textColor:e})=>e),Ge=e=>{const{title:t,color:a,onClick:o,startTime:i}=e,c=Q(de.userSettings),r=(c==null?void 0:c.appearance.theme)===N.Light?a.dark3:a.light3,s=(c==null?void 0:c.appearance.theme)===N.Light?a.transparent3:a.transparent2,d=()=>o==null?void 0:o(e);return n.jsxs(Be,{textColor:r,background:s,gap:"6px",onClick:d,children:[n.jsx(he,{isCurrentEvent:!1,color:a}),n.jsx(He,{textColor:r,children:t}),n.jsx(U,{fontSize:"0.7rem",children:i})]})},I=4,Ue=(e,t)=>{const a=pe(t);return a==="sunday"?[]:e==null?void 0:e[a].filter(o=>o.endDate?t>=o.startDate&&t<=o.endDate:T(o.startDate,t))},Ve=({daysAmount:e,startDate:t,events:a,addOneOnWeekends:o,handleEventClick:i,disabled:c=!1})=>{if(e<0||isNaN(e))return n.jsx(G,{text:"Неправильная длина календаря"});const r=new Date(t),{isMobile:s}=B(),{open:d}=ge(),h=(f,m)=>()=>{d(n.jsx(fe,{isCurrentDay:!1,dayEvents:f,day:m}),m)};return n.jsx(n.Fragment,{children:Array(e).fill(0).map((f,m)=>{var C,k,u;if(m!==0)r.getDay()===6&&o?r.setDate(r.getDate()+2):r.setDate(r.getDate()+1);else if(r.getDay()===0)return null;const g=Ue(a,r),x=S(r),w=r.getDay()===1&&x.getMonth()!==r.getMonth(),j=x.getMonth()===r.getMonth()&&m===0&&r.getDay()===1||r.getDay()===1&&r.getDate()===1;return n.jsxs(_.Fragment,{children:[(j||w)&&n.jsx(Fe,{children:ue(w?S(r).toLocaleDateString("ru-RU",{month:"long"}):r.toLocaleDateString("ru-RU",{month:"long"}))}),n.jsxs(Ne,{disabled:c,onClick:h(g,xe(r)),children:[n.jsxs(Ae,{children:[n.jsxs(_e,{isCurrentChosenDay:T(r,new Date),isCurrent:T(r,new Date),children:[me(r.getDate())," "]}),!s&&r.getDate()===1&&r.toLocaleDateString("ru-RU",{month:"short"})]}),!s&&n.jsxs(y,{d:"column",ai:"flex-start",gap:"0px",children:[(C=g==null?void 0:g.slice(0,I))==null?void 0:C.map(D=>n.jsx(Ge,{...D,onClick:i},D.title+D.startTime+D.dateInterval)),((k=g==null?void 0:g.length)!=null?k:0)>I&&n.jsxs(U,{children:["И еще ",((u=g==null?void 0:g.length)!=null?u:0)-I]})]}),s&&n.jsx(Y,{subjects:g})]})]},r.toLocaleDateString("ru-RU"))})})},M=_.memo(Ve),Ye=({events:e,startDate:t,endDate:a,onDayClick:o})=>{const i=new Date(t),c=new Date(a),r=F(i),s=c.getDay()!==0?S(c):c,d=v(i,c);return n.jsxs(ze,{children:[n.jsx(L,{showColumns:!1,events:null,onDayClick:o}),n.jsxs(Re,{children:[n.jsx(M,{daysAmount:v(r,i)-1,startDate:r,events:e,disabled:!0,addOneOnWeekends:!1}),n.jsx(M,{daysAmount:d,startDate:i,events:e,addOneOnWeekends:!0}),n.jsx(M,{daysAmount:v(c,s)-1,startDate:new Date(c.getFullYear(),c.getMonth(),c.getDate()+1),events:e,disabled:!0,addOneOnWeekends:!1})]})]})},Pe=({events:e,view:t,showDates:a,startDate:o,endDate:i})=>{const[c,r]=b.useState(void 0),s=h=>{De.changeView(we.day),r(h)},d=[n.jsx(We,{currentChosenDay:c,events:e,interval:[9,22],showDates:a},"day"),n.jsx(Le,{events:e,interval:[9,22],showDates:a,onDayClick:s},"week"),n.jsx(Ye,{events:e,startDate:o,endDate:i,onDayClick:s},"month")];return n.jsx(n.Fragment,{children:d[t]})};export{Pe as T};
