import{m as j,n as O,a4 as A,p as h,h as x,x as a,q as N,r as S,j as s,F as P,a2 as Q,a1 as R,s as V}from"./vendor-48260ac4.js";import{g as v,$ as y,d as B,B as D,F,G as W,V as H,h as G,M as J,q as E,S as _,p as q,L as K}from"./index-1b291f82.js";const X=async()=>{new FormData().set("token",v());const{data:t}=await y.get(`?getChildren&token=${v()}`);return t},Y=async e=>{const t=new FormData;t.set("token",v()),t.set("children",JSON.stringify(e));const{data:n}=await y.post("?saveChildren=1",t,{headers:{"Content-Type":"multipart/form-data"}});if(n.result!=="ok")throw new Error(n.errors);return n},Z=async({id:e})=>{const{data:t}=await y.get(`?deleteChildren=${e}&token=${v()}`);if(t.result!=="ok")throw new Error(t.errors);return t};function $(e){return!Number.isNaN(Number(e))}const u=j({sid:"e6q5sh",fn:()=>O({handler:X}),name:"getChildrensQuery",method:"createQuery"}),p=j({sid:"msh5e3",fn:()=>A({handler:Y}),name:"saveChildrensMutation",method:"createMutation"}),w=j({sid:"-7alc01",fn:()=>A({handler:Z}),name:"deleteChildrenMutation",method:"createMutation"}),o=h({name:"pageMounted",sid:"djyjfq"}),b=h({name:"addChildren",sid:"v90e6m"}),I=h({name:"editChildren",sid:"-zhb01p"}),z=h({name:"childrensSaved",sid:"-aup8ei"}),M=h({name:"childrenDeleted",sid:"-jlo5mb"}),ee=x(0,{name:"$counter",sid:"-7ly1ij"}).on(b,e=>e+1).reset(o),r=x([{fio:"",birthdate:"",id:"n0",created:new Date().toISOString()}],{name:"$newChildrens",sid:"lqhxdm"}).reset([o,p.finished.success]),T=x(!1,{name:"$isActive",sid:"-yi3kcv"}).reset(o),U=x([],{name:"$allChildrens",sid:"-i9ix64"}).reset(o);a({and:[{clock:o,target:u.start}],or:{sid:"-byuyps"}});a({and:[{clock:b,source:{newChildrens:r,counter:ee},fn:({newChildrens:e,counter:t})=>[...e,{fio:"",birthdate:"",id:"n"+t.toString(),created:new Date().toISOString()}],target:r}],or:{sid:"-bl43vr"}});a({and:[{clock:M,filter:({id:e})=>$(e),target:w.start}],or:{sid:"-aoo8vg"}});a({and:[{clock:M,filter:(e,{id:t})=>!$(t),source:r,fn:(e,{id:t})=>e.filter(n=>n.id!==t),target:r}],or:{sid:"-aktopx"}});a({and:[{clock:I,source:r,fn:(e,{id:t,data:n})=>e.map(i=>i.id===t?{...i,...n}:i),target:r}],or:{sid:"-a389qd"}});a({and:[{clock:[u.$data,r],source:{saved:u.$data,newChildrens:r},fn:({saved:e,newChildrens:t})=>[...e||[],...t],target:U}],or:{sid:"-99jdov"}});a({and:[{clock:z,source:r,target:p.start}],or:{sid:"-8re63y"}});a({and:[{clock:r,fn:e=>e.every(t=>t.birthdate&&t.fio),target:T}],or:{sid:"-8on755"}});a({and:[{clock:[p.$succeeded,w.$succeeded],target:u.start}],or:{sid:"-ypefk4"}});a({and:[{clock:p.$succeeded,fn:()=>({type:"success",message:"Данные сохранены"}),target:B.evokePopUpMessage}],or:{sid:"-yn796o"}});a({and:[{clock:w.$succeeded,fn:()=>({type:"success",message:"Данные сохранены"}),target:B.evokePopUpMessage}],or:{sid:"-y797z7"}});const c={childrens:U,loading:u.$pending,saving:p.$pending,isActive:T},l={pageMounted:o,addChildren:b,saveChildrens:z,deleteChildren:M,editChildren:I},re=()=>{const[e,t,n,i,k,g,m]=N([l.pageMounted,c.loading,c.childrens,l.addChildren,l.saveChildrens,c.saving,c.isActive]),[d,L]=S.useState(!1),f=d??!1;return S.useEffect(()=>{e()},[]),t?s.jsx(D,{isDone:f,children:s.jsx(F,{noHeader:!0,children:s.jsx(W,{w:"100%",jc:"center",ai:"center",children:s.jsx(H,{})})})}):s.jsx(D,{isDone:f,children:s.jsxs(F,{noHeader:!0,children:[s.jsx(G,{size:3,align:"left",children:"Состав семьи"}),s.jsx(J,{type:"info",title:"Как заполнить",icon:s.jsx(P,{}),children:"Укажите ваших детей и внуков в возрасте от 2 до 14 лет"}),[...n].map(C=>s.jsx(te,{id:C.id,fio:C.fio,birthdate:C.birthdate},C.id)),s.jsx(E,{icon:s.jsx(Q,{}),text:"Добавить",onClick:()=>i(),background:"transparent"}),s.jsx(_,{text:f?"Отправлено":"Отправить",action:()=>{k()},isLoading:g,completed:d,setCompleted:L,repeatable:!1,buttonSuccessText:"Отправлено",isDone:f,isActive:m,popUpFailureMessage:"Для отправки формы необходимо, чтобы все поля были заполнены",popUpSuccessMessage:"Данные формы успешно отправлены"})]})})},te=({id:e,fio:t,birthdate:n})=>{const[i,k,g]=N([c.saving,l.deleteChildren,l.editChildren]),m=!$(e);return s.jsxs(se,{children:[s.jsx(q,{placeholder:"ФИО",value:t,setValue:d=>{g({id:e,data:{fio:d,birthdate:n}})},required:!0,isActive:m}),s.jsx(q,{type:"date",placeholder:"Дата рождения",value:n,setValue:d=>{g({id:e,data:{fio:t,birthdate:d}})},required:!0,width:"30%",minWidth:"150px",isActive:m}),s.jsx(E,{icon:s.jsx(R,{}),textColor:K.red.main,onClick:()=>k({id:e}),background:"transparent",isActive:!i})]})},se=V.div.withConfig({componentId:"sc-1tg60zq-0"})(["display:flex;align-items:flex-end;column-gap:5px;"]);export{re as default};
