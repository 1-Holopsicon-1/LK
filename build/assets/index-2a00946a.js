var x=Object.defineProperty,h=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var j=(i,t,a)=>t in i?x(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,N=(i,t)=>{for(var a in t||(t={}))g.call(t,a)&&j(i,a,t[a]);if(v)for(var a of v(t))D.call(t,a)&&j(i,a,t[a]);return i},_=(i,t)=>h(i,S(t));import{r as c,cM as A,j as m}from"./vendor-31894644.js";import{be as I,b7 as p,s as F,bf as k,B as w,F as B,I as T,S as q,j as H,c as E}from"./index-0f8b6250.js";const G=async(i,t,a)=>{a(!1);const d=t.map(f=>{if(Array.isArray(f.data[0])){const e=f.data.map(l=>Object.assign({},...l==null?void 0:l.map(s=>{var y,b;const u={};return s!=null&&s.fieldName&&(u[s==null?void 0:s.fieldName]=(y=s==null?void 0:s.value)!=null&&y.title?(b=s==null?void 0:s.value)==null?void 0:b.title:s==null?void 0:s.value),u}))),r={};return r[i]=JSON.stringify(e),r}else return f.data.map(e=>{var l,s;const r={};return e!=null&&e.fieldName&&(r[(l=e==null?void 0:e.fieldName)!=null?l:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(r[(s=e==null?void 0:e.fieldName)!=null?s:""]=JSON.stringify(e==null?void 0:e.value.map(u=>u.title))),r})}).flat(),o=Object.assign({},...d);!(await I.sendBufferHolidayTransferFx({employeeGuid:o.jobGuid,reason:o.reason,period:{from:{startDate:o.holiday_old_start,endDate:o.holiday_old_end},to:{startDate:o.holiday_new_start,endDate:o.holiday_new_end}}})).isError&&a(!0)},O=(i,t,a)=>{const{surname:d,name:o,patronymic:n}=i;return{title:"Заявление о переносе отпуска",data:[{title:"ФИО",type:"simple-text",value:d+" "+o+" "+n,fieldName:"fio",visible:!0},{title:"Должность",type:"simple-text",fieldName:"post",value:t[a].jobTitle.toString(),visible:!0},{title:"Подразделение",type:"simple-text",value:t[a].subDivision.toString(),fieldName:"subDivision",visible:!0},{title:"Начало отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_start",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"",type:"simple-text",value:t[a].jobGuid.toString(),fieldName:"jobGuid"},{title:"Окончание отпуска до переноса:",type:"date",value:"",fieldName:"holiday_old_end",editable:!0,mask:!0,required:!0,minValueInput:p(0)},{title:"Начало отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_start",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Окончание отпуска после переноса:",type:"date",value:"",fieldName:"holiday_new_end",editable:!0,mask:!0,required:!0,minValueInput:p(5)},{title:"Причина",type:"select",fieldName:"reason",value:"",editable:!0,required:!0,width:"100%",items:[{id:0,title:"Семейные обстоятельства"},{id:1,title:"Рабочая необходимость"}]}]}},L=()=>{var s,u;const[i,t]=c.useState(null),{data:{dataUserApplication:a,dataWorkerApplication:d}}=F.useApplications(),{loading:o}=k.useBufferHolidayTransfer(),[n,f]=c.useState(!1),e=n!=null?n:!1,{id:r}=A(),l=+r;return c.useEffect(()=>{a&&d&&!o&&t(O(a,d,l))},[a,l,o]),m.jsx(w,{isDone:e,children:!!i&&!!t&&m.jsxs(B,{children:[m.jsx(T,_(N({},i),{collapsed:e,setData:t})),m.jsx(q,{text:"Отправить",action:()=>G(H.DISMISSAL,[i],f),isLoading:o,completed:n,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:e,isActive:E(i)&&((u=(s=i.optionalCheckbox)==null?void 0:s.value)!=null?u:!0),alerts:!1})]})})};export{L as default};
