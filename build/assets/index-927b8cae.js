import{r as c,cM as h,j as g}from"./vendor-8312535b.js";import{b6 as A,b2 as w,aW as C,b7 as R,s as _,B as F,F as G,I,S as O,j as k,c as L}from"./index-3ed27df5.js";const q=async(d,l,i)=>{var f,s;i(!1);const v=l.map(p=>{if(Array.isArray(p.data[0])){const e=p.data.map(n=>Object.assign({},...n==null?void 0:n.map(t=>{var y,b;const m={};return t!=null&&t.fieldName&&(m[t==null?void 0:t.fieldName]=(y=t==null?void 0:t.value)!=null&&y.title?(b=t==null?void 0:t.value)==null?void 0:b.title:t==null?void 0:t.value),m}))),r={};return r[d]=JSON.stringify(e),r}else return p.data.map(e=>{var n,t;const r={};return e!=null&&e.fieldName&&(r[(n=e==null?void 0:e.fieldName)!=null?n:""]=typeof e.value!="object"?e==null?void 0:e.value:e.value.title),e.type==="multiselect"&&(r[(t=e==null?void 0:e.fieldName)!=null?t:""]=JSON.stringify(e==null?void 0:e.value.map(m=>m.title))),r})}).flat(),a=Object.assign({},...v),u=await A.postApplicationFx({guid:w(C()||"{}").IndividualGuid,jobGuid:a.jobGuid,signingDate:new Date(new Date().getTime()-new Date().getTimezoneOffset()*6e4).toISOString(),dateOfDismissal:a.last_day,isSendMail:a.get_tk==="По почте",isRetirement:!!a.isRetirement,address:a.get_tk_address,reason:a.reason.charAt(0).toLowerCase()+a.reason.slice(1)});!((s=(f=u==null?void 0:u.data)==null?void 0:f.dismissalResponse)!=null&&s.isError)&&i(!0)},B=(d,l,i,v,a,u,f,s,p,e,r,n,t)=>{const{surname:m,name:y,patronymic:b}=d;return{title:"Заявление на увольнение",data:[{title:"ФИО",value:m+" "+y+" "+b,fieldName:"fio",type:"simple-text"},{title:"Должность",type:"simple-text",fieldName:"post",value:l[i].jobTitle.toString()},{title:"Подразделение",type:"simple-text",value:l[i].subDivision.toString(),fieldName:"subDivision"},{title:"",type:"simple-text",value:l[i].jobGuid.toString(),fieldName:"jobGuid"},{title:"Ставка",type:"simple-text",value:l[i].rate.toString(),fieldName:"reate"},{title:"Дата увольнения (последний рабочий день)",type:"date",value:n,fieldName:"last_day",editable:!0,mask:!0,required:!0,minValueInput:R(0),onChange:o=>{t(o)}},{title:"Причина",type:"text",value:e,fieldName:"reason",editable:!0,mask:!0,required:!0,maxValueLength:50,onChange:o=>{r(o)}},{title:"В связи с выходом на пенсию",type:"hr-checkbox",value:v,fieldName:"isRetirement",editable:!0,mask:!0,required:!1,onChange:o=>{a(o)}},{title:"Способ получения трудовой книжки",type:"select",fieldName:"get_tk",value:s,editable:!0,required:!0,width:"100%",items:[{id:0,title:"Очно"},{id:1,title:"По почте"}],onChange:o=>{p(o)}},{title:"Адрес для отправки трудовой книжки",value:u,fieldName:"get_tk_address",editable:!0,mask:!0,required:(s==null?void 0:s.title)=="По почте",visible:(s==null?void 0:s.title)=="По почте",onChange:o=>{f(o)}}]}},M=()=>{var x,N;const[d,l]=c.useState(null),{data:{dataUserApplication:i,dataWorkerApplication:v},workerLoading:a}=_.useApplications(),[u,f]=c.useState(!1),[s,p]=c.useState(null),[e,r]=c.useState(!1),[n,t]=c.useState(null),[m,y]=c.useState("По собственному желанию"),[b,o]=c.useState(null),S=u!=null?u:!1,{id:D}=h(),j=+D;return c.useEffect(()=>{i&&v&&!a&&l(B(i,v,j,s,p,n,t,e,r,m,y,b,o))},[i,j,a,s,n,e,m,b]),g.jsx(F,{isDone:S,children:!!d&&!!l&&g.jsxs(G,{children:[g.jsx(I,{...d,collapsed:S,setData:l}),g.jsx(O,{text:"Отправить",action:()=>q(k.DISMISSAL,[d],f),isLoading:a,completed:u,setCompleted:f,repeatable:!1,buttonSuccessText:"Отправлено",isDone:S,isActive:L(d)&&((N=(x=d.optionalCheckbox)==null?void 0:x.value)!=null?N:!0),alerts:!1})]})})};export{M as default};
